//>>built
define("com/huayun/thematicmap/thematicWidget/SupplyContainer","require dojo/_base/declare dojo/dom dojo/dom-class dojo/dom-construct dojo/request dojo/on dojo/query ../../facades/PowerFacade ../../thematicmap/tool/Treedata dijit/_WidgetBase dijit/_TemplatedMixin dijit/_OnDijitClickMixin dojo/text!../widget/templates/power-supply.html".split(" "),function(f,p,k,g,e,q,n,m,r,t,u,v,w,x){return p("",[u,v,w],{templateString:x,baseClass:"power-supply",picUrl:f.toUrl("com/huayun/webgis/css/images/power/sign_close.png"),
pic1Url:f.toUrl("com/huayun/webgis/css/images/power/greencircle.png"),pic2Url:f.toUrl("com/huayun/webgis/css/images/power/close.png"),pic3Url:f.toUrl("com/huayun/webgis/css/images/power/greenp.png"),constructor:function(a){this.map=a.map;this.view=this.map.view;this.data={appendDY:"true",mapID:"",opStatus:"true",returnFilter:{className:""},startID:"",topoType:"",userBean:{buro:"",dynamic:"true"}};this._powerFacade=new r;this._treedata=new t;this.url="http://10.136.35.108:8082/topo-server/topoCenter/normalServices/supplyArea";
this.mixUrl="http://10.136.35.108:8082/vdc/dataService/t_dxt_mergerel";this.dicUrl="http://gateway.test.cloud.zj.sgcc.com.cn/vdc/dataService/META_MODEL_CLASS?access_token\x3db99e03be-dd1e-428b-aeea-d12bdab254d6";this.devs=[];this.click=null;this.heightLight=[];this.showMes=[];this.treeData=this.currGraphic=this.dicArray=null},postCreate:function(){q.get(this.dicUrl,{handleAs:"json"}).then(function(a){this.dicArray=a}.bind(this))},onSupplyClose:function(){this.domNode.style.display="none";this.restore()},
onSupplyCloseDev:function(){this.restore()},onSupplySelect:function(){event.stopPropagation();event.preventDefault();g.add(m(".webgis-root")[0],"changeCursor");g.add(this.ownerDocumentBody,"changeCursor");this.click&&(this.click.remove(),this.click=null);this.click=n(this.view.domNode,"click",function(a){a=this.view.screenToGeometry(a.clientX,a.clientY);var b=this.view.queryGraphicsByGeometry(a,5);if(0<b.length){var f,l,m;a=0;for(b=b[0].feature.attributes;a<b.length;a++)"map_id"===b[a].name&&(f=b[a].value),
"dev_id"===b[a].name&&(l=b[a].value),"name"===b[a].name&&(m=b[a].value);this.data.mapID=f.toString();this.data.startID=l;k.byId("devSelectName").innerHTML=m;e.empty(k.byId("extentShow"));this.delCursor();this.click.remove();this.click=null;if(0<this.heightLight.length){for(l=0;l<this.heightLight.length;l++)this.heightLight[l].glow=null;this.view.threeRender()}this._powerFacade.getPowerExtentData(this.url,this.data,function(a){if(null!==a.data&&0<a.data.length){this.devs=[];this.heightLight=[];this.showMes=
[];for(var b=0;b<a.data.length;b++)-1===this.devs.indexOf(a.data[b].devID)&&this.devs.push(a.data[b].devID);this._powerFacade.getMixtureData(this.mixUrl+"?map_id\x3d"+f+"\x26REL_DEV_ID\x3d"+this.devs,function(a){for(var c=0;c<a.data.length;c++){var b=a.data[c].MERGE_FID;-1===this.devs.indexOf(b)&&this.devs.push(b)}for(c=0;c<this.devs.length;c++){var d=this.view.queryGraphicByDevId(this.devs[c]);if(null!==d){this.heightLight.push(d);a={};b=0;for(d=d.feature.attributes;b<d.length;b++)"name"===d[b].name&&
(a.name=d[b].value),"dev_id"===d[b].name&&(a.devId=d[b].value),"class_id"===d[b].name&&(a.classId=d[b].value);this.showMes.push(a)}}for(c=0;c<this.heightLight.length;c++)this.heightLight[c].glow={color:"#0ce386"};this.view.threeRender();this.treeData=this._treedata.getParentData(this.dicArray.data,this.showMes);for(var h in this.treeData){a=e.create("div",{class:"simpleShowCon"},k.byId("extentShow"));c=e.create("div",{class:"treeBtn"},a);e.create("span",{class:"pic"},c);e.create("span",{class:"picName",
innerHTML:h},c);b=e.create("div",{class:"showMes"},a);for(c=0;c<this.treeData[h].length;c++){var d=e.create("div",{class:"oneDev"},b),d=e.create("table",{class:"table"},d),f=e.create("tr",{class:"simpleShowP",devId:this.treeData[h][c].devId},d);e.create("td",{innerHTML:"\u540d\u79f0",class:"tdTitle",devId:this.treeData[h][c].devId},f);e.create("td",{innerHTML:this.treeData[h][c].name,devId:this.treeData[h][c].devId},f);d=e.create("tr",{class:"simpleShowP",devId:this.treeData[h][c].devId},d);e.create("td",
{innerHTML:"\u8d44\u6e90ID",class:"tdTitle",devId:this.treeData[h][c].devId},d);e.create("td",{innerHTML:this.treeData[h][c].devId,devId:this.treeData[h][c].devId},d)}n(a,"click",function(a){"pic"===a.target.getAttribute("class")?(g.remove(a.target,"pic"),g.add(a.target,"picOpen"),a.target.parentNode.nextElementSibling.style.display="block"):"picOpen"===a.target.getAttribute("class")&&(g.remove(a.target,"picOpen"),g.add(a.target,"pic"),a.target.parentNode.nextElementSibling.style.display="none");
"td"===a.target.localName&&(this.currGraphic&&(this.currGraphic.glow={color:"#0ce386"},this.view.threeRender()),(a=this.view.queryGraphicByDevId(a.target.getAttribute("devId")))?(this.view.setCenter(a.position,null,this.view.resolution),a.glow={color:"red"},this.view.threeRender()):alert("\u6b64\u56fe\u65e0\u8be5\u8bbe\u5907"),this.currGraphic=a);g.add(k.byId("extentShow"),"showScroll")}.bind(this))}}.bind(this),function(a){})}}.bind(this),function(a){})}}.bind(this))},restore:function(){this.click&&
(this.click.remove(),this.click=null);this.delCursor();this.resetDiv()},delCursor:function(){g.remove(m(".webgis-root")[0],"changeCursor");g.remove(this.ownerDocumentBody,"changeCursor")},resetDiv:function(){k.byId("devSelectName").innerHTML="\u8bf7\u9009\u62e9\u8bbe\u5907";e.empty(k.byId("extentShow"));g.remove(k.byId("extentShow"),"showScroll");if(0<this.heightLight.length){for(var a=0;a<this.heightLight.length;a++)this.heightLight[a].glow=null;this.view.threeRender()}}})});