//>>built
define("com/huayun/thematicmap/thematicWidget/TrackContainer","require dojo/_base/declare dojo/dom dojo/dom-class dojo/dom-construct dojo/request dojo/on dojo/query ../../facades/PowerFacade ../../thematicmap/tool/Treedata dijit/_WidgetBase dijit/_TemplatedMixin dijit/_OnDijitClickMixin dojo/text!../widget/templates/power-point-tracking.html".split(" "),function(g,p,k,h,e,q,m,n,r,t,u,v,w,x){return p(" ",[u,v,w],{templateString:x,baseClass:"power-track",picUrl:g.toUrl("com/huayun/webgis/css/images/power/sign_close.png"),
pic1Url:g.toUrl("com/huayun/webgis/css/images/power/greencircle.png"),pic2Url:g.toUrl("com/huayun/webgis/css/images/power/close.png"),pic3Url:g.toUrl("com/huayun/webgis/css/images/power/greenp.png"),constructor:function(e){this.map=e.map;this.view=this.map.view;this.data={endID:"",mapID:"",opStatus:"true",startID:"",type:"",userBean:{buro:"",dynamic:"true"}};this._powerFacade=new r;this._treedata=new t;this.url=e.getUrl;this.mixUrl="http://10.136.35.108:8082/vdc/dataService/t_dxt_mergerel";this.dicUrl=
"http://gateway.test.cloud.zj.sgcc.com.cn/vdc/dataService/META_MODEL_CLASS?access_token\x3db99e03be-dd1e-428b-aeea-d12bdab254d6";this.devs=[];this.click=null;this.heightLight=[];this.showMes=[];this.currGraphic=this.treeData=this.dicArr=null},postCreate:function(){q.get(this.dicUrl,{handleAs:"json"}).then(function(e){this.dicArr=e}.bind(this))},onClose:function(){this.domNode.style.display="none";this.restore()},onCloseDev:function(){this.restore()},onSelect:function(d){d.stopPropagation();d.preventDefault();
h.add(n(".webgis-root")[0],"changeCursor");h.add(this.ownerDocumentBody,"changeCursor");this.click&&(this.click.remove(),this.click=null);this.click=m(this.view.domNode,"click",function(a){a=this.view.screenToGeometry(a.clientX,a.clientY);var b=this.view.queryGraphicsByGeometry(a,5);if(0<b.length){var d,l,g;a=0;for(b=b[0].feature.attributes;a<b.length;a++)"map_id"===b[a].name&&(d=b[a].value),"dev_id"===b[a].name&&(l=b[a].value),"name"===b[a].name&&(g=b[a].value);this.data.mapID=d.toString();this.data.startID=
l;k.byId("equName").innerHTML=g;e.empty(k.byId("mesListShow"));this.delCursor();this.click.remove();this.click=null;if(0<this.heightLight.length){for(l=0;l<this.heightLight.length;l++)this.heightLight[l].glow=null;this.view.threeRender()}this._powerFacade.getPowerPointData(this.url+"/searchPower",this.data,function(a){if(null!==a.data&&0<a.data.length){this.devs=[];this.heightLight=[];this.showMes=[];for(var b=0;b<a.data.length;b++)-1===this.devs.indexOf(a.data[b].devID)&&this.devs.push(a.data[b].devID);
this._powerFacade.getMixtureData(this.mixUrl+"?map_id\x3d"+d+"\x26REL_DEV_ID\x3d"+this.devs,function(a){for(var c=0;c<a.data.length;c++){var b=a.data[c].MERGE_FID;-1===this.devs.indexOf(b)&&this.devs.push(b)}for(c=0;c<this.devs.length;c++){var f=this.view.queryGraphicByDevId(this.devs[c]);if(null!==f){this.heightLight.push(f);a={};b=0;for(f=f.feature.attributes;b<f.length;b++)"name"===f[b].name&&(a.name=f[b].value),"dev_id"===f[b].name&&(a.devId=f[b].value),"class_id"===f[b].name&&(a.classId=f[b].value);
this.showMes.push(a)}}for(c=0;c<this.heightLight.length;c++)this.heightLight[c].glow={color:"#0ce386"};this.view.threeRender();this.treeData=this._treedata.getParentData(this.dicArr.data,this.showMes);for(var d in this.treeData){a=e.create("div",{class:"simpleShowCon"},k.byId("mesListShow"));c=e.create("div",{class:"treeBtn"},a);e.create("span",{class:"pic"},c);e.create("span",{class:"picName",innerHTML:d},c);b=e.create("div",{class:"showMes"},a);for(c=0;c<this.treeData[d].length;c++){var f=e.create("div",
{class:"oneDev"},b),f=e.create("table",{class:"table"},f),g=e.create("tr",{class:"simpleShowP",devId:this.treeData[d][c].devId},f);e.create("td",{innerHTML:"\u540d\u79f0",class:"tdTitle",devId:this.treeData[d][c].devId},g);e.create("td",{innerHTML:this.treeData[d][c].name,devId:this.treeData[d][c].devId},g);f=e.create("tr",{class:"simpleShowP",devId:this.treeData[d][c].devId},f);e.create("td",{innerHTML:"\u8d44\u6e90ID",class:"tdTitle",devId:this.treeData[d][c].devId},f);e.create("td",{innerHTML:this.treeData[d][c].devId,
devId:this.treeData[d][c].devId},f)}m(a,"click",function(a){"pic"===a.target.getAttribute("class")?(h.remove(a.target,"pic"),h.add(a.target,"picOpen"),a.target.parentNode.nextElementSibling.style.display="block"):"picOpen"===a.target.getAttribute("class")&&(h.remove(a.target,"picOpen"),h.add(a.target,"pic"),a.target.parentNode.nextElementSibling.style.display="none");"td"===a.target.localName&&(this.currGraphic&&(this.currGraphic.glow={color:"#0ce386"},this.view.threeRender()),(a=this.view.queryGraphicByDevId(a.target.getAttribute("devId")))?
(this.view.setCenter(a.position,null,this.view.resolution),a.glow={color:"red"},this.view.threeRender()):alert("\u6b64\u56fe\u65e0\u8be5\u8bbe\u5907"),this.currGraphic=a);h.add(k.byId("mesListShow"),"showScroll")}.bind(this))}}.bind(this),function(a){})}}.bind(this),function(a){})}}.bind(this))},restore:function(){this.click&&(this.click.remove(),this.click=null);this.delCursor();this.resetDiv()},delCursor:function(){h.remove(n(".webgis-root")[0],"changeCursor");h.remove(this.ownerDocumentBody,"changeCursor")},
resetDiv:function(){k.byId("equName").innerHTML="\u8bf7\u9009\u62e9\u8bbe\u5907";e.empty(k.byId("mesListShow"));h.remove(k.byId("mesListShow"),"showScroll");if(0<this.heightLight.length){for(var d=0;d<this.heightLight.length;d++)this.heightLight[d].glow=null;this.view.threeRender()}}})});