//>>built
define("com/huayun/edit/EditModule","dojo/promise/first ./ConfigLoader ../util/JSONFormatterUtil ../vo/DataSourceVo ../vo/DiagramVo ./components/ToolBarPanel ./components/FeatureTemplatePanel ./components/EditPanel ./components/PropertyPanel ./tool/EditController".split(" "),function(w,l,m,n,p,q,r,t,u,v){function b(a){this.configLoader=new l(a);this.container=a.container;this.token=a.accessToken;this.filter=a.deviceParams;this.mapId=a.deviceParams.mapId;this.toolBarWarp=document.createElement("div");
this.toolBarWarp.id="tool-bar-wrap";this.featureTemplateWrap=document.createElement("div");this.featureTemplateWrap.id="feature-template-wrap";this.editMapWrap=document.createElement("div");this.editMapWrap.id="edit-map-wrap";this.propertyWrap=document.createElement("div");this.propertyWrap.id="property-wrap";this.container.appendChild(this.toolBarWarp);this.container.appendChild(this.featureTemplateWrap);this.container.appendChild(this.editMapWrap);this.container.appendChild(this.propertyWrap);this.currentSelectedGraphic=
this.propertyPanel=this.editPanel=this.currentSelected=null;this.currentEditState="";this.editController=new v}b.prototype.creationComplete=function(){return this.configLoader.load().then(function(a){var b=a[0].data,c=a[1].data,d=a[2].data;a=a.slice(3,a.length);for(var f=0;f<a.length;f++)for(var g=a[f].data,e=0;e<g.length;e++)if(g[e]){var h=g[e].symbols;if(h)for(var k=0;k<h.length;k++)m.merge(b,h[k])}b=new n(c);d=new p(d,a);c=d.environmentVo.bgColor;this.createToolBarPanel();this.createFeatureTemplate(d.mapVo.layerVoList);
this.createEidtPanel(b,d.mapVo,c);this.createPropertyPanel()}.bind(this))};b.prototype.createToolBarPanel=function(){new q({container:this.toolBarWarp,buttonSelectedHook:this.buttonSelectedHook.bind(this)})};b.prototype.createFeatureTemplate=function(a){new r({container:this.featureTemplateWrap,layers:a,selectedHook:this.selectedHook.bind(this)})};b.prototype.createEidtPanel=function(a,b,c){this.editPanel=new t({container:this.editMapWrap,dataSourceVo:a,mapVo:b,token:this.token,bgColor:c,filter:this.filter,
currentEditTarget:this.currentSelected,editController:this.editController,mapId:this.mapId,addComplete:this.addComplete.bind(this),selectedHook:this.selectedHookOfEditPanel.bind(this)})};b.prototype.createPropertyPanel=function(){this.propertyPanel=new u({container:this.propertyWrap,currentEditTarget:this.currentSelected})};b.prototype.selectedHook=function(a){this.currentSelected=a.data;this.editPanel.update({currentEditTarget:this.currentSelected,type:a.type});this.propertyPanel.currentEditTarget=
this.currentSelected};b.prototype.selectedHookOfEditPanel=function(a){this.currentSelectedGraphic=a;this.propertyPanel.update(a.feature.attributes)};b.prototype.buttonSelectedHook=function(a){this.currentEditState=a;switch(a){case "\u9009\u62e9":this.currentSelected=null;this.editPanel.currentEditTarget=null;break;case "\u5220\u9664":this.propertyPanel.update(null),this.editPanel.delete(this.currentSelectedGraphic)}};b.prototype.addComplete=function(a){this.propertyPanel.update(a)};return b});