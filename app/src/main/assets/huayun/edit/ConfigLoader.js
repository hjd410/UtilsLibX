//>>built
define("com/huayun/edit/ConfigLoader",["dojo/Deferred","dojo/request","dojo/promise/all","../util/JSONFormatterUtil"],function(_1,_2,_3,_4){function _5(_6){this.config=_6.config;this.root=this.config.root;this.styles=this.config.styles;this.templateXml=this.config.map;this.x2js=new X2JS();};_5.prototype.load=function(){var _7=[];_7.push(this._baseStyleRequest.call(this));_7.push(this._dataSourceRequest.call(this));_7.push(this._mapRequest.call(this));this._stylesRequest(_7);return _3(_7);};_5.prototype._baseStyleRequest=function(){var _8=new _1();_2(this.root+"baseStyle.xml").then.call(this,function(_9){var _a=this.x2js.xml_str2json(_9).style;var _b=[];for(var _c in _a){if(_a.hasOwnProperty(_c)){_b[_b.length]=_4.formatterKey(_a[_c]);}}_8.resolve({data:_b,type:"baseStyle"});}.bind(this));return _8.promise;};_5.prototype._dataSourceRequest=function(){var _d=new _1();_2(this.root+"data/dataSource.xml").then.call(this,function(_e){var _f=[];var _10=this.x2js.xml_str2json(_e).cat.dataSources.dataSource;if(Array.isArray(_10)){_f=_10;}else{_f.push(_10);}_d.resolve({data:_f,type:"dataSource"});}.bind(this));return _d.promise;};_5.prototype._mapRequest=function(){var _11=new _1();_2(this.root+"maps/"+this.templateXml).then.call(this,function(_12){var aaa=this.x2js.xml_str2json(_12);var _13=this.x2js.xml_str2json(_12).cat;_11.resolve({data:_13,type:"map"});}.bind(this));return _11.promise;};_5.prototype._stylesRequest=function(_14){for(var i=0;i<this.styles.length;i++){var _15=function(i){var _16=new _1();var _17=this.styles[i];_2(this.root+"style/"+_17).then(function(_18){var reg=/(\w+)\.(xml)$/;if(reg.test(_17)){var _19=RegExp.$1;var _1a=this.x2js.xml_str2json(_18).styles;var _1b=[];for(var key in _1a){if(_1a.hasOwnProperty(key)){var _1c=_1a[key].style;if(typeof _1c!=="undefined"){this._formatterOneTypeStyle(_1c,_1b);}}}_16.resolve({data:_1b,type:"style",name:_19});}else{}}.bind(this));return _16.promise;}.call(this,i);_14.push(_15);}};_5.prototype._formatterOneTypeStyle=function(_1d,_1e){if(Array.isArray(_1d)){for(var _1f in _1d){if(_1d.hasOwnProperty(_1f)){var _20=_1d[_1f];_1e.push(this._formatterOneStyle(_20));}}}else{_1e.push(this._formatterOneStyle(_1d));}};_5.prototype._formatterOneStyle=function(_21){if(!_21){return;}var _22=Object.keys(_21);var _23={"symbols":[]};for(var i=0;i<_22.length;i++){var key=_22[i];var _24=_21[key];if(Object.prototype.toString.call(_24)==="[object String]"){var _25=Object.keys(_4.formatterKey(_21));for(var _26 in _25){if(_25.hasOwnProperty(_26)){var _27=_25[_26];_23[_27]=_4.formatterKey(_21)[_27];}}}else{if(Object.prototype.toString.call(_24)==="[object Array]"){var _28=[];for(var j=0;j<_24.length;j++){var _29=_24[j];_28[j]=_4.formatterKey(_29);}_23["symbols"]=_28;}else{if(Object.prototype.toString.call(_24)==="[object Object]"){_23["symbols"].push(_4.formatterKey(_24));}}}}return _23;};return _5;});