//>>built
define("com/huayun/edit/components/FeatureTemplatePanel",["../../webgis/Viewpoint","../../webgis/Graphic","../../webgis/Feature","../../webgis/gl/Context","../../webgis/symbols/CompositeMarkSymbol","../../webgis/symbols/CompositeLineSymbol","../../webgis/symbols/CompositeFillSymbol","../../webgis/symbols/CircleSymbol","../../webgis/symbols/LineSymbol","../../webgis/symbols/FontSymbol","../../webgis/symbols/PolygonSymbol","../../webgis/symbols/DecorationLineSymbol","../../webgis/geometry/Point","../../webgis/geometry/Polyline","../../webgis/geometry/Polygon","../../webgis/renderer/LineRenderer","../../webgis/renderer/FontRenderer","../../webgis/renderer/DecorationLineRenderer","../../webgis/renderer/CompositeMarkerRenderer","../../webgis/renderer/CompositeLineRenderer","../../webgis/renderer/CompositeFillRenderer"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e,_f,_10,_11,_12,_13,_14,_15){function _16(_17){this.container=_17.container;this.layers=_17.layers;this.width=this.container.clientWidth;this.height=this.container.clientHeight;this.graphicList=[];this.selectedHook=_17.selectedHook;var _18=document.createElement("canvas");_18.width=this.width;_18.height=this.height;this.webglContext=_18.getContext("webgl");this.container.appendChild(_18);this.liDiv=document.createElement("div");this.liDiv.id="feature-template-content";this.liDiv.style.width=(this.width-50)+"px";this.liDiv.style.height=this.height+"px";this.container.appendChild(this.liDiv);this.labelUl=document.createElement("ul");this.liDiv.appendChild(this.labelUl);this.liDiv.addEventListener("click",function(evt){this.selectedHook.call(this,{data:evt.target.data,type:"add"});}.bind(this));var _19=new _4(this.webglContext);this.view={width:this.width,height:this.height,resolution:1,scale:1,context:_19,threeRender:function(){this.graphicList.forEach(function(_1a){_1a.renderer.draw(this.view,_1a,_1a.feature.geometry,_1a.symbol);}.bind(this));}.bind(this)};var _1b=new _1(this.view.width,this.view.height,0,0,0,0,0,this.view);this.view.viewpoint=_1b;_1b.center=[200,450];_1b.resolution=1;_1b.calcMatrix(false);this.createFeatureTemplate();this.view.threeRender();};_16.prototype.createFeatureTemplate=function(){var _1c=1;for(var i=0,len=this.layers.length;i<len;i++){var _1d=this.layers[i];var _1e=_1d.rules[0];var _1f=_1e.styles;var _20=typeof _1e.propertyName==="undefined"?"":_1e.propertyName.toLowerCase();var _21=this.getPropertyNameList(_20);var _22=this.getFeaturesTemplates(_21,_1d.featureTemplates);var _23=this.getSymbols(_22,_1f);for(var j=0;j<_23.length;j++){var _24=_23[j].style;var _25=_24.symbol;var _26=_23[j].fields;var _27=this.createAttributeFromFields(_26);if(_25[0].baseid==="p_font_style"){_25[0]["font-size"]=24;}else{_25[0]["r"]=10;}_25.isFixed=_1e.isFixed;var _28=this.createGeometry(_24.type,_1c);var _29=this.createCompositeSymbol(_24.type,_25);var _2a=this.createCompositeSymbol(_24.type,_25);var _2b=new _2({feature:new _3({attributes:_27,geometry:_28}),symbol:_29});var _2c=this.createRenderer(_24.type);_2c.add(this.view,_2b,_28,_29);_2b.renderer=_2c;this.graphicList.push(_2b);_1c++;this.createLabel({name:_1d.name,attributes:_2b.feature.attributes,viewId:_1d.dataSource.viewId,symbol:_2a,fields:_26});}}};_16.prototype.getPropertyNameList=function(_2d){return _2d.split(",");};_16.prototype.getFeaturesTemplates=function(_2e,_2f){var _30=[];for(var i=0;i<_2f.length;i++){var _31=_2f[i];var _32=_31.fields;var _33=[];for(var j=0;j<_32.length;j++){var _34=_32[j];if(_2e.indexOf(_34.name)!==-1){if(_33.indexOf(_34.defaultValue)===-1){_33.push(_34.defaultValue);}}}var _35=_33.toString();if(_31.propertyValue===_35){_30.push(_31);}}return _30;};_16.prototype.getSymbols=function(_36,_37){var _38=[];for(var i=0;i<_36.length;i++){var _39=_36[i];var _3a=_39.propertyValue===""?_39.propertyValue="DefaultValue":_39.propertyValue;for(var j=0;j<_37.length;j++){var _3b=_37[j];if(_3a===_3b.propertyValue||_3b.propertyValue===""){_38.push({style:_3b,fields:_39.fields});break;}}}return _38;};_16.prototype.createAttributeFromFields=function(_3c){var _3d=[];for(var i=0;i<_3c.length;i++){var _3e=_3c[i];_3d.push({name:_3e.name,value:_3e.defaultValue});}return _3d;};_16.prototype.createRenderer=function(_3f){var _40=null;switch(_3f){case "point":_40=new _13();break;case "line":_40=new _14();break;case "polygon":_40=new _15();break;}return _40;};_16.prototype.createCompositeSymbol=function(_41,_42){var _43=null;switch(_41){case "point":_43=new _5({symbol:_42});break;case "line":_43=new _6({symbol:_42});break;case "polygon":_43=new _7({symbol:_42});break;}return _43;};_16.prototype.createGeometry=function(_44,_45){var _46=null;switch(_44){case "point":_46=new _d(30,this.height-40*_45);break;case "line":_46=new _e([[new _d(30,this.height-40*_45),new _d(50,this.height-40*_45)]]);break;case "polygon":_46=new _f([[new _d(30,this.height-40*_45),new _d(50,this.height-40*_45),new _d(50,this.height-40*_45-20),new _d(30,this.height-40*_45-20),new _d(30,this.height-40*_45)]]);break;}return _46;};_16.prototype.createLabel=function(_47){var li=document.createElement("li");li.innerText=_47.name;li.data=_47;this.labelUl.appendChild(li);};return _16;});