//>>built
define("com/huayun/module/supportClass/SimpleMapModule3D",["dojo/_base/declare","dojo/dom-style","dojo/topic","../../util/ClassFacotry","./BaseMapModule","../../webgis/Map","../../webgis/views/SceneView","../../webgis/layers/GraphicLayer","../../webgis/facade/MapConfigFacade","../../webgis/geometry/Extent","../../webgis/layers/TerrainLayer"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b){return _1("com.huayun.module.supportClass.SimpleMapModule3D",[_5],{_mapConfigFacade:"",_layerList:{TileMapServiceLayer:{clazz:"com.huayun.webgis.layers.TileLayer",id:"tile"},VectorTileLayer:{clazz:"com.huayun.webgis.layers.VectorTileLayer",id:"vector"},VectorBuildLayer:{clazz:"com.huayun.webgis.layers.VectorBuildingLayer",id:"build"},PowerLayer:{clazz:"com.huayun.webgis.layers.MapImageLayer",id:"power"},HeatmapLayer:{clazz:"com.huayun.webgis.layers.HeatmapLayer",id:"heatmap"},TerrainLayer:{clazz:"com.huayun.webgis.layers.TerrainLayer",id:"tile"}},constructor:function(){_3.subscribe("mapLoadComplete",function(){this._mapLoadCompleteHandler();}.bind(this));},postCreate:function(){this.inherited(arguments);_2.set(this.domNode,"position","absolute");_2.set(this.domNode,"pointer-events","all");},startup:function(){this.inherited(arguments);},doInit:function(){var _c=this.get("configUrl");this._mapConfigFacade=new _9({url:_c});this._mapConfigFacade.getMapConfigData(function(_d){this.map=new _6({id:"map"});this.view=new _7({is3DVision:_d.map.properties.is3D,rotateEnabled:_d.map.properties.rotateEnabled,container:this.domNode,map:this.map,backgroundColor:_d.environment.bgColor.fill,maxPitch:_d.map.properties.maxPitch,maxLevel:_d.map.properties.maxLevel});this._createLayer(_d.map.layers,this.view,function(){var _e=this._getInitialExtent(_d.map);this.view.setExtent(_e);_3.publish("layerComplete",this);}.bind(this));}.bind(this),function(_f){});},_getInitialExtent:function(map){var _10=map.properties.initialExtent;return new _a(_10.minX,_10.minY,_10.maxX,_10.maxY);},_createLayer:function(_11,_12,_13){var len=_11.length,_14=0;_15.call(this,_14);function _15(_16){if(_16<len){var _17=_11[_16],_18=null,_19="";if(typeof _17.clazz==="undefined"){_19=this._layerList[_17.type].clazz;}else{_19=_17.clazz;}_18=new _4({clazz:_19});_18.newInstance({name:_17.name,id:this._layerList[_17.type].id||_17.id,url:_17["dataSource"].serviceURL,visible:_17.visible,options:_17,imageUrl:_17["dataSource"].imageUrl},function(_1a){this.map.addLayer(_1a);if(_1a instanceof _b){_12.ground=_1a;}_16++;_15.call(this,_16);}.bind(this),true);}else{var _1b=new _8({name:"画图图层",id:"drawLayer",visible:true,controlEnabled:false});this.map.addLayer(_1b);_13();}};},_mapLoadCompleteHandler:function(){}});});