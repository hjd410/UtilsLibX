//>>built
define("com/huayun/framework/context/BaseContext",["dojo/_base/declare","../../util/HashTable","../../util/StringHelp","../../framework/vo/BeanVo","../../util/ClassFacotry","../../util/BaseGetAndSet"],function(_1,_2,_3,_4,_5,_6){return _1("com.huayun.framework.context.BaseContext",[_6],{constructor:function(){this.parentContext=null;this._hash=new _2();this._config=new _2();this._singleCache={};this._beanHash=new _2();},_setHashAttr:function(_7){this._hash=_7;},_getHashAttr:function(){return this._hash;},_setParentContextAttr:function(_8){this.parentContext=_8;},_setConfigAttr:function(_9){this._config=_9;},createBean:function(_a){}.bind(this),gengeBean:function(_b,_c){var _d=_b.clazz;var _e=new _5({clazz:_d});var _f=[];var _10=/^\$\{(.*)\}$/;for(var i=0;i<_b.constructorArgs.length;i++){var arg=_b.constructorArgs[i];if(_10.test(arg)){arg=_3.extractProerty(arg);arg=this.findConfigvalue(arg);}_f.push(arg);}var _11=_3.isSpace(_b.identifyId)?"":_b.identifyId;var _12;if(!_b.isSingle&&_11===""){if(_3.isSpace(this._beanHash.get(_b.id))){_12={params:_f,id:_b.id+_11,identifyId:_b.identifyId};}else{_12={params:_f,id:_b.id+(new Date()).getTime(),identifyId:_b.identifyId};}}else{_12={params:_f,id:_b.id+_11,identifyId:_b.identifyId};}_e.newInstance(_12,function(_13){this.beanProcess(_b,_13);_c(_13);}.bind(this));},beanProcess:function(_14,_15){var reg=/^\$\{(.*)\}$/;if(!_3.isSpace(_14.propertys)){for(var i=0;i<_14.propertys.length;i++){var _16=_14.propertys[i].type;var _17=_14.propertys[i].name;var _18=_14.propertys[i].value;if(reg.test(_18)){_18=_3.extractProerty(_18);_18=this.findConfigvalue(_18);}switch(_16){case "ref":var _19=this._hash.get(_18).identifyId;~function(_1a,_1b,_1c,_1d){this.getBean(_1c,_1d,function(_1e){_1a[_1b]=_1e;});}.call(this,_15,_17,_18,_19);break;case "number":_15[_17]=Number(_18);break;default:_15[_17]=_18;}}}if(_15!==null&&_15.declaredClass==="com.huayun.framework.context.BaseContext"){_15.set("hash",this.get("hash"));_15.parentContext=this;}else{_15.context=this;_15.startBean();}},getBean:function(_1f,_20,_21){var _22=null;var _23=this.declaredClass;if(_1f==="baseContext"&&_23!=="com.huayun.framework.context.GlobalContext"){return this;}if(!_3.isSpace(this._hash.get(_1f))){var _24=this._hash.get(_1f);if(!_3.isSpace(_20)){_24.identifyId=_20;}if(_24.isSingle){if(this._singleCache[_1f]){_22=this._singleCache[_1f];}else{if(_22==null&&this.parentContext){_22=this.parentContext.lookUp(_1f);}if(_3.isSpace(_22)){this.gengeBean(_24,function(_25){_22=_25;this._singleCache[_1f]=_22;_21(_22);if(_22==null&&this.parentContext){_22=this.parentContext.getBean(_1f,_20);}if(_22==null){}}.bind(this));}}}else{this.gengeBean(_24,function(_26){_22=_26;if(_3.isSpace(this._beanHash.get(_1f))){this._beanHash.put(_1f,[_22]);}else{this._beanHash.get(_1f).push(_22);}_21(_22);if(_22==null&&this.parentContext){_22=this.parentContext.getBean(_1f,_20);}if(_22==null){}}.bind(this));}}else{}},getBeanEx:function(_27,_28,_29){var _2a=null;if(this.parentContext.declaredClass==="com.huayun.framework.context.GlobalContext"){if(this._hash.get(_27)!==null||this.parentContext.get("hash").get(_27)!==null){_2a=this._hash.get(_27);if(!_2a){debugger;}if(_2a.type!=="module"){this.getBean(_27,_28,function(_2b){_29(_2b);});}}else{console.error("对应的bean类型没有定义"+_27);}}else{if(this._hash.get(_27)!==null){_2a=this._hash.get(_27);if(_2a.type!=="module"){this.getBean(_27,_28,function(_2c){_29(_2c);});}}else{console.error("对应的bean类型没有定义"+_27);}}},lookUp:function(_2d){var _2e=null;if(this._hash.containsKey(_2d)){if(this._hash.get(_2d).isSingle){_2e=this._singleCache[_2d];}else{if(this._beanHash.containsKey(_2d)){if(this._beanHash.get(_2d).length>0){_2e=this._beanHash.get(_2d)[0];}}}}if(_3.isSpace(_2e)&&this.parentContext){_2e=this.parentContext.lookUp(_2d);}return _2e;},lookUpBeans:function(_2f){var _30=null;if(this._beanHash.containsKey(_2f)){_30=this._beanHash.get(_2f);}if(this.parentContext){if(_30==null||_30.length===0){_30=this.parentContext.lookUpBeans(_2f);}}return _30;},lookUpOnlyOne:function(_31,_32){var _33=null;if(_3.isSpace(_32)){_33=this.lookUp(_31);}else{var _34=this.lookUpBeans(_31);if(_34!==null){for(var i=0;i<_34.length;i++){var _35=this._hash.get(_31);if(_35.identifyId===_32){_33=_34[i];break;}}}}if(_33===null&&this.parentContext){_33=this.parentContext.lookUpOnlyOne(_31,_32);}return _33;},doRealease:function(_36){var _37=true;var id=this._getBeanId(_36);if(id===null&&this.parentContext){this.parentContext.doRealease(_36);}else{if(id!==null){var _38=this._beanHash.get(id);if(_36===_38){this._beanHash.remove(id);}else{if(_38.constructor===Array){var _39=[];for(var i=0;i<_38.length;i++){var _3a=_38[i];if(_3a===_36){_37=false;}else{_39.push(_3a);}}this._beanHash.put(id,_39);}}}else{_37=false;}}return _37;},doRealeaseBeans:function(_3b){for(var i=0;i<_3b.length;i++){var _3c=_3b[i];this.doRealease(_3c);}return true;},findConfigvalue:function(key){var _3d;_3d=this._config.get(key);if(_3.isSpace(_3d)&&this.parentContext){_3d=this.parentContext.findConfigvalue(key);}return _3d;},_getBeanId:function(_3e){var _3f=null;for(var i=0;i<this._beanHash.size();i++){var key=this._beanHash.getKeyList()[i];var _40=this._beanHash.get(key);for(var j=0;j<_40.length;j++){var _41=_40[j];if(_3e===_41){_3f=key;break;}}}return _3f;}});});