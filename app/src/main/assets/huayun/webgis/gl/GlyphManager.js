//>>built
define("com/huayun/webgis/gl/GlyphManager",["../utils/utils","../utils/image","../utils/Constant","../utils/loadGlyphRange","../utils/TinySDF"],function(_1,_2,_3,_4,_5){var _6=function _6(_7){this.localIdeographFontFamily=_7;this.entries={};};_6.prototype.setURL=function setURL(_8){this.url=_8;};_6.prototype.getGlyphs=function getGlyphs(_9,_a){var _b=this;var _c=[];for(var _d in _9){for(var i=0,_e=_9[_d];i<_e.length;i+=1){var id=_e[i];_c.push({stack:_d,id:id});}}_1.asyncAll(_c,function(_f,_10){var _11=_f.stack;var id=_f.id;var _12=_b.entries[_11];if(!_12){_12=_b.entries[_11]={glyphs:{},requests:{}};}var _13=_12.glyphs[id];if(_13!==undefined){_10(null,{stack:_11,id:id,glyph:_13});return;}_13=_b._tinySDF(_12,_11,id);if(_13){_10(null,{stack:_11,id:id,glyph:_13});return;}var _14=Math.floor(id/256);if(_14*256>65535){_10(new Error("glyphs > 65535 not supported"));return;}var _15=_12.requests[_14];if(!_15){_15=_12.requests[_14]=[];_6.loadGlyphRange(_11,_14,_b.url,function(err,_16){if(_16){for(var id in _16){_12.glyphs[+id]=_16[+id];}}for(var i=0,_e=_15;i<_e.length;i+=1){var cb=_e[i];cb(err,_16);}delete _12.requests[_14];});}_15.push(function(err,_17){if(err){_10(err);}else{if(_17){_10(null,{stack:_11,id:id,glyph:_17[id]||null});}}});},function(err,_18){if(err){_a(err);}else{if(_18){var _19={};for(var i=0,_e=_18;i<_e.length;i+=1){var ref=_e[i];var _1a=ref.stack;var id=ref.id;var _1b=ref.glyph;(_19[_1a]||(_19[_1a]={}))[id]=_1b&&{id:_1b.id,bitmap:_1b.bitmap.clone(),metrics:_1b.metrics};}_a(null,_19);}}});};_6.prototype._tinySDF=function _tinySDF(_1c,_1d,id){var _1e=this.localIdeographFontFamily;if(!_1e){return;}if(!_3.unicodeBlockLookup["CJK Unified Ideographs"](id)&&!_3.unicodeBlockLookup["Hangul Syllables"](id)&&!_3.unicodeBlockLookup["Hiragana"](id)&&!_3.unicodeBlockLookup["Katakana"](id)){return;}var _1f=_1c.tinySDF;if(!_1f){var _20="400";if(/bold/i.test(_1d)){_20="900";}else{if(/medium/i.test(_1d)){_20="500";}else{if(/light/i.test(_1d)){_20="200";}}}_1f=_1c.tinySDF=new _5(24,3,8,0.25,_1e,_20);}return {id:id,bitmap:new _2.AlphaImage({width:30,height:30},_1f.draw(String.fromCharCode(id))),metrics:{width:24,height:24,left:0,top:-8,advance:24}};};_6.loadGlyphRange=_4;_6.TinySDF=_5;return _6;});