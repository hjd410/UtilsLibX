//>>built
define("com/huayun/webgis/gl/ImageAtlas",["./potpack","./ImagePosition","../utils/image","../utils/Constant"],function(_1,_2,_3,_4){var _5=function _5(_6,_7){var _8={},_9={};this.haveRenderCallbacks=[];var _a=[];this.addImages(_6,_8,_a);this.addImages(_7,_9,_a);var _b=_1(_a);var w=_b.w;var h=_b.h;var _c=new _3.RGBAImage({width:w||1,height:h||1});for(var id in _6){var _d=_6[id];var _e=_8[id].paddedRect;_3.RGBAImage.copy(_d.data,_c,{x:0,y:0},{x:_e.x+_4.layout.padding,y:_e.y+_4.layout.padding},_d.data);}for(var _f in _7){var _10=_7[_f];var _11=_9[_f].paddedRect;var x=_11.x+_4.layout.padding,y=_11.y+_4.layout.padding,w$1=_10.data.width,h$1=_10.data.height;_3.RGBAImage.copy(_10.data,_c,{x:0,y:0},{x:x,y:y},_10.data);_3.RGBAImage.copy(_10.data,_c,{x:0,y:h$1-1},{x:x,y:y-1},{width:w$1,height:1});_3.RGBAImage.copy(_10.data,_c,{x:0,y:0},{x:x,y:y+h$1},{width:w$1,height:1});_3.RGBAImage.copy(_10.data,_c,{x:w$1-1,y:0},{x:x-1,y:y},{width:1,height:h$1});_3.RGBAImage.copy(_10.data,_c,{x:0,y:0},{x:x+w$1,y:y},{width:1,height:h$1});}this.image=_c;this.iconPositions=_8;this.patternPositions=_9;};_5.prototype.addImages=function addImages(_12,_13,_14){for(var id in _12){var src=_12[id];var bin={x:0,y:0,w:src.data.width+2*_4.layout.padding,h:src.data.height+2*_4.layout.padding};_14.push(bin);_13[id]=new _2(bin,src);if(src.hasRenderCallback){this.haveRenderCallbacks.push(id);}}};_5.prototype.patchUpdatedImages=function patchUpdatedImages(_15,_16){_15.dispatchRenderCallbacks(this.haveRenderCallbacks);for(var _17 in _15.updatedImages){this.patchUpdatedImage(this.iconPositions[_17],_15.getImage(_17),_16);this.patchUpdatedImage(this.patternPositions[_17],_15.getImage(_17),_16);}};_5.prototype.patchUpdatedImage=function patchUpdatedImage(_18,_19,_1a){if(!_18||!_19){return;}if(_18.version===_19.version){return;}_18.version=_19.version;var ref=_18.tl;var x=ref[0];var y=ref[1];_1a.update(_19.data,undefined,{x:x,y:y});};return _5;});