//>>built
define("com/huayun/webgis/gl/Program",["./VertexArrayObject"],function(_1){var _2=function _2(_3,_4,_5,_6,_7){if(!_7){_7=[];}var gl=_3.gl;this.program=gl.createProgram();var _8=_5.defines();var _9=_8.concat(_4.fragmentSource).join("\n");var _a=_8.concat(_4.vertexSource).join("\n");_a=_7.concat(_a).join("\n");_9=_7.concat(_9).join("\n");var _b=gl.createShader(gl.FRAGMENT_SHADER);gl.shaderSource(_b,_9);gl.compileShader(_b);var _c=gl.getShaderParameter(_b,gl.COMPILE_STATUS);var _d;if(!_c){_d=gl.getShaderInfoLog(_b);}gl.attachShader(this.program,_b);var _e=gl.createShader(gl.VERTEX_SHADER);gl.shaderSource(_e,_a);gl.compileShader(_e);_c=gl.getShaderParameter(_b,gl.COMPILE_STATUS);if(!_c){_d=gl.getShaderInfoLog(_b);}gl.attachShader(this.program,_e);var _f=_5.layoutAttributes||[];for(var i=0;i<_f.length;i++){gl.bindAttribLocation(this.program,i,_f[i].name);}gl.linkProgram(this.program);this.numAttributes=gl.getProgramParameter(this.program,gl.ACTIVE_ATTRIBUTES);this.attributes={};var _10={};for(var i$1=0;i$1<this.numAttributes;i$1++){var _11=gl.getActiveAttrib(this.program,i$1);if(_11){this.attributes[_11.name]=gl.getAttribLocation(this.program,_11.name);}}var _12=gl.getProgramParameter(this.program,gl.ACTIVE_UNIFORMS);for(var i$2=0;i$2<_12;i$2++){var _13=gl.getActiveUniform(this.program,i$2);if(_13){_10[_13.name]=gl.getUniformLocation(this.program,_13.name);}}this.fixedUniforms=_6(_3,_10);this.binderUniforms=_5.getUniforms(_3,_10);};_2.prototype.draw=function draw(_14,_15,_16,_17,_18,_19,_1a,_1b,_1c,_1d,_1e,_1f,_20,_21,_22,_23){var obj;var gl=_14.gl;_14.program.set(this.program);_14.setDepthMode(_16);_14.setStencilMode(_17);_14.setColorMode(_18);_14.setCullFace(_19);for(var _24 in this.fixedUniforms){this.fixedUniforms[_24].set(_1a[_24]);}if(_21){_21.setUniforms(_14,this.binderUniforms,_1f,{zoom:(_20)});}var _25=(obj={},obj[gl.LINES]=2,obj[gl.TRIANGLES]=3,obj[gl.LINE_STRIP]=1,obj)[_15];for(var i=0,_26=_1e.get();i<_26.length;i+=1){var _27=_26[i];var _28=_27.vaos||(_27.vaos={});var vao=_28[_1b]||(_28[_1b]=new _1());vao.bind(_14,this,_1c,_21?_21.getPaintVertexBuffers():[],_1d,_27.vertexOffset,_22,_23);gl.drawElements(_15,_27.primitiveLength*_25,gl.UNSIGNED_SHORT,_27.primitiveOffset*_25*2);}};_2.prototype.draw2=function draw2(_29,_2a,_2b,_2c,_2d,_2e,_2f,_30,_31,_32,_33,_34,_35,_36,_37,_38){var obj;var gl=_29.gl;_29.program.set(this.program);_29.setDepthMode(_2b);_29.setColorMode(_2d);_29.setCullFace(_2e);for(var _39 in this.fixedUniforms){this.fixedUniforms[_39].set(_2f[_39]);}if(_36){_36.setUniforms(_29,this.binderUniforms,_34,{zoom:(_35)});}var _3a=(obj={},obj[gl.LINES]=2,obj[gl.TRIANGLES]=3,obj[gl.LINE_STRIP]=1,obj)[_2a];for(var i=0,_3b=_33.get();i<_3b.length;i+=1){var _3c=_3b[i];var _3d=_3c.vaos||(_3c.vaos={});var vao=_3d[_30]||(_3d[_30]=new _1());vao.bind(_29,this,_31,_36?_36.getPaintVertexBuffers():[],_32,_3c.vertexOffset,_37,_38);gl.drawElements(_2a,_3c.primitiveLength*_3a,gl.UNSIGNED_SHORT,_3c.primitiveOffset*_3a*2);}};_2.prototype.draw3=function draw(_3e,_3f,_40,_41,_42,_43,_44,_45,_46,_47,_48,_49,_4a,_4b,_4c,_4d){var obj;var gl=_3e.gl;_3e.program.set(this.program);_3e.setDepthMode(_40);_3e.setStencilMode(_41);_3e.setColorMode(_42);_3e.setCullFace(_43);for(var _4e in this.fixedUniforms){this.fixedUniforms[_4e].set(_44[_4e]);}if(_4b){_4b.setUniforms(_3e,this.binderUniforms,_49,{zoom:(_4a)});}var _4f=(obj={},obj[gl.LINES]=2,obj[gl.TRIANGLES]=3,obj[gl.LINE_STRIP]=1,obj)[_3f];for(var i=0,_50=_48.get();i<_50.length;i+=1){var _51=_50[i];var _52=_51.vaos||(_51.vaos={});var vao=_52[_45]||(_52[_45]=new _1());vao.bind(_3e,this,_46,_4b?_4b.getPaintVertexBuffers():[],_47,_51.vertexOffset,_4c,_4d);_4b.setUniform(_3e,"fill-extrusion-base",this.binderUniforms[2].binding,0);_4b.setUniform(_3e,"fill-extrusion-height",this.binderUniforms[1].binding,20);gl.drawElements(_3f,_51.primitiveLength*_4f,gl.UNSIGNED_SHORT,_51.primitiveOffset*_4f*2);_4b.setUniform(_3e,"fill-extrusion-base",this.binderUniforms[2].binding,20);_4b.setUniform(_3e,"fill-extrusion-height",this.binderUniforms[1].binding,50);gl.drawElements(_3f,_51.primitiveLength*_4f,gl.UNSIGNED_SHORT,_51.primitiveOffset*_4f*2);_4b.setUniform(_3e,"fill-extrusion-base",this.binderUniforms[2].binding,50);_4b.setUniform(_3e,"fill-extrusion-height",this.binderUniforms[1].binding,80);gl.drawElements(_3f,_51.primitiveLength*_4f,gl.UNSIGNED_SHORT,_51.primitiveOffset*_4f*2);}};_2.prototype.drawArray=function(_53,_54,_55,_56,_57,_58,_59,_5a,_5b,_5c,_5d){var obj;var gl=_53.gl;_53.program.set(this.program);_53.setDepthMode(_55);_53.setStencilMode(_56);_53.setColorMode(_57);_53.setCullFace(_58);for(var _5e in this.fixedUniforms){this.fixedUniforms[_5e].set(_59[_5e]);}for(var i=0,_5f=_5d.get();i<_5f.length;i+=1){var _60=_5f[i];var _61=_60.vaos||(_60.vaos={});var vao=_61[_5a]||(_61[_5a]=new _1());vao.bind(_53,this,_5b,[],_5c,_60.vertexOffset,undefined,undefined);}};return _2;});