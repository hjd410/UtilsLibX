//>>built
define("com/huayun/webgis/gl/ProgramSimplify",["./VertexArrayObject"],function(_1){var _2=function Program(_3,_4,_5,_6){var gl=_3.gl;this.program=gl.createProgram();var _7=_5.defines;var _8,_9;if(_7){_8=_7.concat(_4.fragmentSource).join("\n");_9=_7.concat(_4.vertexSource).join("\n");}else{_8=_4.fragmentSource;_9=_4.vertexSource;}var _a=gl.createShader(gl.FRAGMENT_SHADER);gl.shaderSource(_a,_8);gl.compileShader(_a);gl.attachShader(this.program,_a);var _b=gl.createShader(gl.VERTEX_SHADER);gl.shaderSource(_b,_9);gl.compileShader(_b);gl.attachShader(this.program,_b);var _c=_5.layoutAttributes||[];for(var i=0;i<_c.length;i++){gl.bindAttribLocation(this.program,i,_c[i].name);}gl.linkProgram(this.program);this.numAttributes=gl.getProgramParameter(this.program,gl.ACTIVE_ATTRIBUTES);this.attributes={};var _d={};for(var _e=0;_e<this.numAttributes;_e++){var _f=gl.getActiveAttrib(this.program,_e);if(_f){this.attributes[_f.name]=gl.getAttribLocation(this.program,_f.name);}}var _10=gl.getProgramParameter(this.program,gl.ACTIVE_UNIFORMS);for(var i$2=0;i$2<_10;i$2++){var _11=gl.getActiveUniform(this.program,i$2);if(_11){_d[_11.name]=gl.getUniformLocation(this.program,_11.name);}}this.fixedUniforms=_6(_3,_d);};_2.prototype.draw=function draw(_12,_13,_14,_15,_16,_17,_18,_19,_1a,_1b,_1c,_1d,_1e,_1f,_20,_21){var obj;var gl=_12.gl;_12.program.set(this.program);_12.setDepthMode(_14);_12.setColorMode(_16);_12.setCullFace(_17);for(var _22 in this.fixedUniforms){this.fixedUniforms[_22].set(_18[_22]);}var _23=(obj={},obj[gl.LINES]=2,obj[gl.TRIANGLES]=3,obj[gl.LINE_STRIP]=1,obj)[_13];for(var i=0,_24=_1c.get();i<_24.length;i+=1){var _25=_24[i];var _26=_25.vaos||(_25.vaos={});var vao=_26[_19]||(_26[_19]=new _1());vao.bind(_12,this,_1a,[],_1b,_25.vertexOffset,_20,_21);gl.drawElements(_13,_25.primitiveLength*_23,gl.UNSIGNED_SHORT,_25.primitiveOffset*_23*2);}};_2.prototype.draw2=function draw2(_27,_28,_29,_2a,_2b,_2c,_2d,_2e,_2f,len){var obj;var gl=_27.gl;_27.program.set(this.program);_27.setDepthMode(_29);_27.setColorMode(_2b);_27.setCullFace(_2c);for(var _30 in this.fixedUniforms){this.fixedUniforms[_30].set(_2d[_30]);}_27.bindVertexBuffer.set(_2f.buffer);gl.drawArrays(_28,0,len);};_2.prototype.drawArray=function(_31,_32,_33,_34,_35,_36,_37,_38,_39,_3a,_3b){var obj;var gl=_31.gl;_31.program.set(this.program);_31.setDepthMode(_33);_31.setColorMode(_35);_31.setCullFace(_36);for(var _3c in this.fixedUniforms){this.fixedUniforms[_3c].set(_37[_3c]);}for(var i=0,_3d=_3b.get();i<_3d.length;i+=1){var _3e=_3d[i];var _3f=_3e.vaos||(_3e.vaos={});var vao=_3f[_38]||(_3f[_38]=new _1());vao.bind(_31,this,_39,[],_3a,_3e.vertexOffset,undefined,undefined);gl.drawArrays(_32,_3e.primitiveOffset,_3e.vertexLength);}};_2.prototype.drawArraysInstancedANGLE=function(_40,_41,_42,_43,_44,_45,_46,_47,_48,_49,_4a,_4b,_4c){var gl=_40.gl;_40.program.set(this.program);_40.setDepthMode(_42);_40.setColorMode(_44);_40.setCullFace(_45);for(var _4d in this.fixedUniforms){this.fixedUniforms[_4d].set(_46[_4d]);}var _4e=_4b.attributes;var ext=_40.extInstancedArray;for(var i=0,_4f=_4a.get();i<_4f.length;i+=1){var _50=_4f[i];var _51=_50.vaos||(_50.vaos={});var vao=_51[_47]||(_51[_47]=new _1());vao.bind(_40,this,_48,[_4b],_49,_50.vertexOffset,undefined,undefined);for(var j=0;j<_4e.length;j++){var _52=_4e[j];ext.vertexAttribDivisorANGLE(this.attributes[_52.name],1);}ext.drawArraysInstancedANGLE(_41,_50.primitiveOffset,_50.vertexLength,_4c);}};_2.prototype.drawInstancedANGLE=function(_53,_54,_55,_56,_57,_58,_59,_5a,_5b,_5c,_5d,_5e,_5f){var gl=_53.gl;_53.program.set(this.program);_53.setDepthMode(_55);_53.setColorMode(_57);_53.setCullFace(_58);for(var _60 in this.fixedUniforms){this.fixedUniforms[_60].set(_59[_60]);}var _61=_5e.attributes;var ext=_53.extInstancedArray;var _62=3;for(var i=0,_63=_5d.get();i<_63.length;i+=1){var _64=_63[i];var _65=_64.vaos||(_64.vaos={});var vao=_65[_5a]||(_65[_5a]=new _1());vao.bind(_53,this,_5b,[_5e],_5c,_64.vertexOffset,undefined,undefined);for(var j=0;j<_61.length;j++){var _66=_61[j];ext.vertexAttribDivisorANGLE(this.attributes[_66.name],1);}ext.drawElementsInstancedANGLE(_54,_64.primitiveLength*_62,gl.UNSIGNED_SHORT,_64.primitiveOffset*_62*2,_5f);}};_2.prototype.drawMassive=function draw(_67,_68,_69,_6a,_6b,_6c,_6d,_6e,_6f,_70,_71,_72,_73,_74,_75,_76){var obj;var gl=_67.gl;_67.program.set(this.program);_67.setDepthMode(_69);_67.setColorMode(_6b);_67.setCullFace(_6c);for(var _77 in this.fixedUniforms){this.fixedUniforms[_77].set(_6d[_77]);}if(_74){_74.setUniforms(_67,this.binderUniforms,_72,{zoom:(_73)});}var _78=(obj={},obj[gl.LINES]=2,obj[gl.TRIANGLES]=3,obj[gl.LINE_STRIP]=1,obj)[_68];for(var i=0,_79=_71.get();i<_79.length;i+=1){var _7a=_79[i];var _7b=_7a.vaos||(_7a.vaos={});var vao=_7b[_6e]||(_7b[_6e]=new _1());vao.bind(_67,this,_6f,_74?_74.getPaintVertexBuffers():[],_70,_7a.vertexOffset,_75,_76);gl.drawElements(_68,_7a.primitiveLength*_78,gl.UNSIGNED_INT,_7a.primitiveOffset*_78*2);}};return _2;});