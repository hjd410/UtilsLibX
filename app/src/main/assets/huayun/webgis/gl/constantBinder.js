//>>built
define("com/huayun/webgis/gl/constantBinder",["exports","./uniform","./dataTransfer","../layers/support/EvaluationParameters","../utils/utils"],function(_1,_2,_3,_4,_5){var _6=function _6(_7,_8,_9){this.value=_7;this.names=_8;this.uniformNames=this.names.map(function(_a){return ("u_"+_a);});this.type=_9;this.maxValue=-Infinity;};_6.prototype.defines=function defines(){return this.names.map(function(_b){return ("#define HAS_UNIFORM_u_"+_b);});};_6.prototype.setConstantPatternPositions=function setConstantPatternPositions(){};_6.prototype.populatePaintArray=function populatePaintArray(){};_6.prototype.updatePaintArray=function updatePaintArray(){};_6.prototype.upload=function upload(){};_6.prototype.destroy=function destroy(){};_6.prototype.setUniforms=function setUniforms(_c,_d,_e,_f){_d.set(_f.constantOr(this.value));};_6.prototype.setUniform=function setUniform(_10,_11,_12){_11.set(_12);};_6.prototype.getBinding=function getBinding(_13,_14){return (this.type==="color")?new _2.UniformColor(_13,_14):new _2.Uniform1f(_13,_14);};_6.serialize=function serialize$1(_15){var _16=_15.value;var _17=_15.names;var _18=_15.type;return {value:_3.serialize(_16),names:_17,type:_18};};_6.deserialize=function deserialize$1(_19){var _1a=_19.value;var _1b=_19.names;var _1c=_19.type;return new _6(_3.deserialize(_1a),_1b,_1c);};var _1d=function _1d(_1e,_1f,_20){this.value=_1e;this.names=_1f;this.uniformNames=this.names.map(function(_21){return ("u_"+_21);});this.type=_20;this.maxValue=-Infinity;this.patternPositions={patternTo:null,patternFrom:null};};_1d.prototype.defines=function defines(){return this.names.map(function(_22){return ("#define HAS_UNIFORM_u_"+_22);});};_1d.prototype.populatePaintArray=function populatePaintArray(){};_1d.prototype.updatePaintArray=function updatePaintArray(){};_1d.prototype.upload=function upload(){};_1d.prototype.destroy=function destroy(){};_1d.prototype.setConstantPatternPositions=function setConstantPatternPositions(_23,_24){this.patternPositions.patternTo=_23.tlbr;this.patternPositions.patternFrom=_24.tlbr;};_1d.prototype.setUniforms=function setUniforms(_25,_26,_27,_28,_29){var pos=this.patternPositions;if(_29==="u_pattern_to"&&pos.patternTo){_26.set(pos.patternTo);}if(_29==="u_pattern_from"&&pos.patternFrom){_26.set(pos.patternFrom);}};_1d.prototype.getBinding=function getBinding(_2a,_2b){return new _2.Uniform4f(_2a,_2b);};var _2c=function _2c(_2d,_2e,_2f,_30){this.expression=_2d;this.names=_2e;this.type=_2f;this.uniformNames=this.names.map(function(_31){return ("a_"+_31);});this.maxValue=-Infinity;this.paintVertexAttributes=_2e.map(function(_32){return ({name:("a_"+_32),type:"Float32",components:_2f==="color"?2:1,offset:0});});this.paintVertexArray=new _30();};_2c.prototype.defines=function defines(){return [];};_2c.prototype.setConstantPatternPositions=function setConstantPatternPositions(){};_2c.prototype.populatePaintArray=function populatePaintArray(_33,_34){var _35=this.paintVertexArray;var _36=_35.length;_35.reserve(_33);var _37=this.expression.evaluate(new _4(0),_34,{});if(this.type==="color"){var _38=_5.packColor(_37);for(var i=_36;i<_33;i++){_35.emplaceBack(_38[0],_38[1]);}}else{for(var i$1=_36;i$1<_33;i$1++){_35.emplaceBack(_37);}this.maxValue=Math.max(this.maxValue,_37);}};_2c.prototype.updatePaintArray=function updatePaintArray(_39,end,_3a,_3b){var _3c=this.paintVertexArray;var _3d=this.expression.evaluate({zoom:0},_3a,_3b);if(this.type==="color"){var _3e=_5.packColor(_3d);for(var i=_39;i<end;i++){_3c.emplace(i,_3e[0],_3e[1]);}}else{for(var i$1=_39;i$1<end;i$1++){_3c.emplace(i$1,_3d);}this.maxValue=Math.max(this.maxValue,_3d);}};_2c.prototype.upload=function upload(_3f){if(this.paintVertexArray&&this.paintVertexArray.arrayBuffer){if(this.paintVertexBuffer&&this.paintVertexBuffer.buffer){this.paintVertexBuffer.updateData(this.paintVertexArray);}else{this.paintVertexBuffer=_3f.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent);}}};_2c.prototype.destroy=function destroy(){if(this.paintVertexBuffer){this.paintVertexBuffer.destroy();}};_2c.prototype.setUniforms=function setUniforms(_40,_41){_41.set(0);};_2c.prototype.getBinding=function getBinding(_42,_43){return new _2.Uniform1f(_42,_43);};var _44=function _44(_45,_46,_47,_48,_49,_4a){this.expression=_45;this.names=_46;this.uniformNames=this.names.map(function(_4b){return ("u_"+_4b+"_t");});this.type=_47;this.useIntegerZoom=_48;this.zoom=_49;this.maxValue=-Infinity;var _4c=_4a;this.paintVertexAttributes=_46.map(function(_4d){return {name:("a_"+_4d),type:"Float32",components:_47==="color"?4:2,offset:0};});this.paintVertexArray=new _4c();};_44.prototype.defines=function defines(){return [];};_44.prototype.setConstantPatternPositions=function setConstantPatternPositions(){};_44.prototype.populatePaintArray=function populatePaintArray(_4e,_4f){var _50=this.paintVertexArray;var _51=_50.length;_50.reserve(_4e);var min=this.expression.evaluate(new _4(this.zoom),_4f,{});var max=this.expression.evaluate(new _4(this.zoom+1),_4f,{});if(this.type==="color"){var _52=_5.packColor(min);var _53=_5.packColor(max);for(var i=_51;i<_4e;i++){_50.emplaceBack(_52[0],_52[1],_53[0],_53[1]);}}else{for(var i$1=_51;i$1<_4e;i$1++){_50.emplaceBack(min,max);}this.maxValue=Math.max(this.maxValue,min,max);}};_44.prototype.updatePaintArray=function updatePaintArray(_54,end,_55,_56){var _57=this.paintVertexArray;var min=this.expression.evaluate({zoom:this.zoom},_55,_56);var max=this.expression.evaluate({zoom:this.zoom+1},_55,_56);if(this.type==="color"){var _58=_5.packColor(min);var _59=_5.packColor(max);for(var i=_54;i<end;i++){_57.emplace(i,_58[0],_58[1],_59[0],_59[1]);}}else{for(var i$1=_54;i$1<end;i$1++){_57.emplace(i$1,min,max);}this.maxValue=Math.max(this.maxValue,min,max);}};_44.prototype.upload=function upload(_5a){if(this.paintVertexArray&&this.paintVertexArray.arrayBuffer){if(this.paintVertexBuffer&&this.paintVertexBuffer.buffer){this.paintVertexBuffer.updateData(this.paintVertexArray);}else{this.paintVertexBuffer=_5a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent);}}};_44.prototype.destroy=function destroy(){if(this.paintVertexBuffer){this.paintVertexBuffer.destroy();}};_44.prototype.interpolationFactor=function interpolationFactor(_5b){if(this.useIntegerZoom){return this.expression.interpolationFactor(Math.floor(_5b),this.zoom,this.zoom+1);}else{return this.expression.interpolationFactor(_5b,this.zoom,this.zoom+1);}};_44.prototype.setUniforms=function setUniforms(_5c,_5d,_5e){_5d.set(this.interpolationFactor(_5e.zoom));};_44.prototype.getBinding=function getBinding(_5f,_60){return new _2.Uniform1f(_5f,_60);};var _61=function _61(_62,_63,_64,_65,_66,_67,_68){this.expression=_62;this.names=_63;this.type=_64;this.uniformNames=this.names.map(function(_69){return ("u_"+_69+"_t");});this.useIntegerZoom=_65;this.zoom=_66;this.maxValue=-Infinity;this.layerId=_68;this.paintVertexAttributes=_63.map(function(_6a){return ({name:("a_"+_6a),type:"Uint16",components:4,offset:0});});this.zoomInPaintVertexArray=new _67();this.zoomOutPaintVertexArray=new _67();};_61.prototype.defines=function defines(){return [];};_61.prototype.setConstantPatternPositions=function setConstantPatternPositions(){};_61.prototype.populatePaintArray=function populatePaintArray(_6b,_6c,_6d){var _6e=this.zoomInPaintVertexArray;var _6f=this.zoomOutPaintVertexArray;var ref=this;var _70=ref.layerId;var _71=_6e.length;_6e.reserve(_6b);_6f.reserve(_6b);if(_6d&&_6c.patterns&&_6c.patterns[_70]){var _72=_6c.patterns[_70];var min=_72.min;var mid=_72.mid;var max=_72.max;var _73=_6d[min];var _74=_6d[mid];var _75=_6d[max];if(!_73||!_74||!_75){return;}for(var i=_71;i<_6b;i++){_6e.emplaceBack(_74.tl[0],_74.tl[1],_74.br[0],_74.br[1],_73.tl[0],_73.tl[1],_73.br[0],_73.br[1]);_6f.emplaceBack(_74.tl[0],_74.tl[1],_74.br[0],_74.br[1],_75.tl[0],_75.tl[1],_75.br[0],_75.br[1]);}}};_61.prototype.updatePaintArray=function updatePaintArray(_76,end,_77,_78,_79){var _7a=this.zoomInPaintVertexArray;var _7b=this.zoomOutPaintVertexArray;var ref=this;var _7c=ref.layerId;if(_79&&_77.patterns&&_77.patterns[_7c]){var _7d=_77.patterns[_7c];var min=_7d.min;var mid=_7d.mid;var max=_7d.max;var _7e=_79[min];var _7f=_79[mid];var _80=_79[max];if(!_7e||!_7f||!_80){return;}for(var i=_76;i<end;i++){_7a.emplace(i,_7f.tl[0],_7f.tl[1],_7f.br[0],_7f.br[1],_7e.tl[0],_7e.tl[1],_7e.br[0],_7e.br[1]);_7b.emplace(i,_7f.tl[0],_7f.tl[1],_7f.br[0],_7f.br[1],_80.tl[0],_80.tl[1],_80.br[0],_80.br[1]);}}};_61.prototype.upload=function upload(_81){if(this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer){this.zoomInPaintVertexBuffer=_81.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent);this.zoomOutPaintVertexBuffer=_81.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent);}};_61.prototype.destroy=function destroy(){if(this.zoomOutPaintVertexBuffer){this.zoomOutPaintVertexBuffer.destroy();}if(this.zoomInPaintVertexBuffer){this.zoomInPaintVertexBuffer.destroy();}};_61.prototype.setUniforms=function setUniforms(_82,_83){_83.set(0);};_61.prototype.getBinding=function getBinding(_84,_85){return new _2.Uniform1f(_84,_85);};_3.register("ConstantBinder",_6);_3.register("CrossFadedConstantBinder",_1d);_3.register("SourceExpressionBinder",_2c);_3.register("CrossFadedCompositeBinder",_61);_3.register("CompositeExpressionBinder",_44);_1.ConstantBinder=_6;_1.CrossFadedConstantBinder=_1d;_1.SourceExpressionBinder=_2c;_1.CrossFadedCompositeBinder=_61;_1.CompositeExpressionBinder=_44;});