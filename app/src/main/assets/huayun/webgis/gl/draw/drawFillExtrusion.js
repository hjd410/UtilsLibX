//>>built
define("com/huayun/webgis/gl/draw/drawFillExtrusion",["../mode"],function(_1){function _2(){var _3=new Float32Array(9);_3[0]=1;_3[4]=1;_3[8]=1;return _3;};function _4(_5,_6){var s=Math.sin(_6),c=Math.cos(_6);_5[0]=c;_5[1]=s;_5[2]=0;_5[3]=-s;_5[4]=c;_5[5]=0;_5[6]=0;_5[7]=0;_5[8]=1;return _5;};function _7(_8,a,m){var x=a[0],y=a[1],z=a[2];_8[0]=x*m[0]+y*m[3]+z*m[6];_8[1]=x*m[1]+y*m[4]+z*m[7];_8[2]=x*m[2]+y*m[5]+z*m[8];return _8;};var _9=function(_a,_b,_c,_d,_e,_f){var _10=[0.12347,-0.56158,0.9959292143521045];var _11=_2();_4(_11,-0);_7(_10,_10,_11);var _12={r:1,g:1,b:1,a:1};if(_e){return {"u_matrix":_a,"u_lightpos":_10,"u_lightintensity":0.3,"u_lightcolor":[_12.r,_12.g,_12.b],"u_vertical_gradient":+_c,"u_opacity":_d,"u_height_image":0,"u_min_height":_f.minimumHeight,"u_delta_height":_f.maximumHeight-_f.minimumHeight};}else{return {"u_matrix":_a,"u_lightpos":_10,"u_lightintensity":0.3,"u_lightcolor":[_12.r,_12.g,_12.b],"u_vertical_gradient":+_c,"u_opacity":_d};}};function _13(_14){if(_14==="opaque"){return _1.ColorMode.unblended;}else{return _1.ColorMode.alphaBlended;}};function _15(_16,_17,_18,_19,_1a,_1b,_1c){var _1d=_16.view.context;var gl=_1d.gl;var _1e=_18.paint.get("fill-extrusion-opacity");var _1f=_18.paint.get("fill-extrusion-terrain");var _20;if(_1f){_20=_16.view.ground.sourceCache;}for(var i=0,_21=_19;i<_21.length;i+=1){var _22=_21[i];var _23=_17.getTile(_22);var _24=_23.getBucket(_18);if(!_24){continue;}var _25=_24.programConfigurations.get(_18.id);var _26=_16.view.useProgram("fillExtrusion",_25,_1f?["#define HAS_TERRAIN"]:[]);if(_1f){if(!_23.groundTile){_23.groundTile=_20.getTile(_22);}if(!_23.groundTile||!_23.groundTile.heightTexture){continue;}var _27=gl.LINEAR;_1d.activeTexture.set(gl.TEXTURE0);gl.bindTexture(gl.TEXTURE_2D,_23.groundTile.heightTexture);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,_27);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,_27);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE);}var _28=_22.posMatrix;var _29=_18.paint.get("fill-extrusion-vertical-gradient");var _2a=_9(_28,_16,_29,_1e,_1f,_23.groundTile);_26.draw(_1d,_1d.gl.TRIANGLES,_1a,_1b,_1c,_1.CullFaceMode.backCCW,_2a,_18.id,_24.layoutVertexBuffer,_24.indexBuffer,_24.segments,_18.paint,_16.transform.level,_25);}};function _2b(_2c,_2d,_2e,_2f){var _30=_2e.paint.get("fill-extrusion-opacity");if(_30===0){return;}if(_2c.renderPass==="translucent"){var _31=_2c.depthModeForSublayer(0,_1.DepthMode.ReadWrite);if(_30===1&&!_2e.paint.get("fill-extrusion-pattern").constantOr((1))){var _32=_13();_15(_2c,_2d,_2e,_2f,_31,_1.StencilMode.disabled,_32);}else{_15(_2c,_2d,_2e,_2f,_31,_1.StencilMode.disabled,_1.ColorMode.disabled);_15(_2c,_2d,_2e,_2f,_31,_2c.stencilModeFor3D(),_13());}}};return _2b;});