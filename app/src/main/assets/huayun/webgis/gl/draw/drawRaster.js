//>>built
define("com/huayun/webgis/gl/draw/drawRaster",["exports","../mode","../../geometry/Point","../Texture","../../utils/utils","custom/gl-matrix-min"],function(_1,_2,_3,_4,_5,_6){var _7=function(_8,_9,_a,_b,_c){return ({"u_matrix":_8,"u_tl_parent":_9,"u_scale_parent":_a,"u_buffer_scale":1,"u_fade_t":_b.mix,"u_opacity":_b.opacity,"u_image0":0,"u_image1":1,"u_brightness_low":0,"u_brightness_high":1,"u_saturation_factor":-0,"u_contrast_factor":1,"u_spin_weights":[1,0,0]});};function _d(_e,_f,_10,_11){var _12=300;if(_12>0){var now=_5.now();var _13=(now-_e.timeAdded)/_12;var _14=_f?(now-_f.timeAdded)/_12:-1;var _15=_10.getSource();var _16=_11.coveringZoomLevel({tileSize:_15.tileSize,roundZoom:_15.roundZoom});var _17=!_f||Math.abs(_f.tileID.overscaledZ-_16)>Math.abs(_e.tileID.overscaledZ-_16);var _18=(_17&&_e.refreshedUponExpiration)?1:_5.clamp(_17?_13:1-_14,0,1);if(_f){return {opacity:1,mix:1-_18};}else{return {opacity:_18,mix:0};}}else{return {opacity:1,mix:0};}};return function(_19,_1a,_1b,_1c){var _1d=_19.view.context;var gl=_1d.gl;var _1e=_1a.getSource();var _1f=_19.view.useProgram("raster");var _20=_2.StencilMode.disabled;var _21=_2.ColorMode.alphaBlended;var _22=_1c.length&&_1c[0].overscaledZ;var _23=true;for(var i=0,_24=_1c;i<_24.length;i+=1){var _25=_24[i];var _26=_19.depthModeForSublayer(_25.overscaledZ-_22,_2.DepthMode.ReadWrite,gl.LESS);var _27=_1a.getTile(_25);var _28=_25.posMatrix;_27.registerFadeDuration(300);var _29=_1a.findLoadedParent(_25,0),_2a=_d(_27,_29,_1a,_19.transform);if(_2a.opacity<1){_19._fadeDirty=true;}var _2b=(void 0),_2c=(void 0);var _2d=gl.LINEAR;_1d.activeTexture.set(gl.TEXTURE0);_27.texture.bind(_2d,gl.CLAMP_TO_EDGE,gl.LINEAR_MIPMAP_NEAREST);_1d.activeTexture.set(gl.TEXTURE1);if(_29){_29.texture.bind(_2d,gl.CLAMP_TO_EDGE,gl.LINEAR_MIPMAP_NEAREST);_2b=Math.pow(2,_29.tileID.overscaledZ-_27.tileID.overscaledZ);_2c=[_27.tileID.canonical.x*_2b%1,_27.tileID.canonical.y*_2b%1];}else{_27.texture.bind(_2d,gl.CLAMP_TO_EDGE,gl.LINEAR_MIPMAP_NEAREST);}var _2e=_7(_28,_2c||[0,0],_2b||1,_2a,_1b);_1f.draw2(_1d,gl.TRIANGLES,_26,_20,_21,_2.CullFaceMode.disabled,_2e,"tile",_19.rasterBoundsBuffer,_19.quadTriangleIndexBuffer,_19.rasterBoundsSegments);}};});