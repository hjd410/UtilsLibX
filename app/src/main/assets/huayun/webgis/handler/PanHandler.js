//>>built
define("com/huayun/webgis/handler/PanHandler",["dojo/_base/declare","dojo/on"],function(_1,on){return _1("com.huayun.webgis.handler.PanHandler",[],{view:null,_mouseDown:false,_fromX:0,_fromY:0,_toX:0,_toY:0,mouseMove:null,mouseUp:null,panRaf:null,mapMouseClickTolerance:0,isPanning:false,isRotating:false,isSwitching:false,constructor:function(_2){this.view=_2;this._mouseDown=false;this.mapMouseClickTolerance=3;oncontextmenu=function(){return false;};this.panRaf=null;var _3=this;on(_2.domNode,"mousedown",function(e){if(e.button==0&&_2.panEnabled){_3._fromX=e.x;_3._fromY=e.y;_3._mouseDown=true;if(!_3.isPanning){_3._toX=e.x;_3._toY=e.y;}_3.mouseMove=on(document,"mousemove",function(e){_3.mouseMoveHandler(e);});_3.mouseUp=on(document,"mouseup",function(e){_3.mouseUpHandler(e);});}else{if(e.button==2&&_2.rotateEnabled){_3._fromX=e.x;_3._fromY=e.y;_3._mouseDown=true;if(!_3.isRotating||!_3.isSwitching){_3._toX=e.x;_3._toY=e.y;}_3.mouseMove=on(this,"mousemove",function(e){_3.rightMoveHandle(e);});_3.mouseUp=on(this,"mouseup",function(e){_3.rightUpHandle(e);});}}});},rightMoveHandle:function(e){this._toX=e.x;this._toY=e.y;if(!this._mouseDown){return;}var _4=this;var _5=this._toX-this._fromX,_6=this._toY-this._fromY;if(Math.abs(_5)>=this.mapMouseClickTolerance||Math.abs(_6)>=this.mapMouseClickTolerance){if(!this.isRotating&&!this.isSwitching){if(Math.abs(_5)>Math.abs(_6)){this.isRotating=true;this.isSwitching=false;}else{this.isSwitching=true;this.isRotating=false;}}this._fromX=this._toX;this._fromY=this._toY;if(this.isRotating&&!this.isSwitching){this.view._mouseRotate(_5);}else{this.view._mouseSwitchDip(_6);}if(this.timeout){clearTimeout(this.timeout);this.timeout=null;}this.timeout=setTimeout(function(){_4.timeout=null;if(_4.isSwitching){_4.view._stopSwitch();}if(_4.isRotating){_4.view._stopMouseRotate();}_4.isSwitching=false;_4.isRotating=false;_4._fromX=_4._toX;_4._fromY=_4._toY;},50);}},rightUpHandle:function(e){if(this.timeout){clearTimeout(this.timeout);this.timeout=null;}if(this.isRotating){this.view._stopMouseRotate();}if(this.isSwitching){this.view._stopSwitch();}this.isRotating=false;this.isSwitching=false;this._mouseDown=false;this.mouseMove.remove();this.mouseUp.remove();this.view.handlePushViewState();},mouseMoveHandler:function(e){this._toX=e.x;this._toY=e.y;if(!this._mouseDown){return;}var _7=this;var _8=this._toX-this._fromX,_9=this._toY-this._fromY;if(Math.abs(_8)>=this.mapMouseClickTolerance||Math.abs(_9)>=this.mapMouseClickTolerance){this._fromX=this._toX;this._fromY=this._toY;this.view.mapMove(_8,_9);if(this.timeout){clearTimeout(this.timeout);this.timeout=null;}this.timeout=setTimeout(function(){_7.timeout=null;_7.view.stopMove();_7._fromX=_7._toX;_7._fromY=_7._toY;},50);}},mouseUpHandler:function(e){if(this.timeout){clearTimeout(this.timeout);this.timeout=null;}this.view.stopMove();this._mouseDown=false;this.mouseMove.remove();this.mouseUp.remove();this.view.handlePushViewState();},});});