//>>built
define("com/huayun/webgis/handler/TouchHandler",["dojo/_base/declare","dojo/on"],function(_1,on,_2){return _1("com.huayun.webgis.handler.TouchHandler",[],{view:null,_touch:false,_zoom:false,_fromX:0,_fromY:0,_fromX1:0,_fromY1:0,_toX:0,_toY:0,_toX1:0,_toY1:0,touchMove:null,touchUp:null,touchRaf:null,mapTouchTolerance:0,isTouching:false,isZooming:false,zoomUp:null,zoomMove:null,constructor:function(_3){this.view=_3;this.mapTouchTolerance=3;this.touchRaf=null;var _4=this;on(_3.domNode,"touchstart",function(e){e.preventDefault();var _5=e.targetTouches||e.touches;if(_5.length<2&&_3.panEnabled){_4._fromX=e.targetTouches[0].clientX;_4._fromY=e.targetTouches[0].clientY;_4._touch=true;if(!_4.isTouching){_4._toX=e.targetTouches[0].clientX;_4._toY=e.targetTouches[0].clientY;}_4.touchMove=on(document,"touchmove",function(e){_4.touchMoveHandler(e);});_4.touchUp=on(document,"touchend",function(e){_4.touchUpHandler(e);});_4.enterFrameHandler();}if(_5.length>1&&_3.zoomEnabled){_4._touch=false;_4.isTouching=false;if(_4.touchMove){_4.touchMove.remove();_4.touchUp.remove();}_4._zoom=true;var sx=e.targetTouches[0].clientX,ex=e.targetTouches[1].clientX,sy=e.targetTouches[0].clientY,ey=e.targetTouches[1].clientY;_4.cx=(sx+ex)/2;_4.cy=(sy+ey)/2;_4.lastLen=Math.sqrt((sx-ex)*(sx-ex)+(sy-ey)*(sy-ey));_4.zoomMove=on(document,"touchmove",_4.zoomMoveHandler.bind(_4));_4.zoomEnd=on(document,"touchend",_4.zoomEndHandle.bind(_4));}});},zoomEndHandle:function(e){if(this.view.zoomEnabled){var _6=e.touches||e.targetTouches;var dx=_6[0].clientX-_6[1].clientX,dy=_6[0].clientY-_6[1].clientY;var _7=Math.sqrt(dx*dx+dy*dy);if(_7-this.lastLen>5){this.view.zoomInWheel(this.cx,this.cy);this.lastLen=_7;}else{if(_7-this.lastLen<-5){this.view.zoomOutWheel(this.cx,this.cy);this.lastLen=_7;}}}this.zoomMove.remove();this.zoomEnd.remove();},zoomMoveHandler:function(e){if(this.view.zoomEnabled){var _8=e.touches||e.targetTouches;var dx=_8[0].clientX-_8[1].clientX,dy=_8[0].clientY-_8[1].clientY;var _9=Math.sqrt(dx*dx+dy*dy);if(_9-this.lastLen>5){this.view.zoomInWheel(this.cx,this.cy);this.lastLen=_9;}else{if(_9-this.lastLen<-5){this.view.zoomOutWheel(this.cx,this.cy);this.lastLen=_9;}}}},touchMoveHandler:function(e){var _a=e.targetTouches||e.touches;if(_a.length<2){this._toX=e.targetTouches[0].clientX;this._toY=e.targetTouches[0].clientY;}},touchUpHandler:function(e){var _b=e.targetTouches||e.touches;if(_b.length<2){if(this.isTouching){this.isTouching=false;this.view.stopMove();}this._touch=false;this.touchMove.remove();this.touchUp.remove();this.view.handlePushViewState();window.cancelAnimationFrame(this.touchRaf);}},enterFrameHandler:function(){if(!this._touch){return;}var _c=this._toX-this._fromX,_d=this._toY-this._fromY;if(this.isTouching){if(Math.abs(_d)<5&&Math.abs(_c)<5){this.isTouching=false;this.view.stopMove();this._fromX=this._toX;this._fromY=this._toY;}else{this.isTouching=true;this.view.mapMove(_c,_d);this._fromX=this._toX;this._fromY=this._toY;}}else{if(Math.abs(_c)>=this.mapTouchTolerance||Math.abs(_d)>=this.mapTouchTolerance){this.isTouching=true;this._fromX=this._toX;this._fromY=this._toY;}}this.touchRaf=window.requestAnimationFrame(this.enterFrameHandler.bind(this));}});});