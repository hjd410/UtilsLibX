//>>built
require({cache:{"url:com/huayun/webgis/templates/drawController.html":"<div class=\"${baseClass}\" style=\"pointer-events: all;\">\r\n    <!--<div class=\"collapse-btn collapse-down tool\" id=\"openTl\">工具<span class=\"arrowText\" id=\"arrowText\"></span></div>\r\n    -->\r\n    <div class=\"tool\" id=\"openTl\">工具<span class=\"arrowText\" id=\"arrowText\"></span></div>\r\n    <ul id=\"drawSelectWrap\" class=\"drawSelect\">\r\n        <li class=\"toolGroupLabel\">\r\n           绘制工具\r\n        </li>\r\n\r\n        <li class=\"drawWrap\" data-dojo-attach-point=\"drawDotNode\" data-dojo-attach-event=\"onclick:drawDot\">\r\n            <div class=\"drawDot\">画点\r\n            </div>\r\n        </li>\r\n        <li class=\"drawWrap\" data-dojo-attach-point=\"drawLineNode\" data-dojo-attach-event=\"onclick:drawLine\">\r\n            <div class=\"drawLine\">画线</div>\r\n        </li>\r\n        <li class=\"drawWrap\" data-dojo-attach-point=\"drawCircleNode\"\r\n            data-dojo-attach-event=\"onclick:drawCircle\">\r\n            <div class=\"drawCircle\" >\r\n                画圆\r\n            </div>\r\n        </li>\r\n        <li class=\"drawWrap\"  data-dojo-attach-point=\"drawPolyNode\"\r\n            data-dojo-attach-event=\"onclick:drawPolygon\">\r\n            <div class=\"drawPoly\">\r\n                画多边形\r\n            </div>\r\n        </li>\r\n        <li class=\"drawWrap\" data-dojo-attach-point=\"drawSphereNode\"\r\n            data-dojo-attach-event=\"onclick:drawSphere\">\r\n            <div class=\"drawSphere\">\r\n                画球\r\n            </div>\r\n        </li>\r\n        <li class=\"toolGroupLabel\">\r\n            测量工具\r\n        </li>\r\n\r\n        <li class=\"drawWrap\"  data-dojo-attach-point=\"measureLineNode\" data-dojo-attach-event=\"onclick:measureLine\">\r\n            <div class=\"drawLine\">距离\r\n            </div>\r\n        </li>\r\n\r\n        <li class=\"drawWrap\" data-dojo-attach-point=\"measurePolyNode\"\r\n            data-dojo-attach-event=\"onclick:measurePoly\">\r\n            <div class=\"drawPoly\" >\r\n                面积\r\n            </div>\r\n        </li>\r\n\r\n        <li class=\"drawWrap\" data-dojo-attach-point=\"measureAngleNode\"\r\n            data-dojo-attach-event=\"onclick:measureAngle\">\r\n            <div class=\"drawLine\" >\r\n                角度\r\n            </div>\r\n        </li>\r\n\r\n        <li class=\"drawWrap\">\r\n            <div class=\"clearDraw\" data-dojo-attach-event=\"onclick:clearGraphic\">清空</div>\r\n        </li>\r\n\r\n        <li class=\"drawWrap\">\r\n            <div class=\"clearDraw\" data-dojo-attach-event=\"onclick:rectSelect\">矩形选择</div>\r\n        </li>\r\n\r\n        <li class=\"drawWrap\">\r\n            <div class=\"clearDraw\" data-dojo-attach-event=\"onclick:polygonSelect\">多边形选择</div>\r\n        </li>\r\n    </ul>\r\n</div>"}});define("com/huayun/webgis/widget/DrawController",["dojo/_base/declare","dojo/on","dojo/dom","dojo/topic","dojo/_base/query","./MapModuleX","com/huayun/webgis/action/DrawAction","dojo/text!../templates/drawController.html"],function(_1,on,_2,_3,_4,_5,_6,_7){return _1("com.huayun.webgis.widget.DrawController",[_5],{map:null,baseClass:"drawController",itemDefaultClassName:"drawWrap",itemActiveClassName:"toolItemActive",templateString:_7,toolBtnId:"openTl",selectWrapId:"drawSelectWrap",selectArrowId:"arrowText",selectState:false,activeState:"",actionState:"",linesRecordDict:[],drawAction:null,doInit:function(_8){this.map=this.get("map");this.drawAction=new _6({id:"draw",map:this.map,actionState:"none"});var _9=this;on(_2.byId(_9.toolBtnId),"click",function(e){e.preventDefault();e.stopPropagation();_9._toggleSelect();var _a=e.target,_b=_9.map.action,_c=_2.byId(_9.selectWrapId).style.display;if(_a.className=="tool"){if(_b){var _d=_b.id;if(_d=="draw"){if(_b.actionState!="none"){if(_c=="block"){_2.byId("drawSelectWrap").style.display="none";}else{_2.byId("drawSelectWrap").style.display="block";}}else{_a.className="tool";_2.byId("arrowText").className="arrowText";_2.byId("drawSelectWrap").style.display="none";_9.map.clearAction();}}}else{_a.className="toolActive";_2.byId("arrowText").className="arrowTextActive";_2.byId("drawSelectWrap").style.display="block";_9.map.setAction(_9.drawAction);}}else{_a.className="toolActive";_2.byId("arrowText").className="arrowTextActive";_2.byId("drawSelectWrap").style.display="block";_9.map.setAction(_9.drawAction);}});_3.subscribe("mapDrawDot",function(){_9.clearDrawIcon();});_3.subscribe("mapDrawEnd",function(){_9.clearDrawIcon();});},_toggleSelect:function(){var _e=this;if(_e.selectState){_e._closeSelectWrap();}else{_e._openSelectWrap();}},_openSelectWrap:function(){_4("#"+this.toolBtnId).removeClass("tool").addClass("toolActive");_4("#"+this.selectWrapId).style("display","block");_4("#"+this.selectArrowId).removeClass("arrowText").addClass("arrowTextActive");this.selectState=true;},_closeSelectWrap:function(){_4("#"+this.toolBtnId).removeClass("toolActive").addClass("tool");_4("#"+this.selectWrapId).style("display","none");_4("#"+this.selectArrowId).removeClass("arrowTextActive").addClass("arrowText");this.selectState=false;},removeActiveClass:function(){_4("."+this.itemActiveClassName).removeClass(this.itemActiveClassName);},addActiveClass:function(_f){_f.className=this.itemDefaultClassName+" "+this.itemActiveClassName;},drawDot:function(){this.removeActiveClass();this.addActiveClass(this.drawDotNode);this.drawAction.setActionState("dot");this._toggleSelect();},drawLine:function(){this.removeActiveClass();this.addActiveClass(this.drawLineNode);this.drawAction.setActionState("line");this._toggleSelect();},drawCircle:function(){this.removeActiveClass();this.addActiveClass(this.drawCircleNode);this.drawAction.setActionState("circle");this._toggleSelect();},drawPolygon:function(){this.removeActiveClass();this.addActiveClass(this.drawPolyNode);this.drawAction.setActionState("polygon");this._toggleSelect();},drawSphere:function(){this.removeActiveClass();this.addActiveClass(this.drawSphereNode);this.drawAction.setActionState("sphere");this._toggleSelect();},measureLine:function(){this.removeActiveClass();this.addActiveClass(this.measureLineNode);this.drawAction.setActionState("measureLine");this._toggleSelect();},measurePoly:function(){this.removeActiveClass();this.addActiveClass(this.measurePolyNode);this.drawAction.setActionState("measurePoly");this._toggleSelect();},measureAngle:function(){this.removeActiveClass();this.addActiveClass(this.measureAngleNode);this.drawAction.setActionState("measureAngle");this._toggleSelect();},clearGraphic:function(){this.removeActiveClass();document.getElementById("arrowText").className="arrowText";document.getElementById("drawSelectWrap").style.display="none";document.getElementById("openTl").className="tool";this.drawAction.actionState="none";this.drawAction.clear();this.map.panAble=true;this.map.clearAction();this._toggleSelect();},clearDrawIcon:function(){this.removeActiveClass();},rectSelect:function(){this.drawAction.setActionState("rectSelect");this._toggleSelect();},circleSelect:function(){this.drawAction.setActionState("circleSelect");this._toggleSelect();},polygonSelect:function(){this.drawAction.setActionState("polygonSelect");this._toggleSelect();}});});