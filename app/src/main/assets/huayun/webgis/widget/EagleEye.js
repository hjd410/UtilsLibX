//>>built
require({cache:{"url:com/huayun/webgis/templates/eagleEye.html":"<div class=\"eagleEye-box\" data-dojo-attach-point=\"eagleEyeBox\" style=\"pointer-events: none;\">\r\n    <div class=\"target-view-box\" draggable=\"true\" data-dojo-attach-point=\"viewBox\" style=\"pointer-events: auto;\"></div>\r\n    <p data-dojo-attach-point=\"slideEagleEye\"  data-dojo-attach-event=\"onclick:toggle\" class=\"eagleEye-toggle-btn\" id=\"eagleEye-toggle-button\" style=\"pointer-events: all;\"></p>\r\n</div>\r\n\r\n"}});define("com/huayun/webgis/widget/EagleEye",["dojo/_base/declare","dojo/_base/fx","dojo/dom","dojo/dom-class","dojo/dom-construct","dojo/topic","dojo/on","./MapModuleX","../Map","../views/EagleView","../../webgis/geometry/Extent","../../webgis/layers/TileLayer","dojo/text!../templates/eagleEye.html"],function(_1,_2,_3,_4,_5,_6,on,_7,_8,_9,_a,_b,_c){return _1("com.huayun.webgis.widget.EagleEye",[_7],{templateString:_c,name:"EagleEye",baseClass:"eagleEye",targetViewBoxClass:"",scale:2,showFlag:true,width:0,height:0,toggleBtnSize:16,_moveHandler:null,_centerTopAndLeft:{},constructor:function(){},doInit:function(){this.map=this.get("map");this.view=this.get("view");var _d=this.view.height/this.view.width;var _e=400,_f=_e*_d;this.width=_e;this.height=_f;this.eagleEyeBox.style.width=_e+"px";this.eagleEyeBox.style.height=_f+"px";this.viewBox.style.width=_e/this.scale+"px";this.viewBox.style.height=_f/this.scale+"px";this.offsetTop=(_f-_f/this.scale)/2;this.offsetLeft=(_e-_e/this.scale)/2;this.maxTop=_f-_f/this.scale;this.maxLeft=_e-_e/this.scale;this.viewBox.style.top=this.offsetTop+"px";this.viewBox.style.left=this.offsetLeft+"px";var _10=this.get("config");if(this.view._load){var map=new _8({id:"EagleMap"});var _11=new _b({id:"eagleTile",visible:true,url:_10.url});map.addLayer(_11);this.eagleView=new _9({container:this.domNode,map:map,id:"EagleEye",level:this.view.level-3,center:this.view.center});}_6.subscribe("extentChangeEvent",function(_12){if(_12.id==="EagleEye"){return;}if(!this.eagleView){var map=new _8({id:"EagleMap"});var _13=new _b({id:"eagleTile",visible:true,url:_10.url});map.addLayer(_13);this.eagleView=new _9({container:this.domNode,map:map,name:"EagleEye",id:"EagleEye",level:this.view.level-3,center:this.view.center});}else{var _14=(_12.viewpoint.targetZoom||_12.level)-3;var _15=_12.center;this.eagleView.setCenter(_15,_14);}}.bind(this));this.addDragEventListener();this.toggle();},addDragEventListener:function(){this.startPoint={};on(this.viewBox,"mousedown",function(e){e.stopPropagation();e.preventDefault();this.startPoint.x=e.clientX;this.startPoint.y=e.clientY;this._moveHandler=on(this.viewBox,"mousemove",this._onMouseMoveMethod.bind(this));this._upHandler=on(this.viewBox,"mouseup",function(e){e.stopPropagation();var _16=Number(this.viewBox.style.left.substring(0,this.viewBox.style.left.length-2)),_17=_16+this.width/this.scale,_18=Number(this.viewBox.style.top.substring(0,this.viewBox.style.top.length-2)),_19=_18+this.height/this.scale;var _1a=this.eagleView.calcBounds(_16,_17,_18,_19);var cx=(_1a[0].x+_1a[1].x)/2,cy=(_1a[0].y+_1a[2].y)/2;this.view.setCenter([cx,cy],this.view.level);this.viewBox.style.top=this.offsetTop+"px";this.viewBox.style.left=this.offsetLeft+"px";if(this._moveHandler){this._moveHandler.remove();}if(this._upHandler){this._upHandler.remove();}}.bind(this));}.bind(this));},_onMouseMoveMethod:function(e){var x=e.clientX,y=e.clientY;if((this.offsetTop+(y-this.startPoint.y))>this.maxTop){this.viewBox.style.top=this.maxTop+"px";}else{if((this.offsetTop+(y-this.startPoint.y))<0){this.viewBox.style.top=0+"px";}else{this.viewBox.style.top=this.offsetTop+(y-this.startPoint.y)+"px";}}if((this.offsetLeft+(x-this.startPoint.x))>this.maxLeft){this.viewBox.style.left=this.maxLeft+"px";}else{if((this.offsetLeft+(x-this.startPoint.x))<0){this.viewBox.style.left=0+"px";}else{this.viewBox.style.left=(this.offsetLeft+(x-this.startPoint.x))+"px";}}},getNewMapExtent:function(_1b){this.getPxExtent();this.getPyExtent();var _1c=this.bigView.extent;var _1d=new _a(_1c.minx+_1b.x*this.perPxExtent,_1c.miny+-_1b.y*this.perPyExtent,_1c.maxx+_1b.x*this.perPxExtent,_1c.maxy+-_1b.y*this.perPyExtent);return _1d;},toggle:function(){if(this.showFlag){this.hide();}else{this.show();}},hide:function(){var _1e=this;_2.animateProperty({node:this.domNode,properties:{top:-_1e.height+_1e.toggleBtnSize,right:-_1e.width+_1e.toggleBtnSize},duration:400}).play();this.showFlag=false;},show:function(){var _1f=this;_2.animateProperty({node:_1f.domNode,properties:{top:0,right:0},duration:400}).play();this.showFlag=true;}});});