//>>built
define("com/huayun/webgis/widget/searchs/PathPlanningSearch","dojo/_base/declare dojo/dom-construct dojo/dom-class dojo/dom-style dijit/focus ../../geometry/Extent ../../geometry/Polyline ../../geometry/Point ../../Graphic ../../Feature ../../symbols/LineSymbol ../../symbols/ImageSymbol ../../../util/HashTable ../../../facades/AgsFacade ../MapModuleX dojo/text!../../templates/searchs/path-planning-search.html".split(" "),function(t,g,b,q,d,u,v,m,n,p,w,r,A,x,y,z){return t("com.huayun.webgis.widget.searchs.PathPlanningSearch",
[y],{templateString:z,baseClass:"pathSearch",agsUrl:"",_regPoint:/(\d+\.*\d*)\s+(\d+\.*\d*)/,_regString:/(\d+\.*\d*)\s+(\d+\.*\d*)/g,constructor:function(a){this.agsUrl=a.agsUrl},postCreate:function(){this.inherited(arguments);this._agsFacade=new x;this._searchPathData={};this._lastEndPath=this._lastStartPath="";this._curNode=null;this._lastNodeValue="";this._endInputFlag=!1},doInit:function(){this.view=this.get("view");this.changeMethod=null;this._lineSymbol=new w({color:"#11ff6b",width:3});this._startSymbol=
new r({url:require.toUrl("com/huayun/webgis/css/images/blue.png"),width:21,height:33});this._endSymbol=new r({url:require.toUrl("com/huayun/webgis/css/images/red.png"),width:21,height:33})},onChange2Name:function(){b.add(this.domNode,"hidden");this.changeMethod&&this.changeMethod()},focusHandle:function(a){a.target.focus();this._curNode=d.curNode},compositionstartHandler:function(){this._endInputFlag=!1;this._lastNodeValue=d.curNode.value},compositionendHandler:function(){this._endInputFlag=!0;this._curNode=
d.curNode;this._lastNodeValue!==d.curNode.value&&this._getInterestPlaceData(d.curNode.value,function(a){this._showSelectList(a.detail)}.bind(this))},onKeyDown:function(a){},onKeyUp:function(a){switch(a.code){case "Backspace":case "Delete":this._endInputFlag&&(this._curNode=d.curNode,this._getInterestPlaceData(d.curNode.value,function(a){this._showSelectList(a.detail)}.bind(this)))}},selectItem:function(a){b.contains(this._curNode,"startVal")?this._searchPathData.startCenterPoint=a.target.getAttribute("data-path-center-point"):
b.contains(this._curNode,"endVal")&&(this._searchPathData.endCenterPoint=a.target.getAttribute("data-path-center-point"));this._curNode.value=a.target.innerText;b.add(this.addressNode,"hidden")},_showSelectList:function(a){if("undefined"===typeof a||null===a)b.add(this.addressNode,"hidden"),g.empty(this.addressListNode);else{g.empty(this.addressListNode);for(var f=0;f<a.length;f++){var e=a[f];g.create("li",{class:"path-planning-search",innerHTML:e.name,"data-path-center-point":e.centerPoint},this.addressListNode)}b.remove(this.addressNode,
"hidden")}},_getInterestPlaceData:function(a,f){a=a.replace(/\s+/g,"");""!==a&&null!==a&&this._agsFacade.getInterestPlaceData(this.agsUrl,{words:a,cityCode:"",num:10},function(a){f(a)}.bind(this),function(a){})},changeCost:function(){var a=this.startZoneNode.value;this.startZoneNode.value=this.endZoneNode.value;this.endZoneNode.value=a;a=this._searchPathData.startCenterPoint;this._searchPathData.startCenterPoint=this._searchPathData.endCenterPoint;this._searchPathData.endCenterPoint=a},searchPath:function(){if(0<
this.endZoneNode.value.length&&0<this.startZoneNode.value.length){if(this._lastStartPath!==this.startZoneNode.value||this._lastEndPath!==this.endZoneNode.value){var a=this._searchPathData.startCenterPoint.match(this._regPoint)[1],f=this._searchPathData.startCenterPoint.match(this._regPoint)[2],e=this._searchPathData.endCenterPoint.match(this._regPoint)[1],c=this._searchPathData.endCenterPoint.match(this._regPoint)[2];this._agsFacade.getCostPath({url:this.agsUrl,stops:a+","+f+";"+e+","+c},function(a){"1000"===
a.code&&this._drawPath(a.detail)}.bind(this),function(a){console.error(a.message)});this._lastStartPath=this.startZoneNode.value;this._lastEndPath=this.endZoneNode.value}}else alert("\u5730\u5740\u4e0d\u80fd\u4e3a\u7a7a")},_drawPath:function(a){this.drawLayer||(this.drawLayer=this.view.map.findLayerById("drawLayer"));this.drawLayer.clear();var f=a.length,e=[];if(!(2>f)){for(var c=a[0].geom.match(this._regString),b=c[c.length-1].match(this._regPoint),b=[Number(b[1]),Number(b[2])],c=a[f-1].geom.match(this._regString),
c=c[c.length-1].match(this._regPoint),c=[Number(c[1]),Number(c[2])],d=0;d<f;d++){for(var h=a[d].geom.match(this._regString),k=[],l=0;l<h.length;l++){var g=h[l].match(this._regPoint);k.push(new m(g[1],g[2]))}e.push(k)}f=new v(e);f=new p({attribute:null,geometry:f});this._currentGraphic=new n({feature:f,symbol:this._lineSymbol});this.drawLayer.addGraphic(this._currentGraphic);b=new m(b[0],b[1]);b=new p({attribute:null,geometry:b});b=new n({feature:b,symbol:this._startSymbol});this.drawLayer.addGraphic(b);
c=new m(c[0],c[1]);c=new p({attribute:null,geometry:c});c=new n({feature:c,symbol:this._endSymbol});this.drawLayer.addGraphic(c);this._setNewExtent(a)}},_setNewExtent:function(a){for(var b=a.length,e=[],c=[],d=0;d<b;d++)for(var g=a[d].geom.match(this._regString),h=0;h<g.length;h++){var k=g[h].match(this._regPoint),l=k[2];e.push(k[1]);c.push(l)}e.sort();c.sort();a=Number(e[0]);b=Number(e[e.length-1]);d=Number(c[0]);c=Number(c[e.length-1]);e={x:(a+b)/2,y:(d+c)/2};c=new u(a,d,b,c);this.view.setExtent(c);
return e},getStartCost:function(){this.zoneNode="startZoneNode";this.getZoneFlag=!0;q.set(this.view.domNode,"cursor","url(../dojo/com/huayun/webgis/css/images/AGS/signred.png) 12 12 ,crosshair");this.hideCostContainer();this.startZoneNode.value="";startZone=null},getEndCost:function(){this.zoneNode="endZoneNode";this.getZoneFlag=!0;q.set(this.view.domNode,"cursor","url(../dojo/com/huayun/webgis/css/images/AGS/signred.png) 12 12 ,crosshair");this.hideCostContainer();this.endZoneNode.value="";endZone=
null},getCostNameByPoint:function(a){if(this.getZoneFlag){a={point:a.x+","+a.y,tolerance:100,num:1};var b=this;this.getZoneFlag=!1;this.configFacade.getAddressAround(this.url+"ags/findAround",a,function(a){"1000"===a.code?(a=a.detail[0],"startZoneNode"==b.zoneNode&&(startZone=a,b.startZoneNode.value=startZone.name,b.startCostNode.innerHTML=startZone.name),"endZoneNode"==b.zoneNode&&(endZone=a,b.endZoneNode.value=endZone.name,b.endCostNode.innerHTML=endZone.name)):alert(a.info)},function(a){})}},selectSeaTab:function(){b.add(this.seaBtnNode,
"myselect");b.remove(this.pathBtnNode,"myselect");b.remove(this.seaTabNode,"hidden");b.add(this.pathTabNode,"hidden");""!=this.zoneListNode.innerHTML&&(this.zoneListNode.innerHTML="",b.add(this.pageContainerNode,"hidden"))},selectPathTab:function(){b.remove(this.seaBtnNode,"myselect");b.add(this.pathBtnNode,"myselect");b.add(this.seaTabNode,"hidden");b.remove(this.pathTabNode,"hidden")},zoneInit:function(){this.cnameNode.value="";this.startZoneNode.value="";this.endZoneNode.value="";this.zoneListNode.innerHTML=
"";b.add(this.pageContainerNode,"hidden");b.add(this.totalCostNode,"hidden");b.add(this.startCostNode,"hidden");b.add(this.costListNode,"hidden");b.add(this.addrListNode,"hidden");b.add(this.endCostNode,"hidden")}})});