//>>built
define("com/huayun/webgis/widget/searchs/NameSearch","require dojo/on dojo/_base/declare dojo/dom-class dojo/dom-style dijit/form/Select dojo/store/Memory dojo/data/ObjectStore ../../../util/WKTGeometryFormater ../../geometry/MapPoint ../../Feature ../../Graphic ../../geometry/Extent ../../geometry/Point ../../../facades/AgsFacade ../../symbols/ImageSymbol ../MapModuleX dojo/text!../../templates/searchs/nameSearch.html".split(" "),function(m,D,p,b,q,r,t,u,v,E,w,x,y,F,z,n,A,B){return p("com.huayun.webgis.widget.searchs.NameSearch",
[A],{templateString:B,baseClass:"nameSearch",constructor:function(a){this.agsUrl=a.agsUrl},postCreate:function(){this.inherited(arguments);this._agsFacade=new z;this._currentPage=1;this._defaultValue=5;this.addressList=[]},doInit:function(){this.view=this.get("view");this.changeMethod=null;this.wktGeometryFormater=new v;this.locationGraphic=null;this._imageSymbol=new n({url:m.toUrl("com/huayun/webgis/css/images/red.png"),width:21,height:33});this._locationImageSymbol=new n({url:m.toUrl("com/huayun/webgis/css/images/blue.png"),
width:21,height:33});this.graphics=[];this.zoneSelect=new r({name:"zoneName",class:"type-select__node"},this.zoneSelectNode);this.zoneSelect.startup();this._agsFacade.getCityCodeData(this.agsUrl,function(a){"1000"===a.code&&(a=new t({idProperty:"cityCode",data:a.detail}),a=new u({objectStore:a,labelProperty:"name"}),this.zoneSelect.setStore(a),this.zoneSelect.set("value","33401"))}.bind(this),function(a){})},focusHandle:function(){var a=a?a:window.event;a.target.focus()},compositionstartHandler:function(){},
compositionendHandler:function(){},oninputHandler:function(a){0<this.cnameNode.value.length?b.remove(this.closeBtnNode,"hidden"):b.add(this.closeBtnNode,"hidden")},onChange2Path:function(){b.add(this.domNode,"hidden");this.changeMethod&&this.changeMethod()},_clear2Change:function(){b.remove(this.changeIcon,"hidden");b.add(this.clearIcon,"hidden")},_change2Clear:function(){b.add(this.changeIcon,"hidden");b.remove(this.clearIcon,"hidden")},keypressHandler:function(a){13===a.keyCode&&this.searchKeyZone()},
searchKeyZone:function(){var a=this.cnameNode.value;if(""===a||null==a)alert("\u8bf7\u8f93\u5165\u5730\u5740");else{b.add(this.closeBtnNode,"hidden");this._change2Clear();var C=this.zoneSelect.getValue();this._agsFacade.getInterestPlaceData(this.agsUrl,{words:a,citycode:C,num:20},function(a){"1000"===a.code?(this.addressList=a.detail,b.remove(this.pageContainerNode,"hidden"),this.addressList.length<=this._defaultValue&&b.add(this.pageContainerNode,"hidden"),b.add(this.preButton,"button-disabled"),
this.addressHandle(this.addressList)):alert(a.info)}.bind(this),function(a){})}},zoneListClick:function(a){a=a?a:window.event;a=(a.target||a.srcElement).getAttribute("index")-1;this.locationGraphic&&(this.locationGraphic.symbol=this._imageSymbol);this.locationGraphic=this.graphics[a];this.locationGraphic.symbol=this._locationImageSymbol;a=this.locationGraphic.feature.geometry;this.view.centerAt(a.x,a.y)},prevPage:function(){1<this._currentPage&&(this._currentPage--,this.addressHandle(this.addressList),
this._currentPage<this._defaultValue-1&&b.remove(this.nextButton,"button-disabled"),1===this._currentPage&&b.add(this.preButton,"button-disabled"))},nextPage:function(){this._currentPage<this._defaultValue-1&&(this._currentPage++,2===this._currentPage&&b.remove(this.preButton,"button-disabled"),this.addressHandle(this.addressList),this._currentPage===this._defaultValue-1&&b.add(this.nextButton,"button-disabled"))},addressHandle:function(a){this.zoneListNode.innerHTML="";if(null!=a){for(var b=0,f=
this._currentPage*this._defaultValue>a.length?a.length:this._currentPage*this._defaultValue,d=[],c=(this._currentPage-1)*this._defaultValue;c<f;c++){var b=b+1,h=a[c].address;d.push(a[c].centerPoint);var g=a[c].name,e=document.createElement("li");e.setAttribute("index",b);q.set(e,"cursor","pointer");var k=document.createElement("strong");k.className="zoneIcon";k.innerHTML=b;k.setAttribute("index",b);var l=document.createElement("span");l.innerHTML=g;l.setAttribute("index",b);g=document.createElement("p");
g.innerHTML=h;g.setAttribute("index",b);e.appendChild(k);e.appendChild(l);e.appendChild(g);this.zoneListNode.appendChild(e)}this.addIcon2Map(d)}},addIcon2Map:function(a){this.drawLayer||(this.drawLayer=this.view.map.findLayerById("drawLayer"));this.graphics=[];this.drawLayer.clear();var b=this.getMapExtent(a);a.forEach(function(a){a=this.wktGeometryFormater.toGeometry(a);a=new w({attribute:null,geometry:a});a=new x({feature:a,symbol:this._imageSymbol});this.graphics.push(a);this.drawLayer.addGraphic(a)}.bind(this));
this.view.setExtent(b)},getMapExtent:function(a){for(var b=[],f=[],d=0;d<a.length;d++){var c=this.wktGeometryFormater.toGeometry(a[d]);b.push(c.x);f.push(c.y)}var h=c=d=a=0;a=Math.min.apply(null,b);c=Math.max.apply(null,b);d=Math.min.apply(null,f);h=Math.max.apply(null,f);return new y(a,d,c,h)},closeSearch:function(){this.drawLayer||(this.drawLayer=this.view.map.findLayerById("drawLayer"));this.graphics=[];this.drawLayer.clear();this._clear2Change();this.locationGraphic=null;b.add(this.pageContainerNode,
"hidden");this.zoneListNode.innerHTML="";b.add(this.closeBtnNode,"hidden");this.cnameNode.value=""}})});