//>>built
require({cache:{"url:com/huayun/webgis/templates/deviceSearch.html":"<div class=\"${baseClass}\">\r\n    <div class=\"title-container\">\r\n        <span class=\"active\" data-dojo-attach-event=\"onclick: switchSBD\">输变电</span>\r\n        <span data-dojo-attach-event=\"onclick: switchPD\">配电</span>\r\n        <span data-dojo-attach-event=\"onclick: switchDY\">低压</span>\r\n    </div>\r\n    <div class=\"input-container\">\r\n        <div>\r\n            设备类型: <select class=\"device-select\" data-dojo-attach-point=\"selectNode\"></select>\r\n        </div>\r\n        <div>\r\n            设备名称: <input type=\"text\" data-dojo-attach-point=\"searchName\"><button data-dojo-attach-event=\"onclick: search\"></button>\r\n        </div>\r\n    </div>\r\n    <div class=\"result-container\">\r\n        <div class=\"device-result\" >\r\n            搜索结果 <span class=\"count-result\" data-dojo-attach-point=\"countResult\">(0)</span>\r\n            <span class=\"page-count\" data-dojo-attach-point=\"pageResult\">\r\n                <button class=\"pre-page\" data-dojo-attach-event=\"onclick: prePage\"></button>\r\n                <span data-dojo-attach-point=\"countPage\">1/20</span>\r\n                <button class=\"next-page\" data-dojo-attach-event=\"onclick: nextPage\"></button>\r\n            </span>\r\n        </div>\r\n        <div data-dojo-attach-point=\"searchResult\">\r\n\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n"}});define("com/huayun/webgis/widget/DeviceSearch",["dojo/_base/declare","dojo/request","dojo/query","dojo/dom-class","./DeviceResult","./MapModuleX","dojo/text!../templates/deviceSearch.html"],function(_1,_2,_3,_4,_5,_6,_7){return _1("com.huayun.webgis.widget.DeviceSearch",[_6],{baseClass:"deviceSearch",templateString:_7,constructor:function(){this.map=null;this.sbd=null;this.pd=null;this.dy=null;this.modelClass=null;this.ftsService="";this.vdcService="";this.currentState="sbd";this.data=null;this.page=1;this.maxPage=1;this.view=null;},doInit:function(){this.map=this.get("map");this.view=this.get("view");this.modelClass={};var _8=this.get("configData");this.sbd=_8.data[0].types;this.pd=_8.data[1].types;this.dy=_8.data[2].types;this.ftsService=_8.ftsService;this.vdcService=_8.vdcService;var _9=document.createElement("option");_9.value=" ";_9.text="请选择";this.selectNode.add(_9);for(var i=0;i<this.sbd.length;i++){_9=document.createElement("option");_9.value=this.sbd[i]["class_id"];_9.text=this.sbd[i]["class_desc"];this.selectNode.add(_9);}var _a=_8.modelClass;_2.get(_a,{handleAs:"json"}).then(function(_b){var _c=_b.data,_d;for(var i=0;i<_c.length;i++){_d=_c[i];this.modelClass[_d["CLASS_ID"]]={"name":_d["CLASS_NAME"],"table":_d["G_TABLE_NAME"]};}}.bind(this));},search:function(){var _e=this.selectNode.value,_f=this.searchName.value,_10=this.modelClass[_e].name,_11=this.modelClass[_e].table;this.searchResult.innerHTML="";_2.get(this.ftsService+"?name="+_f+"&class_name="+_10,{handleAs:"json"}).then(function(_12){if(_12.resultState==="0000"){var _13=_12.data;this.data=_13;this.countResult.innerText="( "+_13.length+" )";if(_13.length<6){this.pageResult.style.visibility="hidden";}else{this.pageResult.style.visibility="visible";}if(_13.length===0){alert("未查询到设备");}else{var _14="/";var _15=Math.min(5,_13.length);this.page=1;this.maxPage=Math.ceil(_13.length/5);this.countPage.innerHTML=this.page+"/"+this.maxPage;for(var i=0;i<_15;i++){_14+=_13[i]["PSR_ID"]+",";}_2.get(this.vdcService+_11+_14.substr(0,_14.length-1),{handleAs:"json"}).then(function(_16){if(_16.resultState==="0000"){var _17=_16.data;for(var m=0;m<_17.length;m++){var _18=new _5({sequence:m+1,name:_17[m]["NAME"],shape:_17[m]["SHAPE"],map:this.map});this.searchResult.append(_18.domNode);}}}.bind(this));}}}.bind(this));},switchSBD:function(e){if(this.currentState!=="sbd"){_3(".title-container span").forEach(function(_19){_4.remove(_19,"active");});_4.add(e.target,"active");for(var i=this.selectNode.children.length;i>0;i--){this.selectNode.remove(i);}var _1a;for(i=0;i<this.sbd.length;i++){_1a=document.createElement("option");_1a.value=this.sbd[i]["class_id"];_1a.text=this.sbd[i]["class_desc"];this.selectNode.add(_1a);}this.currentState="sbd";}},switchPD:function(e){if(this.currentState!=="pd"){_3(".title-container span").forEach(function(_1b){_4.remove(_1b,"active");});_4.add(e.target,"active");for(var i=this.selectNode.children.length;i>0;i--){this.selectNode.remove(i);}var _1c;for(i=0;i<this.pd.length;i++){_1c=document.createElement("option");_1c.value=this.pd[i]["class_id"];_1c.text=this.pd[i]["class_desc"];this.selectNode.add(_1c);}this.currentState="pd";}},switchDY:function(e){if(this.currentState!=="dy"){_3(".title-container span").forEach(function(_1d){_4.remove(_1d,"active");});_4.add(e.target,"active");for(var i=this.selectNode.children.length;i>0;i--){this.selectNode.remove(i);}var _1e;for(i=0;i<this.dy.length;i++){_1e=document.createElement("option");_1e.value=this.dy[i]["class_id"];_1e.text=this.dy[i]["class_desc"];this.selectNode.add(_1e);}this.currentState="dy";}},prePage:function(){if(this.page>1){this.searchResult.innerHTML="";this.page-=1;this.countPage.innerHTML=this.page+"/"+this.maxPage;var _1f="/",_20=this.selectNode.value,_21=this.modelClass[_20].table;var _22=Math.min(this.page*5,this.data.length);for(var i=(this.page-1)*5;i<_22;i++){_1f+=this.data[i]["PSR_ID"]+",";}_2.get(this.vdcService+_21+_1f.substr(0,_1f.length-1),{handleAs:"json"}).then(function(_23){if(_23.resultState==="0000"){var _24=_23.data;for(var m=0;m<_24.length;m++){var _25=new _5({sequence:m+1,name:_24[m]["NAME"],shape:_24[m]["SHAPE"],map:this.map});this.searchResult.append(_25.domNode);}}}.bind(this));}},nextPage:function(){if(this.page<this.maxPage){this.searchResult.innerHTML="";this.page+=1;this.countPage.innerHTML=this.page+"/"+this.maxPage;var _26="/",_27=this.selectNode.value,_28=this.modelClass[_27].table;var _29=Math.min(this.page*5,this.data.length);for(var i=(this.page-1)*5;i<_29;i++){_26+=this.data[i]["PSR_ID"]+",";}_2.get(this.vdcService+_28+_26.substr(0,_26.length-1),{handleAs:"json"}).then(function(_2a){if(_2a.resultState==="0000"){var _2b=_2a.data;for(var m=0;m<_2b.length;m++){var _2c=new _5({sequence:m+1,name:_2b[m]["NAME"],shape:_2b[m]["SHAPE"],map:this.map});this.searchResult.append(_2c.domNode);}}}.bind(this));}}});});