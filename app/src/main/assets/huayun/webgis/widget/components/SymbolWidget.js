//>>built
define("com/huayun/webgis/widget/components/SymbolWidget",["../../Viewpoint","../../Graphic","../../Feature","../../gl/Context","../../symbols/CompositeMarkSymbol","../../symbols/CompositeLineSymbol","../../symbols/CompositeFillSymbol","../../symbols/CircleSymbol","../../symbols/LineSymbol","../../symbols/FontSymbol","../../symbols/PolygonSymbol","../../symbols/DecorationLineSymbol","../../geometry/Point","../../geometry/Multipoint","../../geometry/Polyline","../../geometry/Polygon","../../renderer/LineRenderer","../../renderer/FontRenderer","../../renderer/DecorationLineRenderer","../../renderer/CompositeMarkerRenderer","../../renderer/CompositeLineRenderer","../../renderer/CompositeFillRenderer"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e,_f,_10,_11,_12,_13,_14,_15,_16){var _17=document.createElement("canvas");_17.id="graphic-item";var _18=_17.getContext("webgl");function _19(_1a){this.el=_1a.el;this.data=_1a.data;this.size=_1a.data.size;this.symbol=_1a.data.symbol;this.type=this.symbol.type;this.id=this.symbol.id;this.name=this.symbol.name;this.symbols=this.symbol.symbols;_18.canvas.width=this.size;_18.canvas.height=this.size;_18.viewport(0,0,this.size,this.size);var _1b;if(_1a.data.bgColor){_1b=_1a.data.bgColor.split(",");}else{_1b=[0,0,0,1];}_18.clearColor(_1b[0],_1b[1],_1b[2],_1b[3]);this._initViewPoint();this.graphicList=[];this._createGraphic();};_19.prototype.update=function(_1c){this.data=_1c.data;this.size=this.data.size||this.size;this.symbol=this.data.symbol||this.symbol;this.symbols=this.symbol.symbols;for(var i=0;i<this.graphicList.length;i++){var _1d=this.graphicList[i];if(_1d.id===this.id){_1d.graphic.symbol=this._createCompositeSymbol(this.symbols);break;}}this.view.threeRender();};_19.prototype._initViewPoint=function(){var _1e=new _4(_18);this.view={width:this.size,height:this.size,resolution:1,scale:1,context:_1e,geometryToScreen:function(x,y){return new _d(x,y);},threeRender:function(){this.graphicList.forEach(function(_1f){var _20=_1f.graphic;if(_20.renderer){var cvs=_1f.canvas;var ctx=cvs.getContext("2d");ctx.clearRect(0,0,cvs.width,cvs.height);_18.clear(_18.COLOR_BUFFER_BIT);_20.renderer.draw(this.view,_20,_20.feature.geometry,_20.symbol);ctx.drawImage(_17,0,0);}}.bind(this));}.bind(this)};var _21=new _1(this.view.width,this.view.height,0,0,0,0,0,this.view);this.view.viewpoint=_21;_21.center=[this.size*0.5,this.size*0.5];_21.resolution=1;_21.calcMatrix(false);};_19.prototype._createGraphic=function(){var _22=this._createGeometry();var _23=this._createCompositeSymbol(this.symbols);var _24=new _2({feature:new _3({attributes:null,geometry:_22}),symbol:_23});this.el.width=this.size;this.el.height=this.size;this.graphicList.push({id:this.id,graphic:_24,canvas:this.el});var _25=this._createRenderer();if(_25!==null){_25.add(this.view,_24,_22,_23);_24.renderer=_25;this.view.threeRender();}};_19.prototype._createRenderer=function(){var _26=null;switch(this.type){case "1001":_26=new _14();break;case "1002":_26=new _15();break;case "1003":_26=new _16();break;case "1004":_26=null;break;}return _26;};_19.prototype._createCompositeSymbol=function(_27){var _28=null;switch(this.type){case "1001":_28=new _5({symbol:_27,size:this.size*0.4});break;case "1002":_28=new _6({symbol:_27});break;case "1003":_28=new _7({symbol:_27});break;}return _28;};_19.prototype._createGeometry=function(){var _29=null;switch(this.type){case "1001":_29=this._getPointGeometry();break;case "1002":_29=this._getLineGeometry();break;case "1003":_29=new _10([[new _d(this.size/4,this.size/4),new _d(this.size*3/4,this.size/4),new _d(this.size*3/4,this.size*3/4),new _d(this.size/4,this.size*3/4),new _d(this.size/4,this.size/4)]]);break;}return _29;};_19.prototype._getPointGeometry=function(){if(this.symbols.length===1){if(this.symbols[0]["baseid"]==="p_twocoiltransformer_style"){return new _e([new _d(this.size*0.5,this.size),new _d(this.size*0.5,0)]);}else{if(this.symbols[0]["baseid"]==="p_threecoiltransformer_style"){var r=0.75,d=1.5,lp=0.3;var vl=lp+d+r+r*0.5+lp;var _2a=Math.cos(30*Math.PI/180)*r*this.size/vl;var lw=this.size*0.5-_2a;var rw=this.size*0.5+_2a;return new _e([new _d(this.size*0.5,this.size),new _d(lw,0),new _d(rw,0)]);}else{if(this.symbols[0]["baseid"]==="p_autotransformer_style"){var tap=this.symbols[0]["tap"];if(tap==="true"){return new _e([new _d(this.size*0.5,this.size),new _d(this.size*0.5,this.size*0.5),new _d(this.size*0.5,0)]);}else{return new _e([new _d(this.size*0.5,this.size),new _d(this.size*0.5,0)]);}}else{return new _d(this.size*0.5,this.size*0.5);}}}}else{return new _d(this.size*0.5,this.size*0.5);}};_19.prototype._getLineGeometry=function(){if(this.symbols[0]["baseid"]==="l_leadlinesymbol_style"){return new _f([[new _d(0,this.size*0.5),new _d(this.size*0.5,this.size*0.5),new _d(this.size,this.size*0.5)]]);}else{if(this.symbols[0]["baseid"]==="l_multileadlinesymbol_style"){return new _f([[new _d(0,this.size*0.5),new _d(this.size*0.5,this.size*0.5),new _d(this.size,this.size*0.5)]]);}else{return new _f([[new _d(0,this.size*0.5),new _d(this.size,this.size*0.5)]]);}}};return _19;});