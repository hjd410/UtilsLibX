//>>built
define("com/huayun/webgis/widget/components/ComparisonWidget",["../../Viewpoint","../../Graphic","../../Feature","../../gl/Context","../../symbols/CompositeMarkSymbol","../../symbols/CompositeLineSymbol","../../symbols/CompositeFillSymbol","../../symbols/CircleSymbol","../../symbols/LineSymbol","../../symbols/FontSymbol","../../symbols/PolygonSymbol","../../symbols/DecorationLineSymbol","../../geometry/Point","../../geometry/Multipoint","../../geometry/Polyline","../../geometry/Polygon","../../renderer/LineRenderer","../../renderer/FontRenderer","../../renderer/DecorationLineRenderer","../../renderer/CompositeMarkerRenderer","../../renderer/CompositeLineRenderer","../../renderer/CompositeFillRenderer"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e,_f,_10,_11,_12,_13,_14,_15,_16){var _17=document.createElement("canvas");_17.id="graphic-item";var _18=_17.getContext("webgl");function _19(_1a){this.el=_1a.el;this.data=_1a.data;this.scale=_1a.scale;this.size=this.el.width;this.symbol=_1a.data.symbol;this.type=this.symbol.type;this.id=this.symbol.id;this.name=this.symbol.name;this.symbols=this.symbol.symbols;this.currentCompositeSymbol=null;_18.canvas.width=this.size;_18.canvas.height=this.size;_18.viewport(0,0,this.size,this.size);var _1b;if(_1a.data.bgColor){_1b=_1a.data.bgColor.split(",");}else{_1b=[0,0,0,1];}_18.clearColor(_1b[0],_1b[1],_1b[2],_1b[3]);this._initViewPoint();this.graphicList=[];this._createGraphic();};_19.prototype.update=function(_1c){this.data=_1c.data;this.scale=_1c.scale;this.symbol=this.data.symbol||this.symbol;this.symbols=this.symbol.symbols;for(var i=0;i<this.graphicList.length;i++){var _1d=this.graphicList[i];if(_1d.id===this.id){var _1e=this._createCompositeSymbol(this.symbols);this.currentCompositeSymbol=_1e;var _1f=this._createRenderer();if(_1f!==null){_1d.graphic.reset();_1d.graphic.symbol=_1e;_1d.graphic.renderer=_1f;_1f.add(this.view,_1d.graphic,_1d.graphic.feature.geometry,_1e);this.view.threeRender();}break;}}};_19.prototype.updateGraphics=function(){this.graphicList.forEach(function(_20){var _21=_20.graphic;if(_21.renderer){_21.destroy();_21.renderer.add(this.view,_21,_21.feature.geometry,_21.symbol);}}.bind(this));};_19.prototype._initViewPoint=function(){var _22=new _4(_18);this.view={width:this.size,height:this.size,resolution:1,scale:1,context:_22,geometryToScreen:function(x,y){return new _d(x,y);},threeRender:function(){var ctx;this.graphicList.forEach(function(_23){var _24=_23.graphic;if(_24.renderer){var cvs=_23.canvas;ctx=cvs.getContext("2d");ctx.clearRect(0,0,cvs.width,cvs.height);_18.clear(_18.COLOR_BUFFER_BIT);_24.renderer.draw(this.view,_24,_24.feature.geometry,_24.symbol);ctx.drawImage(_17,0,0);}}.bind(this));if(ctx){ctx.save();ctx.strokeStyle="red";ctx.setLineDash([5,5]);ctx.beginPath();ctx.moveTo(0,ctx.canvas.height*0.5+0.5);ctx.lineTo(ctx.canvas.width,ctx.canvas.height*0.5+0.5);ctx.moveTo(ctx.canvas.width*0.5+0.5,0);ctx.lineTo(ctx.canvas.width*0.5+0.5,ctx.canvas.height);ctx.stroke();ctx.restore();}}.bind(this)};var _25=new _1(this.view.width,this.view.height,0,0,0,0,0,this.view);this.view.viewpoint=_25;_25.center=[this.size*0.5,this.size*0.5];_25.resolution=1;_25.calcMatrix(false);};_19.prototype._createGraphic=function(){var _26=this._createGeometry();var _27=this._createCompositeSymbol(this.symbols);this.currentCompositeSymbol=_27;var _28=new _2({feature:new _3({attributes:null,geometry:_26}),symbol:_27});this.el.width=this.size;this.el.height=this.size;this.graphicList.push({id:this.id,graphic:_28,canvas:this.el});var _29=this._createRenderer();if(_29!==null){_29.add(this.view,_28,_26,_27);_28.renderer=_29;this.view.threeRender();}};_19.prototype._createRenderer=function(){var _2a=null;switch(this.type){case "1001":_2a=new _14();break;case "1002":_2a=new _15();break;case "1003":_2a=new _16();break;case "1004":_2a=null;break;}return _2a;};_19.prototype._createCompositeSymbol=function(_2b){var _2c=null;switch(this.type){case "1001":_2c=new _5({symbol:_2b,isFixed:false,minScale:this.scale});break;case "1002":_2c=new _6({symbol:_2b});break;case "1003":_2c=new _7({symbol:_2b});break;}return _2c;};_19.prototype._createGeometry=function(){var _2d=null;switch(this.type){case "1001":_2d=this._getPointGeometry();break;case "1002":_2d=this._getLineGeometry();break;case "1003":_2d=new _10([[new _d(this.size/4,this.size/4),new _d(this.size*3/4,this.size/4),new _d(this.size*3/4,this.size*3/4),new _d(this.size/4,this.size*3/4),new _d(this.size/4,this.size/4)]]);break;}return _2d;};_19.prototype._getPointGeometry=function(){if(this.symbols.length===1){if(this.symbols[0]["baseid"]==="p_twocoiltransformer_style"){return new _e([new _d(this.size*0.5,this.size),new _d(this.size*0.5,0)]);}else{if(this.symbols[0]["baseid"]==="p_threecoiltransformer_style"){var r=0.75,d=1.5,lp=0.3;var vl=lp+d+r+r*0.5+lp;var _2e=Math.cos(30*Math.PI/180)*r*this.size/vl;var lw=this.size*0.5-_2e;var rw=this.size*0.5+_2e;return new _e([new _d(this.size*0.5,this.size),new _d(lw,0),new _d(rw,0)]);}else{if(this.symbols[0]["baseid"]==="p_autotransformer_style"){var tap=this.symbols[0]["tap"];if(tap==="true"){return new _e([new _d(this.size*0.5,this.size),new _d(this.size*0.5,this.size*0.5),new _d(this.size*0.5,0)]);}else{return new _e([new _d(this.size*0.5,this.size),new _d(this.size*0.5,0)]);}}else{return new _d(this.size*0.5,this.size*0.5);}}}}else{return new _d(this.size*0.5,this.size*0.5);}};_19.prototype._getLineGeometry=function(){if(this.symbols[0]["baseid"]==="l_leadlinesymbol_style"){return new _f([[new _d(0,this.size*0.5),new _d(this.size*0.5,this.size*0.5),new _d(this.size,this.size*0.5)]]);}else{if(this.symbols[0]["baseid"]==="l_multileadlinesymbol_style"){return new _f([[new _d(0,this.size*0.5),new _d(this.size*0.5,this.size*0.5),new _d(this.size,this.size*0.5)]]);}else{return new _f([[new _d(0,this.size*0.5),new _d(this.size,this.size*0.5)]]);}}};_19.prototype.refresh=function(){this.view.threeRender();};return _19;});