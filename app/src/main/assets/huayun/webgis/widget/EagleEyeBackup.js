//>>built
require({cache:{"url:com/huayun/webgis/templates/eagleEye.html":"<div class=\"eagleEye-box\" data-dojo-attach-point=\"eagleEyeBox\" style=\"pointer-events: none;\">\r\n    <div class=\"target-view-box\" draggable=\"true\" data-dojo-attach-point=\"viewBox\" style=\"pointer-events: auto;\"></div>\r\n    <p data-dojo-attach-point=\"slideEagleEye\"  data-dojo-attach-event=\"onclick:toggle\" class=\"eagleEye-toggle-btn\" id=\"eagleEye-toggle-button\" style=\"pointer-events: all;\"></p>\r\n</div>\r\n\r\n"}});define("com/huayun/webgis/widget/EagleEyeBackup",["dojo/_base/declare","dojo/_base/fx","dojo/dom","dojo/dom-class","dojo/dom-construct","dojo/dom-attr","dojo/topic","dojo/on","dojo/_base/query","../../module/supportClass/BaseMapModule","../../webgis/geometry/Extent","../Map","../../webgis/views/SceneView","../../webgis/layers/TileLayer","../../webgis/layers/MapImageLayer","../facade/MapConfigFacade","../action/MapAction","dojo/text!../templates/eagleEye.html"],function(_1,_2,_3,_4,_5,_6,_7,on,_8,_9,_a,_b,_c,_d,_e,_f,_10,_11){return _1("com.huayun.webgis.widget.EagleEye",[_9],{smallMap:null,bigMap:null,bigView:null,eagleEyeDomId:"eagleEyeDom",templateString:_11,name:"EagleEye",baseClass:"eagleEye",targetViewBoxClass:"target-view-box",toggleBtnClass:"eagleEye-toggle-btn",toggleBtnId:"eagleEye-toggle-button",perPxExtent:0,perPyExtent:0,scale:2,status:false,showFlag:true,width:0,height:0,showLogo:false,toggleBtnSize:16,_moveHandler:null,_centerTopAndLeft:{},constructor:function(){this.view=null;_7.subscribe("mapLoadComplete",function(){this._mapLoadCompleteHandler();}.bind(this));window.addEventListener("resize",this._resize.bind(this),false);},doInit:function(){var _12=this.context.lookUp("simpleMapModule3D");this.bigMap=_12.map;this.bigView=_12.view;this.aspect_ratio=this.bigView.width/this.bigView.height;this.width=400;this.height=this.width/this.aspect_ratio;this.targetViewBoxDom=document.getElementsByClassName(this.targetViewBoxClass)[0];_8("."+this.baseClass).style("width",this.width+"px");_8("."+this.baseClass).style("height",this.height+"px");_8("."+this.baseClass).style("overflow","hidden");_8("."+this.targetViewBoxClass).style("width",this.width/this.scale+"px");_8("."+this.targetViewBoxClass).style("height",this.height/this.scale+"px");_8("."+this.targetViewBoxClass).style("top",(1-1/this.scale)/2*this.height+"px");_8("."+this.targetViewBoxClass).style("left",(1-1/this.scale)/2*this.width+"px");_8("."+this.toggleBtnClass).style("left","0");_8("."+this.toggleBtnClass).style("bottom","0");_8("#"+this.eagleEyeDomId).style("position","absolute");_8("#"+this.eagleEyeDomId).style("top","0");_8("#"+this.eagleEyeDomId).style("left","0");var _13=this.get("config");this.view=new _c({container:this.domNode,map:this.bigMap,name:"EagleEye"});this.view.extent=_12.view.extent;this.view.setLevel(_12.view.level-3);this.view.allLayerViews.forEach(function(_14){if(_14.id!=="tile"){_14.setVisible(false);}});_7.subscribe("extentChangeEvent",function(_15){var _16=_12.view.level-3;var _17;if(_16>0){_17=_12.view.extent.getCenter();var _18=this.view.extent.getCenter();this.view.setLevel(_16);this.view.centerAt(_17.x,_17.y);}else{_17=_12.view.extent.getCenter();this.view.setLevel(0);this.view.centerAt(_17.x,_17.y);}this._setTargetViewBoxToCenter();}.bind(this));this.getPxExtent();this.getPyExtent();this.addDragEventListener();this.toggle();},_resize:function(){},_setTargetViewBoxToCenter:function(){_8("."+this.targetViewBoxClass).style("top",(1-1/this.scale)/2*this.height+"px");_8("."+this.targetViewBoxClass).style("left",(1-1/this.scale)/2*this.width+"px");},getPxExtent:function(){var _19=(this.view.extent.maxx-this.view.extent.minx)/this.width;this.perPxExtent=_19;return _19;},getPyExtent:function(){var _1a=(this.view.extent.maxy-this.view.extent.miny)/this.height;this.perPyExtent=_1a;return _1a;},addDragEventListener:function(){var _1b=document.getElementsByClassName(this.targetViewBoxClass);var _1c={};this._centerTopAndLeft={top:_1b[0].style.top.slice(0,-2),left:_1b[0].style.left.slice(0,-2)};on(_1b[0],"mousedown",function(e){e.stopPropagation();e.preventDefault();var x=e.pageX||e.clientX+(document.body.scrollLeft||document.documentElement.scrollLeft);var y=e.pageY||e.clientY+(document.body.scrollTop||document.documentElement.scrollTop);_1c.x=x;_1c.y=y;this._moveHandler=on(this.domNode,"mousemove",function(evt){this._onMouseMoveMethod({evt:evt,target:_1b[0],startValue:_1c});}.bind(this));}.bind(this));on(document,"mouseup",function(e){e.stopPropagation();if(this._moveHandler!==null){this._moveHandler.remove();this._moveHandler=null;var _1d=e.pageX||e.clientX+(document.body.scrollLeft||document.documentElement.scrollLeft);var _1e=e.pageY||e.clientY+(document.body.scrollTop||document.documentElement.scrollTop);var _1f={x:_1d-_1c.x,y:_1e-_1c.y};var _20=this.getNewMapExtent(_1f),_21=_20.getCenter();this.bigView.centerAt(_21.x,_21.y);_1b[0].style.top=this._centerTopAndLeft.top+"px";_1b[0].style.left=this._centerTopAndLeft.left+"px";}}.bind(this));},_onMouseMoveMethod:function(_22){if(Math.abs(_22.evt.clientY-_22.startValue.y)>Number(_22.target.style.height.slice(0,-2))){_22.target.style.top=_22.evt.clientY-_22.startValue.y>0?_22.target.style.height:"0px";}else{_22.target.style.top=Number(this._centerTopAndLeft.top)+_22.evt.clientY-_22.startValue.y+"px";}if(Math.abs(_22.evt.clientX-_22.startValue.x)>Number(_22.target.style.width.slice(0,-2))){_22.target.style.left=_22.evt.clientX-_22.startValue.x>0?_22.target.style.width:"0px";}else{_22.target.style.left=Number(this._centerTopAndLeft.left)+_22.evt.clientX-_22.startValue.x+"px";}},getNewMapExtent:function(_23){this.getPxExtent();this.getPyExtent();var _24=this.bigView.extent;var _25=new _a(_24.minx+_23.x*this.perPxExtent,_24.miny+-_23.y*this.perPyExtent,_24.maxx+_23.x*this.perPxExtent,_24.maxy+-_23.y*this.perPyExtent);return _25;},toggle:function(){if(this.showFlag){this.hide();}else{this.show();}},hide:function(){var _26=this;_2.animateProperty({node:this.domNode,properties:{top:-_26.height+_26.toggleBtnSize,right:-_26.width+_26.toggleBtnSize},duration:400}).play();this.showFlag=false;_8("#"+this.toggleBtnId).style("transform","rotate(90deg)");},show:function(){var _27=this;_2.animateProperty({node:_27.domNode,properties:{top:0,right:0},duration:400}).play();this.showFlag=true;_8("#"+this.toggleBtnId).style("transform","rotate(-90deg)");}});});