//>>built
require({cache:{"url:com/huayun/webgis/templates/gridLayerControl.html":"<div class=\"${baseClass}\" style=\"width: 100px;\" data-dojo-attach-event=\"mouseover:_onMouseOverHandler,mouseout:_onMouseOutHandler\">\r\n    <div style=\"border:2px solid #EEEEEE;width: 52px;float:right;background: #EEEEEE\" data-dojo-attach-event=\"onclick:_changeGridState\">\r\n        <div class=\"gridOpenIcon hidden\" data-dojo-attach-point=\"openNode\"\r\n             style=\"height: 27px;background-repeat: no-repeat;\"></div>\r\n        <div class=\"gridCloseIcon hidden\" data-dojo-attach-point=\"closeNode\"\r\n             style=\"height: 27px;background-repeat: no-repeat;\"></div>\r\n        <div data-dojo-attach-point=\"gridTxt\" style=\"font-size: 1px;text-align: center\"></div>\r\n    </div>\r\n</div>"}});define("com/huayun/webgis/widget/GridLayerControl",["dojo/_base/declare","dojo/topic","dojo/on","dojo/dom-construct","dojo/dom-class","dojo/dom-style","./MapModuleX","../../util/HashTable","dojo/text!../templates/gridLayerControl.html"],function(_1,_2,on,_3,_4,_5,_6,_7,_8){return _1("com.huayun.webgis.widget.GridLayerControl",[_6],{templateString:_8,baseClass:"gridLayerControlClass",_map:null,_view:null,_visible:true,_filters:[],_id:"power",_floatNode:null,_showHash:null,_hideHash:null,_allHash:null,constructor:function(){_2.subscribe("layerControllerGridChange",this._layerControllerGridChangeHandler.bind(this));_2.subscribe("mapImageLayerVisibleChange",this._mapImageLayerVisibleChange.bind(this));},postCreate:function(){this.inherited(arguments);this._showHash=new _7();this._hideHash=new _7();this._allHash=new _7();this._floatNode=_3.create("div",{className:"change-control"},this.domNode);_4.add(this._floatNode,"hidden");},doInit:function(){this._map=this.get("map");this._view=this.get("view");var _9=this.get("configData");var _a=_9["configuration"]["grid"];this._visible=_a.visible;this._filters=_a.filters;if(!this._visible){_4.remove(this.openNode,"hidden");this.gridTxt.innerHTML="打开电网";}else{_4.remove(this.closeNode,"hidden");this.gridTxt.innerHTML="关闭电网";}if(this._map.findLayerById(this._id)){this._map.findLayerById(this._id).setVisible(this._visible);}else{_2.subscribe("layerComplete",function(_b){this._map.findLayerById(this._id).setVisible(this._visible);}.bind(this));}this._createCheckBox();},_createCheckBox:function(){for(var i=0;i<this._filters.length;i++){var _c=this._filters[i];this._allHash.put(_c.id,_c);if(_c.visible){this._showHash.put(_c.id,_c);}else{this._hideHash.put(_c.id,_c);}var _d=_3.create("div",{className:"grid-label",innerHTML:_c.label},this._floatNode,"last");_3.create("input",{type:"checkbox",value:_c.id,checked:_c.visible,onchange:this._visibleSwitch.bind(this)},_d,"first");}},_visibleSwitch:function(_e){_e.preventDefault();_e.stopPropagation();var _f=this._allHash.get(_e.target.value);if(_e.target.checked){_f.visible=true;this._showHash.put(_e.target.value,_f);this._hideHash.remove(_e.target.value);}else{_f.visible=false;this._hideHash.put(_e.target.value,_f);this._showHash.remove(_e.target.value);}var _10=this._map.findLayerById(this._id);if(this._isAllShowBoolean()){_10.setFilter();}else{var _11="&layers=hide:"+this._getHideSubLayers(_10).toString();_10.setFilter(_11);}_10.refresh();},_isAllShowBoolean:function(){var _12=this._allHash.getKeyList();var _13=true;for(var i=0;i<_12.length;i++){var key=_12[i];_13=_13&this._allHash.get(key).visible;}return _13;},_getHideSubLayers:function(_14){var _15=[];var _16=this._hideHash.getKeyList();for(var i=0;i<_16.length;i++){var key=_16[i];for(var j=0;j<_14.sublayers.length;j++){var _17=_14.sublayers[j];if(_17.name===key){_15=_15.concat(_17["subLayerIds"]);break;}}}return _15;},_changeGridState:function(_18){_18.preventDefault();_18.stopPropagation();this._visible=!this._visible;if(!this._visible){_4.remove(this.openNode,"hidden");_4.add(this.closeNode,"hidden");_4.add(this._floatNode,"hidden");this.gridTxt.innerHTML="打开电网";}else{_4.remove(this.closeNode,"hidden");_4.add(this.openNode,"hidden");_4.remove(this._floatNode,"hidden");this.gridTxt.innerHTML="关闭电网";}this._map.findLayerById(this._id).setVisible(this._visible);_2.publish("gridLayerControlChange",this._visible);},_onMouseOverHandler:function(_19){_19.preventDefault();_19.stopPropagation();if(this._visible){_4.remove(this._floatNode,"hidden");}},_onMouseOutHandler:function(){event.preventDefault();event.stopPropagation();if(this._visible){_4.add(this._floatNode,"hidden");}},_layerControllerGridChangeHandler:function(_1a){this._visible=_1a;if(!this._visible){_4.remove(this.openNode,"hidden");_4.add(this.closeNode,"hidden");this.gridTxt.innerHTML="打开电网";}else{_4.remove(this.closeNode,"hidden");_4.add(this.openNode,"hidden");this.gridTxt.innerHTML="关闭电网";}},_mapImageLayerVisibleChange:function(_1b,_1c){if(_1c===this._id){this._visible=_1b;if(!this._visible){_4.remove(this.openNode,"hidden");_4.add(this.closeNode,"hidden");this.gridTxt.innerHTML="打开电网";}else{_4.remove(this.closeNode,"hidden");_4.add(this.openNode,"hidden");this.gridTxt.innerHTML="关闭电网";}}}});});