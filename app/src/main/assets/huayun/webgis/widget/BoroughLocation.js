//>>built
require({cache:{"url:com/huayun/webgis/templates/boroughLocation.html":"<div>\r\n    <div class=\"boroughLocation-panel\">\r\n        <div class=\"boroughLocation-head\">\r\n            <span class=\"titleIcon\">行政区定位</span>\r\n            <span class=\"borough-clear-btn\" data-dojo-attach-point=\"clearNode\" data-dojo-attach-event=\"onclick:clear\">清除定位</span>\r\n        </div>\r\n        <div class=\"boroughLocation-content\">\r\n            <div id=\"${treeId}\"></div>\r\n        </div>\r\n    </div>\r\n</div>"}});define("com/huayun/webgis/widget/BoroughLocation",["dojo/_base/declare","dojo/dom-class","dojo/dom-construct","dojo/topic","dojo/_base/query","com/huayun/facades/ConfigFacade","dojo/store/Memory","dijit/Tree","dijit/tree/TreeStoreModel","dijit/tree/ObjectStoreModel","dojo/data/ItemFileReadStore","./MapModuleX","./LocatingController","../geometry/Polyline","../symbols/LineSymbol","../Feature","../Graphic","../../webgis/geometry/Extent","../../webgis/geometry/Point2D","dojo/text!../templates/boroughLocation.html"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e,_f,_10,_11,_12,_13,_14){return _1("com.huayun.webgis.widget.BoroughLocation",[_c],{view:null,localTool:null,templateString:_14,name:"行政区定位",PARENT_CODE:"330000000000",baseClass:"boroughLocation",btnId:"boroughLocation-btn",btnClass:"boroughLocation-btn",treeId:"boroughTree",btnText:"行政区定位",width:"400px",height:"800px",drawLayer:null,_lineSymbol:null,_feature:null,_currentGraphic:null,_geometry:null,constructor:function(){this.maxLevel=15;},_getList:function(url){var _15=this;this.inherited(arguments);this.configFacade=new _6();this.configFacade.getZoneSelect(url,function(_16){if(_16.resultState=="0000"){var _17=_16.data;var _18=new _7({data:_17,idProperty:"CODE",getChildren:function(_19){return this.query({PARENT_CODE:_19.CODE});}});var _1a=new _a({store:_18,query:{FID:1345},labelAttr:"NAME",typeAttr:""});_1a.mayHaveChildren=function(_1b){if(_1b.root){return true;}else{if(_1a.store.query({PARENT_CODE:_1b.CODE}).total===0){return false;}else{return true;}}};var _1c=new _8({id:"boroughTree",model:_1a,showRoot:true,openOnClick:false,openOnDblClick:true,autoExpand:false,persist:true},_15.treeId);_1c.startup();_1c.on("click",function(_1d){this._onExpandoClick({node:_1c.get("selectedNodes")[0]});var _1e=_15.geoTransform(_1d["SHAPE"]);_15._drawPath(_1e);});}},function(err){});},_getMinRange:function(_1f,_20){var _21=Math.min.apply(null,_1f),_22=Math.max.apply(null,_1f),_23=Math.min.apply(null,_20),_24=Math.max.apply(null,_20);var _25=new _12(_21,_23,_22,_24);this.view.setExtent(_25);},_drawPath:function(_26){if(!this.drawLayer){this.drawLayer=this.view.map.findLayerById("drawLayer");}if(_26.length===0){return;}this.drawLayer.clear();var _27=[],_28=[],_29=[];_26.forEach(function(_2a){var _2b=[];for(var i=0;i<_2a.length;i++){var _2c=_2a[i];_28.push(_2c.x);_29.push(_2c.y);_2b.push(new _13(_2c.x,_2c.y));}_27.push(_2b);});this._geometry.setPath(_27);this.drawLayer.addGraphic(this._currentGraphic);this._getMinRange(_28,_29);},doInit:function(){this._getList(this.get("url"));this.view=this.get("view");this.maxLevel=this.view.maxLevel;this.localTool=new _d();this._lineSymbol=new _f({color:"#11ff6b",width:2,join:"round",cap:"round"});this._geometry=new _e();this._feature=new _10({attribute:null,geometry:this._geometry});this._currentGraphic=new _11({feature:this._feature,symbol:this._lineSymbol});},geoTransform:function(_2d){var _2e={};var _2d=_2d.toLocaleUpperCase();if(_2d.startsWith("MULTIPOLYGON")){_2e["type"]="MULTIPOLYGON";var reg=/\({2}(\d+\.?\d+\s+\d+\d+\.\d+,?)+\){2}/g;var _2f=_2d.match(reg);var _30=/(\d+\.?\d+\s+\d+\d+)/g;var _31=[];_2f.forEach(function(_32){var _33=_32.match(_30);var _34=[];for(var i=0;i<_33.length;i++){var _35=_33[i].split(" ");_34.push({x:Number(_35[0]),y:Number(_35[1])});}_31.push(_34);});}return _31;},clear:function(){this.drawLayer.removeGraphic(this._currentGraphic);}});});