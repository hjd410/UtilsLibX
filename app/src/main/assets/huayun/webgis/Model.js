//>>built
define("com/huayun/webgis/Model",["./utils/glTFLoader","./gl/SegmentVector","custom/gl-matrix-min"],function(_1,_2,_3){var _4={"TRIANGLES":3,"TriangleFan":3,"TriangleStrip":3};var _5={unload:0,loading:1,loaded:2};function _6(_7,_8,_9){var m;if(_7.matrix){m=_3.mat4.multiply(new Float32Array(16),_9,_7.matrix);}if(_7.geometry){_7.modelMatrix=m?m:_9;_8.push(_7);}if(_7.children){_7.children.forEach(function(o){_6(o,_8,m?m:_9);});}};function _a(_b,_c,_d,_e,_f){var _10=_c.attributes;var _11=_10.position;var _12=_b.createVertexBuffer({length:_11.count,bytesPerElement:_11.itemSize*_11.array.BYTES_PER_ELEMENT,arrayBuffer:_11.array},[{name:"position",type:"Float32",components:_11.itemSize,offset:0}]);var _13=_c.index;var _14=_b.createIndexBuffer({arrayBuffer:_13.array});var _15=_2.simpleSegment(0,0,_11.count,_13.count/_4[_d]);return {vertexBuffer:_12,indexBuffer:_14,segments:_15,modelMatrix:_e,material:_f};};var uid=0;function _16(_17){this.url=_17.url;this.loaded=false;this.state=_5.unload;this.buckets=[];this.id="model"+(uid++);};_16.prototype.load=function(_18,_19){if(this.state===_5.unload){var _1a=_18.context;var _1b=this;this.state=_5.loading;_1.load(this.url,function(_1c){_1b.loaded=true;_1b.state=_5.loaded;var _1d=_1c.scene;var _1e=[];var _1f=_3.mat4.create();_6(_1d,_1e,_1f);for(var i=0,ii=_1e.length;i<ii;i++){var obj=_1e[i];var _20=obj.geometry;_1b.buckets.push(_a(_1a,_20,obj.drawMode,obj.modelMatrix,obj.material));}_19();});}};return _16;});