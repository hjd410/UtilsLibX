//>>built
define("com/huayun/webgis/facade/tiffTerrainFacade",["exports","dojo/request","../data/TiffTerrainData","./TiffTagEnum"],function(b,n,v,p){var w={4:{func:"getUint32",bytes:4},12:{func:"getFloat64",bytes:8},2:{func:"getUint8",bytes:1},3:{func:"getUint16",bytes:2}};b.loadTifDat=function(p,q,b){n.get(p,{handleAs:"arraybuffer"}).then(function(f){f=new DataView(f);for(var d=0,a=[],h=0;3968>h;h++){for(var e=[],c=0;3456>c;c++)e.push(f.getInt16(d,!0)),d+=2;a.push(e)}q(new v({version:1,imageWidth:3415,imageHeight:3882,
reference:[0,0,0,497038.9953648312,3433999.3373779617,0],resolutions:[30,30,0],tileWidth:128,tileHeight:128,tiles:a}))})};b.loadTifTerrain=function(b,q,r){n.get(b,{handleAs:"arraybuffer"}).then(function(f){var d=new DataView(f),a=0;d.getUint16(a,!0);a+=2;f=d.getUint16(a,!0);for(var a=a+2,a=d.getUint32(a,!0),h=d.getUint16(a,!0),a=a+2,e={},c=[],k=0;k<h;k++){var g=d.getUint16(a,!0),a=a+2,b=d.getUint16(a,!0),a=a+2,m=d.getUint32(a,!0),a=a+4;if(1===m){var l=d.getUint32(a,!0);e[p[g]]={type:b,len:m,value:l}}else l=
d.getUint32(a,!0),e[p[g]]={type:b,len:m,offset:l},c.push(p[g]);a+=4}c.forEach(function(b){var c=e[b];a=c.offset;var h=c.len,f=c.type,g=[],m=w[f].func,f=w[f].bytes;for(k=0;k<h;k++)g.push(d[m](a,!0)),a+=f;if("GeoAsciiParamsTag"===b||"GdalMetadata"===b||"GdalNoData"===b){var l="";g.forEach(function(a){l+=String.fromCharCode(a)});c.value=l}else c.value=g});for(var h=e.GdalNoData.value.trim(),h=parseFloat(h),c=e.TileWidth.value,g=e.TileHeight.value,b=e.ImageWidth.value,m=e.ImageHeight.value,l=[],n=Math.ceil(b/
c),k=0;k<m;k++){for(var x=[],r=Math.floor(k/g),z=0,A=k%g*c*2,t=0;t<n;t++)for(var a=e.TileOffsets.value[r*n+t]+A,y=0;y<c;y++){var u=d.getInt16(a,!0);u===h&&(u=0);x[z++]=u;a+=2}l.push(x)}q(new v({version:f,imageWidth:b,imageHeight:m,reference:e.GeoreferenceTag.value,resolutions:e.ModelPixelScaleTag.value,tileWidth:c,tileHeight:g,tiles:l}))}).catch(r)}});