//>>built
define("com/huayun/webgis/facade/tiffTerrainFacade2",["exports","dojo/request","../data/TiffTerrainData","./TiffTagEnum"],function(c,n,x,p){var u={4:{func:"getUint32",bytes:4},12:{func:"getFloat64",bytes:8},2:{func:"getUint8",bytes:1},3:{func:"getUint16",bytes:2}};c.loadTifTerrain=function(c,y,q){n.get(c,{handleAs:"arraybuffer"}).then(function(c){var e=new DataView(c),a=0;e.getUint16(a,!0);a+=2;c=e.getUint16(a,!0);for(var a=a+2,a=e.getUint32(a,!0),b=e.getUint16(a,!0),a=a+2,f={},k=[],g=0;g<b;g++){var d=
e.getUint16(a,!0),a=a+2,m=e.getUint16(a,!0),a=a+2,h=e.getUint32(a,!0),a=a+4;if(1===h){var l=e.getUint32(a,!0);f[p[d]]={type:m,len:h,value:l}}else l=e.getUint32(a,!0),f[p[d]]={type:m,len:h,offset:l},k.push(p[d]);a+=4}k.forEach(function(b){var c=f[b];a=c.offset;var k=c.len,d=c.type,h=[],m=u[d].func,d=u[d].bytes;for(g=0;g<k;g++)h.push(e[m](a,!0)),a+=d;if("GeoAsciiParamsTag"===b||"GdalMetadata"===b||"GdalNoData"===b){var l="";h.forEach(function(a){l+=String.fromCharCode(a)});c.value=l}else c.value=h});
debugger;for(var b=f.GdalNoData.value.trim(),b=parseFloat(b),b=f.TileWidth.value,k=f.TileHeight.value,d=f.ImageWidth.value,m=f.ImageHeight.value,h=[],l=Math.ceil(d/b),n=Math.ceil(m/k),g=0;g<d;g++){for(var v=[],q=Math.floor(g/k),z=0,A=g%k*b*4,r=0;r<l;r++)for(var a=f.TileOffsets.value[q*n+r]+A,w=0;w<b;w++){var t=e.getFloat32(a,!0);-3.3E38>t&&(t=0);v[z++]=t;a+=4}h.push(v)}y(new x({version:c,imageWidth:d,imageHeight:m,reference:f.GeoreferenceTag.value,resolutions:f.ModelPixelScaleTag.value,tileWidth:b,
tileHeight:k,tiles:h}))}).catch(q)}});