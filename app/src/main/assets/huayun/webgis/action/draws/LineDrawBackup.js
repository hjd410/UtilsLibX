//>>built
define("com/huayun/webgis/action/draws/LineDrawBackup",["dojo/_base/declare","dojo/on","dojo/dom-class","dojo/throttle","../../geometry/Polyline","../../Graphic","../../Feature","../../symbols/LineSymbol","../../geometry/Point2D","../ActiveMapAction"],function(_1,on,_2,_3,_4,_5,_6,_7,_8,_9){return _1("com.huayun.webgis.action.draws.LineDraw",[_9],{constructor:function(_a){this.view=_a.view;this.view.selectEnabled=false;this.isActive=true;this.drawLayer=_a.drawLayer?_a.drawLayer:this.view.map.findLayerById("drawLayer");this._mouseClick=null;this._dblMouseClick=null;this._mouseClickMove=null;this._lastPoint=null;this.cachePoint=[];this.capture=_a.capture===undefined?false:_a.capture;if(this.capture){this.captureRadius=_a.captureRadius===undefined?5:_a.captureRadius;}this._symbol=_a.symbol?_a.symbol:new _7({color:"#009688",width:3});this._currentGraphic=null;},active:function(){if(!this.state){this.state=true;this.view.panEnabled=false;this.view.selectEnabled=false;this._mouseClick=on(this.view.domNode,"click",this._onMouseClick.bind(this));this._dblMouseClick=on(this.view.domNode,"dblclick",this._onDoubleMouseClick.bind(this));if(this.capture){this.captureMove=on(this.view.domNode,"mousemove",this._captureMoveHandler.bind(this));}_2.add(this.view.domNode,"draw-cursor-style");}},_captureMoveHandler:function(e){var _b=this.view.screenToGeometry(e.x,e.y);var _c=this.drawLayer.captureFeaturesByGeometry(_b,this.captureRadius);if(_c.length>0){for(var i=0;i<_c.length;i++){if(_c[i].symbol.type==="point"){if(_c[i]!==this.selectPoint){this.selectPoint=_c[i];this.capturePoint(this.selectPoint);}break;}}this.view.threeRender();}else{if(this.selectPoint){this.releasePoint(this.selectPoint);this.selectPoint=null;}this.view.threeRender();}},_onMouseClick:function(_d){_d.preventDefault();_d.stopPropagation();var _e=this.view.screenToGeometry(_d.x,_d.y);if(this._lastPoint===null){this.doAction(_e);}else{if(_d.x!==this._lastPoint.x&&_d.y!==this._lastPoint.y){this.doAction(_e);}}this._lastPoint={x:_d.x,y:_d.y};},_onDoubleMouseClick:function(_f){_f.preventDefault();_f.stopPropagation();if(this._currentGraphic){this.addAttributes(this._currentGraphic);}this._endDrawMethod();},endActionMethod:function(){},invalid:function(){this.state=false;this.view.panEnabled=true;this.view.selectEnabled=true;if(this._mouseClick!==null){this._mouseClick.remove();this._mouseClick=null;}if(this._dblMouseClick!==null){this._dblMouseClick.remove();this._dblMouseClick=null;}if(this.captureMove!==null){this.captureMove.remove();this.captureMove=null;}this._endDrawMethod();},doAction:function(_10){this._drawVertex(_10);this._drawLine();},_drawVertex:function(_11){var geo;if(this.selectPoint){geo=this.selectPoint.feature.geometry;}else{geo=_11;}if(this.cachePoint.length===0){this.cachePoint.push(geo);}else{this.cachePoint.splice(this.cachePoint.length-1,1,geo);this.cachePoint.push(geo);}},_drawLine:function(){this.view.panEnabled=false;if(!this._mouseClickMove){this._mouseClickMove=on(this.view.domNode,"mousemove",function(e){var geo=this.view.screenToGeometry(e.x,e.y);this.drawLayer.removeGraphic(this._currentGraphic);var _12=new _4();var _13=new _6({attribute:null,geometry:_12});var _14=new _5({feature:_13,symbol:this._symbol});if(this.cachePoint.length<2){this.cachePoint.push(new _8(geo.x,geo.y));}else{this.cachePoint.splice(this.cachePoint.length-1,1,new _8(geo.x,geo.y));}_12.setPath([this.cachePoint]);this._currentGraphic=_14;this.drawLayer.addGraphic(_14);this.drawLayer.layerView.view.threeRender();}.bind(this));}},_endDrawMethod:function(){if(this._mouseClickMove!==null){this._mouseClickMove.remove();this._mouseClickMove=null;}this.cachePoint=[];this._lastPoint=null;this._currentGraphic=null;},capturePoint:function(_15){},releasePoint:function(_16){},addAttributes:function(){}});});