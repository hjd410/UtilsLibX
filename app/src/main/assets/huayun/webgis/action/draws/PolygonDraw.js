//>>built
define("com/huayun/webgis/action/draws/PolygonDraw",["dojo/_base/declare","dojo/on","dojo/dom-class","dojo/throttle","../../geometry/Polygon","../../geometry/Point2D","../../Graphic","../../Feature","../../symbols/PolygonSymbol","../../symbols/PointSymbol","../ActiveMapAction"],function(_1,on,_2,_3,_4,_5,_6,_7,_8,_9,_a){return _1("com.huayun.webgis.action.draws.PolygonDraw",[_a],{constructor:function(_b){this.view=_b.view;this.view.selectEnabled=false;this.isActive=true;this.drawLayer=this.view.map.findLayerById("drawLayer");this._mouseClick=null;this._dblMouseClick=null;this._mouseClickMove=null;this._lastPoint=null;this._vertexArr=[];this._polygonList=[];this._symbol=_b.symbol?_b.symbol:new _8({color:"#4CAF50",opacity:0.8});this._vertexSymbol=new _9({radius:5,color:"#0000FF"});this._currentGraphic=null;this.drawEndHook=[];},active:function(){if(!this.state){this.state=true;this.view.panEnabled=false;this.view.selectEnabled=false;this._mouseClick=on(this.view.domNode,"click",this._onMouseClick.bind(this));this._dblMouseClick=on(this.view.domNode,"dblclick",this._onDoubleMouseClick.bind(this));_2.add(this.view.domNode,"draw-cursor-style");this._createPolygonList();}},_createPolygonList:function(){for(var i=this._polygonList.length-1;i>-1;i--){var _c=this._polygonList[i];if(_c.length===0){this._polygonList.splice(i,1);}}this._vertexArr=[];this._polygonList.push(this._vertexArr);},_onMouseClick:function(_d){_d.preventDefault();_d.stopPropagation();var _e=this.view.screenToGeometry(_d.x,_d.y);if(!this._mouseMove){this._mouseMove=on(this.view.domNode,"mousemove",this._onMouseMove.bind(this));}if(this._lastPoint===null){this.doAction(_e);}else{if(_d.x!==this._lastPoint.x&&_d.y!==this._lastPoint.y){this.doAction(_e);}}this._lastPoint={x:_d.x,y:_d.y};},_onMouseMove:function(e){var _f=this.view.screenToGeometry(e.x,e.y);this.drawLayer.removeGraphic(this._currentGraphic);var _10=new _4();var _11=new _7({attribute:null,geometry:_10});var _12=new _6({feature:_11,symbol:this._symbol});if(this._preClick){this._vertexArr.push(new _5(_f.x,_f.y));this._preClick=false;}else{this._vertexArr.splice(this._vertexArr.length-1,1,new _5(_f.x,_f.y));}_10.setPath([this._vertexArr]);this._currentGraphic=_12;this.drawLayer.addGraphic(_12);this.drawLayer.layerView.view.threeRender();},_onDoubleMouseClick:function(_13){_13.preventDefault();_13.stopPropagation();this._endDrawMethod();},invalid:function(){this.state=false;this.view.panEnabled=true;if(this._mouseClick!==null){this._mouseClick.remove();this._mouseClick=null;}if(this._dblMouseClick!==null){this._dblMouseClick.remove();this._dblMouseClick=null;}this._vertexArr=[];this._endDrawMethod();},doAction:function(_14){this._drawPoint(_14);},_drawVertex:function(x,y){},_drawPoint:function(_15){var geo=new _5(_15.x,_15.y);var _16=new _7({attribute:null,geometry:geo});var _17=new _6({feature:_16,symbol:this._vertexSymbol});this.drawLayer.addGraphic(_17);var len=this._vertexArr.length;this._preClick=true;if(len<3){this._vertexArr.push(new _5(geo.x,geo.y));}else{this._vertexArr.splice(this._vertexArr.length-1,1,new _5(_15.x,_15.y));}this.drawLayer.layerView.view.threeRender();},_endDrawMethod:function(){if(this._mouseClickMove!==null){this._mouseClickMove.remove();this._mouseClickMove=null;}for(var i=0;i<this.drawEndHook.length;i++){this.drawEndHook[i](this._currentGraphic);}this._vertexArr=[];this._currentGraphic=null;}});});