//>>built
define("com/huayun/webgis/action/select/PolygonSelected",["dojo/_base/declare","dojo/on","dojo/topic","../../geometry/Extent","../../geometry/Polygon","../../Graphic","../../Feature","../../symbols/PolygonSymbol","../ActiveMapAction"],function(_1,on,_2,_3,_4,_5,_6,_7,_8){return _1("com.huayun.webgis.action.select.PolygonSelected",[_8],{constructor:function(_9){this.view=_9.view;this.view.selectEnabled=false;this.isActive=true;this.drawLayer=this.view.map.findLayerById("drawLayer");this._mouseClick=null;this._dblMouseClick=null;this._mouseClickMove=null;this._mouseUp=null;this._lastPoint=null;this._vertexArr=[];this._polygonList=[];this.cachePoint=[];this._currentGraphic=null;this._feature=null;this._geometry=null;this._symbol=null;},active:function(){if(!this.state){this.state=true;this.view.panEnabled=false;this.view.selectEnabled=false;this._mouseClick=on(this.view.domNode,"click",this._onMouseClick.bind(this));this._dblMouseClick=on(this.view.domNode,"dblclick",this._onDoubleMouseClick.bind(this));this._createPolygonList();}},_createPolygonList:function(){for(var i=this._polygonList.length-1;i>-1;i--){var _a=this._polygonList[i];if(_a.length===0){this._polygonList.splice(i,1);}}this._vertexArr=[];this._polygonList.push(this._vertexArr);},_onMouseClick:function(_b){_b.preventDefault();_b.stopPropagation();if(this._lastPoint===null){this._symbol=new _7({color:255,opacity:0.2});this._geometry=new _4();this._feature=new _6({attribute:null,geometry:this._geometry});this._currentGraphic=new _5({feature:this._feature,symbol:this._symbol});this.drawLayer.addGraphic(this._currentGraphic);this.doAction({x:_b.x,y:_b.y});}else{if(_b.x!==this._lastPoint.x&&_b.y!==this._lastPoint.y){this.doAction({x:_b.x,y:_b.y});}}this._lastPoint={x:_b.x,y:_b.y};},_onDoubleMouseClick:function(_c){_c.preventDefault();_c.stopPropagation();if(_c.button===0){this._vertexArr=[];this._lastPoint=null;this._currentGraphic.clear();this._endDrawMethod();}},invalid:function(){this.state=false;this.view.panEnabled=true;if(this._mouseClick!==null){this._mouseClick.remove();this._mouseClick=null;}if(this._dblMouseClick!==null){this._dblMouseClick.remove();this._dblMouseClick=null;}this._vertexArr=[];this._endDrawMethod();this.endActionMethod.call();},doAction:function(_d){this._drawPolygon(_d.x,_d.y);},_drawVertex:function(x,y){},_drawPolygon:function(x,y){this.view.panEnabled=false;var _e=this.view.screenToGeometry(x,y);if(this._vertexArr.length===0){this._vertexArr[0]=_e;this._vertexArr[this._vertexArr.length]=_e;}else{this._vertexArr.splice(this._vertexArr.length-1,0,_e);}if(!this._mouseClickMove){this._mouseClickMove=on(this.view.domNode,"mousemove",function(e){var ep=this.view.screenToGeometry(e.x,e.y),_f=this._vertexArr.length;this._vertexArr[_f-1]=ep;this._geometry.setPath(this._vertexArr);if(this._vertexArr.length>2){this._currentGraphic.refresh();}}.bind(this));}},_endDrawMethod:function(){if(this._mouseClickMove!==null){this._mouseClickMove.remove();this._mouseClickMove=null;}if(this._mouseUp!==null){this._mouseUp.remove();this._mouseUp=null;}}});});