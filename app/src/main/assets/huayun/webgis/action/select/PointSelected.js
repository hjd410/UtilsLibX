//>>built
define("com/huayun/webgis/action/select/PointSelected",["dojo/_base/declare","dojo/on","dojo/topic","dojo/dom-construct","dojo/_base/window","../../geometry/Point2D","../ActiveMapAction"],function(_1,on,_2,_3,_4,_5,_6){return _1("com.huayun.webgis.action.select.PointSelected",[_6],{constructor:function(_7){_1.safeMixin(this,_7);this.view=_7.view;this.state=false;this.drawLayer=this.view.map.findLayerById("drawLayer");this._onClick=null;this.showResult=document.getElementById("selectResult");if(!this.showResult){this.showResult=_3.create("div",{className:"select-result",id:"selectResult"},_4.body());}},active:function(){if(!this.state){this.state=true;this.view.selectEnabled=true;this._onClick=on(this.view.domNode,"click",this._mouseClick.bind(this));}},_mouseClick:function(e){this.doAction(e);},invalid:function(){this.view.panEnabled=true;this.showResult.style.display="none";this._endActionMethod.call(this);},doAction:function(e){if(this.view.selectEnabled){var _8=this.view.screenToGeometry(e.clientX,e.clientY);this.view.queryFeaturesByGeometry(new _5(_8.x,_8.y),5,function(_9){var _a=this.filterResult(_9);this.showResult.innerHTML=JSON.stringify(_a);this.showResult.style.display="block";this.drawLayer.highlightGraphic(_9[this.drawLayer.id]);}.bind(this));}},_endActionMethod:function(){this.state=false;this.showResult.style.display="none";if(this._onClick){this._onClick.remove();this._onClick=null;}},filterResult:function(_b){var _c={};for(var id in _b){if(id===this.drawLayer.id){var _d=_b[id];var _e=[];_d.forEach(function(_f){_e.push(_f.feature);});_c[id]=_e;}else{_c[id]=_b[id][0];}}return _c;}});});