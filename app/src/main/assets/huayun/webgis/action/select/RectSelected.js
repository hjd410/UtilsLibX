//>>built
define("com/huayun/webgis/action/select/RectSelected",["dojo/_base/declare","dojo/on","dojo/topic","dojo/dom-construct","dojo/_base/window","../../geometry/Extent","../../geometry/Polygon","../../geometry/Point","../../Graphic","../../Feature","../../symbols/PolygonSymbol","../ActiveMapAction"],function(_1,on,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b){return _1("com.huayun.webgis.action.select.RectSelected",[_b],{constructor:function(_c){_1.safeMixin(this,_c);this.view=_c.view;this.isActive=true;this.drawLayer=this.view.map.findLayerById("drawLayer");this._mouseDown=null;this._mouseUp=null;this._mouseClickMove=null;this.state=false;this.startPoint=null;this.endPoint=null;this.extent=null;this._currentGraphic=null;this._symbol=new _a({color:"#cccccc",opacity:0.5});this.showResult=document.getElementById("selectResult");if(!this.showResult){this.showResult=_3.create("div",{className:"select-result",id:"selectResult"},_4.body());}},active:function(){if(!this.state){this.state=true;this.view.selectEnabled=true;this.view.panEnabled=false;if(!this._mouseDown){this._mouseDown=on(this.view.domNode,"mousedown",this._onMouseDown.bind(this));}}},_onMouseDown:function(e){e.preventDefault();e.stopPropagation();if(e.button===0){this.startPoint=this.view.screenToGeometry(e.x,e.y);this.doAction();}},_onMouseClickMove:function(e){if(e.button===0){this.endPoint=this.view.screenToGeometry(e.x,e.y);this.drawLayer.removeGraphic(this._currentGraphic);var _d=new _6();var _e=new _9({attribute:null,geometry:_d});var _f=new _8({feature:_e,symbol:this._symbol});var sp=this.startPoint,ep=this.endPoint;this.extent=[sp,new _7(ep.x,sp.y),ep,new _7(sp.x,ep.y)];_d.setPath([this.extent]);this._currentGraphic=_f;this.drawLayer.addGraphic(_f);this.drawLayer.layerView.view.threeRender();}},_onMouseUp:function(e){if(this._mouseClickMove){this._mouseClickMove.remove();this._mouseClickMove=null;}if(this._mouseUp){this._mouseUp.remove();this._mouseUp=null;}this.drawLayer.removeGraphic(this._currentGraphic);this.view.queryFeaturesByGeometry(this.extent,8,function(_10){var obj=this.filterResult(_10);this.showResult.innerHTML=JSON.stringify(obj);this.showResult.style.display="block";this.drawLayer.highlightGraphic(_10[this.drawLayer.id]);}.bind(this));},invalid:function(){this.state=false;this.view.panEnabled=true;this.view.selectEnabled=true;this.cachePoint=[];this._endDrawMethod();this.endActionMethod.call();},doAction:function(){if(!this._mouseClickMove){this._mouseClickMove=on(this.view.domNode,"mousemove",this._onMouseClickMove.bind(this));}if(!this._mouseUp){this._mouseUp=on(document,"mouseup",this._onMouseUp.bind(this));}},_endDrawMethod:function(){if(this._mouseDown){this._mouseDown.remove();this._mouseDown=null;}if(this._mouseClickMove){this._mouseClickMove.remove();this._mouseClickMove=null;}if(this._mouseUp){this._mouseUp.remove();this._mouseUp=null;}this._currentGraphic=null;this.startPoint=null;this.endPoint=null;this.extent=null;this.showResult.style.display="none";},filterResult:function(_11){var obj={};for(var id in _11){if(id===this.drawLayer.id){var _12=_11[id];var arr=[];_12.forEach(function(_13){arr.push(_13.feature);});obj[id]=arr;}else{obj[id]=_11[id][0];}}return obj;}});});