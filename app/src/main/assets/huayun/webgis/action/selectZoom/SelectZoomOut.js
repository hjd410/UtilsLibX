//>>built
define("com/huayun/webgis/action/selectZoom/SelectZoomOut",["dojo/_base/declare","dojo/on","dojo/topic","dojo/dom-construct","../../geometry/Extent","../ActiveMapAction"],function(_1,on,_2,_3,_4,_5){return _1("com.huayun.webgis.action.SelectZoom.SelectZoomOut",[_5],{_mouseDown:null,_mouseUp:null,_mouseMove:null,drawLayer:null,startPoint:null,endPoint:{},state:false,flag:false,canvas:null,canvasId:"selectZoomCanvas",canvasShow:false,constructor:function(_6){_1.safeMixin(this,_6);this.view=_6.view;this.map=this.view.map;this.isActive=true;this.drawLayer=this.map.findLayerById("drawLayer");this._mouseDown=null;this._mouseUp=null;this._mouseMove=null;},active:function(){if(!this.state){this.state=true;this.view.panEnabled=false;this._mouseDown=on(this.view.domNode,"mousedown",this._onMouseDown.bind(this));this._mouseUp=on(this.view.domNode,"mouseup",this._onMouseUp.bind(this));}},addCanvas:function(){if(!this.canvas){var _7=document.createElement("canvas");_7.width=this.view.width;_7.height=this.view.height;_7.style="position:absolute;top:0;right:0;cursor:crosshair;";this.canvas=_7;this.ctx=_7.getContext("2d");this.view.domNode.appendChild(_7);}else{this.canvas.style.display="block";}this.canvasShow=true;},removeCanvas:function(){this.canvas.style.display="none";this.view.domNode.style="cursor: pointer;";this.canvasShow=false;},_onMouseDown:function(e){event.preventDefault();event.stopPropagation();this.startPoint={};this.addCanvas();this.selectStart(e);this.doAction();},_onMouseUp:function(e){event.preventDefault();event.stopPropagation();this.selectEnd(e);this.removeCanvas();this._mouseMove.remove();},_onMouseMove:function(e){event.preventDefault();event.stopPropagation();if(this.startPoint){this.drawRect(this.ctx,this.canvas,this.startPoint,e);}},invalid:function(){this._endDrawMethod();},doAction:function(){this._mouseMove=on(this.view.domNode,"mousemove",this._onMouseMove.bind(this));},selectStart:function(e){this.flag=!this.flag;this.startPoint.x=e.offsetX;this.startPoint.y=e.offsetY;},selectEnd:function(e){this.endPoint.x=e.offsetX;this.endPoint.y=e.offsetY;var _8=this.getSelectedExtend(this.startPoint,this.endPoint,this.canvas);this.view.setExtent(this.getNewMapExtent(_8));this.startPoint=null;this.endPoint={};this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);},drawRect:function(_9,_a,_b,e){_9.clearRect(0,0,_a.width,_a.height);_9.beginPath();_9.fillStyle="rgba(0,0,0,0.3)";_9.strokeStyle="rgba(0,0,0,0.6)";_9.fillRect(_b.x,_b.y,e.offsetX-_b.x,e.offsetY-_b.y);},getSelectedExtend:function(p1,p2,_c){var x1=p1.x,x2=p2.x,y1=p1.y,y2=p2.y;var _d=this.view.calcBounds(Math.min(x1,x2),Math.max(x1,x2),Math.min(y1,y2),Math.max(y1,y2));var _e=Math.min(_d[0].x,_d[1].x,_d[2].x,_d[3].x),_f=Math.max(_d[0].x,_d[1].x,_d[2].x,_d[3].x),_10=Math.min(_d[0].y,_d[1].y,_d[2].y,_d[3].y),_11=Math.max(_d[0].y,_d[1].y,_d[2].y,_d[3].y);return new _4(_e,_10,_f,_11);},getNewMapExtent:function(_12){var _13=_12,_14=this.view,_15=_14.getExtent();var _16=(_15.getWidth()/_12.getWidth()+_15.getHeight()/_12.getHeight())/2;var _17=_13.getCenter();var _18=_15.getWidth()*_16;var _19=_15.getHeight()*_16;var _1a=_17.x-_18/2;var _1b=_17.y-_19/2;var _1c=_17.x+_18/2;var _1d=_17.y+_19/2;var _1e=new _4(_1a,_1b,_1c,_1d);return _1e;},_endDrawMethod:function(){this.state=false;if(this._mouseDown){this._mouseDown.remove();this._mouseDown=null;}if(this._mouseUp){this._mouseUp.remove();this._mouseUp=null;}if(this._mouseMove){this._mouseMove.remove();this._mouseMove=null;}}});});