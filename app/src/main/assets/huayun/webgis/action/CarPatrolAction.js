//>>built
define("com/huayun/webgis/action/CarPatrolAction",["dojo/_base/declare","dojo/topic","./MapAction"],function(_1,_2,_3){return _1("com.huayun.webgis.action.CarPatrolAction",[_3],{pointsPos:null,counts:null,speeds:null,lens:null,raf:null,carModel:null,turningRadius:75,activeState:null,carParts:{body:[],rims:[],glass:[]},constructor:function(_4){_1.safeMixin(this,_4);this.count=[940,1180];var _5=(this.pointsPos[0].x-0)/this.count[0],_6=(this.pointsPos[0].y-0)/this.count[1],_7=(this.pointsPos[1].x-this.pointsPos[0].x)/this.count[0],_8=(this.pointsPos[1].y-this.pointsPos[0].y)/this.count[1],_9=(this.pointsPos[2].x-this.pointsPos[1].x)/this.count[0],_a=(this.pointsPos[2].y-this.pointsPos[1].y)/this.count[1],_b=(this.pointsPos[3].x-this.pointsPos[2].x)/this.count[0],_c=(this.pointsPos[3].y-this.pointsPos[2].y)/this.count[1];this.speeds=[{spx:_5,spy:_6},{spx:_7,spy:_8},{spx:_9,spy:_a},{spx:_b,spy:_c}];this.lens=[this.count[0],3*this.count[0],5*this.count[0],7*this.count[0]];},active:function(_d){this.activeState=_d;if(_d){this.map.panAble=false;this.map.zoomAble=false;this.map.rotateAble=false;this.carMove(0,true);}else{this.map.panAble=true;this.map.zoomAble=true;this.map.rotateAble=true;cancelAnimationFrame(this.raf);}},carMove:function(i,_e){if(i<this.lens[0]){if(!_e){this.map.rotateMap(-90);_e=true;i--;}else{this.map.patrol(this.speeds[0].spx,this.speeds[0].spy);}i++;this.raf=requestAnimationFrame(this.carMove.bind(this,i,_e));}else{if(i<this.lens[1]){if(_e){this.carModel.rotateY(-75/180*Math.PI);this.map.rotateMap(-90);_e=false;}else{this.map.patrol(this.speeds[1].spy,this.speeds[1].spx);}i++;this.raf=requestAnimationFrame(this.carMove.bind(this,i,_e));}else{if(i<this.lens[2]){if(!_e){this.carModel.rotateY(-100/180*Math.PI);this.map.rotateMap(-90);_e=true;}else{this.map.patrol(this.speeds[2].spx,this.speeds[2].spy);}i++;this.raf=requestAnimationFrame(this.carMove.bind(this,i,_e));}else{if(i<this.lens[3]){if(_e){this.map.rotateMap(-75/180*Math.PI);this.map.rotateMap(-90);_e=false;}else{this.map.patrol(this.speeds[3].spy,this.speeds[3].spx);}i++;this.raf=requestAnimationFrame(this.carMove.bind(this,i,_e));}else{this.map.rotateMap(-90);_e=true;i++;_2.publish("patrolOver");}}}}}});});