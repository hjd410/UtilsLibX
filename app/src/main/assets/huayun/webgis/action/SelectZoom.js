//>>built
define("com/huayun/webgis/action/SelectZoom",["dojo/_base/declare","dojo/on","dojo/topic","dojo/dom-construct","../geometry/Extent","./ActiveMapAction"],function(_1,on,_2,_3,_4,_5){return _1("com.huayun.webgis.action.SelectZoom",[_5],{_mouseDown:null,_mouseUp:null,_mouseMove:null,drawLayer:null,startPoint:{},endPoint:{},state:false,flag:false,canvas:null,canvasId:"selectZoomCanvas",canvasShow:false,constructor:function(_6){_1.safeMixin(this,_6);this.map=_6.map;this.isActive=true;this.drawLayer=this.map.findLayerById("drawLayer");this._mouseDown=null;this._mouseUp=null;this._mouseMove=null;},active:function(){if(!this.state){this.state=true;this._mouseDown=on(this.map.domNode,"mousedown",this._onMouseDown.bind(this));this._mouseUp=on(this.map.domNode,"mouseup",this._onMouseUp.bind(this));}},addCanvas:function(){if(!this.canvas){var _7=document.createElement("canvas");_7.setAttribute("data-dojo-attach-event","onmousewheel:_zoomMap");_7.width=this.map.realWidth;_7.height=this.map.realHeight;_7.style="position:absolute;top:0;right:0;cursor:crosshair;";this.canvas=_7;this.ctx=_7.getContext("2d");this.map.domNode.appendChild(_7);}else{this.canvas.style.display="block";}this.canvasShow=true;},removeCanvas:function(){this.canvas.style.display="none";this.map.domNode.style="cursor: pointer;";this.canvasShow=false;},_onMouseDown:function(e){event.preventDefault();event.stopPropagation();this.addCanvas();this.selectStart(e);this.doAction();},_onMouseUp:function(e){event.preventDefault();event.stopPropagation();this.selectEnd(e);this.map.panAble=true;this.removeCanvas();this._mouseMove.remove();this.invalid();},_onMouseMove:function(e){event.preventDefault();event.stopPropagation();if(this.startPoint){this.drawRect(this.ctx,this.canvas,this.startPoint,e);}},invalid:function(){this._endDrawMethod();this.endActionMethod.call();},doAction:function(){this._mouseMove=on(this.map.domNode,"mousemove",this._onMouseMove.bind(this));},selectStart:function(e){this.flag=!this.flag;this.map.panAble=false;this.startPoint.x=e.offsetX;this.startPoint.y=e.offsetY;},selectEnd:function(e){this.endPoint.x=e.offsetX;this.endPoint.y=e.offsetY;var _8=this.getSelectedExtend(this.startPoint,this.endPoint,this.canvas,this.map);this.map.setExtent(_8);_2.publish("setEagleEyeExtent",this.map.extent);this.startPoint={};this.endPoint={};this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);},drawRect:function(_9,_a,_b,e){_9.clearRect(0,0,_a.width,_a.height);_9.beginPath();_9.fillStyle="rgba(0,0,0,0.3)";_9.strokeStyle="rgba(0,0,0,0.6)";_9.fillRect(_b.x,_b.y,e.offsetX-_b.x,e.offsetY-_b.y);},getSelectedExtend:function(p1,p2,_c,_d){var _e={x:0,y:0};var _f={x:_c.width,y:_c.height};_e.x=p1.x<p2.x?p1.x:p2.x;_e.y=p1.y<p2.y?p1.y:p2.y;_f.x=p1.x>p2.x?p1.x:p2.x;_f.y=p1.y>p2.y?p1.y:p2.y;var _10=(_d.extent.maxx-_d.extent.minx)/_c.width;var _11=(_d.extent.maxy-_d.extent.miny)/_c.height;var _12=new _4(_d.extent.minx+p1.x*_10,_d.extent.maxy-p1.y*_11,_d.extent.minx+p2.x*_10,_d.extent.maxy-p2.y*_11);return _12;},_endDrawMethod:function(){this.state=false;if(this._mouseDown){this._mouseDown.remove();this._mouseDown=null;}if(this._mouseUp){this._mouseUp.remove();this._mouseUp=null;}if(this._mouseMove){this._mouseMove.remove();this._mouseMove=null;}}});});