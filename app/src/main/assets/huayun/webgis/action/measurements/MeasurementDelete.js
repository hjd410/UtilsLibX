//>>built
define("com/huayun/webgis/action/measurements/MeasurementDelete",["dojo/_base/declare","dojo/on","dojo/topic","dojo/dom-construct","dojo/_base/window","../ActiveMapAction","../../geometry/Point2D"],function(_1,on,_2,_3,_4,_5,_6){return _1("com.huayun.webgis.action.draws.DrawDelete",[_5],{constructor:function(_7){this.view=_7.view;this.view.selectEnabled=true;this.isActive=true;this._mouseClick=null;this.drawLayer=this.view.map.findLayerById("drawLayer");this.selectGraphic=null;this.tooltip=_3.create("div",{className:"delete-tooltip"},_4.body());_3.create("button",{className:"tip-ok",innerHTML:"确定",onclick:this.sureDelete.bind(this)},this.tooltip);_3.create("button",{className:"tip-cancel",innerHTML:"取消",onclick:this.cancelDelete.bind(this)},this.tooltip);},sureDelete:function(){if(this.selectGraphic){this.drawLayer.removeGraphic(this.selectGraphic);this.tooltip.style.visibility="hidden";_2.publish("measurement-delete",this.selectGraphic["id"]);this.selectGraphic=null;}},cancelDelete:function(){this.tooltip.style.visibility="hidden";},active:function(){if(!this.state){this.state=true;this.view.panEnabled=false;this.view.selectEnabled=false;this._mouseClick=on(this.view.domNode,"click",this._onMouseClick.bind(this));this.drawLayer.createIndex();}},invalid:function(){this.state=false;if(this._mouseClick!==null){this._mouseClick.remove();this._mouseClick=null;this.endActionMethod.call();}},_onMouseClick:function(_8){_8.preventDefault();_8.stopPropagation();this.doAction({x:_8.x,y:_8.y});},doAction:function(_9){this._deleteGraphic(_9.x,_9.y);},_deleteGraphic:function(x,y){var _a=this.view.screenToGeometry(x,y);var _b=this.drawLayer.queryFeaturesByGeometry(new _6(_a.x,_a.y));if(_b.length>0){this.tooltip.style.visibility="visible";this.tooltip.style.top=y+"px";this.tooltip.style.left=x+"px";this.selectGraphic=_b[0];}else{this.tooltip.style.visibility="hidden";}}});});