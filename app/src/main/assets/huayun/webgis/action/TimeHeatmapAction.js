//>>built
define("com/huayun/webgis/action/TimeHeatmapAction",["dojo/_base/declare","dojo/topic","./MapAction"],function(_1,_2,_3){return _1("com.huayun.webgis.action.TimeHeatmapAction",[_3],{targetLayerId:null,targetLayer:null,timeFlag:null,timeLine:null,time:0,count:97,night:true,timeInterval:3000,constructor:function(_4){_1.safeMixin(this,_4);this.targetLayer=this.map.findLayerById(this.targetLayerId);var _5=this;_2.subscribe("timeLineStop",function(){clearTimeout(_5.timeFlag);});_2.subscribe("timeLineGo",function(){_5.change();});_2.subscribe("timeHeatmapInterval",function(_6){_5.timeInterval+=_6;if(_5.timeInterval<1000){_5.timeInterval=1000;}});},active:function(_7){this.activeState=_7;if(_7){this.map.panAble=false;this.map.zoomAble=false;this.map.rotateAble=false;this.targetLayer.withPower=true;this.targetLayer.updatePower(this.time,true,15761408);this.timeLine.domNode.style.display="block";this.timeLine.set("time",0);_2.publish("heatmapShow",true);if(this.map.level>12){this.switchToNight();}this.change();}else{this.map.panAble=true;this.map.zoomAble=true;this.map.rotateAble=true;this.targetLayer.withPower=false;this.timeLine.domNode.style.display="none";this.time=0;this.count=97;_2.publish("heatmapShow",false);clearTimeout(this.timeFlag);if(this.map.level>12){var _8=this.map.mapType;if(_8.type=="basic"&&_8.more.night){this.switchToNight();}else{this.switchToDay();}}else{this.targetLayer.plane.visible=false;}}},change:function(){var _9=this;this.timeFlag=setTimeout(function(){if(_9.count>0){_9.time=(_9.time+15)%1440;var _a=Math.floor(_9.time/60);_a=_a<10?"0"+_a:_a;var _b=_9.time%60;_b=_b==0?"00":_b;var _c=_a+":"+_b+":00";_9.timeLine.set("time",_9.time);_9.targetLayer.updatePower(_c);_9.count--;if(_9.time>360&&_9.time<=1080&&_9.night){_9.switchToDay();_9.night=false;}if(_9.time>1080&&!_9.night){_9.switchToNight();_9.night=true;}_9.change();}else{_9.count=97;_9.time=0;}},this.timeInterval);},switchToNight:function(){var _d=this.map.layerContainer;_d.scene.background=new THREE.Color(4148055);_d.scene.fog.color=new THREE.Color(4148055);_2.publish("switchToNight",true);},switchToDay:function(){var _e=this.map.layerContainer;_e.scene.background=new THREE.Color(13426943);_e.scene.fog.color=new THREE.Color(13426943);_2.publish("switchToDay",true);}});});