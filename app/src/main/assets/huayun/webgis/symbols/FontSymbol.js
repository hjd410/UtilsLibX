//>>built
define("com/huayun/webgis/symbols/FontSymbol",["./Symbol","com/huayun/webgis/utils/Color","./support/GlyphAtlas","./supports/glyphManager","../../util/FontUnicodeUtil"],function(_1,_2,_3,_4,_5){function _6(_7){var _8=_1.call(this,_7)||this;_8.type="fontSymbol";_8.isFixed=_7.isFixed;_8.fixed={isFixed:_8.isFixed,addratio:0};_8.glyphReady=false;_8.width=0;_8.height=0;_8.color=_2.parse(_7.color||"#ff0000");_8.fontFamily=_7["font-family"];_8.fontSize=Number(_7["font-size"]);_8.fontStyle=_7["font-style"];_8.dx=Number(_7.dx||0);_8.dy=Number(_7.dy||0);_8.angle=Number(_7.angle||0)/180*Math.PI;_8.fillColor=[_8.color.r,_8.color.g,_8.color.b,_8.color.a];_8.uniforms={"u_size":_8.fontSize,"u_pitch_with_map":0,"u_opacity":1,"u_texture":0,"u_fill_color":[_8.color.r,_8.color.g,_8.color.b,_8.color.a],"u_gamma_scale":1,"u_rotate_symbol":1,"u_radian":_8.angle,"u_halo_color":[1,1,1,1],"u_halo_width":0,"u_halo_blur":0,"u_is_halo":0};_8.glyphMap={};_8.glyphReady=false;_8.finishRequest=[];if(_5.getUnicode(_7.text)===undefined){_8.text=_7.text;}else{_8.text=_5.getUnicode(_7.text);}return _8;};if(_1){_6.__proto__=_1;}_6.prototype=Object.create(_1&&_1.prototype);_6.prototype.constructor=_6;Object.defineProperty(_6.prototype,"text",{get:function(){return this._text;},set:function(_9){var _a=this;this._text=_9;var _b=[];for(var i=0;i<_9.length;i++){_b.push(_9.charCodeAt(i));}if(_a.fontFamily==="FontSymbol"){_4.getGlyphsFromImage(this.fontFamily,_b,function(_c){_a.glyphMap[_a.fontFamily]=_c;_a.glyphAtlas=new _3(_a.glyphMap);_a.uniforms.u_buff=0.45;var _d=_a.glyphAtlas.image;_a.width=_d.width;_a.height=_d.height;if(_a.finishRequest.length>0){_a.glyphReady=true;for(var i=0;i<_a.finishRequest.length;i++){_a.finishRequest[i]();}_a.finishRequest=[];}else{_a.glyphReady=true;}});}else{_4.getGlyphs(this.fontFamily,_b,function(_e){_a.glyphMap[_a.fontFamily]=_e;_a.glyphAtlas=new _3(_a.glyphMap);_a.uniforms.u_buff=0.75;var _f=_a.glyphAtlas.image;_a.width=_f.width;_a.height=_f.height;if(_a.finishRequest.length>0){_a.glyphReady=true;for(var i=0;i<_a.finishRequest.length;i++){_a.finishRequest[i]();}_a.finishRequest=[];}else{_a.glyphReady=true;}});}},enumerable:true,configurable:true});_6.prototype.setRadian=function(_10){this.uniforms["u_rotate_symbol"]=1;this.uniforms["u_radian"]=_10;};_6.prototype.getFontOffsetValue=function(id){var _11=null;_4.fontData.chars.forEach(function(_12){if(_12.id===id){_11={xOffset:_12.xoffset,yOffset:_12.yoffset};return _11;}});return _11;};_6.prototype.updateOffset=function(_13){};_6.prototype.getFontInfo=function(){return _4.fontData;};return _6;});