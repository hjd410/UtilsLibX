//>>built
define("com/huayun/webgis/utils/Resource",["exports","dojo/Deferred"],function(g,p){function h(c,a){var b=new Image;b.setAttribute("crossorigin","anonymous");b.onload=function(){a(null,b)};b.onerror=function(){return a(Error("\u52a0\u8f7d\u56fe\u7247\u5931\u8d25, \u56fe\u7247\u5730\u5740\u662f: "+c))};b.src=c;return{cancel:function(){b.src=""}}}function l(c,a){c.type="blob";return e(c,a)}function e(c,a){return!/^file:/.test(c.url)&&m&&k&&n&&k.prototype.hasOwnProperty("signal")?q(c,a):r(c,a)}function q(c,
a){var b=new n,d=new k(c.url,{method:c.method||"GET",body:c.body,credentials:c.credentials,headers:c.headers,signal:b.signal}),f=!1;"json"===c.type&&d.headers.set("Accept","application/json");m(d).then(function(b){return b.ok?("blob"===c.type?b.blob():"arrayBuffer"===c.type?b.arrayBuffer():"json"===c.type?b.json():b.text()).then(function(b){f=!0;a(null,b)}).catch(function(b){return a(b)}):a(Error(b.statusText+b.status+c.url))}).catch(function(b){a(b)});return{cancel:function(){f||b.abort()}}}function r(c,
a){var b=new XMLHttpRequest;b.open(c.method||"GET",c.url,!0);"arrayBuffer"===c.type&&(b.responseType="arraybuffer");"blob"===c.type&&(b.responseType="blob");for(var d in c.headers)b.setRequestHeader(d,c.headers[d]);"json"===c.type&&b.setRequestHeader("Accept","application/json");b.withCredentials="include"===c.credentials;b.onerror=function(){a(Error(b.statusText))};b.onload=function(){if((200<=b.status&&300>b.status||0===b.status)&&null!==b.response){var d=b.response;if("json"===c.type)try{d=JSON.parse(b.response)}catch(t){return a(t)}a(null,
d)}else a(Error(b.statusText+b.status+c.url))};b.send(c.body);return{cancel:function(){return b.abort()}}}var m=self?self.fetch:window.fetch,k=self?self.Request:window.Request,n=self?self.AbortController:window.AbortController;g.loadImage=function(c,a,b){return"function"===typeof a?h(c,a):a&&(a.headers||"POST"===a.method)?(a.url=c,l(a,function(a,f){if(a)b(a);else if(f){var d=new Image,e=e||webkitURL;d.onload=function(){b(null,d);e.revokeObjectURL(d.src)};d.onerror=function(){return b(Error("\u52a0\u8f7d\u56fe\u7247\u5931\u8d25, \u56fe\u7247\u5730\u5740\u662f: "+
c))};d.src=e.createObjectURL(f)}})):h(c,b)};g.loadImagePromise=function(c,a){var b=new p;if(a&&(a.headers||"POST"===a.method))return a.url=c,l(a,function(a,e){if(a)b.reject(a);else if(e){var d=new Image,f=f||webkitURL;d.onload=function(){b.resolve(d);f.revokeObjectURL(d.src)};d.onerror=function(){return b.reject(Error("\u52a0\u8f7d\u56fe\u7247\u5931\u8d25, \u56fe\u7247\u5730\u5740\u662f: "+c))};d.src=f.createObjectURL(e)}}),b;h(c,function(a,c){a?b.reject(a):c&&b.resolve(c)});return b};g.loadJson=
function(c,a,b){if("function"===typeof a)return e({url:c,type:"json"},a);a||(a={});a.url=c;a.type="json";return e(a,b)};g.loadArrayBuffer=function(c,a,b){if("function"===typeof a)return e({url:c,type:"arrayBuffer"},a);a||(a={});a.url=c;a.type="arrayBuffer";return e(a,b)};g.loadText=function(c,a,b){if("function"===typeof a)return e({url:c,type:"text"},a);a||(a={});a.url=c;a.type="text";return e(a,b)}});