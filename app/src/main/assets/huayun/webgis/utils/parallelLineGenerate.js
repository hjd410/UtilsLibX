//>>built
define("com/huayun/webgis/utils/parallelLineGenerate",["exports","./wktUtil"],function(_1,_2){function _3(_4,_5,_6,_7,_8){var _9=Math.floor(_7/2);for(var i=0;i<_7;i++){_8[i].push(_4.add(_5.mult(_6*(_9-i))));}};function _a(_b,_c,_d,_e,_f){var _10=Math.floor(_e/2);for(var i=0;i<_e;i++){_f[i].push(_b.add(_c.mult(_d*(_10-i-0.5))));}};function _11(a,b){var x1=a[0],y1=a[1],x2=b[0],y2=b[1];var _12=x1*x1+y1*y1;if(_12>0){_12=1/Math.sqrt(_12);}var _13=x2*x2+y2*y2;if(_13>0){_13=1/Math.sqrt(_13);}var _14=(x1*x2+y1*y2)*_12*_13;if(_14>1){return 0;}else{if(_14<-1){return Math.PI;}else{return Math.acos(_14);}}};function _15(a,b){return a[0]*b[1]-a[1]*b[0];};function _16(_17,num,_18,_19){var _1a=[_17[1].x-_17[0].x,_17[1].y-_17[0].y];var _1b=[];for(var i=0;i<num;i++){var l=_18[i];var _1c=l.startPoints;var p=_1c[_1c.length-1];_1b.push([_17[0].x-p.x,_17[0].y-p.y]);}var _1d=_1b.map(function(_1e,_1f){var _20=_11(_1a,_1e);var _21=_15(_1a,_1e);if(_21>0){_20=-_20;}return {angle:_20,index:_1f};});_1d.sort(function(a,b){return b.angle-a.angle;});for(i=0;i<_1d.length;i++){var _22=_1d[i].index;_18[_22].startPoints=_18[_22].startPoints.concat(_19[i]);}};function _23(_24,_25,num,_26){var _27=true;var _28,_29,_2a,_2b,_2c;var _2d=[];for(var i=0;i<num;i++){_2d[i]=[];}var _2e=0,len=_24.length;var _2f=num%2===0;for(i=0;i<len;i++){_2a=_24[i+1];if(_2c){_2b=_2c;}if(_28){_29=_28;}_28=_24[i];_2c=_2a?_2a.sub(_28)._unit()._perp():_2b;_2b=_2b||_2c;if(!_2b){return _2d;}var _30=_2b.add(_2c);if(_30.x!==0||_30.y!==0){_30._unit();}var _31=_30.x*_2c.x+_30.y*_2c.y;var _32=_31!==0?_25/_31:Infinity;if(_2f){_a(_28,_30,_32,num,_2d);}else{_3(_28,_30,_32,num,_2d);}}return _2d;};_1.generateParallel=_23;_1.angleOfVecs=_11;_1.directionofVecs=_15;function _33(_34,_35){var _36={};var _37={};_34.forEach(function(_38){var id=_38.ID;var _39=_38.lineTower;var _3a=_38.OWNER;var _3b=_38.TOWERAC;var _3c={startPoints:[],endPoints:[],OWNER:_3a};_36[id]=_3c;var _3d=_39[0];var _3e=0;for(var i=0,ii=_3b.length;i<ii;i++){var _3f=_3b[i];if(_3f.TOWER_ID===_3d.ID){break;}else{_3e++;_3c.startPoints.push(_2.parse2Geometry(_3f.SHAPE));}}var _40=null;var _41=0;var _42;var _43,_44;var _45;for(var j=0,jj=_39.length;j<jj;j++){_3f=_39[j];_46=_3f.SIZE;_40=_3f.LINE_ID;if(_46!==_41){_44=_3f.SHAPE;}_43=_46+"#"+_44;var _47=_37[_43];if(_47&&_47.addLine!==id){_41=_46;continue;}else{_3f.point=_2.parse2Geometry(_3f.SHAPE);if(_46!==_41){if(_45){_37[_45].towers.push(_3f);_37[_45].splitLast=true;}}if(!_37.hasOwnProperty(_43)){if(_46!==_41&&_41!==0){_37[_43]={size:_46,towers:[_42],splitFirst:true,addLine:id,lineIds:_40};}else{_37[_43]={size:_46,towers:[],addLine:id,lineIds:_40};}}_37[_43].towers.push(_3f);_41=_46;_42=_3f;_45=_43;}}for(i=j+_3e;i<ii;i++){_3f=_3b[i];_3f.point=_2.parse2Geometry(_3f.SHAPE);_3c.endPoints.push(_3f.point);}});var _48=[];var hg=[];for(var key in _37){var _49=_37[key];var _4a=_49.lineIds;var _46=_49.size;if(_46<2){var _4b=_4a;var _4c=_49.towers;if(_49.splitLast){_4c.pop();}if(_49.splitFirst){_4c.shift();}for(var k=0,kk=_49.towers.length;k<kk;k++){_36[_4b].startPoints.push(_49.towers[k].point);}}else{var _4d=_49.towers;var _4e=[_4d[1].point.x-_4d[0].point.x,_4d[1].point.y-_4d[0].point.y];var _4f=_4a.split(",");var _50=true;_4f.forEach(function(lid){_50=_50&&(!!_36[lid].ordered);});if(_50){_4f.sort(function(a,b){return _36[a].order-_36[b].order;});var _51=[];var IDS=[];for(var k=0,kk=_49.towers.length;k<kk;k++){_51.push(_49.towers[k].point);IDS.push(_49.towers[k].ID);}var _52=_23(_51,_35,_49.size);var len;if(_49.splitLast){len=_52[0].length-1;}else{len=_52[0].length;}var _53=0;if(_49.splitFirst){_53=1;}for(var i=_53;i<len;i++){var l=[];l.push(_52[0][i]);l.push(_52[_46-1][i]);hg.push({points:l,towerId:IDS[i]});}for(i=0;i<_4f.length;i++){var lds=_4f[i];if(_49.splitLast){_52[i].pop();}if(_49.splitFirst){_52[i].shift();}_36[lds].startPoints=_36[lds].startPoints.concat(_52[i]);}}else{var _54=[];for(var m=0;m<_4f.length;m++){var _55=_36[_4f[m]].startPoints;var p=_55[_55.length-1];if(!p){p={x:0,y:0};}_54.push([_4d[0].point.x-p.x,_4d[0].point.y-p.y]);}var _56=_54.map(function(_57,_58){var _59=_11(_4e,_57);var _5a=_15(_4e,_57);if(_5a>0){_59=-_59;}return {angle:_59,index:_58};});_56.sort(function(a,b){return b.angle-a.angle;});var _51=[];var IDS=[];for(var k=0,kk=_49.towers.length;k<kk;k++){_51.push(_49.towers[k].point);IDS.push(_49.towers[k].ID);}var _52=_23(_51,_35,_49.size);var len;if(_49.splitLast){len=_52[0].length-1;}else{len=_52[0].length;}var _53=0;if(_49.splitFirst){_53=1;}for(var i=_53;i<len;i++){var l=[];l.push(_52[0][i]);l.push(_52[_46-1][i]);hg.push({points:l,towerId:IDS[i]});}for(i=0;i<_56.length;i++){var _5b=_56[i].index;if(_49.splitLast){_52[i].pop();}if(_49.splitFirst){_52[i].shift();}_36[_4f[_5b]].startPoints=_36[_4f[_5b]].startPoints.concat(_52[i]);_36[_4f[_5b]].ordered=true;_36[_4f[_5b]].order=i;}}}}for(var id in _36){_36[id].startPoints=_36[id].startPoints.concat(_36[id].endPoints);_48.push({points:_36[id].startPoints,id:id,OWNER:_36[id].OWNER,order:_36[id].order});}return {gt:_48,hg:hg};};_1.generateParallelGT=_33;_1.generateMultiParallel=function(_5c,_5d){var _5e=_5c.LINE,_5f=_5c.PHYSICTOWER;_5e.forEach(function(_60){_60.lineTower=[];});_5f.forEach(function(_61){var _62=_61.LINE_ID;_61.SIZE=_62.split(",").length||1;for(var i=0;i<_5e.length;i++){var l=_5e[i];if(_61.LINE_ID.indexOf(l.ID)>-1){l.lineTower.push(_61);}}});try{var gt=_33(_5e,_5d);var _63=gt.gt;var hg=gt.hg;var _64=[];var _65=[];_63.forEach(function(_66){var id=_66.id;var _67=_66.OWNER;var _68=_66.order;var _69=_5e.filter(function(l){return l.ID===id;});var _6a=_69[0].TOWERAC;var ps=_66.points;for(var k=0;k<_6a.length;k++){var p=ps[k];_6a[k].SHAPE="POINT ("+p.x+" "+p.y+")";_6a[k].sameOrder=_68;_64.push(_6a[k]);if(k===_6a.length-1){continue;}var np=ps[k+1];_65.push({"DEV_ID":"","ID":"","LINE_ID":id,"NAME":"导线段"+k,"OWNER":_67,SHAPE:"LINESTRING ("+p.x+" "+p.y+","+np.x+" "+np.y+")",nodeTower:[_6a[k].TOWER_ID,_6a[k+1].TOWER_ID],order:_68});}});var _6b=[];hg.forEach(function(bs){var ps=bs.points;var str=ps.map(function(p){return p.x+" "+p.y;});_6b.push({SHAPE:"LINESTRING ("+str.join(",")+")",towerId:bs.towerId});});return {"TOWER":_64,"LINESEG":_65,"BISECTOR":_6b};}catch(e){return null;}};});