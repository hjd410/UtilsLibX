//>>built
define("com/huayun/webgis/utils/symbolLayout","exports ./Constant ./scriptDetection ./shaping ./clipLine ./getAnchors ./classifyRings ./findPoleOfInaccessibility ./murmurhashJs ./quads ./symbolSize ../layers/support/style/EvaluationParameters ../geometry/Anchor ../data/CollisionFeature".split(" "),function(X,P,L,E,Y,Q,Z,aa,R,S,F,B,M,T){function ba(a,b){var g=0,p=0,v=b/Math.sqrt(2);switch(a){case "top-right":case "top-left":p=v-7;break;case "bottom-right":case "bottom-left":p=-v+7;break;case "bottom":p=
-b+7;break;case "top":p=b-7}switch(a){case "top-right":case "bottom-right":g=-v;break;case "top-left":case "bottom-left":g=v;break;case "left":g=b;break;case "right":g=-b}return[g,p]}function U(a){switch(a){case "right":case "top-right":case "bottom-right":return"right";case "left":case "top-left":case "bottom-left":return"left"}return"center"}function V(a){for(var b in a)return a[b];return null}function ca(a,b,g,p){a=a.compareText;if(b in a)for(var v=a[b],q=v.length-1;0<=q;q--){if(p.dist(v[q])<g)return!0}else a[b]=
[];a[b].push(p);return!1}function da(a,b,g,p,v,q,m){var d=q.layoutTextSize.evaluate(b,{}),e=q.layoutIconSize.evaluate(b,{}),c=q.textMaxSize.evaluate(b,{});void 0===c&&(c=d);var f=a.layers[0].layout,y=f.get("icon-offset").evaluate(b,{}),h=V(g.horizontal),k=d/24*a.tilePixelRatio,d=a.tilePixelRatio*c/24,C=a.tilePixelRatio*e,c=a.tilePixelRatio*f.get("symbol-spacing"),B=f.get("text-padding")*a.tilePixelRatio,z=f.get("icon-padding")*a.tilePixelRatio,e=f.get("text-max-angle")/180*Math.PI,x="map"===f.get("text-rotation-alignment")&&
"point"!==f.get("symbol-placement"),G="map"===f.get("icon-rotation-alignment")&&"point"!==f.get("symbol-placement"),r=f.get("symbol-placement"),n=c/2,f=function(d,c){if(!(0>c.x||c.x>=I||0>c.y||c.y>=I)){var e=a.layers[0],f=a.collisionBoxArray,h=b.index,r=b.sourceLayerIndex,u=a.index,n=a.addToLineVertexArray(c,d),l,t,w=0,A=0,O=0,D={},E=R.murmur3(""),M=(e.layout.get("text-radial-offset").evaluate(b,{})||0)*J,N;for(N in g.horizontal){var H=g.horizontal[N];l||(E=R.murmur3(H.text),l=e.layout.get("text-rotate").evaluate(b,
{}),l=new T(f,d,c,h,r,u,H,k,B,x,a.overscaling,l));var L=1===H.lineCount,A=A+W(a,c,H,e,x,b,m,n,g.vertical?K.horizontal:K.horizontalOnly,L?Object.keys(g.horizontal):[N],D,v,q);if(L)break}g.vertical&&(O+=W(a,c,g.vertical,e,x,b,m,n,K.vertical,["vertical"],D,v,q));N=l?l.boxStartIndex:a.collisionBoxArray.length;l=l?l.boxEndIndex:a.collisionBoxArray.length;p&&(H=S.getIconQuads(c,p,e,G,V(g.horizontal),b),w=e.layout.get("icon-rotate").evaluate(b,{}),t=new T(f,d,c,h,r,u,p,C,z,!1,a.overscaling,w),w=4*H.length,
d=a.iconSizeData,f=null,"source"===d.kind?(f=[F.SIZE_PACK_FACTOR*e.layout.get("icon-size").evaluate(b,{})],65535<f[0]&&console.warn(a.layerIds[0]+': Value for "icon-size" is \x3e\x3d 256. Reduce your "icon-size".')):"composite"===d.kind&&(f=[F.SIZE_PACK_FACTOR*q.compositeIconSizes[0].evaluate(b,{}),F.SIZE_PACK_FACTOR*q.compositeIconSizes[1].evaluate(b,{})],(65535<f[0]||65535<f[1])&&console.warn(a.layerIds[0]+': Value for "icon-size" is \x3e\x3d 256. Reduce your "icon-size".')),a.addSymbols(a.icon,
H,f,y,G,b,!1,c,n.lineStartIndex,n.lineLength));e=t?t.boxStartIndex:a.collisionBoxArray.length;n=t?t.boxEndIndex:a.collisionBoxArray.length;a.glyphOffsetArray.length>=P.MAX_GLYPHS&&console.warn("Too many glyphs being rendered in a tile");a.symbolInstances.emplaceBack(c.x,c.y,0<=D.right?D.right:-1,0<=D.center?D.center:-1,0<=D.left?D.left:-1,D.vertical||-1,E,N,l,e,n,h,A,O,w,0,k,M)}};if("line"===r)for(var r=0,l=Y(b.geometry,0,0,I,I);r<l.length;r+=1)for(var t=l[r],w=0,u=Q.getAnchors(t,c,e,g.vertical||
h,p,24,d,a.overscaling,I);w<u.length;w+=1){var A=u[w],O=h;O&&ca(a,O.text,n,A)||f(t,A)}else if("line-center"===r)for(c=0,n=b.geometry;c<n.length;c+=1)r=n[c],1<r.length&&(l=Q.getCenterAnchor(r,e,g.vertical||h,p,24,d))&&f(r,l);else if("Polygon"===b.type)for(h=0,d=Z(b.geometry,0);h<d.length;h+=1)e=d[h],c=aa(e,16),f(e[0],new M(c.x,c.y,0));else if("LineString"===b.type)for(h=0,d=b.geometry;h<d.length;h+=1)e=d[h],f(e,new M(e[0].x,e[0].y,0));else if("Point"===b.type)for(h=0,d=b.geometry;h<d.length;h+=1)for(e=
0,c=d[h];e<c.length;e+=1)n=c[e],f([n],new M(n.x,n.y,0))}function W(a,b,g,p,v,q,m,d,e,c,f,y,h){g=S.getGlyphQuads(b,g,m,p,v,q,y);y=a.textSizeData;var k=null;"source"===y.kind?(k=[F.SIZE_PACK_FACTOR*p.layout.get("text-size").evaluate(q,{})],65535<k[0]&&console.warn(a.layerIds[0]+': Value for "text-size" is \x3e\x3d 256. Reduce your "text-size".')):"composite"===y.kind&&(k=[F.SIZE_PACK_FACTOR*h.compositeTextSizes[0].evaluate(q,{}),F.SIZE_PACK_FACTOR*h.compositeTextSizes[1].evaluate(q,{})],(65535<k[0]||
65535<k[1])&&console.warn(a.layerIds[0]+': Value for "text-size" is \x3e\x3d 256. Reduce your "text-size".'));a.addSymbols(a.text,g,k,m,v,q,e,b,d.lineStartIndex,d.lineLength);for(b=0;b<c.length;b+=1)f[c[b]]=a.text.placedSymbolArray.length-1;return 4*g.length}var K=E.WritingMode,I=P.layout.EXTENT,J=P.ONE_EM;X.performSymbolLayout=function(a,b,g,p,v,q){a.createArrays();a.tilePixelRatio=I/(512*a.overscaling);a.compareText={};a.iconsNeedLinear=!1;var m=a.layers[0].layout,d=a.layers[0]._unevaluatedLayout._values,
e={};if("composite"===a.textSizeData.kind){var c=a.textSizeData,f=c.maxZoom;e.compositeTextSizes=[d["text-size"].possiblyEvaluate(new B(c.minZoom)),d["text-size"].possiblyEvaluate(new B(f))]}"composite"===a.iconSizeData.kind&&(c=a.iconSizeData,f=c.maxZoom,e.compositeIconSizes=[d["icon-size"].possiblyEvaluate(new B(c.minZoom)),d["icon-size"].possiblyEvaluate(new B(f))]);e.layoutTextSize=d["text-size"].possiblyEvaluate(new B(a.zoom+1));e.layoutIconSize=d["icon-size"].possiblyEvaluate(new B(a.zoom+1));
e.textMaxSize=d["text-size"].possiblyEvaluate(new B(18));for(var d=m.get("text-line-height")*J,c="map"===m.get("text-rotation-alignment")&&"point"!==m.get("symbol-placement"),f=m.get("text-keep-upright"),y=0,h=a.features;y<h.length;y+=1){var k=h[y],C=m.get("text-font").evaluate(k,{}).join(","),F=g,z={horizontal:{},vertical:void 0},x=k.text,G=[0,0];if(x){var r=x.toString(),n=m.get("text-letter-spacing").evaluate(k,{})*J,n=L.allowsLetterSpacing(r)?n:0,l=m.get("text-anchor").evaluate(k,{}),t=m.get("text-variable-anchor"),
w=m.get("text-radial-offset").evaluate(k,{});t||(G=w?ba(l,w*J):m.get("text-offset").evaluate(k,{}).map(function(a){return a*J}));var u=c?"center":m.get("text-justify").evaluate(k,{}),w="point"===m.get("symbol-placement")?m.get("text-max-width").evaluate(k,{})*J:0;if(!c&&t)for(r="auto"===u?t.map(function(a){return U(a)}):[u],l=!1,t=0;t<r.length;t++){if(u=r[t],!z.horizontal[u])if(l)z.horizontal[u]=z.horizontal[0];else{var A=E.shapeText(x,b,C,w,d,"center",u,n,G,K.horizontal);A&&(z.horizontal[u]=A,l=
1===A.lineCount)}}else"auto"===u&&(u=U(l)),(t=E.shapeText(x,b,C,w,d,l,u,n,G,K.horizontal))&&(z.horizontal[u]=t),L.allowsVerticalWritingMode(r)&&c&&f&&(z.vertical=E.shapeText(x,b,C,w,d,l,u,n,G,K.vertical))}C=void 0;k.icon&&(x=p[k.icon])&&(C=E.shapeIcon(v[k.icon],m.get("icon-offset").evaluate(k,{}),m.get("icon-anchor").evaluate(k,{})),void 0===a.sdfIcons?a.sdfIcons=x.sdf:a.sdfIcons!==x.sdf&&console.warn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),x.pixelRatio!==a.pixelRatio?
a.iconsNeedLinear=!0:0!==m.get("icon-rotate").constantOr(1)&&(a.iconsNeedLinear=!0));(Object.keys(z.horizontal).length||C)&&da(a,k,z,C,F,e,G)}q&&a.generateCollisionDebugBuffers()}});