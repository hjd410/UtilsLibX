//>>built
define("com/huayun/webgis/work/Actor",["../utils/utils","com/huayun/webgis/gl/dataTransfer","com/huayun/webgis/data/FeatureIndex"],function(_1,_2,_3){var _4=function _4(_5,_6,_7){this.target=_5;this.mapId=_6;this.parent=_7;this.callbacks={};this.callbackID=0;_1.bindAll(["receive"],this);this.target.addEventListener("message",this.receive,false);};_4.prototype.send=function send(_8,_9,_a,_b){var _c=this;var id=_a?(this.mapId+":"+this.callbackID++):null;if(_a){this.callbacks[id]=_a;}var _d=[];this.target.postMessage({targetMapId:_b,sourceMapId:this.mapId,type:_8,id:String(id),data:_2.serialize(_9,_d)},_d);if(_a){return {cancel:function(){return _c.target.postMessage({targetMapId:_b,sourceMapId:_c.mapId,type:"<cancel>",id:String(id)});}};}};_4.prototype.receive=function receive(_e){var _f=this;var _10=_e.data,id=_10.id;var _11;if(_10.targetMapId&&this.mapId!==_10.targetMapId){return;}var _12=function(err,_13){delete _f.callbacks[id];var _14=[];_f.target.postMessage({sourceMapId:_f.mapId,type:"<response>",id:String(id),error:err?_2.serialize(err):null,data:_2.serialize(_13,_14)},_14);};if(_10.type==="<response>"||_10.type==="<cancel>"){_11=this.callbacks[_10.id];delete this.callbacks[_10.id];if(_11&&_10.error){_11(_2.deserialize(_10.error));}else{if(_11){_11(null,_2.deserialize(_10.data));}}}else{if(typeof _10.id!=="undefined"&&this.parent[_10.type]){this.callbacks[_10.id]=null;var _15=this.parent[_10.type](_10.sourceMapId,_2.deserialize(_10.data),_12);if(_15&&this.callbacks[_10.id]===null){this.callbacks[_10.id]=_15.cancel;}}else{if(typeof _10.id!=="undefined"&&this.parent.getWorkerSource){var _16=_10.type.split(".");var _17=(_2.deserialize(_10.data));var _18=(this.parent).getWorkerSource(_10.sourceMapId,_16[0],_17.source);_18[_16[1]](_17,_12);}else{this.parent[_10.type](_2.deserialize(_10.data));}}}};_4.prototype.remove=function remove(){this.target.removeEventListener("message",this.receive,false);};return _4;});