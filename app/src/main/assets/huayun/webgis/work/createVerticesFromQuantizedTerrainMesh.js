//>>built
define("com/huayun/webgis/work/createVerticesFromQuantizedTerrainMesh",["../utils/MathUtils","../data/IndexDatatype"],function(_1,_2){var _3=32767;var _4={longitude:0,latitude:0,height:0};var _5={x:0,y:0};function _6(_7){return _7!==undefined&&_7!==null;};function _8(_9,_a,_b,uv,_c,_d,_e){var u=uv.x;var v=uv.y;_9[_a++]=0;_9[_a++]=0;_9[_a++]=0;_9[_a++]=_c;_9[_a++]=u;_9[_a++]=v;_9[_a++]=_e;return _a;};function _f(_10,_11){var _12;if(typeof _10.slice==="function"){_12=_10.slice();if(typeof _12.sort!=="function"){_12=undefined;}}if(!_6(_12)){_12=Array.prototype.slice.call(_10);}_12.sort(_11);return _12;};function _13(_14,_15,_16,uvs,_17){var _18=Number.POSITIVE_INFINITY;var _19=_17.north;var _1a=_17.south;var _1b=_17.east;var _1c=_17.west;var _1d=_14.length;for(var i=0;i<_1d;++i){var _1e=_14[i];var h=_16[_1e];var uv=uvs[_1e];_4.longitude=_1.lerp(_1c,_1b,uv.x);_4.latitude=_1.lerp(_1a,_19,uv.y);_4.height=h-_15;_18=Math.min(_18,_4.height);}return _18;};function _1f(_20,_21,_22,_23,uvs,_24,_25,_26,_27,_28,_29){var _2a=false;var _2b=_25.north;var _2c=_25.south;var _2d=_25.east;var _2e=_25.west;var _2f=_22.length;for(var i=0;i<_2f;++i){var _30=_22[i];var h=_23[_30];var uv=uvs[_30];_4.longitude=_1.lerp(_2e,_2d,uv.x)+_28;_4.latitude=_1.lerp(_2c,_2b,uv.y)+_29;_4.height=h-_26;var _31=_4;var _32=0;_21=_8(_20,_21,_31,uv,_4.height,_5,_32);}};function _33(_34,_35,_36,_37,_38,_39,_3a){var _3b=_38;_3a=_3c(_34,_3b,_39,_3a);_3b+=_34.length;_3a=_3c(_35,_3b,_39,_3a);_3b+=_35.length;_3a=_3c(_36,_3b,_39,_3a);_3b+=_36.length;_3c(_37,_3b,_39,_3a);};function _3c(_3d,_3e,_3f,_40){var _41=_3d[0];var _42=_3d.length;for(var i=1;i<_42;++i){var _43=_3d[i];_3f[_40++]=_41;_3f[_40++]=_43;_3f[_40++]=_3e;_3f[_40++]=_3e;_3f[_40++]=_43;_3f[_40++]=_3e+1;_41=_43;++_3e;}return _40;};function _44(_45){var _46=_45.quantizedVertices;var _47=_46.length/3;var _48=_45.octEncodedNormals;var _49=_45.westIndices.length+_45.eastIndices.length+_45.southIndices.length+_45.northIndices.length;var _4a=_45.includeWebMercatorT;var _4b=_45.rectangle;var _4c=_4b.west;var _4d=_4b.south;var _4e=_4b.east;var _4f=_4b.north;var _50=_45.exaggeration;var _51=_45.minimumHeight*_50;var _52=_45.maximumHeight*_50;var _53=_46.subarray(0,_47);var _54=_46.subarray(_47,2*_47);var _55=_46.subarray(_47*2,3*_47);var _56=false;var uvs=new Array(_47);var _57=new Array(_47);var _58=new Array(_47);var _59=_4a?new Array(_47):[];var _5a={x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY,z:Number.POSITIVE_INFINITY};var _5b={x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY,z:Number.NEGATIVE_INFINITY};var _5c=Number.POSITIVE_INFINITY;var _5d=Number.NEGATIVE_INFINITY;var _5e=Number.POSITIVE_INFINITY;var _5f=Number.NEGATIVE_INFINITY;for(var i=0;i<_47;++i){var _60=_53[i];var _61=_54[i];var u=_60/_3;var v=_61/_3;var _62=_1.lerp(_51,_52,_55[i]/_3);_4.longitude=_1.lerp(_4c,_4e,u);_4.latitude=_1.lerp(_4d,_4f,v);_4.height=_62;_5c=Math.min(_4.longitude,_5c);_5d=Math.max(_4.longitude,_5d);_5e=Math.min(_4.latitude,_5e);_5f=Math.max(_4.latitude,_5f);uvs[i]={x:u,y:v};_57[i]=_62;_58[i]=_4;_59[i]=0;}var _63=_f(_45.westIndices,function(a,b){return uvs[a].y-uvs[b].y;});var _64=_f(_45.eastIndices,function(a,b){return uvs[b].y-uvs[a].y;});var _65=_f(_45.southIndices,function(a,b){return uvs[b].x-uvs[a].x;});var _66=_f(_45.northIndices,function(a,b){return uvs[a].x-uvs[b].x;});var _67;var _68;var _69;var _6a=_51;_6a=Math.min(_6a,_13(_45.westIndices,_45.westSkirtHeight,_57,uvs,_4b));_6a=Math.min(_6a,_13(_45.southIndices,_45.southSkirtHeight,_57,uvs,_4b));_6a=Math.min(_6a,_13(_45.eastIndices,_45.eastSkirtHeight,_57,uvs,_4b));_6a=Math.min(_6a,_13(_45.northIndices,_45.northSkirtHeight,_57,uvs,_4b));var _6b=7;var _6c=_47*_6b+_49*_6b;var _6d=new Float32Array(_6c);var _6e=0;for(var j=0;j<_47;++j){_6e=_8(_6d,_6e,_58[j],uvs[j],_57[j],_5,_59[j]);}var _6f=Math.max(0,(_49-4)*2);var _70=_45.indices.length+_6f*3;var _71=_2.createTypedArray(_47+_49,_70);_71.set(_45.indices,0);var _72=0.0001;var _73=(_5d-_5c)*_72;var _74=(_5f-_5e)*_72;var _75=-_73;var _76=0;var _77=_73;var _78=0;var _79=0;var _7a=_74;var _7b=0;var _7c=-_74;var _7d=_47*_6b;_1f(_6d,_7d,_63,_57,uvs,_48,_4b,_45.westSkirtHeight,_50,_75,_76);_7d+=_45.westIndices.length*_6b;_1f(_6d,_7d,_65,_57,uvs,_48,_4b,_45.southSkirtHeight,_50,_7b,_7c);_7d+=_45.southIndices.length*_6b;_1f(_6d,_7d,_64,_57,uvs,_48,_4b,_45.eastSkirtHeight,_50,_77,_78);_7d+=_45.eastIndices.length*_6b;_1f(_6d,_7d,_66,_57,uvs,_48,_4b,_45.northSkirtHeight,_50,_79,_7a);_33(_63,_65,_64,_66,_47,_71,_45.indices.length);return {vertices:_6d.buffer,indices:_71.buffer,westIndicesSouthToNorth:_63,southIndicesEastToWest:_65,eastIndicesNorthToSouth:_64,northIndicesWestToEast:_66,vertexStride:_6b,center:undefined,minimumHeight:_51,maximumHeight:_52,boundingSphere:_68,orientedBoundingBox:_67,occludeePointInScaledSpace:_69,encoding:undefined,indexCountWithoutSkirts:_45.indices.length};};return _44;});