//>>built
define("com/huayun/webgis/renderer/AutotransformerRenderer",["./LineRenderer","./CircleRenderer","../geometry/Point","../geometry/Polyline","../utils/MathUtils","../geometry/Multipoint","../utils/geometryGenerate"],function(_1,_2,_3,_4,_5,_6,_7){function _8(){this.lineRenderer=new _1();this.circleRenderer=new _2();this._newP=new _3();};_8.prototype.add=function(_9,_a,_b,_c){var _d=_b.points,_e,_f,_10,_11;if(_c.tap===true){_e=_d[0];_f=_d[1];_10=_d[2];_11=_d[3];}else{_e=_d[0];_f=new _3();_10=_d[1];_11=_d[2];}var _12=_e.radian(_10),_13=_10.radian(_e),_14=_e.dist(_10),_15,_16,_17,_18,_19,_1a,_1b,_1c,_1d=(0.3+0.6+1.5+1.5-0.3+0.3),_1e=_14*0.3/_1d,dis=0.45*_14/_1d;_a.hlDis=_14;_a.hlRadian=_12;_a.lhRadian=_13;if(_c.subtype==="100"){var _1f=_14/_1d;_19=1.5/2;_a.ratio=_1f;_1a=_1f*_19;_a.circleRadius=_1a;_1b=1.2*_1f;_1c=1.35*_1f;_15=_10.calculateOtherPoint(_1e,_13);_16=_15.calculateOtherPoint(_1a,_13);_18=_16.calculateOtherPoint(_1b,_13);_17=_18.calculateOtherPoint(_1c,_13);var _20=new _3((_15.x+_17.x)/2,(_15.y+_17.y)/2);_a.hlCenter=_20;var r=_9.resolution;_c.symbols[1].setRadius(_1a);_c.symbols[1].setStrokeWidth(_c.symbols[1].strokeWidth*_1f/r);this.circleRenderer.add(_9,_a,new _3(_16.x,_16.y),_c.symbols[1]);var _21=_18.calculateOtherPoint3(_e,_1a);var _22=_17.interpolate(_21,0.5);var _23=_22.calculateOtherPoint3(_17,_1a*0.6);var _24=_7.generateBezierCurve(_21,_23,_17,100);var _25=new _4([[_e,_17],[_10,_15],_24.path[0]]);var _26=_c.symbols[1].strokeWidth*_1f/r;_c.symbols[0].setWidth(_26);this.lineRenderer.add(_9,_a,_25,_c.symbols[0]);_c.symbols[2].setRadius(_1a);_c.symbols[2].setStrokeWidth(_c.symbols[2].strokeWidth*_1f/r);this.circleRenderer.add(_9,_a,new _3(_18.x,_18.y),_c.symbols[2]);var _27=[];var _28=[];var _11=_18.interpolate(_16,0.5);if(_c.tap===true){var _29=_22.interpolate(_23,0.5);this._newP=_29;}this.drawConectionTypeMethod(_c,_e,_18,_16,_11,_1a,_12,_13,_1f,_27,_28);if(_c.tap===true){this.drawTapMethod(_f,this._newP,_1f,_27);}this.lineRenderer.add(_9,_a,new _4(_27),_c.symbols[0]);if(_28.length>0){_c.symbols[3].setRadius(_a.circleRadius/r);_c.symbols[3].setStrokeWidth(_c.symbols[3].strokeWidth/r);this.circleRenderer.add(_9,_a,new _6(_28),_c.symbols[3]);}}else{if(_c.subtype==="101"){_1d-=1.2;var _1f=_14/_1d;_a.ratio=_1f;_19=1.5/2;_1a=_1f*_19;_a.circleRadius=_1a;_15=_10.calculateOtherPoint(_1e,_13);_16=_15.calculateOtherPoint(_1a,_13);_1c=1.35*_1f;_17=_16.calculateOtherPoint(_1c,_13);var _20=new _3((_15.x+_17.x)/2,(_15.y+_17.y)/2);_a.hlCenter=_20;var r=_9.resolution;_c.symbols[1].setRadius(_1a);_c.symbols[1].setStrokeWidth(_c.symbols[1].strokeWidth*_1f/r);this.circleRenderer.add(_9,_a,new _3(_16.x,_16.y),_c.symbols[1]);var _2a=_16.calculateOtherPoint3(_e,_1a);var _22=_17.interpolate(_2a,0.5);var _23=_22.calculateOtherPoint3(_17,_1a*0.6);var _24=_7.generateBezierCurve(_2a,_23,_17,100);var _25=new _4([[_e,_17],[_10,_15],_24.path[0]]);var _26=_c.symbols[1].strokeWidth*_1f/r;_c.symbols[0].setWidth(_26);this.lineRenderer.add(_9,_a,_25,_c.symbols[0]);var _27=[];var _28=[];var _2b;switch(_c.lConnMode){case "y":_2b=_16.calculateOtherPoint2(dis,_12);this.drawStarMethod(_16,_2b,_13,_1f,_27);break;case "d":this.drawTriangleMethod(_16,_1a,_12,_13,_1f,_27);break;case "z":this.drawCirCuitousMethod(_16,_1a,_12,_13,_1f,_27);break;case "yn":_2b=_16.calculateOtherPoint(dis,_12);this.drawStarMethod(_16,_2b,_13,_1f,_27);this.drawNeutralPointMethod(_e,_16,_1a,_1f,_27,_28);break;case "zn":this.drawCirCuitousMethod(_16,_1a,_12,_13,_1f,_27);this.drawNeutralPointMethod(_e,_16,_1a,_1f,_27,_28);break;}if(_c.onLoad===true){this.drawOnLoadMethod(_16,_1a,_1f,_12,_13,_27);}this.lineRenderer.add(_9,_a,new _4(_27),_c.symbols[0]);if(_28.length>0){_c.symbols[3].setRadius(_a.circleRadius/r);_c.symbols[3].setStrokeWidth(_c.symbols[3].strokeWidth/r);this.circleRenderer.add(_9,_a,new _6(_28),_c.symbols[3]);}}else{if(_c.subtype==="102"){var _1f=_14/_1d;_19=1.2/2;_a.ratio=_1f;_1a=_1f*_19;_a.circleRadius=_1a;_1b=0.9*_1f;_1c=1.2*_1f;_15=_10.calculateOtherPoint(_1e,_13);var _2c=1.5*_1f;_16=_10.calculateOtherPoint(_2c,_13);_18=_16.calculateOtherPoint(_1b,_13);_17=_18.calculateOtherPoint(_1c,_13);var _20=new _3((_15.x+_17.x)/2,(_15.y+_17.y)/2);_a.hlCenter=_20;var r=_9.resolution;_c.symbols[1].setRadius(_1a);_c.symbols[1].setStrokeWidth(_c.symbols[1].strokeWidth*_1f/r);this.circleRenderer.add(_9,_a,new _3(_18.x,_18.y),_c.symbols[1]);var _21=_18.calculateOtherPoint3(_e,_1a);var _2a=_16.calculateOtherPoint3(_e,_1a);var _11=_e.interpolate(_10,0.5);var _22=_e.interpolate(_21,0.5);var _2d=_10.interpolate(_2a,0.5);var _2e=_22.calculateOtherPoint3(_17,_1a*0.6);var _2f=_2d.calculateOtherPoint3(_15,_1a*0.6);var _24=_7.generateBezierCurve(_21,_2e,_17,100);var _30=_7.generateBezierCurve(_2a,_2f,_15,100);var _25=new _4([[_e,_17],[_10,_15],_24.path[0],_30.path[0]]);var _26=_c.symbols[1].strokeWidth*_1f/r;_c.symbols[0].setWidth(_26);this.lineRenderer.add(_9,_a,_25,_c.symbols[0]);_c.symbols[2].setRadius(_1a);_c.symbols[2].setStrokeWidth(_c.symbols[2].strokeWidth*_1f/r);this.circleRenderer.add(_9,_a,new _3(_16.x,_16.y),_c.symbols[2]);var _27=[];var _28=[];this.drawConectionTypeMethod(_c,_e,_18,_16,_11,_1a,_12,_13,_1f,_27,_28);this.lineRenderer.add(_9,_a,new _4(_27),_c.symbols[0]);if(_28.length>0){_c.symbols[3].setRadius(_a.circleRadius/r);_c.symbols[3].setStrokeWidth(_c.symbols[3].strokeWidth/r);this.circleRenderer.add(_9,_a,new _6(_28),_c.symbols[3]);}}}}};_8.prototype.draw=function(_31,_32,_33,_34,_35){var r=_31.resolution;var _36=_32.ratio;var _37=_34.symbols[1].strokeWidth*_36/r;if(_37<1){_37=1;}_34.symbols[0].setWidth(_37);this.lineRenderer.draw(_31,_32,_33,_34.symbols[0],_35,1);var _38=_32.circleRadius/r;if(_38<1){_38=1;}_34.symbols[1].setRadius(_38);_34.symbols[1].setStrokeWidth(_34.symbols[1].strokeWidth*_36/r);this.circleRenderer.draw(_31,_32,_33,_34.symbols[1],_35,0,true);if(_32.buckets.length>3){_34.symbols[2].setRadius(_38);_34.symbols[2].setStrokeWidth(_34.symbols[2].strokeWidth*_36/r);this.circleRenderer.draw(_31,_32,_33,_34.symbols[2],_35,2,true);}var _39=_34.symbols[1].uniforms.color;_34.symbols[1].uniforms.color=[0,0,0,0];this.circleRenderer.draw(_31,_32,_33,_34.symbols[1],_35,0,true);_34.symbols[1].uniforms.color=_39;if(_32.buckets.length>4){var _39=_34.symbols[2].uniforms.color;_34.symbols[2].uniforms.color=[0,0,0,0];this.circleRenderer.draw(_31,_32,_33,_34.symbols[2],_35,2,true);_34.symbols[2].uniforms.color=_39;}if(_32.buckets.length>3){this.lineRenderer.draw(_31,_32,_33,_34.symbols[0],_35,3);if(_34.symbols[3].radius!==10){_34.symbols[3].setRadius(_32.circleRadius);_34.symbols[3].setStrokeWidth(_34.symbols[3].strokeWidth);this.circleRenderer.draw(_31,_32,_33,_34.symbols[3],_35,4,true);}}else{this.lineRenderer.draw(_31,_32,_33,_34.symbols[0],_35,2);if(_34.symbols[3].radius!==10){_34.symbols[3].setRadius(_32.circleRadius);_34.symbols[3].setStrokeWidth(_34.symbols[3].strokeWidth);this.circleRenderer.draw(_31,_32,_33,_34.symbols[3],_35,3,true);}}};_8.prototype.drawGlow=function(){};_8.prototype.getIntersection=function(p1,p2,_3a,_3b){var _3c,k=(p2.y-p1.y)/(p2.x-p1.x),b=p2.y-k*p2.x,x1,y1,x2,y2,cx=_3a.x,cy=_3a.y,c=cx*cx+(b-cy)*(b-cy)-_3b*_3b,a=(1+k*k),b1=(2*cx-2*k*(b-cy)),tmp=Math.sqrt(b1*b1-4*a*c);x1=(b1+tmp)/(2*a);y1=k*x1+b;x2=(b1-tmp)/(2*a);y2=k*x2+b;if((x1>p2.x&&x1<p1.x)||(y1>p1.y&&y1<p2.y)){_3c=new _3(x1,y1);}else{_3c=new _3(x2,y2);}return _3c;};_8.prototype.getArcCircle=function(p1,p2,p3){var x1=p1.x,x2=p2.x,x3=p3.x,y1=p1.y,y2=p2.y,y3=p3.y,a=x1-x2,b=y1-y2,c=x1-x3,d=y1-y3,e=((x1*x1-x2*x2)+(y1*y1-y2*y2))/2,f=((x1*x1-x3*x3)+(y1*y1-y3*y3))/2,det=b*c-a*d;result,cx=-(d*e-b*f)/det,cy=-(a*f-c*e)/det;result=new _3(cx,cy);return result;};_8.prototype.drawConectionTypeMethod=function(_3d,_3e,_3f,_40,_41,_42,_43,_44,_45,_46,_47){var _48,_49,_4a,_4b;switch(_3d.hConnMode){case "Y":_48=_40.calculateOtherPoint(_42,_44);this.drawStarMethod(_3f,_48,_44,_45,_46);break;case "D":this.drawTriangleMethod(_3f,_42,_43,_44,_45,_46);break;case "Z":this.drawCirCuitousMethod(_3f,_42,_43,_44,_45,_46);break;case "YN":_48=_40.calculateOtherPoint(_42,_44);this.drawStarMethod(_3f,_48,_44,_45,_46);this.drawNeutralPointMethod(_3e,_3f,_42,_45,_46,_47);break;case "ZN":this.drawCirCuitousMethod(_3f,_42,_43,_44,_45,_46);this.drawNeutralPointMethod(_3e,_3f,_42,_45,_46,_47);break;}switch(_3d.lConnMode){case "y":_4a=_3f.calculateOtherPoint(_42,_43);_4b=_4a.dist(_40);_49=_40.calculateOtherPoint(_4b,_43);this.drawStarMethod(_40,_49,_44,_45,_46);break;case "d":this.drawTriangleMethod(_40,_42,_43,_44,_45,_46);break;case "z":this.drawCirCuitousMethod(_40,_42,_43,_44,_45,_46);break;case "yn":_4a=_3f.calculateOtherPoint(_42,_43);_4b=_4a.dist(_40);_49=_40.calculateOtherPoint(_4b,_43);this.drawStarMethod(_40,_49,_44,_45,_46);this.drawNeutralPointMethod(_3e,_40,_42,_45,_46,_47);break;case "zn":this.drawCirCuitousMethod(_40,_42,_43,_44,_45,_46);this.drawNeutralPointMethod(_3e,_40,_42,_45,_46,_47);break;}if(_3d.onLoad===true){this.drawOnLoadMethod(_41,_42,_45,_43,_44,_46);}};_8.prototype.drawStarMethod=function(_4c,_4d,_4e,_4f,_50){var r=_4c.dist(_4d),_51=r*Math.sqrt(3)/2,_52=_4c.calculateOtherPoint(r*0.5,_4e),_53=_4c.calculateOtherPoint2(_52,_51),_54=_53.calculateOtherPoint2(_4c,r*0.5),_55=_52.calculateOtherPoint2(_4c,_51);_50.push([_4c,_4d]);_50.push([_4c,_54]);_50.push([_4c,_55]);};_8.prototype.drawTriangleMethod=function(_56,_57,_58,_59,_5a,_5b){var r1=_57*Math.sqrt(3)/3,_5c=r1*Math.sqrt(3)/2,_5d=_56.calculateOtherPoint(r1,_59),_5e=_56.calculateOtherPoint(r1*0.5,_58),_5f=_5e.calculateOtherPoint2(_56,_5c),_60=_56.calculateOtherPoint2(_5e,_5c),_61=_60.calculateOtherPoint2(_56,r1*0.5);_5b.push([_5d,_5f,_61,_5d]);};_8.prototype.drawCirCuitousMethod=function(_62,_63,_64,_65,_66,_67){var _68=2*_63/5,_69=_68*Math.sqrt(3)/2,_6a=_62.calculateOtherPoint(_68,_65),_6b=_62.calculateOtherPoint(_68*0.5,_64),_6c=_6b.calculateOtherPoint2(_62,_69),_6d=_62.calculateOtherPoint2(_6b,_69),_6e=_6d.calculateOtherPoint2(_62,_68*0.5),_6f=_62.calculateOtherPoint2(_6a,_69),_70=_6f.calculateOtherPoint2(_62,_68),_71=_70.calculateOtherPoint2(_6a,_68*0.5),_72=_62.calculateOtherPoint(_68*1.5,_64),_73=_72.calculateOtherPoint2(_6b,_69),_74=_6b.dist(_6e),_75=_6e.calculateOtherPoint(_69,_74),_76=_6e.calculateOtherPoint2(_75,_68*0.5),_77=_76.calculateOtherPoint2(_6e,_69);_67.push([_62,_6a,_71]);_67.push([_62,_6c,_73]);_67.push([_62,_6e,_77]);};_8.prototype.drawNeutralPointMethod=function(_78,_79,_7a,_7b,_7c,_7d){var r2=2*_7a/5;_7d.push(new _3(_79.x,_79.y));var _7e=_79.calculateOtherPoint2(_78,r2);_7c.push([_79,_7e]);};_8.prototype.drawOnLoadMethod=function(_7f,_80,_81,_82,_83,_84){var _85=1.35*0.5*_81,_86,_87,_88,_89,_8a=_7f.calculateOtherPoint(_85,_82),_8b=_7f.calculateOtherPoint3(_8a,_85*Math.sqrt(3));_86=_8b.calculateOtherPoint3(_7f,_85);var _8c=_86.radian(_7f),_8d=_85*2;_87=_7f.calculateOtherPoint(_8d,_8c);var _8e=_7f.calculateOtherPoint(_8d*0.7,_8c);_89=_8e.calculateOtherPoint3(_87,_8d*0.04);var _8f=_87.calculateOtherPoint3(_8e,_8d*0.04);_88=_8f.calculateOtherPoint3(_87,_8d*0.3);_84.push([_86,_87]);_84.push([_87,_88,_89,_87]);};_8.prototype.drawTapMethod=function(_90,_91,_92,_93){_93.push([_90,_91]);};_8.prototype.calculateExtent=function(_94,_95,_96,_97,_98){var _99=_95.circleRadius,_9a=_95.hlDis/2,_9b=_95.hlRadian/2;var _9c=[{x:_9a,y:_99},{x:-_9a,y:_99},{x:-_9a,y:-_99},{x:_9a,y:-_99}];var _9d=_5.sizeAfterRotated(_9c,_9b);var _9e=_95.hlCenter;_98.push({id:_95.id,g:_95,minX:_9e.x+_9d.xmin,minY:_9e.y+_9d.ymin,maxX:_9e.x+_9d.xmax,maxY:_9e.y+_9d.ymax,});};return _8;});