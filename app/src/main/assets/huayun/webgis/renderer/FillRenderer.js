//>>built
define("com/huayun/webgis/renderer/FillRenderer",["../geometry/Point","../data/bucket/FillBucketSimplify","../gl/mode","../gl/programCache"],function(_1,_2,_3,_4){function _5(){};_5.prototype.add=function(_6,_7,_8,_9){var _a=_7.position||_6.viewpoint.center||[0,0],cx=_a[0],cy=_a[1];if(_8.type==="multipolygon"){var _b=[];for(var i=0;i<_8.polygons.length;i++){var _c=_8.polygons[i];var _d=this._addOnePathFeature(_c,_6,cx,cy);_b.push(_d);}_7.buckets.push(_b);}else{var _d=this._addOnePathFeature(_8,_6,cx,cy);_7.buckets.push(_d);}_7.position=[cx,cy];};_5.prototype._addOnePathFeature=function(_e,_f,cx,cy){var _10=_e.path;var g=[];for(var i=0;i<_10.length;i++){var _11=_10[i];var l=[];for(var j=0;j<_11.length;j++){var p=_11[j];l.push(new _1(p.x-cx,p.y-cy,0));}g.push(l);}var _12=new _2();_12.addFeature(g);_12.upload(_f.context);return _12;};_5.prototype.draw=function(_13,_14,_15,_16,_17,_18){if(_18===undefined){_18=0;}var _19=_3.ColorMode.alphaBlended;var _1a=_13.context;var gl=_1a.gl;var _1b;if(_17){_1b=_17.depthModeForSublayer(0,_3.DepthMode.ReadOnly);}else{_1b=new _3.DepthMode(gl.LEQUAL,_3.DepthMode.ReadOnly,[0.9,0.9]);}var _1c=_4.useProgramSimplify(_1a,"basicFill",{layoutAttributes:[{name:"a_pos",type:"Float32",components:2,offset:0}]});var _1d=_16.uniforms;var _1e=_14.position;_1d["u_matrix"]=_13.viewpoint.getMatrixForPoint(_1e[0],_1e[1]);_1d["u_color"]=_16.color;var _1f=_14.buckets[_18];if(_15.type==="multipolygon"){_1f.forEach(function(bck,_20){_1c.draw(_1a,gl.TRIANGLES,_1b,null,_19,_3.CullFaceMode.disabled,_1d,_14.id+"-fill"+_18+"-"+_20,bck.layoutVertexBuffer,bck.indexBuffer,bck.segments);});}else{_1c.draw(_1a,gl.TRIANGLES,_1b,null,_19,_3.CullFaceMode.disabled,_1d,_14.id+"-fill"+_18,_1f.layoutVertexBuffer,_1f.indexBuffer,_1f.segments);}};_5.prototype.drawGlow=function(_21,_22,_23,_24,_25,_26){var _27=_22.glow;if(!_27){return;}if(_26===undefined){_26=0;}var _28=_3.ColorMode.alphaBlended;var _29=_21.context;var gl=_29.gl;var _2a;if(_25){_2a=_25.depthModeForSublayer(0,_3.DepthMode.ReadOnly);}else{_2a=new _3.DepthMode(gl.LEQUAL,_3.DepthMode.ReadOnly,[0.9,0.9]);}var _2b=_4.useProgramSimplify(_29,"basicFill",{layoutAttributes:[{name:"a_pos",type:"Float32",components:2,offset:0}]});var _2c=_24.uniforms;var _2d=_22.position;_2c["u_matrix"]=_21.viewpoint.getMatrixForPoint(_2d[0],_2d[1]);_2c["u_color"]=_27.color;var _2e=_22.buckets[_26];_2b.draw(_29,gl.TRIANGLES,_2a,null,_28,_3.CullFaceMode.disabled,_2c,_22.id+"-fill"+_26,_2e.layoutVertexBuffer,_2e.indexBuffer,_2e.segments);};_5.prototype.calculateExtent=function(_2f,_30,_31,_32,_33){var _34=_31.extent;_33.push({id:_30.id,g:_30,minX:_34.xmin,minY:_34.ymin,maxX:_34.xmax,maxY:_34.ymax,symbol:_32});};return _5;});