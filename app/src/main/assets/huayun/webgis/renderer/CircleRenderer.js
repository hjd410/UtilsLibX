//>>built
define("com/huayun/webgis/renderer/CircleRenderer",["./Renderer","../gl/mode","../data/bucket/CircleBucketSimplify","../geometry/Point","../gl/programCache"],function(_1,_2,_3,_4,_5){function _6(){};if(_1){_6.__proto__=_1;}_6.prototype=Object.create(_1&&_1.prototype);_6.prototype.constructor=_6;_6.prototype.add=function(_7,_8,_9,_a){var _b=new _3();var _c=_8.position||_7.viewpoint.center||[0,0],cx=_c[0],cy=_c[1];if(_9.type==="multipoint"){var p=[];for(var i=0;i<_9.points.length;i++){p.push(new _4(_9.points[i].x-cx,_9.points[i].y-cy,0));}_b.addFeature([p]);}else{if(_9.type==="point"){_b.addFeature([[new _4(_9.x-cx,_9.y-cy,0)]]);}}_b.upload(_7.context);_8.buckets.push(_b);_8.position=[cx,cy];};_6.prototype.draw=function(_d,_e,_f,_10,_11,_12,_13){if(_12===undefined){_12=0;}var _14=_d.context;var gl=_14.gl;var _15;if(_11){_15=_11.depthModeForSublayer(0,_2.DepthMode.ReadOnly);}else{_15=new _2.DepthMode(gl.LEQUAL,_2.DepthMode.ReadOnly,[0.9,0.9]);}var _16=_2.StencilMode.disabled;var _17=_2.ColorMode.alphaBlended;var _18=_5.useProgramSimplify(_14,"circle",{layoutAttributes:[{name:"a_pos",type:"Float32",components:2,offset:0},{name:"a_data",type:"Int16",components:2,offset:8}]});var _19=_10.uniforms;var _1a=_e.position;var _1b=this.getRealScale(_10.fixed,_d.scale,_10.minScale);var _1c=undefined;var _1d=_d.resolution;if(_10.markerSize){_1b=_1b*(_e.markerScaleFactor||1);_1c=_10.markerSize/_10.radius;_1b=_1b*_1c;}else{if(_e.symbol.size&&_e.symbol.tempW===undefined){_e.scaleFactor=_e.scaleFactor||1;_1b=_1b*_e.scaleFactor;_1c=_e.symbol.size/_10.radius;_e.symbol.tempW=_1c;_1b=_1b*_1c;}else{if(_e.symbol.size&&_e.symbol.tempW!==undefined){_1b=_1b*_e.symbol.tempW;}else{_e.scaleFactor=_e.scaleFactor||1;_1b=_1b*_e.scaleFactor;}}}if(!_13){_19["radius"]=_10.radius*_1b;}if(_e.rotation){_19.u_radian=_10.angle+_e.rotation;}else{_19.u_radian=_10.angle;}var dx=_10.dx*_1b*_1d,dy=_10.dy*_1b*_1d;var _1e=Math.sin(_19.u_radian),_1f=Math.cos(_19.u_radian);var _20=dx*_1f-dy*_1e,_21=dy*_1f+dx*_1e;_19["u_matrix"]=_d.viewpoint.getMatrixForPoint(_1a[0]+_20,_1a[1]+_21);var w=_10.strokeWidth*_1b;_19["stroke_width"]=w<1?1:w;_19["u_camera_to_center_distance"]=_d.viewpoint.cameraToCenterDistance;_19["u_extrude_scale"]=_d.viewpoint.pixelsToGLUnits;_e["_circleOffset"+_12]={dx:_20,dy:_21,size:_10.uniforms["radius"]+_10.uniforms["stroke_width"]};_19["color"]=_10.color;_19["stroke_color"]=_10.strokeColor;var _22=_e.buckets;var _23=_22[_12];_18.draw(_14,gl.TRIANGLES,_15,_16,_17,_2.CullFaceMode.disabled,_19,_e.id+"-circle"+_12,_23.layoutVertexBuffer,_23.indexBuffer,_23.segments,null);};_6.prototype.drawGlow=function(_24,_25,_26,_27,_28,_29,_2a){var _2b=_25.glow;if(!_2b){return;}if(_29===undefined){_29=0;}var _2c=_24.context;var gl=_2c.gl;var _2d;if(_28){_2d=_28.depthModeForSublayer(0,_2.DepthMode.ReadOnly);}else{_2d=new _2.DepthMode(gl.LEQUAL,_2.DepthMode.ReadOnly,[0.9,0.9]);}var _2e=_2.StencilMode.disabled;var _2f=_2.ColorMode.alphaBlended;var _30=_5.useProgramSimplify(_2c,"circle",{layoutAttributes:[{name:"a_pos",type:"Float32",components:2,offset:0},{name:"a_data",type:"Int16",components:2,offset:8}]});var _31=_27.uniforms;var _32=_25.position;var _33=this.getRealScale(_27.fixed,_24.scale,_27.minScale);var _34=1;var _35=_24.resolution;if(_27.markerSize){_33=_33*_25.markerScaleFactor;_34=_27.markerSize/_27.radius;_33=_33*_34;}else{if(_25.symbol.size){_25.scaleFactor=_25.scaleFactor||1;_33=_33*_25.scaleFactor;_34=_25.symbol.size/_27.radius;_33=_33*_34;}else{_25.scaleFactor=_25.scaleFactor||1;_33=_33*_25.scaleFactor;}}if(!_2a){_31["radius"]=_27.radius*_33;}if(_25.rotation){_31.u_radian=_27.angle+_25.rotation;}else{_31.u_radian=_27.angle;}var dx=_27.dx*_33*_35,dy=_27.dy*_33*_35;var _36=Math.sin(_31.u_radian),_37=Math.cos(_31.u_radian);var _38=dx*_37-dy*_36,_39=dy*_37+dx*_36;_31["u_matrix"]=_24.viewpoint.getMatrixForPoint(_32[0]+_38,_32[1]+_39);var w=_27.strokeWidth*_33;_31["stroke_width"]=w<1?1:w;_31["u_camera_to_center_distance"]=_24.viewpoint.cameraToCenterDistance;_31["u_extrude_scale"]=_24.viewpoint.pixelsToGLUnits;var _3a=_2b.color;_31["color"]=_3a;_31["stroke_color"]=_3a;var _3b=_25.buckets;var _3c=_3b[_29];_30.draw(_2c,gl.TRIANGLES,_2d,_2e,_2f,_2.CullFaceMode.disabled,_31,_25.id+"-circle"+_29,_3c.layoutVertexBuffer,_3c.indexBuffer,_3c.segments,null);};_6.prototype.calculateExtent=function(_3d,_3e,_3f,_40,_41,_42){if(!_42){_42=0;}var _43=_3d.resolution;var _44=_3e["_circleOffset"+_42];var _45=_44.size;var x=_3f.x,y=_3f.y;var dx=_44.dx,dy=_44.dy;x=x+dx;y=y+dy;_41.push({id:_3e.id,g:_3e,minX:x-_45*_43,minY:y-_45*_43,maxX:x+_45*_43,maxY:y+_45*_43,});};return _6;});