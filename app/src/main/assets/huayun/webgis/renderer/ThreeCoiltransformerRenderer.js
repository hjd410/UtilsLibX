//>>built
define("com/huayun/webgis/renderer/ThreeCoiltransformerRenderer",["./LineRenderer","./CircleRenderer","../geometry/Point","../geometry/Polyline","../utils/MathUtils","../geometry/Multipoint"],function(_1,_2,_3,_4,_5,_6){function _7(){this.lineRenderer=new _1();this.circleRenderer=new _2();this._rotationAngle=0;this._rotationPoint=null;this.isX=true;};_7.prototype.add=function(_8,_9,_a,_b){var _c=_a.points,_d=_c[0],_e=_c[1],_f=_c[2],_10=(_e.x+_f.x)/2,_11=(_e.y+_f.y)/2;var d=new _3(_10,_11);this._rotationPoint=new _3(_d.x,_d.y);if((_d.y-d.y)===0){if(_d.x<d.x){this._rotationAngle=0;}else{this._rotationAngle=Math.PI;}}else{this._rotationAngle=Math.atan2((d.y-_d.y),(d.x-_d.x));}var aa=new _3(_d.x,_d.y),bb=this.getTranslateTarget(_d,_e,-this._rotationAngle),cc=this.getTranslateTarget(_d,_f,-this._rotationAngle),dd=this.getTranslateTarget(_d,d,-this._rotationAngle),_12=new _3(bb.x,bb.y),_13=new _3(cc.x,cc.y),_14=new _3(dd.x,dd.y);var _15=bb.dist(cc),_16=this.checkDraw(aa,_12,_13),_17,_18,_19=0;if(_16<80){_19=_15/8;_17=new _3(_12.x,_12.y+_19);_18=new _3(_13.x,_13.y-_19);}else{_17=new _3(_12.x,_12.y-_19);_18=new _3(_13.x,_13.y+_19);}var _1a=new _3(_14.x,_14.y),_1b=this._rotationAngle,_1c=this.getpoints2(aa,_17,_18,_9);var _1d=new _3((_1a.x+aa.x)/2,(_1a.y+aa.y)/2);_9.drawCenter=_1d;_9.bottomLen=_17.dist(_18);_9.hlDis=aa.dist(_1a);_9.hlRadian=aa.radian(_1a);var c1=this.getTranslateTarget(_d,_1c[0],_1b),c2=this.getTranslateTarget(_d,_1c[1],_1b),c3=this.getTranslateTarget(_d,_1c[2],_1b),_1e=this.getTranslateTarget(_d,_1c[3],_1b),_1f=this.getTranslateTarget(_d,_1c[4],_1b),_20=this.getTranslateTarget(_d,_1c[5],_1b),bb1=this.getTranslateTarget(_d,_17,_1b),cc1=this.getTranslateTarget(_d,_18,_1b),r=_8.resolution;_b.symbols[1].setRadius(_9.circleRadius/r);_b.symbols[1].setStrokeWidth(_b.symbols[1].strokeWidth/r);this.circleRenderer.add(_8,_9,new _3(c1.x,c1.y),_b.symbols[1]);_b.symbols[2].setRadius(_9.circleRadius/r);_b.symbols[2].setStrokeWidth(_b.symbols[2].strokeWidth/r);this.circleRenderer.add(_8,_9,new _3(c2.x,c2.y),_b.symbols[2]);_b.symbols[3].setRadius(_9.circleRadius/r);_b.symbols[3].setStrokeWidth(_b.symbols[3].strokeWidth/r);this.circleRenderer.add(_8,_9,new _3(c3.x,c3.y),_b.symbols[3]);var _21=new _4([[aa,_1e],[bb1,_1f],[cc1,_20]]);var _22=_b.symbols[1].strokeWidth/r;_b.symbols[0].setWidth(_22);_b.symbols[0].uniforms["u_width"]=1;this.lineRenderer.add(_8,_9,_21,_b.symbols[0]);this.polyPaths=[];this.neturalPoint=[];if(_b.hConnMode){this.processCenter(_b.hConnMode,_1c[0],_b,_9,this.polyPaths,this.neturalPoint);}if(_b.mConnMode){this.processCenter(_b.mConnMode,_1c[1],_b,_9,this.polyPaths,this.neturalPoint);}if(_b.lConnMode){this.processCenter(_b.lConnMode,_1c[2],_b,_9,this.polyPaths,this.neturalPoint);}if(_b.onLoad){this.drawOnLoad(_1c[0],_9,this.polyPaths);}if(this.polyPaths.length>0){this.lineRenderer.add(_8,_9,new _4(this.polyPaths),_b.symbols[0]);}if(this.neturalPoint.length>0){_b.symbols[4].setRadius(_9.circleRadius/(15*r));_b.symbols[4].setStrokeWidth(_b.symbols[4].strokeWidth/r);this.circleRenderer.add(_8,_9,new _6(this.neturalPoint),_b.symbols[4]);}};_7.prototype.draw=function(_23,_24,_25,_26,_27){var r=_23.resolution;var _28=_26.symbols[1].strokeWidth/r;if(_28<1){_28=1;}_26.symbols[0].setWidth(_28);this.lineRenderer.draw(_23,_24,_25,_26.symbols[0],_27,3);var _29=_24.circleRadius/r;if(_29<1){_29=1;}_26.symbols[1].setRadius(_29);_26.symbols[1].setStrokeWidth(_26.symbols[1].strokeWidth/r);this.circleRenderer.draw(_23,_24,_25,_26.symbols[1],_27,0,true);_26.symbols[2].setRadius(_29);_26.symbols[2].setStrokeWidth(_26.symbols[2].strokeWidth/r);this.circleRenderer.draw(_23,_24,_25,_26.symbols[2],_27,1,true);_26.symbols[3].setRadius(_29);_26.symbols[3].setStrokeWidth(_26.symbols[3].strokeWidth/r);this.circleRenderer.draw(_23,_24,_25,_26.symbols[3],_27,2,true);var _2a=_26.symbols[1].color;_26.symbols[1].color=[0,0,0,0];this.circleRenderer.draw(_23,_24,_25,_26.symbols[1],_27,0,true);_26.symbols[1].color=_2a;_2a=_26.symbols[2].color;_26.symbols[2].color=[0,0,0,0];this.circleRenderer.draw(_23,_24,_25,_26.symbols[2],_27,1,true);_26.symbols[2].color=_2a;_2a=_26.symbols[3].color;_26.symbols[3].color=[0,0,0,0];this.circleRenderer.draw(_23,_24,_25,_26.symbols[3],_27,2,true);_26.symbols[3].color=_2a;if(this.polyPaths.length>0){this.lineRenderer.draw(_23,_24,_25,_26.symbols[0],_27,4);}if(this.neturalPoint.length>0){_26.symbols[4].setRadius(_24.circleRadius/(15*r));_26.symbols[4].setStrokeWidth(_26.symbols[4].strokeWidth/r);this.circleRenderer.draw(_23,_24,_25,_26.symbols[4],_27,5,true);}};_7.prototype.drawGlow=function(_2b,_2c,_2d,_2e,_2f){var r=_2b.resolution;var _30=_2e.symbols[1].strokeWidth/r;if(_30<1){_30=1;}_2e.symbols[0].setWidth(_30);this.lineRenderer.drawGlow(_2b,_2c,_2d,_2e.symbols[0],_2f,3);var _31=_2c.circleRadius/r;if(_31<1){_31=1;}_2e.symbols[1].setRadius(_31);_2e.symbols[1].setStrokeWidth(_2e.symbols[1].strokeWidth/r);this.circleRenderer.drawGlow(_2b,_2c,_2d,_2e.symbols[1],_2f,0,true);_2e.symbols[2].setRadius(_31);_2e.symbols[2].setStrokeWidth(_2e.symbols[2].strokeWidth/r);this.circleRenderer.drawGlow(_2b,_2c,_2d,_2e.symbols[2],_2f,1,true);_2e.symbols[3].setRadius(_31);_2e.symbols[3].setStrokeWidth(_2e.symbols[3].strokeWidth/r);this.circleRenderer.drawGlow(_2b,_2c,_2d,_2e.symbols[3],_2f,2,true);var _32=_2e.symbols[1].color;_2e.symbols[1].color=[0,0,0,0];this.circleRenderer.drawGlow(_2b,_2c,_2d,_2e.symbols[1],_2f,0,true);_2e.symbols[1].color=_32;_32=_2e.symbols[2].color;_2e.symbols[2].color=[0,0,0,0];this.circleRenderer.drawGlow(_2b,_2c,_2d,_2e.symbols[2],_2f,1,true);_2e.symbols[2].color=_32;_32=_2e.symbols[3].color;_2e.symbols[3].color=[0,0,0,0];this.circleRenderer.drawGlow(_2b,_2c,_2d,_2e.symbols[3],_2f,2,true);_2e.symbols[3].color=_32;this.lineRenderer.drawGlow(_2b,_2c,_2d,_2e.symbols[0],_2f,4);if(_2d.points.length>0){_2e.symbols[4].setRadius(_2c.circleRadius/(15*r));_2e.symbols[4].setStrokeWidth(_2e.symbols[4].strokeWidth/r);this.circleRenderer.drawGlow(_2b,_2c,_2d,_2e.symbols[4],_2f,5,true);}};_7.prototype.processCenter=function(_33,_34,_35,_36,_37,_38){_33=_33.toLowerCase();switch(_33){case "y":this.drawStar(_34,_36,_37);break;case "d":this.drawAngle(_34,_36,_37);break;case "z":break;case "yn":this.drawStar(_34,_36,_37);this.drawNetural(_34,_35,_36,_37,_38);break;case "zn":break;}};_7.prototype.drawOnLoad=function(c0,_39,_3a){var r=_39.circleRadius,_3b=new _3(c0.x+r,c0.y),_3c=r*2.4,_3d=this._rotationPoint,_3e=this._rotationAngle,_3f=new _3(_3b.x+_3c*0.5,c0.y+_3c*Math.sqrt(3)/2),_40=new _3(_3b.x-_3c*0.5,c0.y-_3c*Math.sqrt(3)/2),dx=_3c*0.3*Math.cos(Math.PI*70/180),dy=_3c*0.3*Math.sin(Math.PI*70/180),_41=new _3(_40.x+dx,_40.y+dy),dx1=_3c*0.3*Math.cos(Math.PI*50/180),dy1=_3c*0.3*Math.sin(Math.PI*50/180),_42=new _3(_40.x+dx1,_40.y+dy1),_43=this.getTranslateTarget2(_3d,_3f,_3e),_44=this.getTranslateTarget2(_3d,_40,_3e),_45=this.getTranslateTarget2(_3d,_41,_3e),_46=this.getTranslateTarget2(_3d,_42,_3e);_3a.push([_43,_44]);_3a.push([_44,_45,_46,_44]);};_7.prototype.drawNetural=function(_47,_48,_49,_4a,_4b){var r=_49.circleRadius,_4c=this._rotationPoint,_4d=this._rotationAngle,ex=new _3(_47.x,_47.y+r/3);var _4e=this.getTranslateTarget(_4c,_47,_4d,r),ex1=this.getTranslateTarget(_4c,ex,_4d,r);_4b.push(new _3(_4e.x,_4e.y));_4a.push([_4e,ex1]);};_7.prototype.drawAngle=function(_4f,_50,_51){var r=_50.circleRadius,_52=this._rotationPoint,_53=this._rotationAngle,top=new _3(_4f.x-r/2,_4f.y),_54=this.getTranslateTarget(_4f,top,-Math.PI*120/180),_55=this.getTranslateTarget(_4f,top,Math.PI*120/180),_56=this.getTranslateTarget(_52,top,_53),_57=this.getTranslateTarget(_52,_54,_53),_58=this.getTranslateTarget(_52,_55,_53);_51.push([_56,_57,_58,_56]);};_7.prototype.drawStar=function(_59,_5a,_5b){var r=_5a.circleRadius,_5c=this._rotationPoint,_5d=this._rotationAngle,top=new _3(_59.x+r/2,_59.y),_5e=this.getTranslateTarget(_59,top,-Math.PI*120/180),_5f=this.getTranslateTarget(_59,top,Math.PI*120/180),_60=this.getTranslateTarget(_5c,top,_5d),_61=this.getTranslateTarget(_5c,_5e,_5d),_62=this.getTranslateTarget(_5c,_5f,_5d),_63=this.getTranslateTarget(_5c,_59,_5d);_5b.push([_63,_60]);_5b.push([_63,_61]);_5b.push([_63,_62]);};_7.prototype.getTranslateTarget=function(_64,_65,_66){var _67=new _3(),_68=Math.atan2((_65.y-_64.y),(_65.x-_64.x)),_69=_68+_66,_6a=Math.sqrt(Math.pow((_65.x-_64.x),2)+Math.pow((_65.y-_64.y),2));_67.x=_64.x+_6a*Math.cos(_69);_67.y=_64.y+_6a*Math.sin(_69);return _67;};_7.prototype.getTranslateTarget2=function(_6b,_6c,_6d){var _6e=new _3(),_6f=Math.atan2((_6c.y-_6b.y),(_6c.x-_6b.x)),_70=_6f-_6d,_71=Math.sqrt(Math.pow((_6c.x-_6b.x),2)+Math.pow((_6c.y-_6b.y),2));_6e.x=_6b.x+_71*Math.cos(_70);_6e.y=_6b.y+_71*Math.sin(-_70);return _6e;};_7.prototype.checkDraw=function(aa,bb,cc){var ab=Math.sqrt(Math.pow(aa.x-bb.x,2)+Math.pow(aa.y-bb.y,2)),bc=Math.sqrt(Math.pow(bb.x-cc.x,2)+Math.pow(bb.y-cc.y,2)),_72=(Math.acos(bc/(2*ab))*180/Math.PI),_73;if(_72<76){_73=76;}else{_73=80;}return _73;};_7.prototype.getpoints2=function(aa,bb,cc,_74){var _75=[],dd=new _3((bb.x+cc.x)/2,(bb.y+cc.y)/2),_76=Math.abs(bb.y-cc.y),add=aa.dist(dd);_74.circleRadius=_76*115/200;var r=_74.circleRadius,_77=2*r+_76*Math.sqrt(3)/2,_78=(add-_77)/2,_79,c1,_7a,c2,_7b,c3;if(_78>0){_79=new _3(aa.x+_78,aa.y);c1=new _3(aa.x+_78+r,aa.y);_7a=new _3(bb.x-_78,bb.y);c2=new _3(bb.x-_78-r,bb.y);_7b=new _3(cc.x-_78,cc.y);c3=new _3(cc.x-_78-r,cc.y);_75=[c1,c2,c3,_79,_7a,_7b,r,_78];}else{r=add/(2+(200/115)*Math.sqrt(3)/2-0.193);_78=0.15*r;_76=r*40/23;_79=new _3(aa.x+_78,aa.y);c1=new _3(aa.x+_78+r,aa.y);c2=new _3(c1.x+_76*Math.sqrt(3)/2,c1.y+_76/2);c3=new _3(c1.x+_76*Math.sqrt(3)/2,c1.y-_76/2);_7a=new _3((c2.x+r),c2.y);_7b=new _3((c3.x+r),c3.y);_75=[c1,c2,c3,_79,_7a,_7b,r,_78];}return _75;};_7.prototype.calculateExtent=function(_7c,_7d,_7e,_7f,_80){var _81=_7d.circleRadius,_82=_7d.hlDis/2,_83=_7d.bottomLen,_84=_7d.hlRadian/2;var _85=[{x:_82,y:_83/2+_81},{x:-_82,y:_83/2+_81},{x:-_82,y:-(_83/2+_81)},{x:_82,y:-(_83/2+_81)}];var _86=_5.sizeAfterRotated(_85,_84);var _87=_7d.drawCenter;_80.push({id:_7d.id,g:_7d,minX:_87.x+_86.xmin,minY:_87.y+_86.ymin,maxX:_87.x+_86.xmax,maxY:_87.y+_86.ymax,});};return _7;});