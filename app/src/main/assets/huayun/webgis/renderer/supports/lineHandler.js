//>>built
define("com/huayun/webgis/renderer/supports/lineHandler",["exports","../../gl/mode","../../gl/programAttributes","../../data/bucket/LineBucketSimplify","../../geometry/Point"],function(_1,_2,_3,_4,_5){var _6=function(_7,_8,_9){var _a=_9.uniforms;var _b=_8.position;_a["u_matrix"]=_7.transform.getMatrixForPoint(_b[0],_b[1]);_a["u_units_to_pixels"]=[_7.transform.width/2,-_7.transform.height/2];_a["u_ratio"]=1/_7.transform.resolution;return _a;};var _c=function(_d,_e,_f){var r=1/_d.view.resolution;var _10=_f.uniforms;var _11=_e.position;_10["u_matrix"]=_d.transform.getMatrixForPoint(_11[0],_11[1]);_10["u_units_to_pixels"]=[_d.transform.width/2,-_d.transform.height/2];_10["u_ratio"]=r;_10["u_image"]=0;_10["u_patternscale_a"]=[r/_f.widthA,_10["u_patternscale_a"][1]];_10["u_patternscale_b"]=[r/_f.widthB,_10["u_patternscale_b"][1]];return _10;};_1.addLine=function(_12,_13,_14,_15){var _16=_13.viewpoint.center,cx=_16[0],cy=_16[1];var _17=_14.path;var g=[];for(var i=0,ii=_17.length;i<ii;i++){var _18=_17[i];var l=[];for(var j=0;j<_18.length;j++){var p=_18[j];l.push(new _5(Math.round(p.x-cx),Math.round(p.y-cy),0));}g.push(l);}var _19=new _4();_19.addFeature(g,_15.join,_15.cap,2,1.05);_19.upload(_13.context);_12.buckets.push(_19);_12.position=[cx,cy];};_1.drawLine=function(_1a,_1b,_1c,_1d){var _1e=_1a.view.context;var gl=_1e.gl;var _1f=_1a.depthModeForSublayer(0,_2.DepthMode.ReadOnly);var _20=_2.ColorMode.alphaBlended;var _21=_1b.buckets[_1d];var _22=_1c.dasharray;var _23=_22?"basicLineSDF":"basicLine";var _24=_1a.view.useProgramSimplify(_23,_3.basicLine);if(_22){_1e.activeTexture.set(gl.TEXTURE0);_1c.lineAtlas.bind(_1e);}var _25=_22?_c(_1a,_1b,_1c):_6(_1a,_1b,_1c);_24.draw(_1e,gl.TRIANGLES,_1f,null,_20,_2.CullFaceMode.disabled,_25,_1b.id+"-"+_1d,_21.layoutVertexBuffer,_21.indexBuffer,_21.segments,null,_1a.view.viewpoint.level);};});