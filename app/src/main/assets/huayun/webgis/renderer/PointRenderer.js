//>>built
define("com/huayun/webgis/renderer/PointRenderer",["./Renderer","../gl/mode","../data/bucket/CircleBucketSimplify","../geometry/Point","../gl/programCache"],function(r,e,z,x,y){function k(){}r&&(k.__proto__=r);k.prototype=Object.create(r&&r.prototype);k.prototype.constructor=k;k.prototype.add=function(c,b,d,a){a=new z;var h=b.position||c.viewpoint.center||[0,0],f=h[0],h=h[1];if("multipoint"===d.type){for(var q=[],e=0;e<d.points.length;e++)q.push(new x(d.points[e].x-f,d.points[e].y-h,0));a.addFeature([q])}else"point"===
d.type&&a.addFeature([[new x(d.x-f,d.y-h,0)]]);a.upload(c.context);b.buckets.push(a);b.position=[f,h]};k.prototype.draw=function(c,b,d,a,h,f,q){void 0===f&&(f=0);d=c.context;var k=d.gl;h=h?h.depthModeForSublayer(0,e.DepthMode.ReadWrite):new e.DepthMode(k.LEQUAL,e.DepthMode.ReadWrite,[.9,.9]);var r=e.StencilMode.disabled,v=e.ColorMode.alphaBlended,w=y.useProgramSimplify(d,"circle",{layoutAttributes:[{name:"a_pos",type:"Float32",components:2,offset:0},{name:"a_data",type:"Int16",components:2,offset:8}]}),
m=a.uniforms,l=b.position,n=this.getRealScale(a.fixed,c.scale,a.minScale),g=void 0,p=c.resolution;a.markerSize?(n*=b.markerScaleFactor||1,g=a.markerSize/a.radius,n*=g):b.symbol.size&&void 0===b.symbol.tempW?(b.scaleFactor=b.scaleFactor||1,n*=b.scaleFactor,g=b.symbol.size/a.radius,b.symbol.tempW=g,n*=g):b.symbol.size&&void 0!==b.symbol.tempW?n*=b.symbol.tempW:(b.scaleFactor=b.scaleFactor||1,n*=b.scaleFactor);q||(m.radius=a.radius*n);m.u_radian=b.rotation?a.angle+b.rotation:a.angle;void 0===m.u_radian&&
(m.u_radian=0);var g=a.dx*n*p,p=a.dy*n*p,t=Math.sin(m.u_radian),u=Math.cos(m.u_radian);q=g*u-p*t;g=p*u+g*t;m.u_matrix=c.viewpoint.getMatrixForPoint(l[0]+q,l[1]+g);l=a.strokeWidth*n;m.stroke_width=1>l?1:l;m.u_camera_to_center_distance=c.viewpoint.cameraToCenterDistance;m.u_extrude_scale=c.viewpoint.pixelsToGLUnits;b["_circleOffset"+f]={dx:q,dy:g,size:a.uniforms.radius+a.uniforms.stroke_width};m.color=a.color;m.stroke_color=a.strokeColor;c=b.buckets[f];w.draw(d,k.TRIANGLES,h,r,v,e.CullFaceMode.disabled,
m,b.id+"-circle"+f,c.layoutVertexBuffer,c.indexBuffer,c.segments,null)};k.prototype.drawGlow=function(c,b,d,a,h,f,q){var k=b.glow;if(k){void 0===f&&(f=0);d=c.context;var r=d.gl;h=h?h.depthModeForSublayer(0,e.DepthMode.ReadOnly):new e.DepthMode(r.LEQUAL,e.DepthMode.ReadOnly,[.9,.9]);var v=e.StencilMode.disabled,w=e.ColorMode.alphaBlended,m=y.useProgramSimplify(d,"circle",{layoutAttributes:[{name:"a_pos",type:"Float32",components:2,offset:0},{name:"a_data",type:"Int16",components:2,offset:8}]}),l=a.uniforms,
n=b.position,g=this.getRealScale(a.fixed,c.scale,a.minScale),p=1,t=c.resolution;a.markerSize?(g*=b.markerScaleFactor,p=a.markerSize/a.radius,g*=p):b.symbol.size?(b.scaleFactor=b.scaleFactor||1,g*=b.scaleFactor,p=b.symbol.size/a.radius,g*=p):(b.scaleFactor=b.scaleFactor||1,g*=b.scaleFactor);q||(l.radius=a.radius*g);l.u_radian=b.rotation?a.angle+b.rotation:a.angle;q=a.dx*g*t;var t=a.dy*g*t,p=Math.sin(l.u_radian),u=Math.cos(l.u_radian);l.u_matrix=c.viewpoint.getMatrixForPoint(n[0]+(q*u-t*p),n[1]+(t*
u+q*p));a=a.strokeWidth*g;l.stroke_width=1>a?1:a;l.u_camera_to_center_distance=c.viewpoint.cameraToCenterDistance;l.u_extrude_scale=c.viewpoint.pixelsToGLUnits;c=k.color;l.color=c;l.stroke_color=c;c=b.buckets[f];m.draw(d,r.TRIANGLES,h,v,w,e.CullFaceMode.disabled,l,b.id+"-circle"+f,c.layoutVertexBuffer,c.indexBuffer,c.segments,null)}};k.prototype.calculateExtent=function(c,b,d,a,h,f){f||(f=0);c=c.resolution;f=b["_circleOffset"+f];a=f.size;var e=d.x;d=d.y;var k=f.dy,e=e+f.dx;d+=k;h.push({id:b.id,g:b,
minX:e-a*c,minY:d-a*c,maxX:e+a*c,maxY:d+a*c})};return k});