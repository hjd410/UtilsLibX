//>>built
define("com/huayun/webgis/layers/HyTerrainLayer",["dojo/topic","./Layer","../views/3d/layers/TerrainLayerView3D","../geometry/Extent","../geometry/Point","./support/TerrainSourceCacheHyTerrain","./support/LOD","./support/TileInfo","com/huayun/facades/TileInfoFacade","../work/Dispatcher"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a){var _b=function(_c){this.id=_c.id;this.loaded=false;this.url=_c.url;this.tileInfo=null;this.layerView=null;this.type="Tile";};if(_2){_b.__proto__=_2;}_b.prototype=Object.create(_2&&_2.prototype);_b.prototype.constructor=_b;_b.prototype._load=function(_d){var _e=/(\/tile\/.+)/;var _f=/access_token=([\d+|\w+]-?)+/;var _10=this.url.replace(_e,"");if(_f.test(this.url)){_10=_10+"?"+this.url.match(_f)[0];}var id="tile";var _11={"tiles":this.format?this.url+this.format:this.url,"tileSize":256};_10="http://tile-server.test.cloud.zj.sgcc.com.cn/rest/services/RASTER_GE_EN/MapServer?f=json";this.sourceCache=new _6(id,_11,_d.width,_d.height,this.url,this,_d);new _9().getTileInfoData(_10,function(_12){var _13=_12.tileInfo;var _14=_13.origin;_14=new _5(_14.x,_14.y);var _15=[];_12.lods.forEach(function(_16){_15.push(new _7({level:_16.level,scale:_16.scale,resolution:_16.resolution}));});var _17=_12.fullExtent;var _18=new _4(Number(_17.xmin),Number(_17.ymin),Number(_17.xmax),Number(_17.ymax));this.tileInfo=new _8({lods:_15,origin:_14,size:_13.cols,fullExtent:_18});_1.publish("tileInfoComplete",this.tileInfo,this.layerView.view.id);}.bind(this));};_b.prototype.createLayerView=function(_19,_1a){var _1b=new _3({visible:this.visible,view:_19,id:this.id,layer:this});this._load(_19);this.layerView=_1b;_1b.transform=_19.viewpoint;return _1b;};return _b;});