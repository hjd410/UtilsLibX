//>>built
define("com/huayun/webgis/layers/support/style/parsingContext",["exports","./Scope","./ParsingError","./EvaluationContext","./styleUtils","../expression/Assertion","../expression/Coercion","../expression/Literal","../expression/Var","../expression/compoundExpression","../expression/CollatorExpression"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b){function _c(_d){if(_d instanceof _9){return _c(_d.boundExpression);}else{if(_d instanceof _a.CompoundExpression&&_d.name==="error"){return false;}else{if(_d instanceof _b){return false;}}}var _e=_d instanceof _7||_d instanceof _6;var _f=true;_d.eachChild(function(_10){if(_e){_f=_f&&_c(_10);}else{_f=_f&&_10 instanceof _8;}});if(!_f){return false;}return _a.isFeatureConstant(_d)&&_a.isGlobalPropertyConstant(_d,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"]);};function _11(_12,_13,_14){if(_14==="assert"){return new _6(_13,[_12]);}else{if(_14==="coerce"){return new _7(_13,[_12]);}else{return _12;}}};var _15=function _15(_16,_17,_18,_19,_1a){if(_17===void 0){_17=[];}if(_19===void 0){_19=new _2();}if(_1a===void 0){_1a=[];}this.registry=_16;this.path=_17;this.key=_17.map(function(_1b){return ("["+_1b+"]");}).join("");this.scope=_19;this.errors=_1a;this.expectedType=_18;};_15.prototype.parse=function parse(_1c,_1d,_1e,_1f,_20){if(_20===void 0){_20={};}if(_1d){return this.concat(_1d,_1e,_1f)._parse(_1c,_20);}return this._parse(_1c,_20);};_15.prototype.concat=function concat(_21,_22,_23){var _24=typeof _21==="number"?this.path.concat(_21):this.path;var _25=_23?this.scope.concat(_23):this.scope;return new _15(this.registry,_24,_22||null,_25,this.errors);};_15.prototype._parse=function _parse(_26,_27){if(_26===null||typeof _26==="string"||typeof _26==="boolean"||typeof _26==="number"){_26=["literal",_26];}if(Array.isArray(_26)){if(_26.length===0){return this.error("Expected an array with at least one element. If you wanted a literal array, use [\"literal\", []].");}var op=_26[0];if(typeof op!=="string"){this.error("Expression name must be a string, but found "+(typeof op)+" instead. If you wanted a literal array, use [\"literal\", [...]].",0);return null;}var _28=this.registry[op];if(_28){var _29=_28.parse(_26,this);if(!_29){return null;}if(this.expectedType){var _2a=this.expectedType;var _2b=_29.type;if((_2a.kind==="string"||_2a.kind==="number"||_2a.kind==="boolean"||_2a.kind==="object"||_2a.kind==="array")&&_2b.kind==="value"){_29=_11(_29,_2a,_27.typeAnnotation||"assert");}else{if((_2a.kind==="color"||_2a.kind==="formatted")&&(_2b.kind==="value"||_2b.kind==="string")){_29=_11(_29,_2a,_27.typeAnnotation||"coerce");}else{if(this.checkSubtype(_2a,_2b)){return null;}}}}if(!(_29 instanceof _8)&&_c(_29)){var ec=new _4();try{_29=new _8(_29.type,_29.evaluate(ec));}catch(e){this.error(e.message);return null;}}return _29;}return this.error(("Unknown expression \""+op+"\". If you wanted a literal array, use [\"literal\", [...]]."),0);}else{if(typeof _26==="undefined"){return this.error("'undefined' value invalid. Use null instead.");}else{if(typeof _26==="object"){return this.error("Bare objects invalid. Use [\"literal\", {...}] instead.");}else{return this.error("Expected an array, but found "+(typeof _26)+" instead.");}}}};_15.prototype.error=function(_2c){var _2d=[],len=arguments.length-1;while(len-->0){_2d[len]=arguments[len+1];}var key=""+this.key+(_2d.map(function(k){return ("["+k+"]");}).join(""));this.errors.push(new _3(key,_2c));};_15.prototype.checkSubtype=function(_2e,t){var _2f=_5.checkSubtype(_2e,t);if(_2f){this.error(_2f);}return _2f;};_1.ParsingContext=_15;});