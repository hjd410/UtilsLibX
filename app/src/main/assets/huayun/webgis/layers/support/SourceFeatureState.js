//>>built
define("com/huayun/webgis/layers/support/SourceFeatureState",["../../utils/utils"],function(_1){var _2=function _2(){this.state={};this.stateChanges={};this.deletedStates={};};_2.prototype.updateState=function updateState(_3,_4,_5){for(var i=0;i<_4.length;i++){var _6=_4[i];var _7=String(_6);this.stateChanges[_3]=this.stateChanges[_3]||{};this.stateChanges[_3][_7]=this.stateChanges[_3][_7]||{};_1.extend(this.stateChanges[_3][_7],_5);if(this.deletedStates[_3]===null){this.deletedStates[_3]={};for(var ft in this.state[_3]){if(ft!==_7){this.deletedStates[_3][ft]=null;}}}else{var _8=this.deletedStates[_3]&&this.deletedStates[_3][_7]===null;if(_8){this.deletedStates[_3][_7]={};for(var _9 in this.state[_3][_7]){if(!_5[_9]){this.deletedStates[_3][_7][_9]=null;}}}else{for(var _a in _5){var _b=this.deletedStates[_3]&&this.deletedStates[_3][_7]&&this.deletedStates[_3][_7][_a]===null;if(_b){delete this.deletedStates[_3][_7][_a];}}}}}};_2.prototype.removeFeatureState=function removeFeatureState(_c,_d,_e){var _f=this.deletedStates[_c]===null;if(_f){return;}var _10=String(_d);this.deletedStates[_c]=this.deletedStates[_c]||{};if(_e&&_d!==undefined&&_d>=0){if(this.deletedStates[_c][_10]!==null){this.deletedStates[_c][_10]=this.deletedStates[_c][_10]||{};this.deletedStates[_c][_10][_e]=null;}}else{if(_d!==undefined&&_d>=0){var _11=this.stateChanges[_c]&&this.stateChanges[_c][_10];if(_11){this.deletedStates[_c][_10]={};for(_e in this.stateChanges[_c][_10]){this.deletedStates[_c][_10][_e]=null;}}else{this.deletedStates[_c][_10]=null;}}else{this.deletedStates[_c]=null;}}};_2.prototype.getState=function getState(_12,_13){var _14=String(_13);var _15=this.state[_12]||{};var _16=this.stateChanges[_12]||{};var _17=_1.extend({},_15[_14],_16[_14]);if(this.deletedStates[_12]===null){return {};}else{if(this.deletedStates[_12]){var _18=this.deletedStates[_12][_13];if(_18===null){return {};}for(var _19 in _18){delete _17[_19];}}}return _17;};_2.prototype.initializeTileState=function initializeTileState(_1a,_1b){_1a.setFeatureState(this.state,_1b);};_2.prototype.coalesceChanges=function coalesceChanges(_1c,_1d){var _1e={};for(var _1f in this.stateChanges){this.state[_1f]=this.state[_1f]||{};var _20={};for(var _21 in this.stateChanges[_1f]){if(!this.state[_1f][_21]){this.state[_1f][_21]={};}_1.extend(this.state[_1f][_21],this.stateChanges[_1f][_21]);_20[_21]=this.state[_1f][_21];}_1e[_1f]=_20;}for(var _22 in this.deletedStates){this.state[_22]=this.state[_22]||{};var _23={};if(this.deletedStates[_22]===null){for(var ft in this.state[_22]){_23[ft]={};this.state[_22][ft]={};}}else{for(var _24 in this.deletedStates[_22]){var _25=this.deletedStates[_22][_24]===null;if(_25){this.state[_22][_24]={};}else{for(var i=0,_26=Object.keys(this.deletedStates[_22][_24]);i<_26.length;i+=1){var key=_26[i];delete this.state[_22][_24][key];}}_23[_24]=this.state[_22][_24];}}_1e[_22]=_1e[_22]||{};_1.extend(_1e[_22],_23);}this.stateChanges={};this.deletedStates={};if(Object.keys(_1e).length===0){return;}for(var id in _1c){var _27=_1c[id];_27.setFeatureState(_1e,_1d);}};return _2;});