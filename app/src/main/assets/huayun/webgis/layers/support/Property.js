//>>built
define("com/huayun/webgis/layers/support/Property","exports ../../utils/Color ./Formatted ./Interpolate ./expressions ../../utils/utils ../../gl/dataTransfer".split(" "),function(p,r,T,z,l,u,g){function K(a,b){for(var c in b)a[c]=b[c];return a}function C(a){return a>U?Math.pow(a,1/3):a/L+M}function D(a){return a>t?a*a*a:L*(a-M)}function E(a){return 255*(.0031308>=a?12.92*a:1.055*Math.pow(a,1/2.4)-.055)}function F(a){a/=255;return.04045>=a?a/12.92:Math.pow((a+.055)/1.055,2.4)}function N(a){var b=F(a.r),
c=F(a.g),d=F(a.b),e=C((.4124564*b+.3575761*c+.1804375*d)/.95047),f=C((.2126729*b+.7151522*c+.072175*d)/1),b=C((.0193339*b+.119192*c+.9503041*d)/1.08883);return{l:116*f-16,a:500*(e-f),b:200*(f-b),alpha:a.a}}function O(a){var b=(a.l+16)/116,c=isNaN(a.a)?b:b+a.a/500,d=isNaN(a.b)?b:b-a.b/200,b=1*D(b),c=.95047*D(c),d=1.08883*D(d);return new r(E(3.2404542*c-1.5371385*b-.4985314*d),E(-.969266*c+1.8760108*b+.041556*d),E(.0556434*c-.2040259*b+1.0572252*d),a.alpha)}function h(a,b,c){return a*(1-c)+b*c}function G(a){return a instanceof
Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":null===a?"null":typeof a}function v(a,b,c){if(void 0!==a)return a;if(void 0!==b)return b;if(void 0!==c)return c}function P(a,b){for(var c=a.length-1,d=0,e=c,f=0,g,h;d<=e;)if(f=Math.floor((d+e)/2),g=a[f],h=a[f+1],g<=b){if(f===c||b<h)return f;d=f+1}else if(g>b)e=f-1;else throw Error("Input is not a number.");return 0}function V(a){return a}function W(a,b,c,d){d-=c;a-=c;return 0===d?0:1===b?a/d:(Math.pow(b,
a)-1)/(Math.pow(b,d)-1)}function Q(a,b,c){var d=void 0!==a.base?a.base:1;if("number"!==G(c))return v(a.default,b.default);var e=a.stops.length;if(1===e||c<=a.stops[0][0])return a.stops[0][1];if(c>=a.stops[e-1][0])return a.stops[e-1][1];var e=P(a.stops.map(function(a){return a[0]}),c),f=W(c,d,a.stops[e][0],a.stops[e+1][0]),g=a.stops[e][1],h=a.stops[e+1][1],m=H[b.type]||V;if(a.colorSpace&&"rgb"!==a.colorSpace)var n=R[a.colorSpace],m=function(a,b){return n.reverse(n.interpolate(n.forward(a),n.forward(b),
f))};return"function"===typeof g.evaluate?{evaluate:function(){for(var a=[],b=arguments.length;b--;)a[b]=arguments[b];b=g.evaluate.apply(void 0,a);a=h.evaluate.apply(void 0,a);if(void 0!==b&&void 0!==a)return m(b,a,f)}}:m(g,h,f)}function X(a,b,c){if("number"!==G(c))return v(a.default,b.default);b=a.stops.length;if(1===b||c<=a.stops[0][0])return a.stops[0][1];if(c>=a.stops[b-1][0])return a.stops[b-1][1];c=P(a.stops.map(function(a){return a[0]}),c);return a.stops[c][1]}function Y(a,b,c,d,e){return v(typeof c===
e?d[c]:void 0,a.default,b.default)}function Z(a,b,c){"color"===b.type?c=r.parse(c):"formatted"===b.type?c=T.fromString(c.toString()):G(c)===b.type||"enum"===b.type&&b.values[c]||(c=void 0);return v(c,a.default,b.default)}function S(a,b){var c=a.stops&&"object"===typeof a.stops[0][0],d=c||void 0!==a.property,d=c||!d,e=a.type||(b.expression&&b.expression.interpolated?"exponential":"interval");"color"===b.type&&(a=K({},a),a.stops&&(a.stops=a.stops.map(function(a){return[a[0],r.parse(a[1])]})),a.default=
a.default?r.parse(a.default):r.parse(b.default));if(a.colorSpace&&"rgb"!==a.colorSpace&&!R[a.colorSpace])throw Error("Unknown color space: "+a.colorSpace);var f,g,h;if("exponential"===e)f=Q;else if("interval"===e)f=X;else if("categorical"===e){f=Y;g=Object.create(null);for(var m=0,n=a.stops;m<n.length;m+=1){var l=n[m];g[l[0]]=l[1]}h=typeof a.stops[0][0]}else if("identity"===e)f=Z;else throw Error('Unknown function type "'+e+'"');if(c){c={};d=[];for(e=0;e<a.stops.length;e++)m=a.stops[e],n=m[0].zoom,
void 0===c[n]&&(c[n]={zoom:n,type:a.type,property:a.property,default:a.default,stops:[]},d.push(n)),c[n].stops.push([m[0].value,m[1]]);for(var k=[],e=0;e<d.length;e+=1)m=d[e],k.push([c[m].zoom,S(c[m],b)]);c={name:"linear"};return{kind:"composite",interpolationType:c,interpolationFactor:z.interpolationFactor.bind(void 0,c),zoomStops:k.map(function(a){return a[0]}),evaluate:function(c,d){c=c.zoom;return Q({stops:k,base:a.base},b,c).evaluate(c,d)}}}return d?(c="exponential"===e?{name:"exponential",base:void 0!==
a.base?a.base:1}:null,{kind:"camera",interpolationType:c,interpolationFactor:z.interpolationFactor.bind(void 0,c),zoomStops:a.stops.map(function(a){return a[0]}),evaluate:function(c){return f(a,b,c.zoom,g,h)}}):{kind:"source",evaluate:function(c,d){c=d&&d.properties?d.properties[a.property]:void 0;return void 0===c?v(a.default,b.default):f(a,b,c,g,h)}}}function A(a){var b=null;if(a instanceof l.expressions.let)b=A(a.result);else if(a instanceof l.expressions.coalesce)for(var c=0,d=a.args;c<d.length&&
!(b=A(d[c]));c+=1);else(a instanceof l.expressions.step||a instanceof z)&&a.input instanceof l.CompoundExpression&&"zoom"===a.input.name&&(b=a);if(b instanceof q)return b;a.eachChild(function(a){a=A(a);a instanceof q?b=a:!b&&a?b=new q("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):b&&a&&b!==a&&(b=new q("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))});return b}function w(a){return{result:"error",value:a}}
function aa(a,b){a=l.createExpression(a,b);if("error"===a.result)return a;var c=a.value.expression,d=l.isFeatureConstant(c);if(!d&&!u.supportsPropertyExpression(b))return w([new q("","data expressions not supported")]);var e=l.isGlobalPropertyConstant(c,["zoom"]);if(!e&&!u.supportsZoomExpression(b))return w([new q("","zoom expressions not supported")]);if((c=A(c))||e){if(c instanceof q)return w([c]);if(c instanceof z&&!u.supportsInterpolation(b))return w([new q("",'"interpolate" expressions cannot be used with this property')])}else return w([new q("",
'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')]);return c?{result:"success",value:d?new l.ZoomDependentExpression("camera",a.value,c):new l.ZoomDependentExpression("composite",a.value,c)}:{result:"success",value:d?new l.ZoomConstantExpression("constant",a.value):new l.ZoomConstantExpression("source",a.value)}}function ba(a){return Array.isArray(a)&&0<a.length&&"string"===typeof a[0]&&a[0]in l.expressions}function ca(a,b){if(u.isFunction(a))return new x(a,
b);if(ba(a)){a=aa(a,b);if("error"===a.result)throw Error(a.value.map(function(a){return a.key+": "+a.message}).join(", "));return a.value}var c=a;"string"===typeof a&&"color"===b.type&&(c=r.parse(a));return{kind:"constant",evaluate:function(){return c}}}var M=4/29,t=6/29,L=3*t*t,U=t*t*t,da=Math.PI/180,ea=180/Math.PI,R=Object.freeze({lab:{forward:N,reverse:O,interpolate:function(a,b,c){return{l:h(a.l,b.l,c),a:h(a.a,b.a,c),b:h(a.b,b.b,c),alpha:h(a.alpha,b.alpha,c)}}},hcl:{forward:function(a){var b=
N(a),c=b.a,d=b.b,e=Math.atan2(d,c)*ea;return{h:0>e?e+360:e,c:Math.sqrt(c*c+d*d),l:b.l,alpha:a.a}},reverse:function(a){var b=a.h*da,c=a.c;return O({l:a.l,a:Math.cos(b)*c,b:Math.sin(b)*c,alpha:a.alpha})},interpolate:function(a,b,c){var d=a.h,e=b.h-d;return{h:d+c*(180<e||-180>e?e-360*Math.round(e/360):e),c:h(a.c,b.c,c),l:h(a.l,b.l,c),alpha:h(a.alpha,b.alpha,c)}}}}),H=Object.freeze({number:h,color:function(a,b,c){return new r(h(a.r,b.r,c),h(a.g,b.g,c),h(a.b,b.b,c),h(a.a,b.a,c))},array:function(a,b,c){return a.map(function(a,
e){return h(a,b[e],c)})}}),x=function(a,b){this._parameters=a;this._specification=b;K(this,S(this._parameters,this._specification))};x.deserialize=function(a){return new x(a._parameters,a._specification)};x.serialize=function(a){return{_parameters:a._parameters,_specification:a._specification}};g.register("StylePropertyFunction",x);var q=function(a){function b(b,d){a.call(this,d);this.message=d;this.key=b}a&&(b.__proto__=a);b.prototype=Object.create(a&&a.prototype);return b.prototype.constructor=
b}(Error),y=function(a,b){this.property=a;this.value=b;this.expression=ca(void 0===b?a.specification.default:b,a.specification)};y.prototype.isDataDriven=function(){return"source"===this.expression.kind||"composite"===this.expression.kind};y.prototype.possiblyEvaluate=function(a){return this.property.possiblyEvaluate(this,a)};p.PropertyValue=y;var I=function(a,b,c,d,e){this.property=a;this.value=b;this.begin=e+d.delay||0;this.end=this.begin+d.duration||0;a.specification.transition&&(d.delay||d.duration)&&
(this.prior=c)};I.prototype.possiblyEvaluate=function(a){var b=a.now||0,c=this.value.possiblyEvaluate(a),d=this.prior;if(d){if(b>this.end||this.value.isDataDriven())return this.prior=null,c;if(b<this.begin)return d.possiblyEvaluate(a);b=(b-this.begin)/(this.end-this.begin);return this.property.interpolate(d.possiblyEvaluate(a),c,easeCubicInOut(b))}return c};var B=function(a){this.property=a;this.value=new y(a,void 0)};B.prototype.transitioned=function(a,b){return new I(this.property,this.value,b,
u.extend({},a.transition,this.transition),a.now)};B.prototype.untransitioned=function(){return new I(this.property,this.value,null,{},0)};p.TransitionablePropertyValue=B;p.Properties=function(a){this.properties=a;this.defaultPropertyValues={};this.defaultTransitionablePropertyValues={};this.defaultTransitioningPropertyValues={};this.defaultPossiblyEvaluatedValues={};for(var b in a){var c=a[b],d=this.defaultPropertyValues[b]=new y(c,void 0),c=this.defaultTransitionablePropertyValues[b]=new B(c);this.defaultTransitioningPropertyValues[b]=
c.untransitioned();this.defaultPossiblyEvaluatedValues[b]=d.possiblyEvaluate({})}};var k=function(a,b,c){this.property=a;this.value=b;this.parameters=c};k.prototype.isConstant=function(){return"constant"===this.value.kind};k.prototype.constantOr=function(a){return"constant"===this.value.kind?this.value.value:a};k.prototype.evaluate=function(a,b){return this.property.evaluate(this.value,this.parameters,a,b)};p.PossiblyEvaluatedPropertyValue=k;g=function(a){this.specification=a};g.prototype.possiblyEvaluate=
function(a,b){return"constant"===a.expression.kind||"camera"===a.expression.kind?new k(this,{kind:"constant",value:a.expression.evaluate(b)},b):new k(this,a.expression,b)};g.prototype.interpolate=function(a,b,c){if("constant"!==a.value.kind||"constant"!==b.value.kind)return a;if(void 0===a.value.value||void 0===b.value.value)return new k(this,{kind:"constant",value:void 0},a.parameters);var d=H[this.specification.type];return d?new k(this,{kind:"constant",value:d(a.value.value,b.value.value,c)},a.parameters):
a};g.prototype.evaluate=function(a,b,c,d){return"constant"===a.kind?a.value:a.evaluate(b,c,d)};p.DataDrivenProperty=g;var J=function(a){this.specification=a};J.prototype.possiblyEvaluate=function(a,b){return a.expression.evaluate(b)};J.prototype.interpolate=function(a,b,c){var d=H[this.specification.type];return d?d(a,b,c):a};p.DataConstantProperty=J;p.CrossFadedDataDrivenProperty=function(a){function b(){a.apply(this,arguments)}a&&(b.__proto__=a);b.prototype=Object.create(a&&a.prototype);b.prototype.constructor=
b;b.prototype.possiblyEvaluate=function(a,b){return void 0===a.value?new k(this,{kind:"constant",value:void 0},b):"constant"===a.expression.kind?(a=a.expression.evaluate(b),a=this._calculate(a,a,a,b),new k(this,{kind:"constant",value:a},b)):"camera"===a.expression.kind?(a=this._calculate(a.expression.evaluate({zoom:b.zoom-1}),a.expression.evaluate({zoom:b.zoom}),a.expression.evaluate({zoom:b.zoom+1}),b),new k(this,{kind:"constant",value:a},b)):new k(this,a.expression,b)};b.prototype.evaluate=function(a,
b,e,f){return"source"===a.kind?(a=a.evaluate(b,e,f),this._calculate(a,a,a,b)):"composite"===a.kind?this._calculate(a.evaluate({zoom:Math.floor(b.zoom)-1},e,f),a.evaluate({zoom:Math.floor(b.zoom)},e,f),a.evaluate({zoom:Math.floor(b.zoom)+1},e,f),b):a.value};b.prototype._calculate=function(a,b,e,f){return f.zoom>f.zoomHistory.lastIntegerZoom?{from:a,to:b}:{from:e,to:b}};b.prototype.interpolate=function(a){return a};return b}(g);g=function(a){this.specification=a};g.prototype.possiblyEvaluate=function(a,
b){if(void 0!==a.value)return"constant"===a.expression.kind?(a=a.expression.evaluate(b),this._calculate(a,a,a,b)):this._calculate(a.expression.evaluate(new EvaluationParameters(Math.floor(b.zoom-1),b)),a.expression.evaluate(new EvaluationParameters(Math.floor(b.zoom),b)),a.expression.evaluate(new EvaluationParameters(Math.floor(b.zoom+1),b)),b)};g.prototype._calculate=function(a,b,c,d){return d.zoom>d.zoomHistory.lastIntegerZoom?{from:a,to:b}:{from:c,to:b}};g.prototype.interpolate=function(a){return a};
p.CrossFadedProperty=g;g=function(a){this.specification=a};g.prototype.possiblyEvaluate=function(a,b){return!!a.expression.evaluate(b)};g.prototype.interpolate=function(){return!1};p.ColorRampProperty=g});