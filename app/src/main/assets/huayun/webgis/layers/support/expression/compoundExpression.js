//>>built
define("com/huayun/webgis/layers/support/expression/compoundExpression",["exports","./types","./expressions","../style/styleUtils","../style/parsingContext","../../../utils/Color","../../../gl/dataTransfer"],function(_1,_2,_3,_4,_5,_6,_7){function _8(e){if(e instanceof _9){if(e.name==="feature-state"){return false;}}var _a=true;e.eachChild(function(_b){if(_a&&!_8(_b)){_a=false;}});return _a;};_1.isStateConstant=_8;function _c(_d){if(Array.isArray(_d)){return "("+(_d.map(_4.toString).join(", "))+")";}else{return "("+(_4.toString(_d.type))+"...)";}};var _9=function _9(_e,_f,_10,_11){this.name=_e;this.type=_f;this._evaluate=_10;this.args=_11;};_9.prototype.evaluate=function(ctx){return this._evaluate(ctx,this.args);};_9.prototype.eachChild=function(fn){this.args.forEach(fn);};_9.prototype.possibleOutputs=function(){return [undefined];};_9.prototype.serialize=function(){return [this.name].concat(this.args.map(function(arg){return arg.serialize();}));};_9.parse=function(_12,_13){var _14;var op=_12[0];var _15=_9.definitions[op];if(!_15){return _13.error(("Unknown expression \""+op+"\". If you wanted a literal array, use [\"literal\", [...]]."),0);}var _16=Array.isArray(_15)?_15[0]:_15.type;var _17=Array.isArray(_15)?[[_15[1],_15[2]]]:_15.overloads;var _18=_17.filter(function(ref){var _19=ref[0];return !Array.isArray(_19)||_19.length===_12.length-1;});var _1a=null;for(var i$3=0,_1b=_18;i$3<_1b.length;i$3+=1){var ref=_1b[i$3];var _1c=ref[0];var _1d=ref[1];_1a=new _5.ParsingContext(_13.registry,_13.path,null,_13.scope);var _1e=[];var _1f=false;for(var i=1;i<_12.length;i++){var arg=_12[i];var _20=Array.isArray(_1c)?_1c[i-1]:_1c.type;var _21=_1a.parse(arg,1+_1e.length,_20);if(!_21){_1f=true;break;}_1e.push(_21);}if(_1f){continue;}if(Array.isArray(_1c)){if(_1c.length!==_1e.length){_1a.error(("Expected "+(_1c.length)+" arguments, but found "+(_1e.length)+" instead."));continue;}}for(var i$1=0;i$1<_1e.length;i$1++){var _22=Array.isArray(_1c)?_1c[i$1]:_1c.type;var _23=_1e[i$1];_1a.concat(i$1+1).checkSubtype(_22,_23.type);}if(_1a.errors.length===0){return new _9(op,_16,_1d,_1e);}}if(_18.length===1){(_14=_13.errors).push.apply(_14,_1a.errors);}else{var _24=_18.length?_18:_17;var _25=_24.map(function(ref){var _26=ref[0];return _c(_26);}).join(" | ");var _27=[];for(var i$2=1;i$2<_12.length;i$2++){var _28=_13.parse(_12[i$2],1+_27.length);if(!_28){return null;}_27.push(_4.toString(_28.type));}_13.error(("Expected arguments of type "+_25+", but found ("+(_27.join(", "))+") instead."));}return null;};_9.register=function(_29,_2a){_9.definitions=_2a;for(var _2b in _2a){_29[_2b]=_9;}};function get(key,obj){var v=obj[key];return typeof v==="undefined"?null:v;};function has(key,obj){return key in obj;};function _2c(ctx,ref){var r=ref[0];var g=ref[1];var b=ref[2];var a=ref[3];r=r.evaluate(ctx);g=g.evaluate(ctx);b=b.evaluate(ctx);var _2d=a?a.evaluate(ctx):1;return new _6(r/255*_2d,g/255*_2d,b/255*_2d,_2d);};function _2e(v,a,i,j){while(i<=j){var m=(i+j)>>1;if(a[m]===v){return true;}if(a[m]>v){j=m-1;}else{i=m+1;}}return false;};_9.register(_3.expressions,{"error":[{kind:"error"},[{kind:"string"}],function(ctx,ref){var v=ref[0];throw new Error(v.evaluate(ctx));}],"typeof":[{kind:"string"},[{kind:"value"}],function(ctx,ref){var v=ref[0];return _4.toString(_4.typeOf(v.evaluate(ctx)));}],"to-rgba":[{kind:"array",itemType:{kind:"number"},N:4},[{kind:"color"}],function(ctx,ref){var v=ref[0];return v.evaluate(ctx).toArray();}],"rgb":[{kind:"color"},[{kind:"number"},{kind:"number"},{kind:"number"}],_2c],"rgba":[{kind:"color"},[{kind:"number"},{kind:"number"},{kind:"number"},{kind:"number"}],_2c],"has":{type:{kind:"boolean"},overloads:[[[{kind:"string"}],function(ctx,ref){var key=ref[0];return has(key.evaluate(ctx),ctx.properties());}],[[{kind:"string"},{kind:"object"}],function(ctx,ref){var key=ref[0];var obj=ref[1];return has(key.evaluate(ctx),obj.evaluate(ctx));}]]},"get":{type:{kind:"value"},overloads:[[[{kind:"string"}],function(ctx,ref){var key=ref[0];return get(key.evaluate(ctx),ctx.properties());}],[[{kind:"string"},{kind:"object"}],function(ctx,ref){var key=ref[0];var obj=ref[1];return get(key.evaluate(ctx),obj.evaluate(ctx));}]]},"feature-state":[_2.ValueType,[_2.StringType],function(ctx,ref){var key=ref[0];return get(key.evaluate(ctx),ctx.featureState||{});}],"properties":[_2.ObjectType,[],function(ctx){return ctx.properties();}],"geometry-type":[_2.StringType,[],function(ctx){return ctx.geometryType();}],"id":[_2.ValueType,[],function(ctx){return ctx.id();}],"zoom":[{kind:"number"},[],function(ctx){return ctx.globals.zoom;}],"heatmap-density":[{kind:"number"},[],function(ctx){return ctx.globals.heatmapDensity||0;}],"line-progress":[_2.NumberType,[],function(ctx){return ctx.globals.lineProgress||0;}],"accumulated":[_2.ValueType,[],function(ctx){return ctx.globals.accumulated===undefined?null:ctx.globals.accumulated;}],"+":[{kind:"number"},{type:{kind:"number"}},function(ctx,_2f){var _30=0;for(var i=0,_31=_2f;i<_31.length;i+=1){var arg=_31[i];_30+=arg.evaluate(ctx);}return _30;}],"*":[{kind:"number"},{type:{kind:"number"}},function(ctx,_32){var _33=1;for(var i=0,_34=_32;i<_34.length;i+=1){var arg=_34[i];_33*=arg.evaluate(ctx);}return _33;}],"-":{type:{kind:"number"},overloads:[[[{kind:"number"},{kind:"number"}],function(ctx,ref){var a=ref[0];var b=ref[1];return a.evaluate(ctx)-b.evaluate(ctx);}],[[{kind:"number"}],function(ctx,ref){var a=ref[0];return -a.evaluate(ctx);}]]},"/":[{kind:"number"},[{kind:"number"},{kind:"number"}],function(ctx,ref){var a=ref[0];var b=ref[1];return a.evaluate(ctx)/b.evaluate(ctx);}],"%":[{kind:"number"},[{kind:"number"},{kind:"number"}],function(ctx,ref){var a=ref[0];var b=ref[1];return a.evaluate(ctx)%b.evaluate(ctx);}],"ln2":[_2.NumberType,[],function(){return Math.LN2;}],"pi":[_2.NumberType,[],function(){return Math.PI;}],"e":[_2.NumberType,[],function(){return Math.E;}],"^":[_2.NumberType,[_2.NumberType,_2.NumberType],function(ctx,ref){var b=ref[0];var e=ref[1];return Math.pow(b.evaluate(ctx),e.evaluate(ctx));}],"sqrt":[_2.NumberType,[_2.NumberType],function(ctx,ref){var x=ref[0];return Math.sqrt(x.evaluate(ctx));}],"log10":[_2.NumberType,[_2.NumberType],function(ctx,ref){var n=ref[0];return Math.log(n.evaluate(ctx))/Math.LN10;}],"ln":[_2.NumberType,[_2.NumberType],function(ctx,ref){var n=ref[0];return Math.log(n.evaluate(ctx));}],"log2":[_2.NumberType,[_2.NumberType],function(ctx,ref){var n=ref[0];return Math.log(n.evaluate(ctx))/Math.LN2;}],"sin":[_2.NumberType,[_2.NumberType],function(ctx,ref){var n=ref[0];return Math.sin(n.evaluate(ctx));}],"cos":[_2.NumberType,[_2.NumberType],function(ctx,ref){var n=ref[0];return Math.cos(n.evaluate(ctx));}],"tan":[_2.NumberType,[_2.NumberType],function(ctx,ref){var n=ref[0];return Math.tan(n.evaluate(ctx));}],"asin":[_2.NumberType,[_2.NumberType],function(ctx,ref){var n=ref[0];return Math.asin(n.evaluate(ctx));}],"acos":[_2.NumberType,[_2.NumberType],function(ctx,ref){var n=ref[0];return Math.acos(n.evaluate(ctx));}],"atan":[_2.NumberType,[_2.NumberType],function(ctx,ref){var n=ref[0];return Math.atan(n.evaluate(ctx));}],"min":[_2.NumberType,{type:_2.NumberType},function(ctx,_35){return Math.min.apply(Math,_35.map(function(arg){return arg.evaluate(ctx);}));}],"max":[_2.NumberType,{type:_2.NumberType},function(ctx,_36){return Math.max.apply(Math,_36.map(function(arg){return arg.evaluate(ctx);}));}],"abs":[_2.NumberType,[_2.NumberType],function(ctx,ref){var n=ref[0];return Math.abs(n.evaluate(ctx));}],"round":[_2.NumberType,[_2.NumberType],function(ctx,ref){var n=ref[0];var v=n.evaluate(ctx);return v<0?-Math.round(-v):Math.round(v);}],"floor":[_2.NumberType,[_2.NumberType],function(ctx,ref){var n=ref[0];return Math.floor(n.evaluate(ctx));}],"ceil":[_2.NumberType,[_2.NumberType],function(ctx,ref){var n=ref[0];return Math.ceil(n.evaluate(ctx));}],"filter-==":[{kind:"boolean"},[{kind:"string"},{kind:"value"}],function(ctx,ref){var k=ref[0];var v=ref[1];return ctx.properties()[k.value]===v.value;}],"filter-id-==":[_2.BooleanType,[_2.ValueType],function(ctx,ref){var v=ref[0];return ctx.id()===v.value;}],"filter-type-==":[{kind:"boolean"},[{kind:"string"}],function(ctx,ref){var v=ref[0];return ctx.geometryType()===v.value;}],"filter-<":[{kind:"boolean"},[{kind:"string"},{kind:"value"}],function(ctx,ref){var k=ref[0];var v=ref[1];var a=ctx.properties()[k.value];var b=v.value;return typeof a===typeof b&&a<b;}],"filter-id-<":[_2.BooleanType,[_2.ValueType],function(ctx,ref){var v=ref[0];var a=ctx.id();var b=v.value;return typeof a===typeof b&&a<b;}],"filter->":[_2.BooleanType,[_2.StringType,_2.ValueType],function(ctx,ref){var k=ref[0];var v=ref[1];var a=ctx.properties()[k.value];var b=v.value;return typeof a===typeof b&&a>b;}],"filter-id->":[_2.BooleanType,[_2.ValueType],function(ctx,ref){var v=ref[0];var a=ctx.id();var b=v.value;return typeof a===typeof b&&a>b;}],"filter-<=":[{kind:"boolean"},[{kind:"string"},{kind:"value"}],function(ctx,ref){var k=ref[0];var v=ref[1];var a=ctx.properties()[k.value];var b=v.value;return typeof a===typeof b&&a<=b;}],"filter-id-<=":[_2.BooleanType,[_2.ValueType],function(ctx,ref){var v=ref[0];var a=ctx.id();var b=v.value;return typeof a===typeof b&&a<=b;}],"filter->=":[{kind:"boolean"},[{kind:"string"},{kind:"value"}],function(ctx,ref){var k=ref[0];var v=ref[1];var a=ctx.properties()[k.value];var b=v.value;return typeof a===typeof b&&a>=b;}],"filter-id->=":[_2.BooleanType,[_2.ValueType],function(ctx,ref){var v=ref[0];var a=ctx.id();var b=v.value;return typeof a===typeof b&&a>=b;}],"filter-has":[_2.BooleanType,[_2.ValueType],function(ctx,ref){var k=ref[0];return k.value in ctx.properties();}],"filter-has-id":[_2.BooleanType,[],function(ctx){return ctx.id()!==null;}],"filter-type-in":[_2.BooleanType,[{kind:"array",itemType:_2.StringType,N:undefined}],function(ctx,ref){var v=ref[0];return v.value.indexOf(ctx.geometryType())>=0;}],"filter-id-in":[_2.BooleanType,[{kind:"array",itemType:_2.ValueType,N:undefined}],function(ctx,ref){var v=ref[0];return v.value.indexOf(ctx.id())>=0;}],"filter-in-small":[{kind:"boolean"},[{kind:"string"},{kind:"array",itemType:{kind:"value"},N:undefined}],function(ctx,ref){var k=ref[0];var v=ref[1];return v.value.indexOf(ctx.properties()[k.value])>=0;}],"filter-in-large":[_2.BooleanType,[_2.StringType,{kind:"array",itemType:_2.ValueType,N:undefined}],function(ctx,ref){var k=ref[0];var v=ref[1];return _2e(ctx.properties()[k.value],v.value,0,v.value.length-1);}],"all":{type:{kind:"boolean"},overloads:[[[{kind:"boolean"},{kind:"boolean"}],function(ctx,ref){var a=ref[0];var b=ref[1];return a.evaluate(ctx)&&b.evaluate(ctx);}],[{type:{kind:"boolean"}},function(ctx,_37){for(var i=0,_38=_37;i<_38.length;i+=1){var arg=_38[i];if(!arg.evaluate(ctx)){return false;}}return true;}]]},"any":{type:{kind:"boolean"},overloads:[[[{kind:"boolean"},{kind:"boolean"}],function(ctx,ref){var a=ref[0];var b=ref[1];return a.evaluate(ctx)||b.evaluate(ctx);}],[{type:{kind:"boolean"}},function(ctx,_39){for(var i=0,_3a=_39;i<_3a.length;i+=1){var arg=_3a[i];if(arg.evaluate(ctx)){return true;}}return false;}]]},"!":[{kind:"boolean"},[{kind:"boolean"}],function(ctx,ref){var b=ref[0];return !b.evaluate(ctx);}],"is-supported-script":[_2.BooleanType,[_2.StringType],function(ctx,ref){var s=ref[0];var _3b=ctx.globals&&ctx.globals.isSupportedScript;if(_3b){return _3b(s.evaluate(ctx));}return true;}],"upcase":[_2.StringType,[_2.StringType],function(ctx,ref){var s=ref[0];return s.evaluate(ctx).toUpperCase();}],"downcase":[_2.StringType,[_2.StringType],function(ctx,ref){var s=ref[0];return s.evaluate(ctx).toLowerCase();}],"concat":[_2.StringType,{type:_2.ValueType},function(ctx,_3c){return _3c.map(function(arg){return _4.toString$1(arg.evaluate(ctx));}).join("");}],"resolved-locale":[_2.StringType,[_2.CollatorType],function(ctx,ref){var _3d=ref[0];return _3d.evaluate(ctx).resolvedLocale();}]});_7.register("CompoundExpression",_9,{omit:["_evaluate"]});_1.CompoundExpression=_9;function _3e(e,_3f){if(e instanceof _9&&_3f.indexOf(e.name)>=0){return false;}var _40=true;e.eachChild(function(arg){if(_40&&!_3e(arg,_3f)){_40=false;}});return _40;};_1.isGlobalPropertyConstant=_3e;function _41(e){if(e instanceof _9){if(e.name==="get"&&e.args.length===1){return false;}else{if(e.name==="feature-state"){return false;}else{if(e.name==="has"&&e.args.length===1){return false;}else{if(e.name==="properties"||e.name==="geometry-type"||e.name==="id"){return false;}else{if(/^filter-/.test(e.name)){return false;}}}}}}var _42=true;e.eachChild(function(arg){if(_42&&!_41(arg)){_42=false;}});return _42;};_1.isFeatureConstant=_41;});