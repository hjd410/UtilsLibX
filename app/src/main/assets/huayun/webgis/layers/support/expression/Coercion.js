//>>built
define("com/huayun/webgis/layers/support/expression/Coercion",["../style/styleUtils","../../../utils/Color","../../../utils/utils","./Formatted","./FormatExpression"],function(_1,_2,_3,_4,_5){var _6={"to-boolean":{kind:"boolean"},"to-color":{kind:"color"},"to-number":{kind:"number"},"to-string":{kind:"string"}};var _7=function _7(_8,_9){this.type=_8;this.args=_9;};_7.parse=function(_a,_b){if(_a.length<2){return _b.error("Expected at least one argument.");}var _c=_a[0];if((_c==="to-boolean"||_c==="to-string")&&_a.length!==2){return _b.error("Expected one argument.");}var _d=_6[_c];var _e=[];for(var i=1;i<_a.length;i++){var _f=_b.parse(_a[i],i,{kind:"value"});if(!_f){return null;}_e.push(_f);}return new _7(_d,_e);};_7.prototype.evaluate=function(ctx){if(this.type.kind==="boolean"){return Boolean(this.args[0].evaluate(ctx));}else{if(this.type.kind==="color"){var _10;var _11;for(var i=0,_12=this.args;i<_12.length;i+=1){var arg=_12[i];_10=arg.evaluate(ctx);_11=null;if(_10 instanceof _2){return _10;}else{if(typeof _10==="string"){var c=ctx.parseColor(_10);if(c){return c;}}else{if(Array.isArray(_10)){if(_10.length<3||_10.length>4){_11="Invalid rbga value "+(JSON.stringify(_10))+": expected an array containing either three or four numeric values.";}else{_11=_3.validateRGBA(_10[0],_10[1],_10[2],_10[3]);}if(!_11){return new _2((_10[0])/255,(_10[1])/255,(_10[2])/255,(_10[3]));}}}}}throw new Error(_11||("Could not parse color from value '"+(typeof _10==="string"?_10:String(JSON.stringify(_10)))+"'"));}else{if(this.type.kind==="number"){var _13=null;for(var i$1=0,_14=this.args;i$1<_14.length;i$1+=1){var _15=_14[i$1];_13=_15.evaluate(ctx);if(_13===null){return 0;}var num=Number(_13);if(isNaN(num)){continue;}return num;}throw new Error(("Could not convert "+(JSON.stringify(_13))+" to number."));}else{if(this.type.kind==="formatted"){return _4.fromString(_1.toString$1(this.args[0].evaluate(ctx)));}else{return _1.toString$1(this.args[0].evaluate(ctx));}}}}};_7.prototype.eachChild=function(fn){this.args.forEach(fn);};_7.prototype.possibleOutputs=function(){var ref;return (ref=[]).concat.apply(ref,this.args.map(function(arg){return arg.possibleOutputs();}));};_7.prototype.serialize=function(){if(this.type.kind==="formatted"){return new _5([{text:this.args[0],scale:null,font:null}]).serialize();}var _16=[("to-"+(this.type.kind))];this.eachChild(function(_17){_16.push(_17.serialize());});return _16;};return _7;});