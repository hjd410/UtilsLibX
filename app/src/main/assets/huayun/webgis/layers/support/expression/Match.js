//>>built
define("com/huayun/webgis/layers/support/expression/Match",["../style/styleUtils"],function(_1){var _2=function _2(_3,_4,_5,_6,_7,_8){this.inputType=_3;this.type=_4;this.input=_5;this.cases=_6;this.outputs=_7;this.otherwise=_8;};_2.parse=function(_9,_a){if(_9.length<5){return _a.error(("Expected at least 4 arguments, but found only "+(_9.length-1)+"."));}if(_9.length%2!==1){return _a.error("Expected an even number of arguments.");}var _b;var _c;if(_a.expectedType&&_a.expectedType.kind!=="value"){_c=_a.expectedType;}var _d={};var _e=[];for(var i=2;i<_9.length-1;i+=2){var _f=_9[i];var _10=_9[i+1];if(!Array.isArray(_f)){_f=[_f];}var _11=_a.concat(i);if(_f.length===0){return _11.error("Expected at least one branch label.");}for(var i$1=0,_12=_f;i$1<_12.length;i$1+=1){var _13=_12[i$1];if(typeof _13!=="number"&&typeof _13!=="string"){return _11.error("Branch labels must be numbers or strings.");}else{if(typeof _13==="number"&&Math.abs(_13)>Number.MAX_SAFE_INTEGER){return _11.error(("Branch labels must be integers no larger than "+(Number.MAX_SAFE_INTEGER)+"."));}else{if(typeof _13==="number"&&Math.floor(_13)!==_13){return _11.error("Numeric branch labels must be integer values.");}else{if(!_b){_b=_1.typeOf(_13);}else{if(_11.checkSubtype(_b,_1.typeOf(_13))){return null;}}}}}if(typeof _d[String(_13)]!=="undefined"){return _11.error("Branch labels must be unique.");}_d[String(_13)]=_e.length;}var _14=_a.parse(_10,i,_c);if(!_14){return null;}_c=_c||_14.type;_e.push(_14);}var _15=_a.parse(_9[1],1,{kind:"value"});if(!_15){return null;}var _16=_a.parse(_9[_9.length-1],_9.length-1,_c);if(!_16){return null;}if(_15.type.kind!=="value"&&_a.concat(1).checkSubtype((_b),_15.type)){return null;}return new _2(_b,_c,_15,_d,_e,_16);};_2.prototype.evaluate=function(ctx){var _17=this.input.evaluate(ctx);var _18=(_1.typeOf(_17)===this.inputType&&this.outputs[this.cases[_17]])||this.otherwise;return _18.evaluate(ctx);};_2.prototype.eachChild=function(fn){fn(this.input);this.outputs.forEach(fn);fn(this.otherwise);};_2.prototype.possibleOutputs=function(){var ref;return (ref=[]).concat.apply(ref,this.outputs.map(function(out){return out.possibleOutputs();})).concat(this.otherwise.possibleOutputs());};_2.prototype.serialize=function(){var _19=this;var _1a=["match",this.input.serialize()];var _1b=Object.keys(this.cases).sort();var _1c=[];var _1d;var _1e={};for(var i=0,_1f=_1b;i<_1f.length;i+=1){var _20=_1f[i];_1d=_1e[this.cases[_20]];if(_1d===undefined){_1e[this.cases[_20]]=_1c.length;_1c.push([this.cases[_20],[_20]]);}else{_1c[_1d][1].push(_20);}}var _21=function(_22){return _19.inputType.kind==="number"?Number(_22):_22;};for(var i$1=0,_23=_1c;i$1<_23.length;i$1+=1){var ref=_23[i$1];_1d=ref[0];var _24=ref[1];if(_24.length===1){_1a.push(_21(_24[0]));}else{_1a.push(_24.map(_21));}_1a.push(this.outputs[outputIndex$1].serialize());}_1a.push(this.otherwise.serialize());return _1a;};return _2;});