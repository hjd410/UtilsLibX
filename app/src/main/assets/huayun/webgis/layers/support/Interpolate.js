//>>built
define("com/huayun/webgis/layers/support/Interpolate",["./UnitBezier","../../utils/utils","../../utils/Color"],function(_1,_2,_3){function _4(a,b,t){return (a*(1-t))+(b*t);};function _5(_6,to,t){return new _3(_4(_6.r,to.r,t),_4(_6.g,to.g,t),_4(_6.b,to.b,t),_4(_6.a,to.a,t));};function _7(_8,to,t){return _8.map(function(d,i){return _4(d,to[i],t);});};var _9=Object.freeze({number:_4,color:_5,array:_7});function _a(_b,_c,_d,_e){var _f=_e-_d;var _10=_b-_d;if(_f===0){return 0;}else{if(_c===1){return _10/_f;}else{return (Math.pow(_c,_10)-1)/(Math.pow(_c,_f)-1);}}};var _11=function _11(_12,_13,_14,_15,_16){this.type=_12;this.operator=_13;this.interpolation=_14;this.input=_15;this.labels=[];this.outputs=[];for(var i=0,_17=_16;i<_17.length;i+=1){var ref=_17[i];var _18=ref[0];var _19=ref[1];this.labels.push(_18);this.outputs.push(_19);}};_11.interpolationFactor=function interpolationFactor(_1a,_1b,_1c,_1d){var t=0;if(_1a.name==="exponential"){t=_a(_1b,_1a.base,_1c,_1d);}else{if(_1a.name==="linear"){t=_a(_1b,1,_1c,_1d);}else{if(_1a.name==="cubic-bezier"){var c=_1a.controlPoints;var ub=new _1(c[0],c[1],c[2],c[3]);t=ub.solve(_a(_1b,1,_1c,_1d));}}}return t;};_11.parse=function parse(_1e,_1f){var _20=_1e[0];var _21=_1e[1];var _22=_1e[2];var _23=_1e.slice(3);if(!Array.isArray(_21)||_21.length===0){return _1f.error("Expected an interpolation type expression.",1);}if(_21[0]==="linear"){_21={name:"linear"};}else{if(_21[0]==="exponential"){var _24=_21[1];if(typeof _24!=="number"){return _1f.error("Exponential interpolation requires a numeric base.",1,1);}_21={name:"exponential",base:_24};}else{if(_21[0]==="cubic-bezier"){var _25=_21.slice(1);if(_25.length!==4||_25.some(function(t){return typeof t!=="number"||t<0||t>1;})){return _1f.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);}_21={name:"cubic-bezier",controlPoints:(_25)};}else{return _1f.error(("Unknown interpolation type "+(String(_21[0]))),1,0);}}}if(_1e.length-1<4){return _1f.error(("Expected at least 4 arguments, but found only "+(_1e.length-1)+"."));}if((_1e.length-1)%2!==0){return _1f.error("Expected an even number of arguments.");}_22=_1f.parse(_22,2,{kind:"number"});if(!_22){return null;}var _26=[];var _27=(null);if(_20==="interpolate-hcl"||_20==="interpolate-lab"){_27=ColorType;}else{if(_1f.expectedType&&_1f.expectedType.kind!=="value"){_27=_1f.expectedType;}}for(var i=0;i<_23.length;i+=2){var _28=_23[i];var _29=_23[i+1];var _2a=i+3;var _2b=i+4;if(typeof _28!=="number"){return _1f.error("Input/output pairs for \"interpolate\" expressions must be defined using literal numeric values (not computed expressions) for the input values.",_2a);}if(_26.length&&_26[_26.length-1][0]>=_28){return _1f.error("Input/output pairs for \"interpolate\" expressions must be arranged with input values in strictly ascending order.",_2a);}var _2c=_1f.parse(_29,_2b,_27);if(!_2c){return null;}_27=_27||_2c.type;_26.push([_28,_2c]);}if(_27.kind!=="number"&&_27.kind!=="color"&&!(_27.kind==="array"&&_27.itemType.kind==="number"&&typeof _27.N==="number")){return _1f.error(("Type "+(toString(_27))+" is not interpolatable."));}return new _11(_27,(_20),_21,_22,_26);};_11.prototype.evaluate=function evaluate(ctx){var _2d=this.labels;var _2e=this.outputs;if(_2d.length===1){return _2e[0].evaluate(ctx);}var _2f=((this.input.evaluate(ctx)));if(_2f<=_2d[0]){return _2e[0].evaluate(ctx);}var _30=_2d.length;if(_2f>=_2d[_30-1]){return _2e[_30-1].evaluate(ctx);}var _31=_2.findStopLessThanOrEqualTo(_2d,_2f);var _32=_2d[_31];var _33=_2d[_31+1];var t=_11.interpolationFactor(this.interpolation,_2f,_32,_33);var _34=_2e[_31].evaluate(ctx);var _35=_2e[_31+1].evaluate(ctx);if(this.operator==="interpolate"){return (_9[this.type.kind.toLowerCase()])(_34,_35,t);}else{if(this.operator==="interpolate-hcl"){return hcl.reverse(hcl.interpolate(hcl.forward(_34),hcl.forward(_35),t));}else{return lab.reverse(lab.interpolate(lab.forward(_34),lab.forward(_35),t));}}};_11.prototype.eachChild=function eachChild(fn){fn(this.input);for(var i=0,_36=this.outputs;i<_36.length;i+=1){var _37=_36[i];fn(_37);}};_11.prototype.possibleOutputs=function possibleOutputs(){var ref;return (ref=[]).concat.apply(ref,this.outputs.map(function(_38){return _38.possibleOutputs();}));};_11.prototype.serialize=function serialize(){var _39;if(this.interpolation.name==="linear"){_39=["linear"];}else{if(this.interpolation.name==="exponential"){if(this.interpolation.base===1){_39=["linear"];}else{_39=["exponential",this.interpolation.base];}}else{_39=["cubic-bezier"].concat(this.interpolation.controlPoints);}}var _3a=[this.operator,_39,this.input.serialize()];for(var i=0;i<this.labels.length;i++){_3a.push(this.labels[i],this.outputs[i].serialize());}return _3a;};return _11;});