//>>built
define("com/huayun/webgis/layers/support/readTile",["com/huayun/webgis/geometry/Point2D"],function(_1){function _2(_3,_4,_5){if(_3==1){_4.id=_5.readVarint();}else{if(_3==2){_6(_5,_4);}else{if(_3==3){_4.type=_5.readVarint();}else{if(_3==4){_4._geometry=_5.pos;}}}}};function _6(_7,_8){var _9=_7.readVarint()+_7.pos;while(_7.pos<_9){var _a=_8._keys[_7.readVarint()],_b=_8._values[_7.readVarint()];_8.properties[_a]=_b;}};function _c(_d,_e,_f,_10,_11){this.properties={};this.extent=_f;this.type=0;this._pbf=_d;this._geometry=-1;this._keys=_10;this._values=_11;_d.readFields(_2,this,_e);};_c.types=["Unknown","Point","LineString","Polygon"];_c.prototype.loadGeometry=function(){var pbf=this._pbf;pbf.pos=this._geometry;var end=pbf.readVarint()+pbf.pos,cmd=1,_12=0,x=0,y=0,_13=[],_14;while(pbf.pos<end){if(_12<=0){var _15=pbf.readVarint();cmd=_15&7;_12=_15>>3;}_12--;if(cmd===1||cmd===2){x+=pbf.readSVarint();y+=pbf.readSVarint();if(cmd===1){if(_14){_13.push(_14);}_14=[];}_14.push(new _1(x,y));}else{if(cmd===7){if(_14){_14.push(_14[0].clone());}}else{throw new Error("unknown command "+cmd);}}}if(_14){_13.push(_14);}return _13;};_c.prototype.bbox=function(){var pbf=this._pbf;pbf.pos=this._geometry;var end=pbf.readVarint()+pbf.pos,cmd=1,_16=0,x=0,y=0,x1=Infinity,x2=-Infinity,y1=Infinity,y2=-Infinity;while(pbf.pos<end){if(_16<=0){var _17=pbf.readVarint();cmd=_17&7;_16=_17>>3;}_16--;if(cmd===1||cmd===2){x+=pbf.readSVarint();y+=pbf.readSVarint();if(x<x1){x1=x;}if(x>x2){x2=x;}if(y<y1){y1=y;}if(y>y2){y2=y;}}else{if(cmd!==7){throw new Error("unknown command "+cmd);}}}return [x1,y1,x2,y2];};_c.prototype.toGeoJSON=function(x,y,z){var _18=this.extent*Math.pow(2,z),x0=this.extent*x,y0=this.extent*y,_19=this.loadGeometry(),_1a=_c.types[this.type],i,j;function _1b(_1c){for(var j=0;j<_1c.length;j++){var p=_1c[j],y2=180-(p.y+y0)*360/_18;_1c[j]=[(p.x+x0)*360/_18-180,360/Math.PI*Math.atan(Math.exp(y2*Math.PI/180))-90];}};switch(this.type){case 1:var _1d=[];for(i=0;i<_19.length;i++){_1d[i]=_19[i][0];}_19=_1d;_1b(_19);break;case 2:for(i=0;i<_19.length;i++){_1b(_19[i]);}break;case 3:_19=classifyRings$1(_19);for(i=0;i<_19.length;i++){for(j=0;j<_19[i].length;j++){_1b(_19[i][j]);}}break;}if(_19.length===1){_19=_19[0];}else{_1a="Multi"+_1a;}var _1e={type:"Feature",geometry:{type:_1a,coordinates:_19},properties:this.properties};if("id" in this){_1e.id=this.id;}return _1e;};function _1f(pbf,end){this.version=1;this.name=null;this.extent=4096;this.length=0;this._pbf=pbf;this._keys=[];this._values=[];this._features=[];pbf.readFields(_20,this,end);this.length=this._features.length;};function _20(tag,_21,pbf){if(tag===15){_21.version=pbf.readVarint();}else{if(tag===1){_21.name=pbf.readString();}else{if(tag===5){_21.extent=pbf.readVarint();}else{if(tag===2){_21._features.push(pbf.pos);}else{if(tag===3){_21._keys.push(pbf.readString());}else{if(tag===4){_21._values.push(_22(pbf));}}}}}}};function _22(pbf){var _23=null,end=pbf.readVarint()+pbf.pos;while(pbf.pos<end){var tag=pbf.readVarint()>>3;_23=tag===1?pbf.readString():tag===2?pbf.readFloat():tag===3?pbf.readDouble():tag===4?pbf.readVarint64():tag===5?pbf.readVarint():tag===6?pbf.readSVarint():tag===7?pbf.readBoolean():null;}return _23;};_1f.prototype.feature=function(i){if(i<0||i>=this._features.length){throw new Error("feature index out of bounds");}this._pbf.pos=this._features[i];var end=this._pbf.readVarint()+this._pbf.pos;return new _c(this._pbf,end,this.extent,this._keys,this._values);};function _24(tag,_25,pbf){if(tag===3){var _26=new _1f(pbf,pbf.readVarint()+pbf.pos);if(_26.length){_25[_26.name]=_26;}}};return _24;});