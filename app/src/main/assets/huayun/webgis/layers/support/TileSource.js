//>>built
define("com/huayun/webgis/layers/support/TileSource","exports dojo/request ../../request ../../utils/utils ../../gl/Texture ../../utils/Resource".split(" "),function(h,n,k,g,l,p){function b(a,d,b,c,m){this.id=a;this.dispatcher=b;this.type="vector";this.minzoom=0;this.maxzoom=16;this.scheme="xyz";this.isTileClipped=this.reparseOverscaled=!0;this.tileSize=256;g.extend(this,g.pick(d,["scheme","tileSize"]));this._options=g.extend({type:"vector"},d);this._collectResourceTiming=d.collectResourceTiming;
this.url=c;this.layer=m}function c(a,d,b,c){this.id=a;this.type="terrain";this.minzoom=0;this.maxzoom=22;this.roundZoom=!0;this.scheme="xyz";this.tileSize=d.tileSize||256;this.url=b;this.view=c}b.prototype.constructor=b;b.prototype.load=function(){};b.prototype.hasTile=function(a){return!0};b.prototype.onAdd=function(a){this.map=a;this.load()};b.prototype.setSize=function(a){this.tileSize=a};b.prototype.onRemove=function(){};b.prototype.serialize=function(){return g.extend({},this._options)};b.prototype.updateTileUrl=
function(a){this.url=[a]};b.prototype.loadTile=function(a,b){function c(c,d){if(a.aborted)return b(null);if(c&&404!==c.status)return b(c);d&&a.setExpiryData(d);a.loadVectorData(d,this.layer);b(null);a.reloadCallback&&(this.loadTile(a,a.reloadCallback),a.reloadCallback=null)}var d={request:{url:a.tileID.canonical.url(this.url,this.scheme)},uid:a.uid,tileID:a.tileID,zoom:a.tileID.overscaledZ,tileSize:this.tileSize,type:this.type,source:this.id,pixelRatio:1,showCollisionBoxes:!1};void 0===a.workerID||
"expired"===a.state?a.workerID=this.dispatcher.send("loadTile",d,c.bind(this)):"loading"===a.state?a.reloadCallback=b:this.dispatcher.send("reloadTile",d,c.bind(this),a.workerID)};b.prototype.abortTile=function(a){this.dispatcher.send("abortTile",{uid:a.uid,type:this.type,source:this.id},void 0,a.workerID)};b.prototype.unloadTile=function(a){a.unloadVectorData();this.dispatcher.send("removeTile",{uid:a.uid,type:this.type,source:this.id},void 0,a.workerID)};b.prototype.hasTransition=function(){return!1};
h.VectorTileSource=b;c.prototype.constructor=c;c.prototype.load=function(){};c.prototype.hasTile=function(a){};c.prototype.updateTileUrl=function(a){this.url=a};c.prototype.loadTile=function(a,b){var c=this,d=a.tileID.canonical.url([this.url]);a.request=k(d,{responseType:"image"}).then(function(a){return a.data}).then(function(d){delete a.request;if(a.aborted)a.state="unloaded",b(null);else if(d){var f=c.view.context,e=f.gl;a.texture=c.view.getTileTexture(d.width);a.texture?a.texture.update(d,{useMipmap:!0}):
(a.texture=new l(f,d,e.RGBA,{useMipmap:!0}),a.texture.bind(e.LINEAR,e.CLAMP_TO_EDGE,e.LINEAR_MIPMAP_NEAREST),f.extTextureFilterAnisotropic&&e.texParameterf(e.TEXTURE_2D,f.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,f.extTextureFilterAnisotropicMax));a.state="loaded";b(null)}}).catch(function(c){a.state="errored";b(c)})};c.prototype.abortTile=function(a,b){a.request&&(a.request.cancel(),delete a.request);b()};c.prototype.unloadTile=function(a,b){a.texture&&this.view.saveTileTexture(a.texture);
b()};c.prototype.hasTransition=function(){return!1};h.TerrainSourceCache=c});