//>>built
define("com/huayun/webgis/layers/support/terrainUtils",["exports","../../geometry/Point","./AttributeCompression","./HyQuantizedMeshTerrainData","../../data/ArrayType","../../gl/SegmentVector",],function(_1,_2,_3,_4,_5,_6){var _7=64*1024;var _8=77067.33977995862;var _9=1;function _a(_b,_c,_d,_e){if(_b>=_7){return new Uint32Array(_c,_d,_e);}return new Uint16Array(_c,_d,_e);};function _f(_10,_11,x,y){var pos=0;var _12=3;var _13=_12+1;var _14=Float64Array.BYTES_PER_ELEMENT*_12;var _15=Float64Array.BYTES_PER_ELEMENT*_13;var _16=3;var _17=Uint16Array.BYTES_PER_ELEMENT*_16;var _18=3;var _19=Uint16Array.BYTES_PER_ELEMENT;var _1a=_19*_18;var _1b=new DataView(_10);var _1c=new _2(_1b.getFloat64(pos,true),_1b.getFloat64(pos+8,true),_1b.getFloat64(pos+16,true));pos+=_14;var _1d=_1b.getFloat32(pos,true);pos+=Float32Array.BYTES_PER_ELEMENT;var _1e=_1b.getFloat32(pos,true);pos+=Float32Array.BYTES_PER_ELEMENT;var _1f={center:new _2(_1b.getFloat64(pos,true),_1b.getFloat64(pos+8,true),_1b.getFloat64(pos+16,true)),radius:_1b.getFloat64(pos+_14,true)};pos+=_15;var _20=new _2(_1b.getFloat64(pos,true),_1b.getFloat64(pos+8,true),_1b.getFloat64(pos+16,true));pos+=_14;var _21=_1b.getUint32(pos,true);pos+=Uint32Array.BYTES_PER_ELEMENT;var _22=new Uint16Array(_10,pos,_21*3);pos+=_21*_17;if(_21>64*1024){_19=Uint32Array.BYTES_PER_ELEMENT;_1a=_19*_18;}var _23=_22.subarray(0,_21);var _24=_22.subarray(_21,2*_21);var _25=_22.subarray(_21*2,3*_21);_3.zigZagDeltaDecode(_23,_24,_25);if(pos%_19!==0){pos+=(_19-(pos%_19));}var _26=_1b.getUint32(pos,true);pos+=Uint32Array.BYTES_PER_ELEMENT;var _27=_a(_21,_10,pos,_26*_18);pos+=_26*_1a;var _28=0;var _29=_27.length;for(var i=0;i<_29;++i){var _2a=_27[i];_27[i]=_28-_2a;if(_2a===0){++_28;}}var _2b=_1b.getUint32(pos,true);pos+=Uint32Array.BYTES_PER_ELEMENT;var _2c=_a(_21,_10,pos,_2b);pos+=_2b*_19;var _2d=_1b.getUint32(pos,true);pos+=Uint32Array.BYTES_PER_ELEMENT;var _2e=_a(_21,_10,pos,_2d);pos+=_2d*_19;var _2f=_1b.getUint32(pos,true);pos+=Uint32Array.BYTES_PER_ELEMENT;var _30=_a(_21,_10,pos,_2f);pos+=_2f*_19;var _31=_1b.getUint32(pos,true);pos+=Uint32Array.BYTES_PER_ELEMENT;var _32=_a(_21,_10,pos,_31);pos+=_31*_19;var _33;var _34;while(pos<_1b.byteLength){var _35=_1b.getUint8(pos,true);pos+=Uint8Array.BYTES_PER_ELEMENT;var _36=_1b.getUint32(pos,_9);pos+=Uint32Array.BYTES_PER_ELEMENT;pos+=_36;}var _37=0;return new _4({center:_1c,minimumHeight:_1d,maximumHeight:_1e,boundingSphere:_1f,orientedBoundingBox:null,horizonOcclusionPoint:_20,quantizedVertices:_22,encodedNormals:_33,indices:_27,westIndices:_2c,southIndices:_2e,eastIndices:_30,northIndices:_32,westSkirtHeight:_37,southSkirtHeight:_37,eastSkirtHeight:_37,northSkirtHeight:_37,waterMask:_34,});};_1.createQuantizedMeshTerrainData=_f;_1.createHyTerrainData=function(_38,_39,_3a){var _3b=new DataView(_38);var pos=0;var _3c=_3b.getFloat64(pos,true);pos+=8;var _3d=_3b.getFloat64(pos,true);pos+=8;var _3e=_3b.getFloat64(pos,true);pos+=8;var _3f=_3b.getFloat64(pos,true);pos+=8;var _40=_3b.getUint8(pos,true);pos+=1;var _41=_3b.getUint8(pos,true);pos+=1;var sx=_39.west,sy=_39.north;var ex=_39.east,ey=_39.south;var _42=new _5.StructArrayLayout3f12();var _43=new _5.StructArrayLayout3ui6();var _44=new _6();var _45=_41*_40;var _46=_44.prepareSegment(_45,_42,_43);var _47=_3e;var _48=_3f;var _49=Infinity,_4a=-Infinity;for(var n=0;n<_40;n++){for(var m=0;m<_41;m++){var _4b=_3b.getInt16(pos,true);pos+=2;if(_4b>_4a){_4a=_4b;}if(_4b<_49){_49=_4b;}var _4c=_3c+m*_47;var _4d=_3d-n*_48;var _4e=(_4c-sx)/_3a/256;var _4f=(sy-_4d)/_3a/256;_42.emplaceBack(_4e,_4f,_4b);}}for(n=0;n<_40-1;n++){for(m=0;m<_41-1;m++){var one=n*_41+m;var two=(n+1)*_41+m;var _50=(n+1)*_41+m+1;var _51=n*_41+m+1;_43.emplaceBack(one,two,_50);_43.emplaceBack(_51,one,_50);}}_46.vertexLength+=_45;_46.primitiveLength+=_43.length;return {vertices:_42,indices:_43,segments:_44,maxH:_4a,minH:_49};};});