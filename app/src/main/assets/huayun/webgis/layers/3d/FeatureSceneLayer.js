//>>built
define("com/huayun/webgis/layers/3d/FeatureSceneLayer",["dojo/_base/declare","dojo/request","./GraphicSceneLayer","../../Feature","../../Graphic","../../geometry/MapPoint"],function(_1,_2,_3,_4,_5,_6){return _1("com.huayun.webgis.layers.3d.FeatureSceneLayer",[_3],{featureSet:null,name:"Feature图层",id:"Feature",layerLv:13,_symbols:[],switchLayer:17,constructor:function(_7){_1.safeMixin(this,_7);this.group=new THREE.Group();this._symbol=this._symbols[0];},readyData:function(){var _8=this.map.level;if(_8>this.layerLv){if(this.visible){if(!this.group.visible){this.group.visible=true;}this.fetchData();}else{if(this.group.visible){this.group.visible=false;}}}else{this.group.visible=false;}},startRender:function(){if(this.group.visible){var _9=this.map.level;if(_9>this.switchLayer){this._symbol=this._symbols[1];}else{this._symbol=this._symbols[0];var _a=Math.pow(2,this.map.initLevel-this.map.level);this._symbol.meshs.forEach(function(_b){_b.scale.set(_a,_a,1);});this._symbol.scale=_a;}this.render();}},render:function(){var _c=this;if(this.loadPromise){this.loadPromise.then(function(_d){_c.clear();var _e=_d.data,p,px,py,_f,_10;for(var i=0;i<_e.length;i++){p=_e[i].geom;_f=p.indexOf(" ");px=p.substring(6,_f);py=p.substring(_f+1,p.length-1);_10=_c.map.geometryTo3DXY(px,py);var _11=new _4({id:_e[i]["dev_id"],attributes:{"num":_e[i]["photo_num"]},_geometry:new _6(_10.x,_10.y,0.05)});var _12=new _5({feature:_11,symbol:_c._symbol,graphicLayer:_c});_c.addGraphic(_12);}_c.map.layerContainer.threeRender();});}},fetchData:function(){var _13=this.map.extent;if(_13){var _14=this.map.level;var url=this.url+"?bbox="+_13.minx+","+_13.miny+","+_13.maxx+","+_13.maxy+"&level="+_14+"&photo_num_min=1";this.loadPromise=_2(url,{handleAs:"json"});}else{this.loadPromise=null;}}});});