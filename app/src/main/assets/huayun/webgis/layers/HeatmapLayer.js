//>>built
define("com/huayun/webgis/layers/HeatmapLayer",["dojo/_base/declare","dojo/request","./Layer","custom/kdbush.min","com/huayun/webgis/views/3d/layers/HeatmapLayerView3D"],function(_1,_2,_3,_4,_5){return _1("com.huayun.webgis.layers.HeatmapLayer",[_3],{url:null,name:"热力图",constructor:function(_6){_1.safeMixin(this,_6);this.layerViews=[];this.spatialReference=_6.options.spatialReference;this.data=null;this.max=_6.options.max;this.radius=_6.options.radius;this.blur=_6.options.blur;this.opacity=_6.options.opacity;this.index=null;this.filter=_6.filter;this.dataDirty=true;if(_6.options.gradient){var _7=_6.options.gradient;this.gradient={};for(var i=0;i<_7.length;i=i+2){this.gradient[_7[i]]=_7[i+1];}}},createLayerView:function(_8,_9){var _a=new _5({width:_8.width,height:_8.height,opacity:this.opacity,visible:this.visible,radius:this.radius,blur:this.blur,view:_8,id:this.id,layer:this,gradient:this.gradient});this.layerView=_a;_a.transform=_8.viewpoint;return _a;},setData:function(_b){this.data=_b;this.dataDirty=true;this.index=new _4(_b,function(p){return p.point.x;},function(p){return p.point.y;});this.layerView.view.threeRender();},refresh:function(){this.layerView.view.threeRender();},setVisible:function(_c){this.visible=_c;this.layerView.setVisible(_c);},setFilter:function(_d){this.dataDirty=true;this.filter=_d;},setOpacity:function(_e){this.layerView.setVisible(_e);},filterData:function(_f){var res=this.index.range(_f.xmin,_f.ymin,_f.xmax,_f.ymax).map(function(id){return this.data[id];}.bind(this));if(this.filter){res=res.filter(this.filter);}return res;},queryFeaturesByGeometry:function(_10,_11){var _12=this.getBounds(_10);var _13=_11||this.options.queryRadius||this.radius;_13=_13*this.layerView.view.resolution;return this.filterData({xmin:_12.xmin-_13,ymin:_12.ymin-_13,xmax:_12.xmax+_13,ymax:_12.ymax+_13});},getBounds:function(_14){if(_14.type==="point"){return {xmin:_14.x,ymin:_14.y,xmax:_14.x,ymax:_14.y};}else{return _14.extent;}}});});