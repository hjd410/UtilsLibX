//>>built
define("com/huayun/webgis/layers/EditFeatureLayer","dojo/_base/declare dojo/request ./Layer ../views/3d/layers/EditFeatureLayerView3D ./EditGraphicsLayer ../Feature ../Graphic ../Attribute ../../util/JSONFormatterUtil ../../util/WKTGeometryFormater ../../util/SymbolFactory ../renderer/CompositeLineRenderer ../renderer/CompositeMarkerRenderer ../renderer/CompositeFillRenderer".split(" "),function(x,k,e,l,m,n,p,q,y,r,t,u,v,w){return function(){function a(b,a){this.geoType=b.geoType;this.id=b.id;this.name=
b.name;this.viewId=b.dataSource.viewId;this.currentRule=b.currentRule;this.rules=b.rules;this.symbols=[];this.editGraphicsLayer=new m;this.editGraphicsLayer.owner=this;this.graphics=this.editGraphicsLayer.graphics;this.featureData=[];this.wktGeometryFormatter=new r;this.symbolFactory=new t;this.createRenderer();this.loadComplete(b,a);this.state=!1}e&&(a.__proto__=e);a.prototype=Object.create(e&&e.prototype);a.prototype.constructor=a;a.prototype.add=function(b){};a.prototype.edit=function(b){};a.prototype.delete=
function(b){};a.prototype.addGraphic=function(b){this.editGraphicsLayer.addGraphic(b)};a.prototype.removeGraphic=function(b){this.editGraphicsLayer.removeGraphic(b)};a.prototype.createLayerView=function(b){var a=new l({visible:!0,layer:this,graphicsLayerView:this.editGraphicsLayer.createLayerView(b)});this.layerView=a;a.transform=b.viewpoint;return a};a.prototype._createGraphic=function(b,a){return new p({feature:b,symbol:a})};a.prototype._createFeature=function(b){var a=this.wktGeometryFormatter.toGeometry(b.SHAPE);
if(!a)return null;var a=new n({type:a.type,geometry:a}),d=[],f;for(f in b)if("SHAPE"!==f&&b.hasOwnProperty(f)){var c=new q;c.name=f.toLowerCase();c.value=b[f];d[d.length]=c}a.attributes=d;return a};a.prototype.getSymbol=function(b,a,d){return this.symbolFactory.createSymbol(b,a)};a.prototype.loadComplete=function(b,a){k(0<b.dataSource.whereFilter.length?b.query.url+b.dataSource.viewId+"?filter\x3d"+b.query.filter+"\x26"+b.dataSource.whereFilter+"\x26access_token\x3d"+b.query.access_token:b.query.url+
b.dataSource.viewId+"?filter\x3d"+b.query.filter+"\x26access_token\x3d"+b.query.access_token,{handleAs:"json"}).then(function(b){this.featureData=b.data;b=null;this.state=!0;this.ruleSymbols=[];if(this.featureData&&0<this.featureData.length){var a=this.featureData[0],c=a.SHAPE,c=this.wktGeometryFormatter.toGeometry(c),a=this._createFeature(a);if(!a)return;for(var e=this.rules,d=0;d<e.length;d++){var g=e[d];g.geoType=this.geoType;b=this.getSymbol(g,a,c.type);this.ruleSymbols.push({symbol:b,minScale:g.minScale,
maxScale:g.maxScale})}}for(var h in this.featureData)this.featureData.hasOwnProperty(h)&&(a=this.featureData[h],c=a.SHAPE,c=this.wktGeometryFormatter.toGeometry(c),a=this._createFeature(a))&&(c=this._createGraphic(a,b),this.addGraphic(c));this.layerView.graphicsLayerView.view.threeRender()}.bind(this))};a.prototype.zoomEnd=function(a){};a.prototype.createRenderer=function(){switch(this.geoType){case "point":this.editGraphicsLayer.setRenderer(new v);break;case "line":this.editGraphicsLayer.setRenderer(new u);
break;case "polygon":this.editGraphicsLayer.setRenderer(new w)}};return a}()});