//>>built
define("com/huayun/webgis/data/bucket/FillExtrusionBucketSimplify",["../ArrayType","../../gl/SegmentVector","../../utils/earcut","../../gl/programConfig","../../gl/members","../../gl/dataTransfer","com/huayun/webgis/layers/support/EvaluationParameters","../../utils/Constant","../../utils/utils","../../utils/classifyRings"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a){var _b=["Unknown","Point","LineString","Polygon"];var _c=Math.pow(2,13);function _d(_e,x,y,nx,ny,nz,t,e){_e.emplaceBack(x,y,Math.floor(nx*_c)*2+t,ny*_c*2,nz*_c*2,Math.round(e));};var _f=function _f(){this.layoutVertexArray=new _1.StructArrayLayout2i4i12();this.indexArray=new _1.StructArrayLayout3ui6();this.segments=new _2();};_f.prototype.isEmpty=function isEmpty(){return this.layoutVertexArray.length===0;};_f.prototype.upload=function upload(_10){this.layoutVertexBuffer=_10.createVertexBuffer(this.layoutVertexArray,[{name:"a_pos",type:"Int16",components:2,offset:0},{name:"a_normal_ed",type:"Int16",components:4,offset:4}]);this.indexBuffer=_10.createIndexBuffer(this.indexArray);};_f.prototype.destroy=function destroy(){if(!this.layoutVertexBuffer){return;}this.layoutVertexBuffer.destroy();this.indexBuffer.destroy();this.segments.destroy();};_f.prototype.addFeature=function addFeature(_11){for(var i$4=0,_12=_a(_11,_8.layout.EARCUT_MAX_RINGS);i$4<_12.length;i$4+=1){var _13=_12[i$4];var _14=0;for(var i$1=0,_15=_13;i$1<_15.length;i$1+=1){var _16=_15[i$1];_14+=_16.length;}var _17=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(var i$2=0,_18=_13;i$2<_18.length;i$2+=1){var _19=_18[i$2];if(_19.length===0){continue;}var _1a=0;for(var p=0;p<_19.length;p++){var p1=_19[p];if(p>=1){var p2=_19[p-1];if(_17.vertexLength+4>_2.MAX_VERTEX_ARRAY_LENGTH){_17=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);}var _1b=p1.sub(p2)._perp()._unit();var _1c=p2.dist(p1);if(_1a+_1c>32768){_1a=0;}_d(this.layoutVertexArray,p1.x,p1.y,_1b.x,_1b.y,0,0,_1a);_d(this.layoutVertexArray,p1.x,p1.y,_1b.x,_1b.y,0,1,_1a);_1a+=_1c;_d(this.layoutVertexArray,p2.x,p2.y,_1b.x,_1b.y,0,0,_1a);_d(this.layoutVertexArray,p2.x,p2.y,_1b.x,_1b.y,0,1,_1a);var _1d=_17.vertexLength;this.indexArray.emplaceBack(_1d,_1d+2,_1d+1);this.indexArray.emplaceBack(_1d+1,_1d+2,_1d+3);_17.vertexLength+=4;_17.primitiveLength+=2;}}}if(_17.vertexLength+_14>_2.MAX_VERTEX_ARRAY_LENGTH){_17=this.segments.prepareSegment(_14,this.layoutVertexArray,this.indexArray);}var _1e=[];var _1f=[];var _20=_17.vertexLength;for(var i$3=0,_21=_13;i$3<_21.length;i$3+=1){var _22=_21[i$3];if(_22.length===0){continue;}if(_22!==_13[0]){_1f.push(_1e.length/2);}for(var i=0;i<_22.length;i++){var p$1=_22[i];_d(this.layoutVertexArray,p$1.x,p$1.y,0,0,1,1,0);_1e.push(p$1.x);_1e.push(p$1.y);}}var _23=_3.earcut(_1e,_1f);for(var j=0;j<_23.length;j+=3){this.indexArray.emplaceBack(_20+_23[j],_20+_23[j+2],_20+_23[j+1]);}_17.primitiveLength+=_23.length/3;_17.vertexLength+=_14;}};return _f;});