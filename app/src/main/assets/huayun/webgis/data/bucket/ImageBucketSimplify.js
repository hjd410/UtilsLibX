//>>built
define("com/huayun/webgis/data/bucket/ImageBucketSimplify",["../ArrayType","../../gl/SegmentVector","../../geometry/Anchor","../../geometry/Point2D"],function(_1,_2,_3,_4){function _5(_6,_7,_8,ox,oy,tx,ty){_6.emplaceBack(_7,_8,Math.round(ox*32),Math.round(oy*32),tx,ty);};function _9(_a,_b,_c){var dx=_c[0],dy=_c[1];var x1=dx-_a*0.5;var x2=x1+_a;var y1=dy-_b*0.5;var y2=y1+_b;return {top:y1,bottom:y2,left:x1,right:x2};};function _d(_e,_f,_10,_11){var top=_f.top;var _12=_f.left;var _13=_f.bottom;var _14=_f.right;var tl,tr,br,bl;tl=new _4(_12,top);tr=new _4(_14,top);br=new _4(_14,_13);bl=new _4(_12,_13);return [{tl:tl,tr:tr,bl:bl,br:br,tex:{x:0,y:0,w:_10,h:_11}}];};var _15=function _15(){this.layoutVertexArray=new _1.StructArrayLayout2f4ib16();this.indexArray=new _1.StructArrayLayout3ui6();this.segments=new _2();};_15.prototype.destroy=function destroy(){if(!this.layoutVertexBuffer){return;}this.layoutVertexBuffer.destroy();this.indexBuffer.destroy();this.segments.destroy();};_15.prototype.addFeature=function(_16,_17,_18,_19){var _1a=_9(_17,_18,_19);for(var i$6=0,_1b=_16;i$6<_1b.length;i$6+=1){var _1c=_1b[i$6];for(var i=0,_1d=_1c;i<_1d.length;i+=1){var _1e=_1d[i];var _1f=new _3(_1e.x,_1e.y);var _20=_d(_1f,_1a,_17,_18);this.addSymbols(_20,_1f);}}};_15.prototype.addSymbols=function addSymbols(_21,_22){var _23=this.indexArray;var _24=this.layoutVertexArray;var _25=this.segments.prepareSegment(4*_21.length,this.layoutVertexArray,this.indexArray);for(var i=0,_26=_21;i<_26.length;i+=1){var _27=_26[i];var tl=_27.tl,tr=_27.tr,bl=_27.bl,br=_27.br,tex=_27.tex;var _28=_25.vertexLength;_5(_24,_22.x,_22.y,tl.x,tl.y,tex.x,tex.y);_5(_24,_22.x,_22.y,tr.x,tr.y,tex.x+tex.w,tex.y);_5(_24,_22.x,_22.y,bl.x,bl.y,tex.x,tex.y+tex.h);_5(_24,_22.x,_22.y,br.x,br.y,tex.x+tex.w,tex.y+tex.h);_23.emplaceBack(_28,_28+1,_28+2);_23.emplaceBack(_28+1,_28+2,_28+3);_25.vertexLength+=4;_25.primitiveLength+=2;}};_15.prototype.upload=function upload(_29){this.layoutVertexBuffer=_29.createVertexBuffer(this.layoutVertexArray,[{name:"a_pos",type:"Float32",components:2,offset:0},{name:"a_data",type:"Int16",components:4,offset:8}]);this.indexBuffer=_29.createIndexBuffer(this.indexArray);};return _15;});