//>>built
define("com/huayun/webgis/data/bucket/MassiveFillBucketSimplify",["../ArrayType","../../gl/MassiveSegmentVector","../../utils/earcut","../../utils/utils","../../utils/Constant"],function(_1,_2,_3,_4,_5){function _6(){this.layoutVertexArray=new _1.StructArrayLayout2f8();this.indexArray=new _1.StructArrayLayout3ui12();this.segments=new _2();};_6.prototype.addFeatures=function addFeatures(_7,_8){for(var i=0,_9=this.features;i<_9.length;i+=1){var _a=_9[i];var _b=_a.geometry;this.addFeature(_a,_b,_a.index,_8);}};_6.prototype.destroy=function destroy(){if(!this.layoutVertexBuffer){return;}this.layoutVertexBuffer.destroy();this.indexBuffer.destroy();this.segments.destroy();};_6.prototype.addFeature=function addFeature(_c){for(var _d=0,_e=_4.classifyRings(_c,_5.layout.EARCUT_MAX_RINGS);_d<_e.length;_d+=1){var _f=_e[_d];var _10=0;for(var i$2=0,_11=_f;i$2<_11.length;i$2+=1){var _12=_11[i$2];_10+=_12.length;}var _13=this.segments.prepareSegment(_10,this.layoutVertexArray,this.indexArray);var _14=_13.vertexLength;var _15=[];var _16=[];for(var i$3=0,_17=_f;i$3<_17.length;i$3+=1){var _18=_17[i$3];if(_18.length===0){continue;}if(_18!==_f[0]){_16.push(_15.length/2);}this.layoutVertexArray.emplaceBack(_18[0].x,_18[0].y);_15.push(_18[0].x);_15.push(_18[0].y);for(var i=1;i<_18.length;i++){this.layoutVertexArray.emplaceBack(_18[i].x,_18[i].y);_15.push(_18[i].x);_15.push(_18[i].y);}}var _19=_3.earcut(_15,_16);for(var i$1=0;i$1<_19.length;i$1+=3){this.indexArray.emplaceBack(_14+_19[i$1],_14+_19[i$1+1],_14+_19[i$1+2]);}_13.vertexLength+=_10;_13.primitiveLength+=_19.length/3;}};_6.prototype.upload=function upload(_1a){this.layoutVertexBuffer=_1a.createVertexBuffer(this.layoutVertexArray,[{name:"a_pos",type:"Float32",components:2,offset:0}]);this.indexBuffer=_1a.createIndexBuffer(this.indexArray);};return _6;});