//>>built
define("com/huayun/webgis/data/GraphicIndex",["custom/rbush","./queryIntersects","./queryIntersectsEx","./captureIntersects"],function(_1,_2,_3,_4){function _5(_6){var _7=Infinity;var _8=Infinity;var _9=-Infinity;var _a=-Infinity;for(var i=0,_b=_6;i<_b.length;i+=1){var p=_b[i];if(p.type==="point"){_7=Math.min(_7,p.x);_8=Math.min(_8,p.y);_9=Math.max(_9,p.x);_a=Math.max(_a,p.y);}else{if(p.type==="polygon"){for(var j=0,_c=p.path[0];j<_c.length;j++){_7=Math.min(_7,_c[j].x);_8=Math.min(_8,_c[j].y);_9=Math.max(_9,_c[j].x);_a=Math.max(_a,_c[j].y);}}}}return {minx:_7,miny:_8,maxx:_9,maxy:_a};};var _d=function(){this.tree=new _1;};_d.prototype.insert=function(_e,_f){var _10=[];for(var i=0;i<_e.length;i++){var _11=_e[i];var _12=[Infinity,Infinity,-Infinity,-Infinity];for(var j=0;j<_11.length;j++){var p=_11[j];_12[0]=Math.min(_12[0],p.x);_12[1]=Math.min(_12[1],p.y);_12[2]=Math.max(_12[2],p.x);_12[3]=Math.max(_12[3],p.y);}_10.push({minX:_12[0],minY:_12[1],maxX:_12[2],maxY:_12[3],id:_f});}this.tree.load(_10);};_d.prototype.insertMsc=function(_13,_14){var _15=[];for(var i=0;i<_13.length;i++){var _16=_13[i];var _17=[Infinity,Infinity,-Infinity,-Infinity];for(var j=0;j<_16.length;j++){var p=_16[j];_17[0]=Math.min(_17[0],p.x);_17[1]=Math.min(_17[1],p.y);_17[2]=Math.max(_17[2],p.x);_17[3]=Math.max(_17[3],p.y);}_15.push({minX:_17[0],minY:_17[1],maxX:_17[2],maxY:_17[3],id:_14});}this.tree.load(_15);};_d.prototype.query=function(_18,_19,_1a,_1b,_1c){var _1d=_5(_18);var _1e=this.tree.search({minX:_1d.minx-_19*_1b,minY:_1d.miny-_19*_1b,maxX:_1d.maxx+_19*_1b,maxY:_1d.maxy+_19*_1b});var g;var _1f=[];for(var i=0;i<_1e.length;i++){for(var j=0;j<_1a.length;j++){if(_1e[i].id===_1a[j].id){g=_1a[j];if(g.feature.geometry.type==="multipoint"){for(var k=0,kk=g.feature.geometry.points.length;k<kk;k++){var p=g.feature.geometry.points[k];if(_2[g.symbol.type](_18,p,g.symbol,_1b,g.feature.geometry.radius,_1c)){_1f.push(g);break;}}}else{if(_2[g.symbol.type](_18,g.feature.geometry,g.symbol,_1b,g.feature.geometry.radius,_1c)){_1f.push(g);}}}}}return _1f;};_d.prototype.roughQuery=function(_20,_21,_22,_23,_24){var _25=_5(_20);var _26=this.tree.search({minX:_25.minx-_21*_23,minY:_25.miny-_21*_23,maxX:_25.maxx+_21*_23,maxY:_25.maxy+_21*_23});var g;var _27=[];for(var i=0;i<_26.length;i++){for(var j=0;j<_22.length;j++){if(_26[i].id===_22[j].id){g=_22[j];_27.push(g);}}}return _27;};_d.prototype.captureQuery=function(_28,_29,_2a,_2b,_2c){var _2d=_5(_28);var _2e=this.tree.search({minX:_2d.minx-_29*_2b,minY:_2d.miny-_29*_2b,maxX:_2d.maxx+_29*_2b,maxY:_2d.maxy+_29*_2b});var g;var _2f=[];for(var i=0;i<_2e.length;i++){for(var j=0;j<_2a.length;j++){if(_2e[i].id===_2a[j].id){g=_2a[j];if(_4[g.symbol.type](_28,g.feature.geometry,g.symbol,_2b,g.feature.geometry.radius,_2c,_29)){_2f.push(g);}}}}return _2f;};_d.prototype.queryMsc=function(_30,_31,_32,_33){var _34=_5(_30);var _35=this.tree.search({minX:_34.minx-_31*_32,minY:_34.miny-_31*_32,maxX:_34.maxx+_31*_32,maxY:_34.maxy+_31*_32});var g;var _36=[];var _37={width:5};var _38;for(var i=0;i<_35.length;i++){g=_35[i];_38=g.id.feature.type+"ex";if(_36.indexOf(g.id)===-1&&_3[_38](_30,g.id.geometry,_37,_32,5,_33)){_36.push(g.id);}}return _36;};_d.prototype.queryRender=function(_39,_3a,_3b,_3c,_3d){var _3e=_5(_39);var _3f=this.tree.search({minX:_3e.minx-_3a*_3c,minY:_3e.miny-_3a*_3c,maxX:_3e.maxx+_3a*_3c,maxY:_3e.maxy+_3a*_3c});var g;var _40=[];for(var i=0;i<_3f.length;i++){for(var j=0;j<_3b.length;j++){if(_3f[i].id===_3b[j].id){g=_3b[j];if(g.visible&&_2[g.symbol.type](_39,g.feature.geometry,g.symbol,_3c,g.feature.geometry.radius,_3d)){_40.push(g);}}}}return _40;};_d.prototype.clear=function(){this.tree.clear();};return _d;});