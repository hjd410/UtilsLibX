//>>built
define("com/huayun/webgis/views/3d/util",["exports","com/huayun/webgis/data/TaggedString","com/huayun/webgis/gl/CollisionFeature"],function(_1,_2,_3){var _4={horizontal:1,vertical:2,horizontalOnly:3};function _5(_6,_7,_8,_9,_a,_b,_c){var _d=(_7-_8)*_a;var _e=(-_9*_c+0.5)*_b;for(var j=0;j<_6.length;j++){_6[j].x+=_d;_6[j].y+=_e;}};function _f(_10,_11,_12,_13,_14,_15,_16,_17){var _18=-17;var x=0;var y=_18;var _19=0;var _1a=_10.positionedGlyphs;var _1b=0.5;for(var i$1=0,_1c=_12;i$1<_1c.length;i$1+=1){var _1d=_1c[i$1];_1d.trim();var _1e=_1d.getMaxScale();if(!_1d.length()){y+=_13;continue;}var _1f=_1a.length;for(var i=0;i<_1d.length();i++){var _20=_1d.getSection(i);var _21=_1d.getCharCode(i);var _22=(_1e-_20.scale)*24;var _23=_11[_20.fontStack];var _24=_23&&_23[_21];if(!_24){continue;}_1a.push({glyph:_21,x:x,y:y+_22,vertical:false,scale:_20.scale,fontStack:_20.fontStack});x+=_24.metrics.advance*_20.scale+_17;}x=0;y+=_13*_1e;}var _25=0.5;var _26=0.5;_5(_1a,_1b,_25,_26,_19,_13,_12.length);var _27=y-_18;_10.top+=-_26*_27;_10.bottom=_10.top+_27;_10.left+=-_25*_19;_10.right=_10.left+_19;};function _28(_29,_2a,_2b,_2c,_2d,_2e,_2f,_30,_31,_32){var _33=_2.fromFeature(_29,_2b);if(_32===_4.vertical){_33.verticalizePunctuation();}var _34=[_33];var _35=[];var _36={positionedGlyphs:_35,text:_33.toString(),top:_31[1],bottom:_31[1],left:_31[0],right:_31[0],writingMode:_32,lineCount:_34.length};_f(_36,_2a,_34,_2d,_2e,_2f,_32,_30);return _36;};function _37(key,_38){var _39,_3a,h1,h1b,c1,c1b,c2,c2b,k1,i;_39=key.length&3;_3a=key.length-_39;h1=_38;c1=3432918353;c2=461845907;i=0;while(i<_3a){k1=((key.charCodeAt(i)&255))|((key.charCodeAt(++i)&255)<<8)|((key.charCodeAt(++i)&255)<<16)|((key.charCodeAt(++i)&255)<<24);++i;k1=((((k1&65535)*c1)+((((k1>>>16)*c1)&65535)<<16)))&4294967295;k1=(k1<<15)|(k1>>>17);k1=((((k1&65535)*c2)+((((k1>>>16)*c2)&65535)<<16)))&4294967295;h1^=k1;h1=(h1<<13)|(h1>>>19);h1b=((((h1&65535)*5)+((((h1>>>16)*5)&65535)<<16)))&4294967295;h1=(((h1b&65535)+27492)+((((h1b>>>16)+58964)&65535)<<16));}k1=0;switch(_39){case 3:k1^=(key.charCodeAt(i+2)&255)<<16;case 2:k1^=(key.charCodeAt(i+1)&255)<<8;case 1:k1^=(key.charCodeAt(i)&255);k1=(((k1&65535)*c1)+((((k1>>>16)*c1)&65535)<<16))&4294967295;k1=(k1<<15)|(k1>>>17);k1=(((k1&65535)*c2)+((((k1>>>16)*c2)&65535)<<16))&4294967295;h1^=k1;}h1^=key.length;h1^=h1>>>16;h1=(((h1&65535)*2246822507)+((((h1>>>16)*2246822507)&65535)<<16))&4294967295;h1^=h1>>>13;h1=((((h1&65535)*3266489909)+((((h1>>>16)*3266489909)&65535)<<16)))&4294967295;h1^=h1>>>16;return h1>>>0;};function _3b(_3c,_3d,_3e,_3f,_40,_41,_42,_43,_44,_45,_46){var _47=getGlyphQuads(_3d,_3e,_41,_3f,_40,_46);var _48={kind:"constant",layoutSize:18};var _49=null;if(_48.kind==="source"){}else{if(_48.kind==="composite"){_49=[4608,4608];if(_49[0]>MAX_PACKED_SIZE||_49[1]>MAX_PACKED_SIZE){}}}_3c.addSymbols(_3c.text,_47,_49,_41,_3f,_40,_43,_3d,_42.lineStartIndex,_42.lineLength);for(var i=0,_4a=_44;i<_4a.length;i+=1){var _4b=_4a[i];_45[_4b]=_3c.text.placedSymbolArray.length-1;}return _47.length*4;};function _4c(_4d,_4e,_4f,_50,_51,_52,_53,_54,_55,_56,_57,_58,_59,_5a,_5b,_5c,_5d,_5e,_5f,_60){var _61={lineStartIndex:0,lineLength:0};var _62,_63;var _64=0;var _65=0;var _66=0;var _67={};var key=_37("");var _68=0;for(var _69 in _50.horizontal){var _6a=_50.horizontal[_69];if(!_62){key=_37(_6a.text);var _6b=0;_62=new _3(_52,_4f,_4e,_53,_54,_55,_6a,_56,_57,_58,_4d.overscaling,_6b);}_65+=_3b(_4d,_4e,_6a,_58,_5e,_59,_61,_50.vertical?_4.horizontal:_4.horizontalOnly,singleLine?(Object.keys(_50.horizontal)):[_69],_67,_5f);break;}var _6c=_62?_62.boxStartIndex:_4d.collisionBoxArray.length;var _6d=_62?_62.boxEndIndex:_4d.collisionBoxArray.length;_4d.symbolInstances.emplaceBack(_4e.x,_4e.y,_67.right>=0?_67.right:-1,_67.center>=0?_67.center:-1,_67.left>=0?_67.left:-1,_67.vertical||-1,key,_6c,_6d,iconBoxStartIndex,iconBoxEndIndex,_53,_65,_66,_64,0,_56,_68);};function _6e(_6f,_70,_71,_72,_73,_74,_75){var _76=12;var _77=12;var _78=_71.horizontal.center;var _79=24,_7a=_76/_79,_7b=_6f.tilePixelRatio*_7a,_7c=_6f.tilePixelRatio*_77/_79,_7d=_6f.tilePixelRatio*250,_7e=2*_6f.tilePixelRatio,_7f=45/180*Math.PI,_80=false,_81="point",_82=_7d/2;var _83=function(_84,_85){_4c(_6f,_85,_84,_71,_72,_6f.collisionBoxArray,_70.index,_70.sourceLayerIndex,_6f.index,_7b,_7e,_80,_75,iconBoxScale,iconPadding,iconAlongLine,iconOffset,_70,_73,_74);};for(var i$6=0,_86=_70.geometry;i$6<_86.length;i$6+=1){var _87=_86[i$6];for(var i$5=0,_88=_87;i$5<_88.length;i$5+=1){var _89=_88[i$5];_83([_89],new Anchor(_89.x,_89.y,0));}}};_1.performSymbolLayout=function(_8a,_8b,_8c,_8d,_8e,_8f){_8a.createArrays();_8a.tilePixelRatio=16;_8a.compareText={};_8a.iconsNeedLinear=false;var _90={};_90.layoutTextSize=12;_90.textMaxSize=12;var _91=28.8;var _92=false;var _93=true;for(var i$1=0,_94=_8a.features;i$1<_94.length;i$1+=1){var _95=_94[i$1];var _96="DIN Offc Pro Medium,Arial Unicode MS Regular";var _97=_8c;var _98={horizontal:{},vertical:undefined};var _99=_95.text;var _9a=[0,0];if(_99){var _9b=_99.toString();var _9c=0;var _9d=0;var _9e="center";var _9f=undefined;var _a0=0;_9a=[0,0];var _a1="center";var _a2=240;var _a3=_28(_99,_8b,_96,_a2,_91,_9e,_a1,_9d,_9a,_4.horizontal);if(_a3){_98.horizontal[_a1]=_a3;}}if(Object.keys(_98.horizontal).length){_6e(_8a,_95,_98,(void 0),_97,_90,_9a);}}if(_8f){_8a.generateCollisionDebugBuffers();}};});