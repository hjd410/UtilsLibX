//>>built
(function(f,d){var m,h=function(){return"undefined"!==typeof u&&"function"!==typeof u?u:"undefined"!==typeof window?window:"undefined"!==typeof self?self:this}(),c=function(){},a=function(b){for(var a in b)return 0;return 1},g={}.toString,l=function(b){return"[object Function]"==g.call(b)},e=function(b){return"[object String]"==g.call(b)},b=function(b){return"[object Array]"==g.call(b)},k=function(b,a){if(b)for(var e=0;e<b.length;)a(b[e++])},n=function(b,a){for(var e in a)b[e]=a[e];return b},p=function(b,
a){return n(Error(b),{src:"dojoLoader",info:a})},t=1,r=function(){return"_"+t++},q=function(b,a,e){return V(b,a,e,0,q)},u=h,z=u.document,v=z&&z.createElement("DiV"),y=q.has=function(b){return l(x[b])?x[b]=x[b](u,z,v):x[b]},x=y.cache=d.hasCache;l(f)&&(f=f(h));y.add=function(b,a,e,k){(void 0===x[b]||k)&&(x[b]=a);return e&&y(b)};y.add("host-webworker","undefined"!==typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope);y("host-webworker")&&(n(d.hasCache,{"host-browser":0,dom:0,"dojo-dom-ready-api":0,
"dojo-sniff":0,"dojo-inject-api":1,"host-webworker":1,"dojo-guarantee-console":0}),d.loaderPatch={injectUrl:function(b,a){try{importScripts(b),a()}catch(Fa){console.error(Fa)}}});for(var w in f.has)y.add(w,f.has[w],0,1);q.async=1;var A=y("csp-restrictions")?function(){}:new Function("return eval(arguments[0]);");q.eval=function(b,a){return A(b+"\r\n//# sourceURL\x3d"+a)};var B={},E=q.signal=function(a,e){a=B[a];k(a&&a.slice(0),function(a){a.apply(null,b(e)?e:[e])})},C=q.on=function(b,a){var e=B[b]||
(B[b]=[]);e.push(a);return{remove:function(){for(var b=0;b<e.length;b++)if(e[b]===a){e.splice(b,1);break}}}},F=[],G={},I=[],M={},D=q.map={},H=[],J={},Q="",L={},K={},P={},U=0;if(!y("foreign-loader"))var Qa=function(b,a){a=!1!==a;var e,k,n,g;for(e in K)k=K[e],(n=e.match(/^url\:(.+)/))?L["url:"+ma(n[1],b)]=k:"*now"==e?g=k:"*noref"!=e&&(n=na(e,b,!0),L[n.mid]=L["url:"+n.url]=k);g&&g(S(b));a&&(K={})};var lb=function(b){return b.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,function(b){return"\\"+b})},bb=function(b,
a){a.splice(0,a.length);for(var e in b)a.push([e,b[e],new RegExp("^"+lb(e)+"(/|$)"),e.length]);a.sort(function(b,a){return a[3]-b[3]});return a},xb=function(b,a){k(b,function(b){a.push([e(b[0])?new RegExp("^"+lb(b[0])+"$"):b[0],b[1]])})},mb=function(b){var a=b.name;a||(a=b,b={name:a});b=n({main:"main"},b);b.location=b.location?b.location:a;b.packageMap&&(D[a]=b.packageMap);b.main.indexOf("./")||(b.main=b.main.substring(2));M[a]=b},nb=[],Ga=function(b,a,g){for(var c in b){"waitSeconds"==c&&(q.waitms=
1E3*(b[c]||0));"cacheBust"==c&&(Q=b[c]?e(b[c])?b[c]:(new Date).getTime()+"":"");if("baseUrl"==c||"combo"==c)q[c]=b[c];b[c]!==x&&(q.rawConfig[c]=b[c],"has"!=c&&y.add("config-"+c,b[c],0,a))}q.baseUrl||(q.baseUrl="./");/\/$/.test(q.baseUrl)||(q.baseUrl+="/");for(c in b.has)y.add(c,b.has[c],0,a);k(b.packages,mb);for(var p in b.packagePaths)k(b.packagePaths[p],function(b){var a=p+"/"+b;e(b)&&(b={name:b});b.location=a;mb(b)});bb(n(D,b.map),H);k(H,function(b){b[1]=bb(b[1],[]);"*"==b[0]&&(H.star=b)});bb(n(G,
b.paths),I);xb(b.aliases,F);if(!y("foreign-loader")){if(a)nb.push({config:b.config});else for(c in b.config)a=N(c,g),a.config=n(a.config||{},b.config[c]);b.cache&&(Qa(),K=b.cache,Qa(0,!!b.cache["*noref"]))}E("config",[b,q.rawConfig])};y("dojo-cdn");var Ra=z.getElementsByTagName("script");m=0;for(var ba,va,Sa,Ha;m<Ra.length;)if(ba=Ra[m++],(Sa=ba.getAttribute("src"))&&(Ha=Sa.match(/(((.*)\/)|^)dojo\.js(\W|$)/i))&&(va=Ha[3]||"",d.baseUrl=d.baseUrl||va,U=ba),Sa=ba.getAttribute("data-dojo-config")||ba.getAttribute("djConfig"))P=
q.eval("({ "+Sa+" })","data-dojo-config"),U=ba;q.rawConfig={};Ga(d,1);y("dojo-cdn")&&((M.dojo.location=va)&&(va+="/"),M.dijit.location=va+"../dijit/",M.dojox.location=va+"../dojox/");Ga(f,1);Ga(P,1);if(!y("foreign-loader"))var W=function(b){da(function(){k(b.deps,Ia)})},V=function(a,k,g,l,t){var d;if(e(a)){if((d=N(a,l,!0))&&d.executed)return d.result;throw p("undefinedModule",a);}b(a)||(Ga(a,0,l),a=k,k=g);if(b(a))if(a.length){g="require*"+r();for(var h,f=[],m=0;m<a.length;)h=a[m++],f.push(N(h,l));
d=n(wa("",g,0,""),{injected:2,deps:f,def:k||c,require:l?l.require:q,gc:1});J[d.mid]=d;W(d);var y=ga&&!0;da(function(){xa(d,y)});d.executed||O.push(d);ha()}else k&&k();return t},S=function(b){if(!b)return q;var a=b.require;a||(a=function(e,k,n){return V(e,k,n,b,a)},b.require=n(a,q),a.module=b,a.toUrl=function(a){return ma(a,b)},a.toAbsMid=function(a){return oa(a,b)});return a},O=[],Y=[],T={},pa=function(b){b.injected=1;T[b.mid]=1;b.url&&(T[b.url]=b.pack||1);ia()},ka=function(b){b.injected=2;delete T[b.mid];
b.url&&delete T[b.url];a(T)&&ja()},ya=q.idle=function(){return!Y.length&&a(T)&&!O.length&&!ga};var la=function(b,a){if(a)for(var e=0;e<a.length;e++)if(a[e][2].test(b))return a[e];return 0},za=function(b){var a=[],e,k;for(b=b.replace(/\\/g,"/").split("/");b.length;)e=b.shift(),".."==e&&a.length&&".."!=k?(a.pop(),k=a[a.length-1]):"."!=e&&a.push(k=e);return a.join("/")},wa=function(b,a,e,k){return{pid:b,mid:a,pack:e,url:k,executed:0,def:0}},Ta=function(b,a,e,n,g,c,t,q,d,r){var h,f,m,z;z=/^\./.test(b);
if(/(^\/)|(\:)|(\.js$)/.test(b)||z&&!a)return wa(0,b,0,b);b=za(z?a.mid+"/../"+b:b);if(/^\./.test(b))throw p("irrationalPath",b);r||z||!c.star||(m=la(b,c.star[1]));!m&&a&&(m=(m=la(a.mid,c))&&la(b,m[1]));m&&(b=m[1]+b.substring(m[3]));a=(Ha=b.match(/^([^\/]+)(\/(.+))?$/))?Ha[1]:"";(h=e[a])?b=a+"/"+(f=Ha[3]||h.main):a="";var v=0;k(q,function(a){var e=b.match(a[0]);e&&0<e.length&&(v=l(a[1])?b.replace(a[0],a[1]):a[1])});if(v)return Ta(v,0,e,n,g,c,t,q,d);if(e=n[b])return d?wa(e.pid,e.mid,e.pack,e.url):n[b];
n=(m=la(b,t))?m[1]+b.substring(m[3]):a?("/"===h.location.slice(-1)?h.location.slice(0,-1):h.location)+"/"+f:y("config-tlmSiblingOfDojo")?"../"+b:b;/(^\/)|(\:)/.test(n)||(n=g+n);return wa(a,b,h,za(n+".js"))},na=function(b,a,e){return Ta(b,a,M,J,q.baseUrl,H,I,F,void 0,e)};if(!y("foreign-loader"))var Aa=function(b,a,e){return b.normalize?b.normalize(a,function(b){return oa(b,e)}):oa(a,e)},Ja=0,N=function(b,a,e){var k,n;(k=b.match(/^(.+?)\!(.*)$/))?(n=N(k[1],a,e),5!==n.executed||n.load||Ba(n),n.load?
(k=Aa(n,k[2],a),b=n.mid+"!"+(n.dynamic?++Ja+"!":"")+k):(k=k[2],b=n.mid+"!"+ ++Ja+"!waitingForPlugin"),b={plugin:n,mid:b,req:S(a),prid:k}):b=na(b,a);return J[b.mid]||!e&&(J[b.mid]=b)};var oa=q.toAbsMid=function(b,a){return na(b,a).mid},ma=q.toUrl=function(b,a){a=na(b+"/x",a);var e=a.url;return R(0===a.pid?b:e.substring(0,e.length-5))};if(!y("foreign-loader"))var qa={injected:2,executed:5,def:3,result:3},ra=function(b){return J[b]=n({mid:b},qa)},Ua=ra("require"),eb=ra("exports"),Va=ra("module"),sa=
{},Ka=0,Ba=function(b){var a=b.result;b.dynamic=a.dynamic;b.normalize=a.normalize;b.load=a.load;return b},Ca=function(b){var a={};k(b.loadQ,function(e){var k=Aa(b,e.prid,e.req.module),g=b.dynamic?e.mid.replace(/waitingForPlugin$/,k):b.mid+"!"+k,k=n(n({},e),{mid:g,prid:k,injected:0});J[g]&&J[g].injected||Z(J[g]=k);a[e.mid]=J[g];ka(e);delete J[e.mid]});b.loadQ=0;var e=function(b){for(var e=b.deps||[],k=0;k<e.length;k++)(b=a[e[k].mid])&&(e[k]=b)},g;for(g in J)e(J[g]);k(O,e)},X=function(b){q.trace("loader-finish-exec",
[b.mid]);b.executed=5;b.defOrder=Ka++;b.loadQ&&(Ba(b),Ca(b));for(m=0;m<O.length;)O[m]===b?O.splice(m,1):m++;/^require\*/.test(b.mid)&&delete J[b.mid]},Wa=[],xa=function(b,a){if(4===b.executed)return q.trace("loader-circular-dependency",[Wa.concat(b.mid).join("-\x3e")]),!b.def||a?sa:b.cjs&&b.cjs.exports;if(!b.executed){if(!b.def)return sa;var e=b.mid,k=b.deps||[],n,g=[],c=0;for(b.executed=4;n=k[c++];){n=n===Ua?S(b):n===eb?b.cjs.exports:n===Va?b.cjs:xa(n,a);if(n===sa)return b.executed=0,q.trace("loader-exec-module",
["abort",e]),sa;g.push(n)}q.trace("loader-run-factory",[b.mid]);a=b.def;var t;if(y("config-dojo-loader-catches"))try{t=l(a)?a.apply(null,g):a}catch(fa){E("error",b.result=p("factoryThrew",[b,fa]))}else t=l(a)?a.apply(null,g):a;b.result=void 0===t&&b.cjs?b.cjs.exports:t;X(b)}return b.result},ga=0,da=function(b){try{ga++,b()}catch(ab){throw ab;}finally{ga--}ya()&&E("idle",[])},ha=function(){ga||da(function(){for(var b,a,e=0;e<O.length;)b=Ka,a=O[e],xa(a),b!=Ka?e=0:e++})};var R="function"==typeof f.fixupUrl?
f.fixupUrl:function(b){b+="";return b+(Q?(/\?/.test(b)?"\x26":"?")+Q:"")};void 0===y("dojo-loader-eval-hint-url")&&y.add("dojo-loader-eval-hint-url",1);var Z=function(b){var a=b.plugin;5!==a.executed||a.load||Ba(a);var e=function(a){b.result=a;ka(b);X(b);ha()};a.load?a.load(b.prid,b.req,e):a.loadQ?a.loadQ.push(b):(a.loadQ=[b],O.unshift(a),Ia(a))},ca=0,Da=0,Ea=0,Xa=function(b,a){y("config-stripStrict")&&(b=b.replace(/(["'])use strict\1/g,""));Ea=1;if(y("config-dojo-loader-catches"))try{b===ca?ca.call(null):
q.eval(b,y("dojo-loader-eval-hint-url")?a.url:a.mid)}catch(Fa){E("error",p("evalModuleThrew",a))}else b===ca?ca.call(null):q.eval(b,y("dojo-loader-eval-hint-url")?a.url:a.mid);Ea=0},Ia=function(b){var a=b.mid,e=b.url;if(!(b.executed||b.injected||T[a]||b.url&&(b.pack&&T[b.url]===b.pack||1==T[b.url])))if(pa(b),b.plugin)Z(b);else{var k=function(){Ya(b);if(2!==b.injected){if(y("dojo-enforceDefine")){E("error",p("noDefine",b));return}ka(b);n(b,qa);q.trace("loader-define-nonmodule",[b.url])}ha()};(ca=L[a]||
L["url:"+b.url])?(q.trace("loader-inject",["cache",b.mid,e]),Xa(ca,b),k()):(q.trace("loader-inject",["script",b.mid,e]),Da=b,q.injectUrl(R(e),k,b),Da=0)}},ta=function(b,a,e){q.trace("loader-define-module",[b.mid,a]);if(2===b.injected)return E("error",p("multipleDefine",b)),b;n(b,{deps:a,def:e,cjs:{id:b.mid,uri:b.url,exports:b.result={},setExports:function(a){b.cjs.exports=a},config:function(){return b.config}}});for(var k=0;a[k];k++)a[k]=N(a[k],b);ka(b);l(e)||a.length||(b.result=e,X(b));return b},
Ya=function(b,a){for(var e=[],n,g;Y.length;)g=Y.shift(),a&&(g[0]=a.shift()),n=g[0]&&N(g[0])||b,e.push([n,g[1],g[2]]);Qa(b);k(e,function(b){W(ta.apply(null,b))})},ua=0,ja=c,ia=c,ja=function(){ua&&clearTimeout(ua);ua=0},ia=function(){ja();q.waitms&&(ua=u.setTimeout(function(){ja();E("error",p("timeout",T))},q.waitms))};y.add("ie-event-behavior",z.attachEvent&&"undefined"===typeof Windows&&("undefined"===typeof opera||"[object Opera]"!=opera.toString()));var La=function(b,a,e,k){if(y("ie-event-behavior"))return b.attachEvent(e,
k),function(){b.detachEvent(e,k)};b.addEventListener(a,k,!1);return function(){b.removeEventListener(a,k,!1)}},Ma=La(window,"load","onload",function(){q.pageLoaded=1;try{"complete"!=z.readyState&&(z.readyState="complete")}catch($a){}Ma()}),Ra=z.getElementsByTagName("script");for(m=0;!U;)/^dojo/.test((ba=Ra[m++])&&ba.type)||(U=ba);q.injectUrl=function(b,a,e){e=e.node=z.createElement("script");var k=La(e,"load","onreadystatechange",function(b){b=b||window.event;var e=b.target||b.srcElement;if("load"===
b.type||/complete|loaded/.test(e.readyState))k(),n(),a&&a()}),n=La(e,"error","onerror",function(a){k();n();E("error",p("scriptError: "+b,[b,a]))});e.type="text/javascript";e.charset="utf-8";e.src=b;U.parentNode.insertBefore(e,U);return e};q.log=c;q.trace=c;if(y("foreign-loader"))Na=c;else{var Na=function(b,a,k){var n=arguments.length,g=["require","exports","module"],c=[0,b,a];1==n?c=[0,l(b)?g:[],b]:2==n&&e(b)?c=[b,l(a)?g:[],a]:3==n&&(c=[b,a,k]);q.trace("loader-define",c.slice(0,2));if((n=c[0]&&N(c[0]))&&
!T[n.mid])W(ta(n,c[1],c[2]));else if(!y("ie-event-behavior")||Ea)Y.push(c);else{n=n||Da;if(!n)for(b in T)if((g=J[b])&&g.node&&"interactive"===g.node.readyState){n=g;break}n?(Qa(n),W(ta(n,c[1],c[2]))):E("error",p("ieDefineFailed",c[0]));ha()}};Na.amd={vendor:"dojotoolkit.org"}}n(n(q,d.loaderPatch),f.loaderPatch);C("error",function(b){try{if(console.error(b),b instanceof Error)for(var a in b);}catch(Fa){}});n(q,{uid:r,cache:L,packs:M});if(!u.define&&(u.define=Na,u.require=q,!y("foreign-loader"))){k(nb,
function(b){Ga(b)});var Za=P.deps||f.deps||d.deps,Oa=P.callback||f.callback||d.callback;q.boot=Za||Oa?[Za||[],Oa]:0}})(function(f){return f.dojoConfig||f.djConfig||f.require||{}},{async:0,hasCache:{"config-selectorEngine":"lite","config-tlmSiblingOfDojo":1,"dojo-built":1,"dojo-loader":1,dom:1,"host-browser":1},packages:[{location:"../dojox",name:"dojox"},{location:"../dijit",name:"dijit"},{location:".",name:"dojo"},{location:"../com",name:"com"}]});
require({cache:{"dojo/sniff":function(){define(["./has"],function(f){var d=navigator,m=d.userAgent,d=d.appVersion,h=parseFloat(d);f.add("air",0<=m.indexOf("AdobeAIR"));f.add("wp",parseFloat(m.split("Windows Phone")[1])||void 0);f.add("msapp",parseFloat(m.split("MSAppHost/")[1])||void 0);f.add("khtml",0<=d.indexOf("Konqueror")?h:void 0);f.add("edge",parseFloat(m.split("Edge/")[1])||void 0);f.add("opr",parseFloat(m.split("OPR/")[1])||void 0);f.add("webkit",!f("wp")&&!f("edge")&&parseFloat(m.split("WebKit/")[1])||
void 0);f.add("chrome",!f("edge")&&!f("opr")&&parseFloat(m.split("Chrome/")[1])||void 0);f.add("android",!f("wp")&&parseFloat(m.split("Android ")[1])||void 0);f.add("safari",!(0<=d.indexOf("Safari"))||f("wp")||f("chrome")||f("android")||f("edge")||f("opr")?void 0:parseFloat(d.split("Version/")[1]));f.add("mac",0<=d.indexOf("Macintosh"));f.add("quirks","BackCompat"==document.compatMode);if(!f("wp")&&m.match(/(iPhone|iPod|iPad)/)){var c=RegExp.$1.replace(/P/,"p"),a=m.match(/OS ([\d_]+)/)?RegExp.$1:
"1",a=parseFloat(a.replace(/_/,".").replace(/_/g,""));f.add(c,a);f.add("ios",a)}f.add("bb",(0<=m.indexOf("BlackBerry")||0<=m.indexOf("BB10"))&&parseFloat(m.split("Version/")[1])||void 0);f.add("trident",parseFloat(d.split("Trident/")[1])||void 0);f.add("svg","undefined"!==typeof SVGAngle);f("webkit")||(0<=m.indexOf("Opera")&&f.add("opera",9.8<=h?parseFloat(m.split("Version/")[1])||h:h),!(0<=m.indexOf("Gecko"))||f("wp")||f("khtml")||f("trident")||f("edge")||f.add("mozilla",h),f("mozilla")&&f.add("ff",
parseFloat(m.split("Firefox/")[1]||m.split("Minefield/")[1])||void 0),document.all&&!f("opera")&&(m=parseFloat(d.split("MSIE ")[1])||void 0,(d=document.documentMode)&&5!=d&&Math.floor(m)!=d&&(m=d),f.add("ie",m)),f.add("wii","undefined"!=typeof opera&&opera.wiiremote));return f})},"com/huayun/webgis/data/GeoJSONFeature":function(){define([],function(){var f=function(d,h,c,a){this.type="GeoJSONFeature";this._vectorTileFeature=d;d._z=h;d._x=c;d._y=a;this.properties=d.properties;null!=d.id&&(this.id=
d.id)},d={geometry:{configurable:!0}};d.geometry.get=function(){void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry);return this._geometry};d.geometry.set=function(d){this._geometry=d};f.prototype.toJSON=function(){var d={geometry:this.geometry},h;for(h in this)"_geometry"!==h&&"_vectorTileFeature"!==h&&(d[h]=this[h]);return d};Object.defineProperties(f.prototype,d);return f})},"com/huayun/webgis/symbols/TextSymbol":function(){define(["./Symbol",
"../utils/Color","./support/glyphManager","./support/CustomGlyphAtlas"],function(f,d,m,h){var c=function(a){f.call(this,a);var g=d.parse(a.color||"#FF0000"),c=void 0===a.opacity?1:a.opacity,e=Number(a.size||a["font-size"]||a.fontSize||12);this.fontSize=e;var b=void 0===a.isRotate?!1:a.isRotate,k=void 0===a.rotateRadian?0:a.rotateRadian;this.offset=(a.offset||[Number(a.dx||0),Number(a.dy||0)]).map(function(b){return b/e});this.hasHalo=a.stroke||!!a.halo;var n,p,t;this.hasHalo?a.halo?(n=a.halo.blur||
0,p=d.parse(a.halo.color||"#FF0000"),t=a.halo.width||Number(a["stroke-width"])):(n=0,p=d.parse(a.stroke||"#FF0000"),t=Number(a["stroke-width"]||0)):(n=0,p=d.parse("#FFF"),t=0);var r=a.colors;r&&0<r.length&&(this.colors=r.map(function(b){b=d.parse(b);return[b.r,b.g,b.b,b.a]}));this.type="text";this.uniforms=this.colors?{u_size:this.fontSize,u_pitch_with_map:0,u_opacity:c,u_fill_color:[g.r,g.g,g.b,g.a],u_texture:0,u_gamma_scale:1,u_rotate_symbol:b,u_radian:k,u_halo_color:[p.r,p.g,p.b,p.a],u_halo_width:t,
u_halo_blur:n,u_is_halo:this.hasHalo?1:0}:{u_size:this.fontSize,u_pitch_with_map:0,u_opacity:c,u_texture:0,u_fill_color:[g.r,g.g,g.b,g.a],u_gamma_scale:1,u_rotate_symbol:b,u_radian:k,u_halo_color:[p.r,p.g,p.b,p.a],u_halo_width:t,u_halo_blur:n,u_is_halo:this.hasHalo?1:0};var g=a.text,q=a.font||a["font-family"]||a.fontFamily||"sans-serif";this.font=q;a=a.texts;if(g){this.text=g;var u={};u[q]=[];a=0;for(c=g.length;a<c;a++)"\t"!==g[a]&&"\n"!==g[a]&&u[q].push(g.charCodeAt(a));this.glyphMap=m.getGlyphs(u);
this.glyphAtlas=new h(this.glyphMap);a=this.glyphAtlas.image;this.width=a.width;this.height=a.height;this.textWidth=this.glyphAtlas.textWidth}else a&&(this.texts=a,u={},u[q]=[],a.forEach(function(b){for(var a=0,e=b.length;a<e;a++)"\n"!==b[a]&&u[q].push(b.charCodeAt(a))}),this.glyphMap=m.getGlyphs(u),this.glyphAtlas=new h(this.glyphMap),a=this.glyphAtlas.image,this.width=a.width,this.height=a.height,this.textWidth=this.glyphAtlas.textWidth)};f&&(c.__proto__=f);c.prototype=Object.create(f&&f.prototype);
c.prototype.constructor=c;c.prototype.setText=function(a,g){if(void 0!==a&&0!==a.length){this.text=a;g||(g=this.font);var c={};c[g]=[];for(var e=0,b=a.length;e<b;e++)c[g].push(a.charCodeAt(e));this.glyphMap=m.getGlyphs(c);this.glyphAtlas=new h(this.glyphMap);g=this.glyphAtlas.image;this.width=g.width;this.height=g.height;this.textWidth=24*a.length}};c.prototype.setOffset=function(a){var g=this.uniforms.u_size;this.offset=a.map(function(a){return a/g})};return c})},"dojo/dom-geometry":function(){define(["./sniff",
"./_base/window","./dom","./dom-style"],function(f,d,m,h){function c(b,a,e,g,c,l){l=l||"px";b=b.style;isNaN(a)||(b.left=a+l);isNaN(e)||(b.top=e+l);0<=g&&(b.width=g+l);0<=c&&(b.height=c+l)}function a(b){return"button"==b.tagName.toLowerCase()||"input"==b.tagName.toLowerCase()&&"button"==(b.getAttribute("type")||"").toLowerCase()}function g(b){return"border-box"==l.boxModel||"table"==b.tagName.toLowerCase()||a(b)}var l={boxModel:"content-box"};f("ie")&&(l.boxModel="BackCompat"==document.compatMode?
"border-box":"content-box");l.getPadExtents=function(b,a){b=m.byId(b);var e=a||h.getComputedStyle(b),k=h.toPixelValue;a=k(b,e.paddingLeft);var g=k(b,e.paddingTop),c=k(b,e.paddingRight);b=k(b,e.paddingBottom);return{l:a,t:g,r:c,b:b,w:a+c,h:g+b}};l.getBorderExtents=function(b,a){b=m.byId(b);var e=h.toPixelValue,k=a||h.getComputedStyle(b);a="none"!=k.borderLeftStyle?e(b,k.borderLeftWidth):0;var g="none"!=k.borderTopStyle?e(b,k.borderTopWidth):0,c="none"!=k.borderRightStyle?e(b,k.borderRightWidth):0;
b="none"!=k.borderBottomStyle?e(b,k.borderBottomWidth):0;return{l:a,t:g,r:c,b:b,w:a+c,h:g+b}};l.getPadBorderExtents=function(b,a){b=m.byId(b);var e=a||h.getComputedStyle(b);a=l.getPadExtents(b,e);b=l.getBorderExtents(b,e);return{l:a.l+b.l,t:a.t+b.t,r:a.r+b.r,b:a.b+b.b,w:a.w+b.w,h:a.h+b.h}};l.getMarginExtents=function(b,a){b=m.byId(b);var e=a||h.getComputedStyle(b),k=h.toPixelValue;a=k(b,e.marginLeft);var g=k(b,e.marginTop),c=k(b,e.marginRight);b=k(b,e.marginBottom);return{l:a,t:g,r:c,b:b,w:a+c,h:g+
b}};l.getMarginBox=function(b,a){b=m.byId(b);a=a||h.getComputedStyle(b);a=l.getMarginExtents(b,a);var e=b.offsetLeft-a.l,k=b.offsetTop-a.t,g=b.parentNode,c=h.toPixelValue;8==f("ie")&&!f("quirks")&&g&&(g=h.getComputedStyle(g),e-="none"!=g.borderLeftStyle?c(b,g.borderLeftWidth):0,k-="none"!=g.borderTopStyle?c(b,g.borderTopWidth):0);return{l:e,t:k,w:b.offsetWidth+a.w,h:b.offsetHeight+a.h}};l.getContentBox=function(b,a){b=m.byId(b);var e=a||h.getComputedStyle(b);a=b.clientWidth;var k,g=l.getPadExtents(b,
e);k=l.getBorderExtents(b,e);var e=b.offsetLeft+g.l+k.l,c=b.offsetTop+g.t+k.t;a?k=b.clientHeight:(a=b.offsetWidth-k.w,k=b.offsetHeight-k.h);if(8==f("ie")&&!f("quirks")){var q=b.parentNode,d=h.toPixelValue;q&&(q=h.getComputedStyle(q),e-="none"!=q.borderLeftStyle?d(b,q.borderLeftWidth):0,c-="none"!=q.borderTopStyle?d(b,q.borderTopWidth):0)}return{l:e,t:c,w:a-g.w,h:k-g.h}};l.setContentSize=function(b,a,e){b=m.byId(b);var k=a.w;a=a.h;g(b)&&(e=l.getPadBorderExtents(b,e),0<=k&&(k+=e.w),0<=a&&(a+=e.h));
c(b,NaN,NaN,k,a)};var e={l:0,t:0,w:0,h:0};l.setMarginBox=function(b,k,n){b=m.byId(b);var p=n||h.getComputedStyle(b);n=k.w;var t=k.h,d=g(b)?e:l.getPadBorderExtents(b,p),p=l.getMarginExtents(b,p);if(f("webkit")&&a(b)){var q=b.style;0<=n&&!q.width&&(q.width="4px");0<=t&&!q.height&&(q.height="4px")}0<=n&&(n=Math.max(n-d.w-p.w,0));0<=t&&(t=Math.max(t-d.h-p.h,0));c(b,k.l,k.t,n,t)};l.isBodyLtr=function(b){b=b||d.doc;return"ltr"==(d.body(b).dir||b.documentElement.dir||"ltr").toLowerCase()};l.docScroll=function(b){b=
b||d.doc;var a=d.doc.parentWindow||d.doc.defaultView;return"pageXOffset"in a?{x:a.pageXOffset,y:a.pageYOffset}:(a=f("quirks")?d.body(b):b.documentElement)&&{x:l.fixIeBiDiScrollLeft(a.scrollLeft||0,b),y:a.scrollTop||0}};l.getIeDocumentElementOffset=function(b){return{x:0,y:0}};l.fixIeBiDiScrollLeft=function(b,a){a=a||d.doc;var e=f("ie");if(e&&!l.isBodyLtr(a)){var k=f("quirks");a=k?d.body(a):a.documentElement;var g=d.global;6==e&&!k&&g.frameElement&&a.scrollHeight>a.clientHeight&&(b+=a.clientLeft);
return 8>e||k?b+a.clientWidth-a.scrollWidth:-b}return b};l.position=function(b,a){b=m.byId(b);var e=d.body(b.ownerDocument),k=b.getBoundingClientRect(),k={x:k.left,y:k.top,w:k.right-k.left,h:k.bottom-k.top};9>f("ie")&&(k.x-=f("quirks")?e.clientLeft+e.offsetLeft:0,k.y-=f("quirks")?e.clientTop+e.offsetTop:0);a&&(b=l.docScroll(b.ownerDocument),k.x+=b.x,k.y+=b.y);return k};l.getMarginSize=function(b,a){b=m.byId(b);a=l.getMarginExtents(b,a||h.getComputedStyle(b));b=b.getBoundingClientRect();return{w:b.right-
b.left+a.w,h:b.bottom-b.top+a.h}};l.normalizeEvent=function(b){"layerX"in b||(b.layerX=b.offsetX,b.layerY=b.offsetY);if(!("pageX"in b)){var a=b.target,a=a&&a.ownerDocument||document,e=f("quirks")?a.body:a.documentElement;b.pageX=b.clientX+l.fixIeBiDiScrollLeft(e.scrollLeft||0,a);b.pageY=b.clientY+(e.scrollTop||0)}};return l})},"com/huayun/webgis/gl/Buffer":function(){define(["exports","./BaseValue","../utils/Constant"],function(f,d,m){function h(a,g,c){this.context=a;var e=a.gl;this.buffer=e.createBuffer();
this.dynamicDraw=!!c;this.context.unbindVAO();a.bindElementBuffer.set(this.buffer);e.bufferData(e.ELEMENT_ARRAY_BUFFER,g.arrayBuffer,this.dynamicDraw?e.DYNAMIC_DRAW:e.STATIC_DRAW);this.dynamicDraw||delete g.arrayBuffer}h.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)};h.prototype.updateData=function(a){var g=this.context.gl;this.context.unbindVAO();this.bind();g.bufferSubData(g.ELEMENT_ARRAY_BUFFER,0,a.arrayBuffer)};h.prototype.destroy=function(){var a=this.context.gl;this.buffer&&
(a.deleteBuffer(this.buffer),delete this.buffer)};f.IndexBuffer=h;var c=function(a,g,c,e){this.length=g.length;this.attributes=c;this.itemSize=g.bytesPerElement;this.dynamicDraw=e;this.context=a;c=a.gl;this.buffer=c.createBuffer();a.bindVertexBuffer.set(this.buffer);c.bufferData(c.ARRAY_BUFFER,g.arrayBuffer,this.dynamicDraw?c.DYNAMIC_DRAW:c.STATIC_DRAW);this.dynamicDraw||delete g.arrayBuffer};c.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)};c.prototype.updateData=function(a){var g=
this.context.gl;this.bind();g.bufferSubData(g.ARRAY_BUFFER,0,a.arrayBuffer)};c.prototype.enableAttributes=function(a,g){for(var c=0;c<this.attributes.length;c++){var e=g.attributes[this.attributes[c].name];void 0!==e&&a.enableVertexAttribArray(e)}};c.prototype.setVertexAttribPointers=function(a,g,c){for(var e=0;e<this.attributes.length;e++){var b=this.attributes[e],k=g.attributes[b.name];void 0!==k&&a.vertexAttribPointer(k,b.components,a[m.AttributeType[b.type]],!1,this.itemSize,b.offset+this.itemSize*
(c||0))}};c.prototype.destroy=function(){var a=this.context.gl;this.buffer&&(a.deleteBuffer(this.buffer),delete this.buffer)};f.VertexBuffer=c;c=function(a,g,c){this.context=a;this.width=g;this.height=c;g=this.framebuffer=a.gl.createFramebuffer();this.colorAttachment=new d.ColorAttachment(a,g);this.depthAttachment=new d.DepthAttachment(a,g)};c.prototype.destroy=function(){var a=this.context.gl,g=this.colorAttachment.get();g&&a.deleteTexture(g);(g=this.depthAttachment.get())&&a.deleteRenderbuffer(g);
a.deleteFramebuffer(this.framebuffer)};f.Framebuffer=c})},"com/huayun/webgis/layers/support/EvaluationParameters":function(){define(["./ZoomHistory"],function(f){var d=function(d,h){this.zoom=d;h?(this.now=h.now,this.fadeDuration=h.fadeDuration,this.zoomHistory=h.zoomHistory,this.transition=h.transition):(this.fadeDuration=this.now=0,this.zoomHistory=new f,this.transition={})};d.prototype.crossFadingFactor=function(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/
this.fadeDuration,1)};d.prototype.getCrossfadeParameters=function(){var d=this.zoom,h=d-Math.floor(d),c=this.crossFadingFactor();return d>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:h+(1-h)*c}:{fromScale:.5,toScale:1,t:1-(1-c)*h}};return d})},"com/huayun/webgis/gl/TinySDF":function(){define([],function(){function f(d,c,a,g,l,e){this.fontSize=d||24;this.buffer=void 0===c?3:c;this.cutoff=g||.25;this.fontFamily=l||"sans-serif";this.fontWeight=e||"normal";this.radius=a||8;d=this.size=this.fontSize+
2*this.buffer;this.canvas=document.createElement("canvas");this.canvas.width=this.canvas.height=d;this.ctx=this.canvas.getContext("2d");this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily;this.ctx.textBaseline="middle";this.ctx.fillStyle="black";this.gridOuter=new Float64Array(d*d);this.gridInner=new Float64Array(d*d);this.f=new Float64Array(d);this.z=new Float64Array(d+1);this.v=new Uint16Array(d);this.middle=Math.round(d/2*(0<=navigator.userAgent.indexOf("Gecko/")?1.2:1))}function d(d,
c,a,g,l,e){for(var b=0;b<c;b++)m(d,b,c,a,g,l,e);for(b=0;b<a;b++)m(d,b*c,1,c,g,l,e)}function m(d,c,a,g,l,e,b){var k,n,p;e[0]=0;b[0]=-1E20;b[1]=1E20;for(k=0;k<g;k++)l[k]=d[c+k*a];k=1;for(p=n=0;k<g;k++){do p=e[n],p=(l[k]-l[p]+k*k-p*p)/(k-p)/2;while(p<=b[n--]);n+=2;e[n]=k;b[n]=p;b[n+1]=1E20}for(n=k=0;k<g;k++){for(;b[n+1]<k;)n++;p=e[n];d[c+k*a]=l[p]+(k-p)*(k-p)}}f.prototype.draw=function(h){this.ctx.clearRect(0,0,this.size,this.size);this.ctx.fillText(h,this.buffer,this.middle);h=this.ctx.getImageData(0,
0,this.size,this.size);for(var c=new Uint8ClampedArray(this.size*this.size),a=0;a<this.size*this.size;a++){var g=h.data[4*a+3]/255;this.gridOuter[a]=1===g?0:0===g?1E20:Math.pow(Math.max(0,.5-g),2);this.gridInner[a]=1===g?1E20:0===g?0:Math.pow(Math.max(0,g-.5),2)}d(this.gridOuter,this.size,this.size,this.f,this.v,this.z);d(this.gridInner,this.size,this.size,this.f,this.v,this.z);for(a=0;a<this.size*this.size;a++)c[a]=Math.max(0,Math.min(255,Math.round(255-255*((Math.sqrt(this.gridOuter[a])-Math.sqrt(this.gridInner[a]))/
this.radius+this.cutoff))));return c};f.prototype.measureText=function(d){return this.ctx.measureText(d)};return f})},"dojo/selector/_loader":function(){define(["../has","require"],function(f,d){if("undefined"!==typeof document){var m=document.createElement("div");f.add("dom-qsa2.1",!!m.querySelectorAll);f.add("dom-qsa3",function(){try{return m.innerHTML="\x3cp class\x3d'TEST'\x3e\x3c/p\x3e",1==m.querySelectorAll(".TEST:empty").length}catch(c){}})}var h;return{load:function(c,a,g,l){if(l&&l.isBuild)g();
else{l=d;c="default"==c?f("config-selectorEngine")||"css3":c;c="css2"==c||"lite"==c?"./lite":"css2.1"==c?f("dom-qsa2.1")?"./lite":"./acme":"css3"==c?f("dom-qsa3")?"./lite":"./acme":"acme"==c?"./acme":(l=a)&&c;if("?"==c.charAt(c.length-1)){c=c.substring(0,c.length-1);var e=!0}if(e&&(f("dom-compliant-qsa")||h))return g(h);l([c],function(b){"./lite"!=c&&(h=b);g(b)})}}}})},"com/huayun/webgis/layers/support/OverscaledTileID":function(){define(["./CanonicalTileID","./funcUtils"],function(f,d){var m=function(c,
a){this.wrap=c;this.canonical=a;this.key=d.calculateKey(c,a.z,a.x,a.y)},h=function(c,a,g,l,e){this.overscaledZ=c;this.wrap=a;this.canonical=new f(g,+l,+e);this.key=d.calculateKey(a,c,l,e)};h.prototype.equals=function(c){return this.overscaledZ===c.overscaledZ&&this.wrap===c.wrap&&this.canonical.equals(c.canonical)};h.prototype.scaledTo=function(c){var a=this.canonical.z-c;return c>this.canonical.z?new h(c,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new h(c,this.wrap,c,this.canonical.x>>
a,this.canonical.y>>a)};h.prototype.isChildOf=function(c){if(c.wrap!==this.wrap)return!1;var a=this.canonical.z-c.canonical.z;return 0===c.overscaledZ||c.overscaledZ<this.overscaledZ&&c.canonical.x===this.canonical.x>>a&&c.canonical.y===this.canonical.y>>a};h.prototype.children=function(c){if(this.overscaledZ>=c)return[new h(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];c=this.canonical.z+1;var a=2*this.canonical.x,g=2*this.canonical.y;return[new h(c,this.wrap,
c,a,g),new h(c,this.wrap,c,a+1,g),new h(c,this.wrap,c,a,g+1),new h(c,this.wrap,c,a+1,g+1)]};h.prototype.isLessThan=function(c){return this.wrap<c.wrap?!0:this.wrap>c.wrap?!1:this.overscaledZ<c.overscaledZ?!0:this.overscaledZ>c.overscaledZ?!1:this.canonical.x<c.canonical.x?!0:this.canonical.x>c.canonical.x?!1:this.canonical.y<c.canonical.y?!0:!1};h.prototype.wrapped=function(){return new h(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)};h.prototype.unwrapTo=function(c){return new h(this.overscaledZ,
c,this.canonical.z,this.canonical.x,this.canonical.y)};h.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)};h.prototype.toUnwrapped=function(){return new m(this.wrap,this.canonical)};h.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y};h.prototype.getTilePoint=function(c){return this.canonical.getTilePoint(new MercatorCoordinate(c.x-this.wrap,c.y))};return h})},"com/huayun/webgis/utils/Resource":function(){define(["exports",
"dojo/Deferred"],function(f,d){function m(b,a){var e=new Image;e.setAttribute("crossorigin","anonymous");e.onload=function(){a(null,e)};e.onerror=function(){return a(Error("\u52a0\u8f7d\u56fe\u7247\u5931\u8d25, \u56fe\u7247\u5730\u5740\u662f: "+b))};e.src=b;return{cancel:function(){e.src=""}}}function h(b,a){b.type="blob";return c(b,a)}function c(k,n){return!/^file:/.test(k.url)&&l&&e&&b&&e.prototype.hasOwnProperty("signal")?a(k,n):g(k,n)}function a(a,n){var k=new b,g=new e(a.url,{method:a.method||
"GET",body:a.body,credentials:a.credentials,headers:a.headers,signal:k.signal}),c=!1;"json"===a.type&&g.headers.set("Accept","application/json");l(g).then(function(b){return b.ok?("blob"===a.type?b.blob():"arrayBuffer"===a.type?b.arrayBuffer():"json"===a.type?b.json():b.text()).then(function(b){c=!0;n(null,b)}).catch(function(b){return n(b)}):n(Error(b.statusText+b.status+a.url))}).catch(function(b){n(b)});return{cancel:function(){c||k.abort()}}}function g(b,a){var e=new XMLHttpRequest;e.open(b.method||
"GET",b.url,!0);"arrayBuffer"===b.type&&(e.responseType="arraybuffer");"blob"===b.type&&(e.responseType="blob");for(var k in b.headers)e.setRequestHeader(k,b.headers[k]);"json"===b.type&&e.setRequestHeader("Accept","application/json");e.withCredentials="include"===b.credentials;e.onerror=function(){a(Error(e.statusText))};e.onload=function(){if((200<=e.status&&300>e.status||0===e.status)&&null!==e.response){var k=e.response;if("json"===b.type)try{k=JSON.parse(e.response)}catch(q){return a(q)}a(null,
k)}else a(Error(e.statusText+e.status+b.url))};e.send(b.body);return{cancel:function(){return e.abort()}}}var l=self?self.fetch:window.fetch,e=self?self.Request:window.Request,b=self?self.AbortController:window.AbortController;f.loadImage=function(b,a,e){return"function"===typeof a?m(b,a):a&&(a.headers||"POST"===a.method)?(a.url=b,h(a,function(a,k){if(a)e(a);else if(k){var n=new Image,g=g||webkitURL;n.onload=function(){e(null,n);g.revokeObjectURL(n.src)};n.onerror=function(){return e(Error("\u52a0\u8f7d\u56fe\u7247\u5931\u8d25, \u56fe\u7247\u5730\u5740\u662f: "+
b))};n.src=g.createObjectURL(k)}})):m(b,e)};f.loadImagePromise=function(b,a){var e=new d;if(a&&(a.headers||"POST"===a.method))return a.url=b,h(a,function(a,k){if(a)e.reject(a);else if(k){var n=new Image,g=g||webkitURL;n.onload=function(){e.resolve(n);g.revokeObjectURL(n.src)};n.onerror=function(){return e.reject(Error("\u52a0\u8f7d\u56fe\u7247\u5931\u8d25, \u56fe\u7247\u5730\u5740\u662f: "+b))};n.src=g.createObjectURL(k)}}),e;m(b,function(b,a){b?e.reject(b):a&&e.resolve(a)});return e};f.loadJson=
function(b,a,e){if("function"===typeof a)return c({url:b,type:"json"},a);a||(a={});a.url=b;a.type="json";return c(a,e)};f.loadArrayBuffer=function(b,a,e){if("function"===typeof a)return c({url:b,type:"arrayBuffer"},a);a||(a={});a.url=b;a.type="arrayBuffer";return c(a,e)};f.loadText=function(b,a,e){if("function"===typeof a)return c({url:b,type:"text"},a);a||(a={});a.url=b;a.type="text";return c(a,e)}})},"com/huayun/webgis/gl/Texture":function(){define([],function(){var f=function(d,f,h,c){this.context=
d;this.format=h;this.texture=d.gl.createTexture();this.update(f,c)};f.prototype.update=function(d,f,h){var c=d.width,a=d.height,g=(!this.size||this.size[0]!==c||this.size[1]!==a)&&!h,l=this.context,e=l.gl;this.useMipmap=!(!f||!f.useMipmap);e.bindTexture(e.TEXTURE_2D,this.texture);l.pixelStoreUnpackFlipY.set(!1);l.pixelStoreUnpack.set(1);l.pixelStoreUnpackPremultiplyAlpha.set(this.format===e.RGBA&&(!f||!1!==f.premultiply));g?(this.size=[c,a],d instanceof HTMLImageElement||d instanceof HTMLCanvasElement||
d instanceof HTMLVideoElement||d instanceof ImageData?e.texImage2D(e.TEXTURE_2D,0,this.format,this.format,e.UNSIGNED_BYTE,d):e.texImage2D(e.TEXTURE_2D,0,this.format,c,a,0,this.format,e.UNSIGNED_BYTE,d.data)):(h=h||{x:0,y:0},f=h.x,h=h.y,d instanceof HTMLImageElement||d instanceof HTMLCanvasElement||d instanceof HTMLVideoElement||d instanceof ImageData?e.texSubImage2D(e.TEXTURE_2D,0,f,h,e.RGBA,e.UNSIGNED_BYTE,d):e.texSubImage2D(e.TEXTURE_2D,0,f,h,c,a,e.RGBA,e.UNSIGNED_BYTE,d.data));this.useMipmap&&
this.isSizePowerOfTwo()&&e.generateMipmap(e.TEXTURE_2D)};f.prototype.bind=function(d,f,h){var c=this.context.gl;c.bindTexture(c.TEXTURE_2D,this.texture);h!==c.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(h=c.LINEAR);d!==this.filter&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,d),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,h||d),this.filter=d);f!==this.wrap&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,f),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,f),this.wrap=f)};f.prototype.isSizePowerOfTwo=
function(){return this.size[0]===this.size[1]&&0===Math.log(this.size[0])/Math.LN2%1};f.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture);this.texture=null};return f})},"com/huayun/webgis/gl/Program":function(){define(["./VertexArrayObject"],function(f){var d=function(d,h,c,a,g){g||(g=[]);var l=d.gl;this.program=l.createProgram();var e=c.defines(),b=e.concat(h.fragmentSource).join("\n");h=e.concat(h.vertexSource).join("\n");h=g.concat(h).join("\n");b=g.concat(b).join("\n");
g=l.createShader(l.FRAGMENT_SHADER);l.shaderSource(g,b);l.compileShader(g);(b=l.getShaderParameter(g,l.COMPILE_STATUS))||l.getShaderInfoLog(g);l.attachShader(this.program,g);e=l.createShader(l.VERTEX_SHADER);l.shaderSource(e,h);l.compileShader(e);(b=l.getShaderParameter(g,l.COMPILE_STATUS))||l.getShaderInfoLog(g);l.attachShader(this.program,e);b=c.layoutAttributes||[];for(h=0;h<b.length;h++)l.bindAttribLocation(this.program,h,b[h].name);l.linkProgram(this.program);this.numAttributes=l.getProgramParameter(this.program,
l.ACTIVE_ATTRIBUTES);this.attributes={};b={};for(h=0;h<this.numAttributes;h++)(g=l.getActiveAttrib(this.program,h))&&(this.attributes[g.name]=l.getAttribLocation(this.program,g.name));h=l.getProgramParameter(this.program,l.ACTIVE_UNIFORMS);for(g=0;g<h;g++)(e=l.getActiveUniform(this.program,g))&&(b[e.name]=l.getUniformLocation(this.program,e.name));this.fixedUniforms=a(d,b);this.binderUniforms=c.getUniforms(d,b)};d.prototype.draw=function(d,h,c,a,g,l,e,b,k,n,p,t,r,q,u,z){var m,y=d.gl;d.program.set(this.program);
d.setDepthMode(c);d.setStencilMode(a);d.setColorMode(g);d.setCullFace(l);for(var x in this.fixedUniforms)this.fixedUniforms[x].set(e[x]);q&&q.setUniforms(d,this.binderUniforms,t,{zoom:r});c=(m={},m[y.LINES]=2,m[y.TRIANGLES]=3,m[y.LINE_STRIP]=1,m)[h];m=0;for(p=p.get();m<p.length;m+=1)a=p[m],g=a.vaos||(a.vaos={}),(g[b]||(g[b]=new f)).bind(d,this,k,q?q.getPaintVertexBuffers():[],n,a.vertexOffset,u,z),y.drawElements(h,a.primitiveLength*c,y.UNSIGNED_SHORT,a.primitiveOffset*c*2)};d.prototype.draw2=function(d,
h,c,a,g,l,e,b,k,n,p,t,r,q,u,z){var m;a=d.gl;d.program.set(this.program);d.setDepthMode(c);d.setColorMode(g);d.setCullFace(l);for(var y in this.fixedUniforms)this.fixedUniforms[y].set(e[y]);q&&q.setUniforms(d,this.binderUniforms,t,{zoom:r});c=(m={},m[a.LINES]=2,m[a.TRIANGLES]=3,m[a.LINE_STRIP]=1,m)[h];m=0;for(p=p.get();m<p.length;m+=1)g=p[m],l=g.vaos||(g.vaos={}),(l[b]||(l[b]=new f)).bind(d,this,k,q?q.getPaintVertexBuffers():[],n,g.vertexOffset,u,z),a.drawElements(h,g.primitiveLength*c,a.UNSIGNED_SHORT,
g.primitiveOffset*c*2)};d.prototype.draw3=function(d,h,c,a,g,l,e,b,k,n,p,t,r,q,u,z){var m,y=d.gl;d.program.set(this.program);d.setDepthMode(c);d.setStencilMode(a);d.setColorMode(g);d.setCullFace(l);for(var x in this.fixedUniforms)this.fixedUniforms[x].set(e[x]);q&&q.setUniforms(d,this.binderUniforms,t,{zoom:r});c=(m={},m[y.LINES]=2,m[y.TRIANGLES]=3,m[y.LINE_STRIP]=1,m)[h];m=0;for(p=p.get();m<p.length;m+=1)a=p[m],g=a.vaos||(a.vaos={}),(g[b]||(g[b]=new f)).bind(d,this,k,q?q.getPaintVertexBuffers():
[],n,a.vertexOffset,u,z),q.setUniform(d,"fill-extrusion-base",this.binderUniforms[2].binding,0),q.setUniform(d,"fill-extrusion-height",this.binderUniforms[1].binding,20),y.drawElements(h,a.primitiveLength*c,y.UNSIGNED_SHORT,a.primitiveOffset*c*2),q.setUniform(d,"fill-extrusion-base",this.binderUniforms[2].binding,20),q.setUniform(d,"fill-extrusion-height",this.binderUniforms[1].binding,50),y.drawElements(h,a.primitiveLength*c,y.UNSIGNED_SHORT,a.primitiveOffset*c*2),q.setUniform(d,"fill-extrusion-base",
this.binderUniforms[2].binding,50),q.setUniform(d,"fill-extrusion-height",this.binderUniforms[1].binding,80),y.drawElements(h,a.primitiveLength*c,y.UNSIGNED_SHORT,a.primitiveOffset*c*2)};d.prototype.drawArray=function(d,h,c,a,g,l,e,b,k,n,p){d.program.set(this.program);d.setDepthMode(c);d.setStencilMode(a);d.setColorMode(g);d.setCullFace(l);for(var t in this.fixedUniforms)this.fixedUniforms[t].set(e[t]);h=0;for(p=p.get();h<p.length;h+=1)c=p[h],a=c.vaos||(c.vaos={}),(a[b]||(a[b]=new f)).bind(d,this,
k,[],n,c.vertexOffset,void 0,void 0)};return d})},"dojo/dom-prop":function(){define("exports ./_base/kernel ./sniff ./_base/lang ./dom ./dom-style ./dom-construct ./_base/connect".split(" "),function(f,d,m,h,c,a,g,l){function e(b){var a="";b=b.childNodes;for(var k=0,n;n=b[k];k++)8!=n.nodeType&&(a=1==n.nodeType?a+e(n):a+n.nodeValue);return a}var b={},k=1,n=d._scopeName+"attrid";m.add("dom-textContent",function(b,a,e){return"textContent"in e});f.names={"class":"className","for":"htmlFor",tabindex:"tabIndex",
readonly:"readOnly",colspan:"colSpan",frameborder:"frameBorder",rowspan:"rowSpan",textcontent:"textContent",valuetype:"valueType"};f.get=function(b,a){b=c.byId(b);var k=a.toLowerCase();a=f.names[k]||a;return"textContent"!=a||m("dom-textContent")?b[a]:e(b)};f.set=function(e,d,r){e=c.byId(e);if(2==arguments.length&&"string"!=typeof d){for(var p in d)f.set(e,p,d[p]);return e}p=d.toLowerCase();p=f.names[p]||d;if("style"==p&&"string"!=typeof r)return a.set(e,r),e;if("innerHTML"==p)return m("ie")&&e.tagName.toLowerCase()in
{col:1,colgroup:1,table:1,tbody:1,tfoot:1,thead:1,tr:1,title:1}?(g.empty(e),e.appendChild(g.toDom(r,e.ownerDocument))):e[p]=r,e;if("textContent"==p&&!m("dom-textContent"))return g.empty(e),e.appendChild(e.ownerDocument.createTextNode(r)),e;if(h.isFunction(r)){var t=e[n];t||(t=k++,e[n]=t);b[t]||(b[t]={});var z=b[t][p];if(z)l.disconnect(z);else try{delete e[p]}catch(v){}r?b[t][p]=l.connect(e,p,r):e[p]=null;return e}e[p]=r;return e}})},"dojo/errors/CancelError":function(){define(["./create"],function(f){return f("CancelError",
null,null,{dojoType:"cancel",log:!1})})},"com/huayun/webgis/data/bucket/FillBucketSimplify":function(){define("../ArrayType ../../gl/SegmentVector ../../utils/earcut ../../utils/utils ../../utils/Constant ../../utils/classifyRings".split(" "),function(f,d,m,h,c,a){function g(){this.layoutVertexArray=new f.StructArrayLayout2f8;this.indexArray=new f.StructArrayLayout3ui6;this.segments=new d}g.prototype.addFeatures=function(a,e){a=0;for(var b=this.features;a<b.length;a+=1){var k=b[a];this.addFeature(k,
k.geometry,k.index,e)}};g.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy())};g.prototype.addFeature=function(g){var e=0;for(g=a(g,c.layout.EARCUT_MAX_RINGS);e<g.length;e+=1){for(var b=g[e],k=0,n=0,l=b;n<l.length;n+=1)k+=l[n].length;for(var n=this.segments.prepareSegment(k,this.layoutVertexArray,this.indexArray),l=n.vertexLength,d=[],r=[],q=0,h=b;q<h.length;q+=1){var f=h[q];if(0!==f.length){f!==b[0]&&r.push(d.length/
2);this.layoutVertexArray.emplaceBack(f[0].x,f[0].y);d.push(f[0].x);d.push(f[0].y);for(var v=1;v<f.length;v++)this.layoutVertexArray.emplaceBack(f[v].x,f[v].y),d.push(f[v].x),d.push(f[v].y)}}b=m.earcut(d,r);for(d=0;d<b.length;d+=3)this.indexArray.emplaceBack(l+b[d],l+b[d+1],l+b[d+2]);n.vertexLength+=k;n.primitiveLength+=b.length/3}};g.prototype.upload=function(a){this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,[{name:"a_pos",type:"Float32",components:2,offset:0}]);this.indexBuffer=
a.createIndexBuffer(this.indexArray)};return g})},"com/huayun/webgis/Feature":function(){define(["./utils/Color"],function(f){return function(d){this.attributes=void 0===d.attributes||null===d.attributes?{}:d.attributes;this.type=d.type;this.geometry=d.geometry;this.attributes.hasOwnProperty("color")&&(d=this.attributes.color,d instanceof Array?this.attributes.color=d:(d=f.parse(d),this.attributes.color=[d.r,d.g,d.b,d.a]))}})},"dojo/_base/lang":function(){define(["./kernel","../has","../sniff"],function(f,
d){d.add("bug-for-in-skips-shadowed",function(){for(var b in{toString:1})return 0;return 1});var m=d("bug-for-in-skips-shadowed")?"hasOwnProperty valueOf isPrototypeOf propertyIsEnumerable toLocaleString toString constructor".split(" "):[],h=m.length,c=function(b,a,e){e||(e=b[0]&&f.scopeMap[b[0]]?f.scopeMap[b.shift()][1]:f.global);try{for(var k=0;k<b.length;k++){var n=b[k];if(!(n in e))if(a)e[n]={};else return;e=e[n]}return e}catch(r){}},a=Object.prototype.toString,g=function(b,a,e){return(e||[]).concat(Array.prototype.slice.call(b,
a||0))},l=/\{([^\}]+)\}/g,e={_extraNames:m,_mixin:function(b,a,e){var k,n,g,c={};for(k in a)n=a[k],k in b&&(b[k]===n||k in c&&c[k]===n)||(b[k]=e?e(n):n);if(d("bug-for-in-skips-shadowed")&&a)for(g=0;g<h;++g)k=m[g],n=a[k],k in b&&(b[k]===n||k in c&&c[k]===n)||(b[k]=e?e(n):n);return b},mixin:function(b,a){b||(b={});for(var k=1,g=arguments.length;k<g;k++)e._mixin(b,arguments[k]);return b},setObject:function(b,a,e){var k=b.split(".");b=k.pop();return(e=c(k,!0,e))&&b?e[b]=a:void 0},getObject:function(b,
a,e){return b?c(b.split("."),a,e):e},exists:function(b,a){return void 0!==e.getObject(b,!1,a)},isString:function(b){return"string"==typeof b||b instanceof String},isArray:Array.isArray||function(b){return"[object Array]"==a.call(b)},isFunction:function(b){return"[object Function]"===a.call(b)},isObject:function(b){return void 0!==b&&(null===b||"object"==typeof b||e.isArray(b)||e.isFunction(b))},isArrayLike:function(b){return!!b&&!e.isString(b)&&!e.isFunction(b)&&!(b.tagName&&"form"==b.tagName.toLowerCase())&&
(e.isArray(b)||isFinite(b.length))},isAlien:function(b){return b&&!e.isFunction(b)&&/\{\s*\[native code\]\s*\}/.test(String(b))},extend:function(b,a){for(var k=1,g=arguments.length;k<g;k++)e._mixin(b.prototype,arguments[k]);return b},_hitchArgs:function(b,a){var k=e._toArray(arguments,2),g=e.isString(a);return function(){var n=e._toArray(arguments),c=g?(b||f.global)[a]:a;return c&&c.apply(b||this,k.concat(n))}},hitch:function(b,a){if(2<arguments.length)return e._hitchArgs.apply(f,arguments);a||(a=
b,b=null);if(e.isString(a)){b=b||f.global;if(!b[a])throw['lang.hitch: scope["',a,'"] is null (scope\x3d"',b,'")'].join("");return function(){return b[a].apply(b,arguments||[])}}return b?function(){return a.apply(b,arguments||[])}:a},delegate:function(){function b(){}return function(a,n){b.prototype=a;a=new b;b.prototype=null;n&&e._mixin(a,n);return a}}(),_toArray:d("ie")?function(){function b(b,a,e){e=e||[];for(a=a||0;a<b.length;a++)e.push(b[a]);return e}return function(a){return(a.item?b:g).apply(this,
arguments)}}():g,partial:function(b){return e.hitch.apply(f,[null].concat(e._toArray(arguments)))},clone:function(b){if(!b||"object"!=typeof b||e.isFunction(b))return b;if(b.nodeType&&"cloneNode"in b)return b.cloneNode(!0);if(b instanceof Date)return new Date(b.getTime());if(b instanceof RegExp)return new RegExp(b);var a,n,g;if(e.isArray(b))for(a=[],n=0,g=b.length;n<g;++n)n in b&&(a[n]=e.clone(b[n]));else a=b.constructor?new b.constructor:{};return e._mixin(a,b,e.clone)},trim:String.prototype.trim?
function(b){return b.trim()}:function(b){return b.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},replace:function(b,a,n){return b.replace(n||l,e.isFunction(a)?a:function(b,k){return e.getObject(k,!1,a)})}};e.mixin(f,e);return e})},"com/huayun/webgis/views/3d/layers/GraphicLayerView3D":function(){define("dojo/_base/declare ./LayerView3D com/huayun/webgis/gl/mode com/huayun/webgis/data/ArrayType com/huayun/webgis/gl/SegmentVector com/huayun/webgis/gl/glUtils".split(" "),function(f,d,m,h,c,a){return f("com.huayun.webgis.views.3d.layers.GraphicLayerView3D",
[d],{constructor:function(a){f.safeMixin(this,a);this.visible=a.visible;this.renderer=a.renderer;this.glow=a.glow;a=new h.StructArrayLayout4i8;a.emplaceBack(-1,-1,0,0);a.emplaceBack(1,-1,1,0);a.emplaceBack(-1,1,0,1);a.emplaceBack(1,1,1,1);this.viewportBuffer=this.view.context.createVertexBuffer(a,[{name:"aPos",type:"Int16",components:4,offset:0}]);this.viewportSegments=c.simpleSegment(0,0,4,2);a=new h.StructArrayLayout3ui6;a.emplaceBack(0,1,2);a.emplaceBack(2,1,3);this.quadTriangleIndexBuffer=this.view.context.createIndexBuffer(a)},
_readyData:function(){},_render:function(){var a=this.view.viewpoint.targetZoom||this.view.viewpoint.level,c=!0;this.layer.minLevel&&a<this.layer.minLevel&&(c=!1);this.layer.maxLevel&&a>=this.layer.maxLevel&&(c=!1);if(this.visible&&c){this.view.currentLayer++;this.depthRangeFor3D=[0,1-(1+this.view.currentLayer)*this.view.numSublayers*this.view.depthEpsilon];for(var a=this.layer.graphics,e,b,c=[],k=0;k<a.length;k++)e=a[k],e.glow&&e.visible&&e.symbol&&c.push(e);try{if(0<c.length){var n=this.view.context,
d=this.view.width,t=this.view.height;this.bindFramebuffer(n,"renderFBO",d,t);var r=n.gl;r.clearColor(0,0,0,0);r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT);for(k=0;k<c.length;k++)e=c[k],b=e.symbol,this.renderer.drawGlow(this.view,e,e.feature.geometry,b,this);this.renderBlur(n,d,t);n.bindFramebuffer.set(null);n.viewport.set([0,0,d,t]);this.renderTextureToMap(n)}for(k=0;k<a.length;k++)e=a[k],b=e.symbol,e.visible&&b&&(this.renderer.draw(this.view,e,e.feature.geometry,b,this),e.addHook&&(e.addHook(e,
this),e.addHook=null))}catch(q){}}},bindFramebuffer:function(g,c,e,b){var k=this[c];if(!k||1<Math.abs(k.width-e)||1<Math.abs(k.height-b))k=this[c]=a.generateFBO(g,e,b);g.bindFramebuffer.set(k.framebuffer)},renderBlur:function(a,c,e){var b=a.gl,k=this.layer.glowRatio;c=Math.ceil(c/k);e=Math.ceil(e/k);this.bindFramebuffer(a,"blurFBO",c,e);a.activeTexture.set(b.TEXTURE0);b.bindTexture(b.TEXTURE_2D,this.renderFBO.colorAttachment.get());b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT);a.viewport.set([0,
0,c,e]);this.view.useProgramSimplify("gaussianBlur",{layoutAttributes:{name:"aPos",type:"Int16",components:4,offset:0}}).draw(a,b.TRIANGLES,m.DepthMode.disabled,m.StencilMode.disabled,m.ColorMode.alphaBlended,m.CullFaceMode.disabled,{uSize:[c,e],uTexture:0,uHorizontal:0,u_kernel:[.8,.15,.1,.05,.01]},this.id,this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments);this.bindFramebuffer(a,"blurFBO2",c,e);b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT);b.bindTexture(b.TEXTURE_2D,this.blurFBO.colorAttachment.get());
this.view.useProgramSimplify("gaussianBlur",{layoutAttributes:{name:"aPos",type:"Int16",components:4,offset:0}}).draw(a,b.TRIANGLES,m.DepthMode.disabled,m.StencilMode.disabled,m.ColorMode.alphaBlended,m.CullFaceMode.disabled,{uSize:[c,e],uTexture:0,uHorizontal:1,u_kernel:[.8,.15,.1,.05,.01]},this.id,this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},renderTextureToMap:function(a){var g=a.gl,e=this.blurFBO2;e&&(a.activeTexture.set(g.TEXTURE0),g.bindTexture(g.TEXTURE_2D,e.colorAttachment.get()),
this.view.useProgramSimplify("screen",{layoutAttributes:{name:"aPos",type:"Int16",components:4,offset:0}}).draw(a,g.TRIANGLES,m.DepthMode.disabled,m.StencilMode.disabled,m.ColorMode.alphaBlended,m.CullFaceMode.disabled,{uTexture:0},this.id,this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments))},refresh:function(){this.view.threeRender()},addGraphic:function(a){a.position||(a.position=this.view.viewpoint.center);a.symbol&&(a.added=!0,this.renderer.add(this.view,a,a.feature.geometry,
a.symbol),a.addHook=function(a,e){try{var b=[];e.renderer.calculateExtent(e.view,a,a.feature.geometry,a.symbol,b);e.view.insertItems(b)}catch(k){debugger}})},zoom:function(){this.visible&&this._render()},depthModeForSublayer:function(a,c,e){return new m.DepthMode(this.view.context.gl.LEQUAL,c,this.view.depthRangeFor3D)},setVisible:function(a){this.visible=a;this.view.threeRender()},beforeRemove:function(a){for(var c=this.layer.graphics,e=[],b=c.length-1;-1<b;b--){var k=[],n=c[b];this.renderer.calculateExtent(this.view,
n,n.feature.geometry,n.symbol,k);e.push(k[0])}a.graphicsIndex.removeItems(e)}})})},"com/huayun/webgis/layers/support/style/styleUtils":function(){define("exports ../expression/Formatted ../expression/Var ../../../utils/utils ../../../utils/Color ../../../geometry/Point".split(" "),function(f,d,m,h,c,a){function g(a){if("array"===a.kind){var b=g(a.itemType);return"number"===typeof a.N?"array\x3c"+b+", "+a.N+"\x3e":"value"===a.itemType.kind?"array":"array\x3c"+b+"\x3e"}return a.kind}function l(a,b){if("error"===
b.kind)return null;if("array"===a.kind){if("array"===b.kind&&(0===b.N&&"value"===b.itemType.kind||!l(a.itemType,b.itemType))&&("number"!==typeof a.N||a.N===b.N))return null}else{if(a.kind===b.kind)return null;if("value"===a.kind)for(var e=0,n=k;e<n.length;e+=1)if(!l(n[e],b))return null}return"Expected "+g(a)+" but found "+g(b)+" instead."}function e(a){if(null===a)return{kind:"null"};if("string"===typeof a)return{kind:"string"};if("boolean"===typeof a)return{kind:"boolean"};if("number"===typeof a)return{kind:"number"};
if(Array.isArray(a)){for(var b=a.length,k,n=0;n<a.length;n+=1){var c=e(a[n]);if(k){if(k!==c){k={kind:"value"};break}}else k=c}return{kind:"array",itemType:k||{kind:"value"},N:b}}return{kind:"object"}}function b(a){if(null===a||"string"===typeof a||"boolean"===typeof a||"number"===typeof a)return!0;if(Array.isArray(a)){for(var e=0;e<a.length;e+=1)if(!b(a[e]))return!1;return!0}if("object"===typeof a){for(e in a)if(!b(a[e]))return!1;return!0}return!1}var k=[{kind:"null"},{kind:"number"},{kind:"string"},
{kind:"boolean"},{kind:"color"},{kind:"formatted"},{kind:"object"},{kind:"array",itemType:{kind:"value"},N:void 0}];f.supportsInterpolation=function(a){return!!a.expression&&a.expression.interpolated};f.findStopLessThanOrEqualTo=function(a,b){for(var e=a.length-1,k=0,n=e,c=0,g,l;k<=n;)if(c=Math.floor((k+n)/2),g=a[c],l=a[c+1],g<=b){if(c===e||b<l)return c;k=c+1}else if(g>b)n=c-1;else throw Error("Input is not a number.");return 0};f.interpolationFactor=function(a,b,e,k){k-=e;a-=e;return 0===k?0:1===
b?a/k:(Math.pow(b,a)-1)/(Math.pow(b,k)-1)};f.interpolate=Object.freeze({number:h.number,color:function(a,b,e){return new c(h.number(a.r,b.r,e),h.number(a.g,b.g,e),h.number(a.b,b.b,e),h.number(a.a,b.a,e))},array:function(a,b,e){return a.map(function(a,k){return h.number(a,b[k],e)})}});f.toString=g;f.checkSubtype=l;f.supportsPropertyExpression=function(a){return"data-driven"===a["property-type"]||"cross-faded-data-driven"===a["property-type"]};f.supportsZoomExpression=function(a){return!!a.expression&&
-1<a.expression.parameters.indexOf("zoom")};f.translate=function(b,e,k,c,g){if(!e[0]&&!e[1])return b;e=a.convert(e)._mult(g);"viewport"===k&&e._rotate(-c);k=[];for(c=0;c<b.length;c++)k.push(b[c].sub(e));return k};f.getMaximumPaintValue=function(a,b,e){var k=b.paint.get(a).value;return"constant"===k.kind?k.value:e.programConfigurations.get(b.id).binders[a].maxValue};f.typeOf=e;f.isValue=b;f.toString$1=function(a){var b=typeof a;return null===a?"":"string"===b||"number"===b||"boolean"===b?String(a):
a instanceof c||a instanceof d?a.toString():JSON.stringify(a)};f.array=function(a,b){return{kind:"array",itemType:a,N:b}};f.success=function(a){return{result:"success",value:a}};f.error=function(a){return{result:"error",value:a}};f.emitValidationErrors=function(a,b){a=!1;if(b&&b.length)for(var e=0;e<b.length;e+=1)a=!0;return a};f.translateDistance=function(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}})},"com/huayun/webgis/layers/support/style/PossiblyEvaluatedPropertyValue":function(){define([],function(){var f=
function(d,f,h){this.property=d;this.value=f;this.parameters=h};f.prototype.isConstant=function(){return"constant"===this.value.kind};f.prototype.constantOr=function(d){return"constant"===this.value.kind?this.value.value:d};f.prototype.evaluate=function(d,f){return this.property.evaluate(this.value,this.parameters,d,f)};return f})},"com/huayun/webgis/data/Pbf":function(){define(["./ieee754"],function(f){function d(a){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(a)?a:new Uint8Array(a||0);this.type=
this.pos=0;this.length=this.buf.length}function m(a,b,e){var k=e.buf,n,g;g=k[e.pos++];n=(g&112)>>4;if(128>g)return c(a,n,b);g=k[e.pos++];n|=(g&127)<<3;if(128>g)return c(a,n,b);g=k[e.pos++];n|=(g&127)<<10;if(128>g)return c(a,n,b);g=k[e.pos++];n|=(g&127)<<17;if(128>g)return c(a,n,b);g=k[e.pos++];n|=(g&127)<<24;if(128>g)return c(a,n,b);g=k[e.pos++];if(128>g)return c(a,n|(g&1)<<31,b);throw Error("Expected varint not more than 10 bytes");}function h(a){return a.type===d.Bytes?a.readVarint()+a.pos:a.pos+
1}function c(a,b,e){return e?4294967296*b+(a>>>0):4294967296*(b>>>0)+(a>>>0)}function a(a,b,e){b=16383>=b?1:2097151>=b?2:268435455>=b?3:Math.floor(Math.log(b)/(7*Math.LN2));e.realloc(b);for(var k=e.pos-1;k>=a;k--)e.buf[k+b]=e.buf[k]}function g(a,b){for(var e=0;e<a.length;e++)b.writeVarint(a[e])}function l(a,b){for(var e=0;e<a.length;e++)b.writeSVarint(a[e])}function e(a,b){for(var e=0;e<a.length;e++)b.writeFloat(a[e])}function b(a,b){for(var e=0;e<a.length;e++)b.writeDouble(a[e])}function k(a,b){for(var e=
0;e<a.length;e++)b.writeBoolean(a[e])}function n(a,b){for(var e=0;e<a.length;e++)b.writeFixed32(a[e])}function p(a,b){for(var e=0;e<a.length;e++)b.writeSFixed32(a[e])}function t(a,b){for(var e=0;e<a.length;e++)b.writeFixed64(a[e])}function r(a,b){for(var e=0;e<a.length;e++)b.writeSFixed64(a[e])}function q(a,b){return(a[b]|a[b+1]<<8|a[b+2]<<16)+16777216*a[b+3]}function u(a,b,e){a[e]=b;a[e+1]=b>>>8;a[e+2]=b>>>16;a[e+3]=b>>>24}function z(a,b){return(a[b]|a[b+1]<<8|a[b+2]<<16)+(a[b+3]<<24)}d.Varint=0;
d.Fixed64=1;d.Bytes=2;d.Fixed32=5;var v=1/4294967296;d.prototype={destroy:function(){this.buf=null},readFields:function(a,b,e){for(e=e||this.length;this.pos<e;){var k=this.readVarint(),c=k>>3,g=this.pos;this.type=k&7;a(c,b,this);this.pos===g&&this.skip(k)}return b},readMessage:function(a,b){return this.readFields(a,b,this.readVarint()+this.pos)},readFixed32:function(){var a=q(this.buf,this.pos);this.pos+=4;return a},readSFixed32:function(){var a=z(this.buf,this.pos);this.pos+=4;return a},readFixed64:function(){var a=
q(this.buf,this.pos)+4294967296*q(this.buf,this.pos+4);this.pos+=8;return a},readSFixed64:function(){var a=q(this.buf,this.pos)+4294967296*z(this.buf,this.pos+4);this.pos+=8;return a},readFloat:function(){var a=f.read(this.buf,this.pos,!0,23,4);this.pos+=4;return a},readDouble:function(){var a=f.read(this.buf,this.pos,!0,52,8);this.pos+=8;return a},readVarint:function(a){var b=this.buf,e,k;k=b[this.pos++];e=k&127;if(128>k)return e;k=b[this.pos++];e|=(k&127)<<7;if(128>k)return e;k=b[this.pos++];e|=
(k&127)<<14;if(128>k)return e;k=b[this.pos++];e|=(k&127)<<21;if(128>k)return e;k=b[this.pos];return m(e|(k&15)<<28,a,this)},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var a=this.readVarint();return 1===a%2?(a+1)/-2:a/2},readBoolean:function(){return!!this.readVarint()},readString:function(){for(var a=this.readVarint()+this.pos,b=this.buf,e="",k=this.pos;k<a;){var c=b[k],g=null,n=239<c?4:223<c?3:191<c?2:1;if(k+n>a)break;var l,d,t;if(1===n)128>c&&(g=c);else if(2===n)l=
b[k+1],128===(l&192)&&(g=(c&31)<<6|l&63,127>=g&&(g=null));else if(3===n){if(l=b[k+1],d=b[k+2],128===(l&192)&&128===(d&192)&&(g=(c&15)<<12|(l&63)<<6|d&63,2047>=g||55296<=g&&57343>=g))g=null}else 4===n&&(l=b[k+1],d=b[k+2],t=b[k+3],128===(l&192)&&128===(d&192)&&128===(t&192)&&(g=(c&15)<<18|(l&63)<<12|(d&63)<<6|t&63,65535>=g||1114112<=g))&&(g=null);null===g?(g=65533,n=1):65535<g&&(g-=65536,e+=String.fromCharCode(g>>>10&1023|55296),g=56320|g&1023);e+=String.fromCharCode(g);k+=n}this.pos=a;return e},readBytes:function(){var a=
this.readVarint()+this.pos,b=this.buf.subarray(this.pos,a);this.pos=a;return b},readPackedVarint:function(a,b){if(this.type!==d.Bytes)return a.push(this.readVarint(b));var e=h(this);for(a=a||[];this.pos<e;)a.push(this.readVarint(b));return a},readPackedSVarint:function(a){if(this.type!==d.Bytes)return a.push(this.readSVarint());var b=h(this);for(a=a||[];this.pos<b;)a.push(this.readSVarint());return a},readPackedBoolean:function(a){if(this.type!==d.Bytes)return a.push(this.readBoolean());var b=h(this);
for(a=a||[];this.pos<b;)a.push(this.readBoolean());return a},readPackedFloat:function(a){if(this.type!==d.Bytes)return a.push(this.readFloat());var b=h(this);for(a=a||[];this.pos<b;)a.push(this.readFloat());return a},readPackedDouble:function(a){if(this.type!==d.Bytes)return a.push(this.readDouble());var b=h(this);for(a=a||[];this.pos<b;)a.push(this.readDouble());return a},readPackedFixed32:function(a){if(this.type!==d.Bytes)return a.push(this.readFixed32());var b=h(this);for(a=a||[];this.pos<b;)a.push(this.readFixed32());
return a},readPackedSFixed32:function(a){if(this.type!==d.Bytes)return a.push(this.readSFixed32());var b=h(this);for(a=a||[];this.pos<b;)a.push(this.readSFixed32());return a},readPackedFixed64:function(a){if(this.type!==d.Bytes)return a.push(this.readFixed64());var b=h(this);for(a=a||[];this.pos<b;)a.push(this.readFixed64());return a},readPackedSFixed64:function(a){if(this.type!==d.Bytes)return a.push(this.readSFixed64());var b=h(this);for(a=a||[];this.pos<b;)a.push(this.readSFixed64());return a},
skip:function(a){a&=7;if(a===d.Varint)for(;127<this.buf[this.pos++];);else if(a===d.Bytes)this.pos=this.readVarint()+this.pos;else if(a===d.Fixed32)this.pos+=4;else if(a===d.Fixed64)this.pos+=8;else throw Error("Unimplemented type: "+a);},writeTag:function(a,b){this.writeVarint(a<<3|b)},realloc:function(a){for(var b=this.length||16;b<this.pos+a;)b*=2;b!==this.length&&(a=new Uint8Array(b),a.set(this.buf),this.buf=a,this.length=b)},finish:function(){this.length=this.pos;this.pos=0;return this.buf.subarray(0,
this.length)},writeFixed32:function(a){this.realloc(4);u(this.buf,a,this.pos);this.pos+=4},writeSFixed32:function(a){this.realloc(4);u(this.buf,a,this.pos);this.pos+=4},writeFixed64:function(a){this.realloc(8);u(this.buf,a&-1,this.pos);u(this.buf,Math.floor(a*v),this.pos+4);this.pos+=8},writeSFixed64:function(a){this.realloc(8);u(this.buf,a&-1,this.pos);u(this.buf,Math.floor(a*v),this.pos+4);this.pos+=8},writeVarint:function(a){a=+a||0;if(268435455<a||0>a){var b,e;0<=a?(b=a%4294967296|0,e=a/4294967296|
0):(b=~(-a%4294967296),e=~(-a/4294967296),b^4294967295?b=b+1|0:(b=0,e=e+1|0));if(1.8446744073709552E19<=a||-1.8446744073709552E19>a)throw Error("Given varint doesn't fit into 10 bytes");this.realloc(10);a=b;this.buf[this.pos++]=a&127|128;a>>>=7;this.buf[this.pos++]=a&127|128;a>>>=7;this.buf[this.pos++]=a&127|128;a>>>=7;this.buf[this.pos++]=a&127|128;this.buf[this.pos]=a>>>7&127;this.buf[this.pos++]|=(e&7)<<4|((e>>>=3)?128:0);e&&(this.buf[this.pos++]=e&127|((e>>>=7)?128:0),e&&(this.buf[this.pos++]=
e&127|((e>>>=7)?128:0),e&&(this.buf[this.pos++]=e&127|((e>>>=7)?128:0),e&&(this.buf[this.pos++]=e&127|((e>>>=7)?128:0),e&&(this.buf[this.pos++]=e&127)))))}else this.realloc(4),this.buf[this.pos++]=a&127|(127<a?128:0),127>=a||(this.buf[this.pos++]=(a>>>=7)&127|(127<a?128:0),127>=a||(this.buf[this.pos++]=(a>>>=7)&127|(127<a?128:0),127>=a||(this.buf[this.pos++]=a>>>7&127)))},writeSVarint:function(a){this.writeVarint(0>a?2*-a-1:2*a)},writeBoolean:function(a){this.writeVarint(!!a)},writeString:function(b){b=
String(b);this.realloc(4*b.length);this.pos++;for(var e=this.pos,k=this.buf,g=this.pos,c=0,n,l;c<b.length;c++){n=b.charCodeAt(c);if(55295<n&&57344>n)if(l)if(56320>n){k[g++]=239;k[g++]=191;k[g++]=189;l=n;continue}else n=l-55296<<10|n-56320|65536,l=null;else{56319<n||c+1===b.length?(k[g++]=239,k[g++]=191,k[g++]=189):l=n;continue}else l&&(k[g++]=239,k[g++]=191,k[g++]=189,l=null);128>n?k[g++]=n:(2048>n?k[g++]=n>>6|192:(65536>n?k[g++]=n>>12|224:(k[g++]=n>>18|240,k[g++]=n>>12&63|128),k[g++]=n>>6&63|128),
k[g++]=n&63|128)}this.pos=g;k=this.pos-e;128<=k&&a(e,k,this);this.pos=e-1;this.writeVarint(k);this.pos+=k},writeFloat:function(a){this.realloc(4);f.write(this.buf,a,this.pos,!0,23,4);this.pos+=4},writeDouble:function(a){this.realloc(8);f.write(this.buf,a,this.pos,!0,52,8);this.pos+=8},writeBytes:function(a){var b=a.length;this.writeVarint(b);this.realloc(b);for(var e=0;e<b;e++)this.buf[this.pos++]=a[e]},writeRawMessage:function(b,e){this.pos++;var k=this.pos;b(e,this);b=this.pos-k;128<=b&&a(k,b,this);
this.pos=k-1;this.writeVarint(b);this.pos+=b},writeMessage:function(a,b,e){this.writeTag(a,d.Bytes);this.writeRawMessage(b,e)},writePackedVarint:function(a,b){b.length&&this.writeMessage(a,g,b)},writePackedSVarint:function(a,b){b.length&&this.writeMessage(a,l,b)},writePackedBoolean:function(a,b){b.length&&this.writeMessage(a,k,b)},writePackedFloat:function(a,b){b.length&&this.writeMessage(a,e,b)},writePackedDouble:function(a,e){e.length&&this.writeMessage(a,b,e)},writePackedFixed32:function(a,b){b.length&&
this.writeMessage(a,n,b)},writePackedSFixed32:function(a,b){b.length&&this.writeMessage(a,p,b)},writePackedFixed64:function(a,b){b.length&&this.writeMessage(a,t,b)},writePackedSFixed64:function(a,b){b.length&&this.writeMessage(a,r,b)},writeBytesField:function(a,b){this.writeTag(a,d.Bytes);this.writeBytes(b)},writeFixed32Field:function(a,b){this.writeTag(a,d.Fixed32);this.writeFixed32(b)},writeSFixed32Field:function(a,b){this.writeTag(a,d.Fixed32);this.writeSFixed32(b)},writeFixed64Field:function(a,
b){this.writeTag(a,d.Fixed64);this.writeFixed64(b)},writeSFixed64Field:function(a,b){this.writeTag(a,d.Fixed64);this.writeSFixed64(b)},writeVarintField:function(a,b){this.writeTag(a,d.Varint);this.writeVarint(b)},writeSVarintField:function(a,b){this.writeTag(a,d.Varint);this.writeSVarint(b)},writeStringField:function(a,b){this.writeTag(a,d.Bytes);this.writeString(b)},writeFloatField:function(a,b){this.writeTag(a,d.Fixed32);this.writeFloat(b)},writeDoubleField:function(a,b){this.writeTag(a,d.Fixed64);
this.writeDouble(b)},writeBooleanField:function(a,b){this.writeVarintField(a,!!b)}};return d})},"com/huayun/webgis/action/Action":function(){define(["dojo/_base/declare"],function(f){return f("com.huayun.webgis.action.Action",null,{id:"",isActive:!1,params:null,endActionMethod:null,constructor:function(d){this.id="";this.state=this.isActive=!1;this.endActionMethod=this.params=null;f.safeMixin(this,d)},doActive:function(d){}})})},"com/huayun/webgis/geometry/MapPoint":function(){define(["dojo/_base/declare",
"./Geometry"],function(f,d){return f("com.huayun.webgis.geometry.MapPoint",[d],{constructor:function(d,h,c){this.x=d;this.y=h;this.z=c;this.type="point"},toString:function(){return"x: "+this.x+" y: "+this.y+"z: "+this.z}})})},"com/huayun/webgis/facade/PowerFacade":function(){define(["dojo/_base/declare","dojo/request"],function(f,d){return f("com.huayun.webgis.facade.PowerFacade",null,{url:"",constructor:function(d){f.safeMixin(this,d)},getMapInfoData:function(f,h){var c=this.url.substring(0,this.url.indexOf("MapServer")+
9),a=this.url.indexOf("access");if(-1<a)var g=this.url.indexOf("\x26",a),a=-1<g?this.url.substring(a,g):this.url.substring(a),c=c+("?f\x3djson\x26"+a);else c+="?f\x3djson";a=dojoConfig.token;d.get(c,{handleAs:"json",headers:a?{"access-key":a}:{}}).then(function(a){f(a)},function(a){h(a)})}})})},"com/huayun/webgis/core/global":function(){define(["require","exports"],function(f,d){return"undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:{}})},"dojo/mouse":function(){define(["./_base/kernel",
"./on","./has","./dom","./_base/window"],function(f,d,m,h,c){function a(g,c){var e=function(a,e){return d(a,g,function(b){if(c)return c(b,e);if(!h.isDescendant(b.relatedTarget,a))return e.call(this,b)})};e.bubble=function(b){return a(g,function(a,e){var k=b(a.target),g=a.relatedTarget;if(k&&k!=(g&&1==g.nodeType&&b(g)))return e.call(k,a)})};return e}m.add("dom-quirks",c.doc&&"BackCompat"==c.doc.compatMode);m.add("events-mouseenter",c.doc&&"onmouseenter"in c.doc.createElement("div"));m.add("events-mousewheel",
c.doc&&"onmousewheel"in c.doc);c=m("dom-quirks")&&m("ie")||!m("dom-addeventlistener")?{LEFT:1,MIDDLE:4,RIGHT:2,isButton:function(a,c){return a.button&c},isLeft:function(a){return a.button&1},isMiddle:function(a){return a.button&4},isRight:function(a){return a.button&2}}:{LEFT:0,MIDDLE:1,RIGHT:2,isButton:function(a,c){return a.button==c},isLeft:function(a){return 0==a.button},isMiddle:function(a){return 1==a.button},isRight:function(a){return 2==a.button}};f.mouseButtons=c;f=m("events-mousewheel")?
"mousewheel":function(a,c){return d(a,"DOMMouseScroll",function(a){a.wheelDelta=-a.detail;c.call(this,a)})};return{_eventHandler:a,enter:a("mouseover"),leave:a("mouseout"),wheel:f,isLeft:c.isLeft,isMiddle:c.isMiddle,isRight:c.isRight}})},"com/huayun/webgis/symbols/LineSymbol":function(){define(["./Symbol","../utils/Color","./support/lineDashTexture"],function(f,d,m){var h=function(a){if(a){f.call(this,a);this.type="line";this.join=a.lineJoin||a.join||"miter";this.cap=a.lineCap||a.cap||"butt";var c=
d.parse(a.color||"#FF0000"),l=void 0===a.opacity?1:a.opacity;this.width=Number(a.width);this.length=a.length||8;this._color=[c.r,c.g,c.b,c.a];this.opacity=l;this.gapwidth=void 0===a.gapwidth?0:a.gapwidth;this.offset=void 0===a.offset?0:a.offset;this.minScale=a.minScale;this.maxScale=a.maxScale;"dash"===a.style?a.dasharray=[5,5]:"solid"===a.style&&(a.dasharray=null);if(a.dasharray){this.dasharray=c={from:a.dasharray,to:a.dasharray};l="round"===this.cap;a=m.lineAtlas.getDash(c.from,l);var c=m.lineAtlas.getDash(c.to,
l),l=2*a.width,e=1*c.width;this.widthA=l;this.widthB=e;var b=m.lineAtlas.width;this.lineAtlas=m.lineAtlas;this.scaleDirty=!0;this.uniforms={u_ratio:1,u_color:this.color,u_opacity:this.opacity,u_gapwidth:0,u_width:this.width,u_blur:0,u_offset:this.offset,u_floorwidth:1,u_patternscale_a:[1/l,-a.height/2],u_patternscale_b:[1/e,-c.height/2],u_sdfgamma:b/(256*Math.min(l,e))/2,u_tex_y_a:a.y,u_tex_y_b:c.y,u_mix:1,ratio:.5}}else this.uniforms={u_ratio:1,u_color:[c.r,c.g,c.b,c.a],u_blur:0,u_opacity:this.opacity,
u_gapwidth:this.gapwidth,u_offset:this.offset,u_width:this.width,ratio:.5}}};f&&(h.__proto__=f);h.prototype=Object.create(f&&f.prototype);h.prototype.constructor=h;h.prototype.setWidth=function(a){this.uniforms.u_width=a};h.prototype.clone=function(){var a=new h;a.type="line";a.join=this.join;a.cap=this.cap;a.width=this.width;a.length=this.length;a.opacity=this.opacity;a.gapwidth=this.gapwidth;a.offset=this.offset;a.minScale=this.minScale;a.maxScale=this.maxScale;this.dasharray&&(a.dasharray=this.dasharray,
a.scaleDirty=this.scaleDirty);a.uniforms=this.uniforms;a.color=this.color;a.fixedSize=this.fixedSize;a.fixed={isFixed:a.fixedSize,addratio:0};return a};var c={color:{configurable:!0}};c.color.set=function(a){a=d.parse(a);this._color=[a.r,a.g,a.b,a.a];this.uniforms&&(this.uniforms.u_color=this._color)};c.color.get=function(){return this._color};Object.defineProperties(h.prototype,c);return h})},"com/huayun/gl/shaders/tiffTerrain":function(){define(["exports","../../webgis/data/uniform"],function(f,
d){f.tiffTerrainVS="precision highp float;\n\nattribute vec3 a_pos;\nuniform mat4 u_matrix;\n\nvarying vec2 v_texture;\n\nvoid main() {\n    vec2 pos \x3d a_pos.xy * 8192.0;\n    float height \x3d a_pos.z;\n    gl_Position \x3d u_matrix * vec4(pos, height, 1.0);\n    v_texture \x3d a_pos.xy;\n}";f.tiffTerrainFS="precision mediump float;\n\nuniform sampler2D u_image;\nvarying vec2 v_texture;\n\nvoid main() {\n//    vec2 tex_location \x3d vec2(v_texture.x, 1.0 - v_texture.y);\n    if(v_texture.x \x3c 0.0 || v_texture.x \x3e 1.0 || v_texture.y \x3c 0.0 || v_texture.y \x3e 1.0) {\n        discard;\n    }\n    gl_FragColor \x3d texture2D(u_image, v_texture);\n}";
f.tifTerrainUniforms=function(f,h){return{u_matrix:new d.UniformMatrix4f(f,h.u_matrix),u_image:new d.Uniform1i(f,h.u_image)}}})},"com/huayun/webgis/gl/SegmentVector":function(){define([],function(){var f=function(d){void 0===d&&(d=[]);this.segments=d};f.prototype.prepareSegment=function(d,m,h,c){var a=this.segments[this.segments.length-1];if(!a||a.vertexLength+d>f.MAX_VERTEX_ARRAY_LENGTH||a.sortKey!==c)a={vertexOffset:m.length,primitiveOffset:h.length,vertexLength:0,primitiveLength:0},void 0!==c&&
(a.sortKey=c),this.segments.push(a);return a};f.prototype.get=function(){return this.segments};f.prototype.destroy=function(){for(var d=0,f=this.segments;d<f.length;d+=1){var h=f[d],c;for(c in h.vaos)h.vaos[c].destroy()}};f.simpleSegment=function(d,m,h,c){return new f([{vertexOffset:d,primitiveOffset:m,vertexLength:h,primitiveLength:c,vaos:{},sortKey:0}])};f.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1;return f})},"com/huayun/webgis/layers/support/CanonicalTileID":function(){define(["./funcUtils"],function(f){var d=
function(d,h,c){this.z=d;this.x=h;this.y=c;this.key=f.calculateKey(0,d,h,c)};d.prototype.equals=function(d){return this.z===d.z&&this.x===d.x&&this.y===d.y};d.prototype.url=function(d,h){return d[(this.x+this.y)%d.length].replace("{z}",String(Math.round(this.z))).replace("{x}",String(this.x)).replace("{y}",String("tms"===h?Math.pow(2,this.z)-this.y-1:this.y))};d.prototype.getTilePoint=function(d){};return d})},"com/huayun/webgis/layers/support/ZoomHistory":function(){define([],function(){var f=function(){this.first=
!0};f.prototype.update=function(d,f){var h=Math.floor(d);if(this.first)return this.first=!1,this.lastIntegerZoom=h,this.lastIntegerZoomTime=0,this.lastZoom=d,this.lastFloorZoom=h,!0;this.lastFloorZoom>h?(this.lastIntegerZoom=h+1,this.lastIntegerZoomTime=f):this.lastFloorZoom<h&&(this.lastIntegerZoom=h,this.lastIntegerZoomTime=f);return d!==this.lastZoom?(this.lastZoom=d,this.lastFloorZoom=h,!0):!1};return f})},"dojo/Evented":function(){define(["./aspect","./on"],function(f,d){function m(){}var h=
f.after;m.prototype={on:function(c,a){return d.parse(this,c,a,function(c,d){return h(c,"on"+d,a,!0)})},emit:function(c,a){var g=[this];g.push.apply(g,arguments);return d.emit.apply(d,g)}};return m})},"com/huayun/webgis/data/FeaturePositionMap":function(){define(["../utils/utils"],function(f){var d=function(){this.ids=[];this.positions=[];this.indexed=!1};d.prototype.add=function(d,h,c,a){this.ids.push(d);this.positions.push(h,c,a)};d.prototype.getPositions=function(d){for(var h=0,c=this.ids.length-
1;h<c;){var a=h+c>>1;this.ids[a]>=d?c=a:h=a+1}for(c=[];this.ids[h]===d;)c.push({index:this.positions[3*h],start:this.positions[3*h+1],end:this.positions[3*h+2]}),h++;return c};d.serialize=function(d,h){var c=new Float64Array(d.ids);d=new Uint32Array(d.positions);f.sort(c,d,0,c.length-1);h.push(c.buffer,d.buffer);return{ids:c,positions:d}};d.deserialize=function(f){var h=new d;h.ids=f.ids;h.positions=f.positions;h.indexed=!0;return h};return d})},"dojo/promise/instrumentation":function(){define(["./tracer",
"../has","../_base/lang","../_base/array"],function(f,d,m,h){function c(a,b,e){if(!a||!1!==a.log){var k="";a&&a.stack&&(k+=a.stack);b&&b.stack&&(k+="\n    ----------------------------------------\n    rejected"+b.stack.split("\n").slice(1).join("\n").replace(/^\s+/," "));e&&e.stack&&(k+="\n    ----------------------------------------\n"+e.stack);console.error(a,k)}}function a(a,b,e,k){b||c(a,e,k)}function g(a,c,g,d){h.some(e,function(b){if(b.error===a)return c&&(b.handled=!0),!0})||e.push({error:a,
rejection:g,handled:c,deferred:d,timestamp:(new Date).getTime()});b||(b=setTimeout(l,k))}function l(){var a=(new Date).getTime(),g=a-k;e=h.filter(e,function(a){return a.timestamp<g?(a.handled||c(a.error,a.rejection,a.deferred),!1):!0});b=e.length?setTimeout(l,e[0].timestamp+k-a):!1}d.add("config-useDeferredInstrumentation","report-unhandled-rejections");var e=[],b=!1,k=1E3;return function(b){var e=d("config-useDeferredInstrumentation");if(e){f.on("resolved",m.hitch(console,"log","resolved"));f.on("rejected",
m.hitch(console,"log","rejected"));f.on("progress",m.hitch(console,"log","progress"));var c=[];"string"===typeof e&&(c=e.split(","),e=c.shift());if("report-rejections"===e)b.instrumentRejected=a;else if("report-unhandled-rejections"===e||!0===e||1===e)b.instrumentRejected=g,k=parseInt(c[0],10)||k;else throw Error("Unsupported instrumentation usage \x3c"+e+"\x3e");}}})},"com/huayun/webgis/action/MapAction":function(){define(["dojo/_base/declare","./ActiveAction"],function(f,d){return f("com.huayun.webgis.action.MapAction",
[d],{view:null,constructor:function(d){this.view=null},doActive:function(d){}})})},"com/huayun/webgis/views/3d/layers/LayerView3D":function(){define(["../../layers/LayerView","../../../utils/extendClazz"],function(f,d){function m(d){f.call(this,d)}d(m,f);m.prototype.resize=function(){};f.prototype.beforeRemove=function(){};return m})},"dojo/global":function(){define(function(){return"undefined"!==typeof global&&"function"!==typeof global?global:"undefined"!==typeof window?window:"undefined"!==typeof self?
self:this})},"com/huayun/webgis/data/GraphicsIndex":function(){define(["custom/rbush"],function(f){function d(){this.tree=new f}d.prototype.load=function(d){this.tree.load(d)};d.prototype.insert=function(d){this.tree.insert(d)};d.prototype.query=function(d,h,c){for(var a=Infinity,g=Infinity,l=-Infinity,e=-Infinity,b=0;b<d.length;b+=1)var k=d[b],a=Math.min(a,k.x),g=Math.min(g,k.y),l=Math.max(l,k.x),e=Math.max(e,k.y);return this.tree.search({minX:a-h*c,minY:g-h*c,maxX:l+h*c,maxY:e+h*c})};d.prototype.checkExtentState=
function(d,h,c,a){return this.tree.search({minX:d,minY:h,maxX:c,maxY:a})};d.prototype.clear=function(){this.tree.clear()};d.prototype.removeItems=function(d){for(var h=0,c=d.length;h<c;h++)this.tree.remove(d[h],function(a,c){return a.id===c.id})};return d})},"com/huayun/webgis/renderer/LineRenderer":function(){define("./Renderer ../geometry/Point ../data/bucket/LineBucketSimplify ../gl/mode ../gl/programAttributes ../gl/programCache".split(" "),function(f,d,m,h,c,a){function g(){}f&&(g.__proto__=
f);g.prototype=Object.create(f&&f.prototype);g.prototype.constructor=g;var l=function(a,e,c){c=c.uniforms;e=e.position;c.u_matrix=a.viewpoint.getMatrixForPoint(e[0],e[1]);c.u_units_to_pixels=[a.viewpoint.width/2,-a.viewpoint.height/2];c.u_ratio=1/a.viewpoint.resolution;return c},e=function(a,e,c,g){var b=1/a.resolution,k=c.uniforms;e=e.position;var n="round"===c.cap;c=a.lineAtlas.getDash(g.from,n);g=a.lineAtlas.getDash(g.to,n);var n=2*c.width,d=1*g.width;k.u_matrix=a.viewpoint.getMatrixForPoint(e[0],
e[1],!1,!1,e[2]||0);k.u_units_to_pixels=[a.viewpoint.width/2,-a.viewpoint.height/2];k.u_ratio=b;k.u_image=0;k.u_patternscale_a=[b/n,-c.height/2];k.u_patternscale_b=[b/d,-g.height/2];k.u_sdfgamma=a.lineAtlas.width/(256*Math.min(n,d))/2;k.u_tex_y_a=c.y;k.u_tex_y_b=g.y;return k};g.prototype.add=function(a,e,c,g){if(a.ground)for(var b=c.path[0],k=0;k<b.length;k++){var n=b[k];if(n.base)if(n.base.posMidified)n.z+=n.base.z,n.base=null;else{e.needAdd=!0;a.threeRender();return}}e.needAdd=!1;k=e.position||
a.viewpoint.center||[0,0];b=k[0];k=k[1];if("multipolygon"===c.type){for(var n=[],d=0;d<c.polygons.length;d++){var l=this._addOnePathFeature(c.polygons[d],a,e,g,b,k);n.push(l)}e.buckets.push(n)}else l=this._addOnePathFeature(c,a,e,g,b,k),e.buckets.push(l);e.position=[b,k]};g.prototype._addOnePathFeature=function(a,e,c,g,l,r){c=a.path;a=[];for(var b=0;b<c.length;b++){var k=c[b],n=[];new d(-1,-1);for(var t=0;t<k.length;t++){var p=k[t];n.push(new d(p.x-l,p.y-r,p.z))}a.push(n)}l=new m;l.addFeature(a,g.join,
g.cap,2,1.05);l.upload(e.context);return l};g.prototype.draw=function(b,k,g,d,t,r,q){if(k.needAdd||0===k.buckets.length)if(this.add(b,k,g,d),k.needAdd)return;void 0===r&&(r=0);var n=b.context,p=n.gl,f;f=t?t.depthModeForSublayer(0,h.DepthMode.ReadWrite):new h.DepthMode(p.LEQUAL,h.DepthMode.ReadWrite,[.9,.9]);var m=h.ColorMode.alphaBlended;t=k.buckets;var x=d.dasharray;x&&(n.activeTexture.set(p.TEXTURE0),b.lineAtlas.bind(n));var w=a.useProgramSimplify(n,x?"basicLineSDF":"myline",c.basicLine),A=x?e(b,
k,d,x):l(b,k,d);q||(b=d.width*this.getRealScale(d.fixed,b.scale,d.minScale),A.u_width=1>b?1:b);A.u_color=d.color;d=t[r];"multipolygon"===g.type?d.forEach(function(a,b){w.draw(n,p.TRIANGLES,f,null,m,h.CullFaceMode.disabled,A,k.id+"-line"+r+"-"+b,a.layoutVertexBuffer,a.indexBuffer,a.segments)}):w.draw(n,p.TRIANGLES,f,null,m,h.CullFaceMode.disabled,A,k.id+"-line"+r,d.layoutVertexBuffer,d.indexBuffer,d.segments)};g.prototype.drawGlow=function(b,k,g,d,t,r,q){if(g=k.glow){void 0===r&&(r=0);var n=b.context,
p=n.gl;t=t?t.depthModeForSublayer(0,h.DepthMode.ReadWrite):new h.DepthMode(p.LEQUAL,h.DepthMode.ReadWrite,[.9,.9]);var f=h.ColorMode.alphaBlended,m=k.buckets,x=d.dasharray;x&&(n.activeTexture.set(p.TEXTURE0),b.lineAtlas.bind(n));var w=a.useProgramSimplify(n,x?"basicLineSDF":"basicLine",c.basicLine),x=x?e(b,k,d,x):l(b,k,d);q||(b=d.width*this.getRealScale(d.fixed,b.scale,d.minScale),x.u_width=1>b?1:b);b=m[r];x.u_color=g.color;w.draw(n,p.TRIANGLES,t,null,f,h.CullFaceMode.disabled,x,k.id+"-line"+r,b.layoutVertexBuffer,
b.indexBuffer,b.segments)}};g.prototype.calculateExtent=function(a,e,c,g,d,l){a=c.extent;d.push({id:e.id,g:e,minX:a.xmin,minY:a.ymin,maxX:a.xmax,maxY:a.ymax,symbol:g})};return g})},"dojo/aspect":function(){define([],function(){function f(a,c,e,b){var k=a[c],g="around"==c,d;if(g){var l=e(function(){return k.advice(this,arguments)});d={remove:function(){l&&(l=a=e=null)},advice:function(a,b){return l?l.apply(a,b):k.advice(a,b)}}}else d={remove:function(){if(d.advice){var b=d.previous,k=d.next;k||b?(b?
b.next=k:a[c]=k,k&&(k.previous=b)):delete a[c];a=e=d.advice=null}},id:a.nextId++,advice:e,receiveArguments:b};if(k&&!g)if("after"==c){for(;k.next&&(k=k.next););k.next=d;d.previous=k}else"before"==c&&(a[c]=d,d.next=k,k.previous=d);else a[c]=d;return d}function d(a){return function(c,e,b,k){var g=c[e],d;g&&g.target==c||(c[e]=d=function(){for(var a=d.nextId,b=arguments,e=d.before;e;)e.advice&&(b=e.advice.apply(this,b)||b),e=e.next;if(d.around)var k=d.around.advice(this,b);for(e=d.after;e&&e.id<a;){if(e.advice)if(e.receiveArguments)var c=
e.advice.apply(this,b),k=c===m?k:c;else k=e.advice.call(this,k,b);e=e.next}return k},g&&(d.around={advice:function(a,b){return g.apply(a,b)}}),d.target=c,d.nextId=d.nextId||0);c=f(d||g,a,b,k);b=null;return c}}var m,h=d("after"),c=d("before"),a=d("around");return{before:c,around:a,after:h}})},"dojo/_base/window":function(){define(["./kernel","./lang","../sniff"],function(f,d,m){var h={global:f.global,doc:f.global.document||null,body:function(c){c=c||f.doc;return c.body||c.getElementsByTagName("body")[0]},
setContext:function(c,a){f.global=h.global=c;f.doc=h.doc=a},withGlobal:function(c,a,g,d){var e=f.global;try{return f.global=h.global=c,h.withDoc.call(null,c.document,a,g,d)}finally{f.global=h.global=e}},withDoc:function(c,a,g,d){var e=h.doc,b=m("quirks"),k=m("ie"),n,l,t;try{return f.doc=h.doc=c,f.isQuirks=m.add("quirks","BackCompat"==f.doc.compatMode,!0,!0),m("ie")&&(t=c.parentWindow)&&t.navigator&&(n=parseFloat(t.navigator.appVersion.split("MSIE ")[1])||void 0,(l=c.documentMode)&&5!=l&&Math.floor(n)!=
l&&(n=l),f.isIE=m.add("ie",n,!0,!0)),g&&"string"==typeof a&&(a=g[a]),a.apply(g,d||[])}finally{f.doc=h.doc=e,f.isQuirks=m.add("quirks",b,!0,!0),f.isIE=m.add("ie",k,!0,!0)}}};d.mixin(f,h);return h})},"com/huayun/webgis/geometry/Multipoint":function(){define(["./Geometry","./Extent"],function(f,d){var m=function(c,a){f.call(this);this.type="multipoint";this.points=void 0===c?[]:c;this.spatialReference=a;this._extent=null};f&&(m.__proto__=f);m.prototype=Object.create(f&&f.prototype);m.prototype.constructor=
m;var h={length:{configurable:!1},extent:{configurable:!1}};h.length.get=function(){return this.points.length};h.extent.get=function(){if(!this._extent){var c=this.points,a,g,l,e;a=l=c[0].x;g=e=c[0].y;for(var b=c.length,k=0;k<b;k++){var n=c[k];a=Math.min(a,n.x);g=Math.min(g,n.y);l=Math.max(l,n.x);e=Math.max(e,n.y)}this._extent=new d(a,g,l,e)}return this._extent};m.prototype={setPoints:function(c){this.points=c;this._extent=null},addPoint:function(c){this.points.push(c);this._extent=null},update:function(c,
a){this.points.forEach(function(g){g.update(c,a)});this._extent=null}};Object.defineProperties(m.prototype,h);return m})},"com/huayun/webgis/utils/extendClazz":function(){define([],function(){return function(f,d){d&&(f.__proto__=d);f.prototype=Object.create(d&&d.prototype);f.prototype.constructor=f}})},"com/huayun/webgis/utils/earcut":function(){define(["exports"],function(f){function d(a,e,k){k=k||2;var n=e&&e.length,d=n?e[0]*k:a.length,t=m(a,0,d,k,!0),p=[];if(!t||t.next===t.prev)return p;var r,
f,z,v;if(n){var u=k,n=[],w,y,x;v=0;for(w=e.length;v<w;v++)y=e[v]*u,x=v<w-1?e[v+1]*u:a.length,y=m(a,y,x,u,!1),y===y.next&&(y.steiner=!0),n.push(b(y));n.sort(g);for(v=0;v<n.length;v++){e=n[v];u=t;if(u=l(e,u))e=q(u,e),h(e,e.next);t=h(t,t.next)}}if(a.length>80*k){r=z=a[0];f=n=a[1];for(u=k;u<d;u+=k)v=a[u],e=a[u+1],v<r&&(r=v),e<f&&(f=e),v>z&&(z=v),e>n&&(n=e);z=Math.max(z-r,n-f);z=0!==z?1/z:0}c(t,p,k,r,f,z);return p}function m(a,b,e,k,c){var g;if(c===0<y(a,b,e,k))for(c=b;c<e;c+=k)g=u(c,a[c],a[c+1],g);else for(c=
e-k;c>=b;c-=k)g=u(c,a[c],a[c+1],g);g&&p(g,g.next)&&(z(g),g=g.next);return g}function h(a,b){if(!a)return a;b||(b=a);var e;do if(e=!1,a.steiner||!p(a,a.next)&&0!==n(a.prev,a,a.next))a=a.next;else{z(a);a=b=a.prev;if(a===a.next)break;e=!0}while(e||a!==b);return b}function c(b,g,d,l,f,m,v){if(b){if(!v&&m){var u=b,w=u;do null===w.z&&(w.z=e(w.x,w.y,l,f,m)),w.prevZ=w.prev,w=w.nextZ=w.next;while(w!==u);w.prevZ.nextZ=null;w.prevZ=null;var u=w,y,x,A,B,C,E,F=1;do{w=u;A=u=null;for(B=0;w;){B++;x=w;for(y=C=0;y<
F&&(C++,x=x.nextZ,x);y++);for(E=F;0<C||0<E&&x;)0!==C&&(0===E||!x||w.z<=x.z)?(y=w,w=w.nextZ,C--):(y=x,x=x.nextZ,E--),A?A.nextZ=y:u=y,y.prevZ=A,A=y;w=x}A.nextZ=null;F*=2}while(1<B)}for(u=b;b.prev!==b.next;){w=b.prev;x=b.next;if(m)A=a(b,l,f,m);else a:if(A=b,B=A.prev,C=A,F=A.next,0<=n(B,C,F))A=!1;else{for(y=A.next.next;y!==A.prev;){if(k(B.x,B.y,C.x,C.y,F.x,F.y,y.x,y.y)&&0<=n(y.prev,y,y.next)){A=!1;break a}y=y.next}A=!0}if(A)g.push(w.i/d),g.push(b.i/d),g.push(x.i/d),z(b),u=b=x.next;else if(b=x,b===u){if(!v)c(h(b),
g,d,l,f,m,1);else if(1===v){v=g;u=d;w=b;do x=w.prev,A=w.next.next,!p(x,A)&&t(x,w,w.next,A)&&r(x,A)&&r(A,x)&&(v.push(x.i/u),v.push(w.i/u),v.push(A.i/u),z(w),z(w.next),w=b=A),w=w.next;while(w!==b);b=w;c(b,g,d,l,f,m,2)}else if(2===v)a:{v=b;do{for(u=v.next.next;u!==v.prev;){if(w=v.i!==u.i){w=v;x=u;A=void 0;if(A=w.next.i!==x.i&&w.prev.i!==x.i){A=void 0;b:{A=w;do{if(A.i!==w.i&&A.next.i!==w.i&&A.i!==x.i&&A.next.i!==x.i&&t(A,A.next,w,x)){A=!0;break b}A=A.next}while(A!==w);A=!1}A=!A}B=void 0;if(B=A&&r(w,x)&&
r(x,w)){A=w;B=!1;C=(w.x+x.x)/2;x=(w.y+x.y)/2;do A.y>x!==A.next.y>x&&A.next.y!==A.y&&C<(A.next.x-A.x)*(x-A.y)/(A.next.y-A.y)+A.x&&(B=!B),A=A.next;while(A!==w)}w=B}if(w){b=q(v,u);v=h(v,v.next);b=h(b,b.next);c(v,g,d,l,f,m);c(b,g,d,l,f,m);break a}u=u.next}v=v.next}while(v!==b)}break}}}}function a(a,b,c,g){var d=a.prev,l=a.next;if(0<=n(d,a,l))return!1;var t=d.x>a.x?d.x>l.x?d.x:l.x:a.x>l.x?a.x:l.x,q=d.y>a.y?d.y>l.y?d.y:l.y:a.y>l.y?a.y:l.y,p=e(d.x<a.x?d.x<l.x?d.x:l.x:a.x<l.x?a.x:l.x,d.y<a.y?d.y<l.y?d.y:
l.y:a.y<l.y?a.y:l.y,b,c,g);b=e(t,q,b,c,g);c=a.prevZ;for(g=a.nextZ;c&&c.z>=p&&g&&g.z<=b;){if(c!==a.prev&&c!==a.next&&k(d.x,d.y,a.x,a.y,l.x,l.y,c.x,c.y)&&0<=n(c.prev,c,c.next))return!1;c=c.prevZ;if(g!==a.prev&&g!==a.next&&k(d.x,d.y,a.x,a.y,l.x,l.y,g.x,g.y)&&0<=n(g.prev,g,g.next))return!1;g=g.nextZ}for(;c&&c.z>=p;){if(c!==a.prev&&c!==a.next&&k(d.x,d.y,a.x,a.y,l.x,l.y,c.x,c.y)&&0<=n(c.prev,c,c.next))return!1;c=c.prevZ}for(;g&&g.z<=b;){if(g!==a.prev&&g!==a.next&&k(d.x,d.y,a.x,a.y,l.x,l.y,g.x,g.y)&&0<=
n(g.prev,g,g.next))return!1;g=g.nextZ}return!0}function g(a,b){return a.x-b.x}function l(a,b){var e=b,c=a.x,g=a.y,n=-Infinity,d;do{if(g<=e.y&&g>=e.next.y&&e.next.y!==e.y){var l=e.x+(g-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(l<=c&&l>n){n=l;if(l===c){if(g===e.y)return e;if(g===e.next.y)return e.next}d=e.x<e.next.x?e:e.next}}e=e.next}while(e!==b);if(!d)return null;if(c===n)return d.prev;b=d;for(var l=d.x,t=d.y,q=Infinity,p,e=d.next;e!==b;)c>=e.x&&e.x>=l&&c!==e.x&&k(g<t?c:n,g,l,t,g<t?n:c,g,e.x,e.y)&&(p=
Math.abs(g-e.y)/(c-e.x),(p<q||p===q&&e.x>d.x)&&r(e,a)&&(d=e,q=p)),e=e.next;return d}function e(a,b,e,k,c){a=32767*(a-e)*c;b=32767*(b-k)*c;a=(a|a<<8)&16711935;a=(a|a<<4)&252645135;a=(a|a<<2)&858993459;b=(b|b<<8)&16711935;b=(b|b<<4)&252645135;b=(b|b<<2)&858993459;return(a|a<<1)&1431655765|((b|b<<1)&1431655765)<<1}function b(a){var b=a,e=a;do{if(b.x<e.x||b.x===e.x&&b.y<e.y)e=b;b=b.next}while(b!==a);return e}function k(a,b,e,k,c,g,n,d){return 0<=(c-n)*(b-d)-(a-n)*(g-d)&&0<=(a-n)*(k-d)-(e-n)*(b-d)&&0<=
(e-n)*(g-d)-(c-n)*(k-d)}function n(a,b,e){return(b.y-a.y)*(e.x-b.x)-(b.x-a.x)*(e.y-b.y)}function p(a,b){return a.x===b.x&&a.y===b.y}function t(a,b,e,k){return p(a,b)&&p(e,k)||p(a,k)&&p(e,b)?!0:0<n(a,b,e)!==0<n(a,b,k)&&0<n(e,k,a)!==0<n(e,k,b)}function r(a,b){return 0>n(a.prev,a,a.next)?0<=n(a,b,a.next)&&0<=n(a,a.prev,b):0>n(a,b,a.prev)||0>n(a,a.next,b)}function q(a,b){var e=new v(a.i,a.x,a.y),k=new v(b.i,b.x,b.y),c=a.next,g=b.prev;a.next=b;b.prev=a;e.next=c;c.prev=e;k.next=e;e.prev=k;g.next=k;k.prev=
g;return k}function u(a,b,e,k){a=new v(a,b,e);k?(a.next=k.next,a.prev=k,k.next.prev=a,k.next=a):(a.prev=a,a.next=a);return a}function z(a){a.next.prev=a.prev;a.prev.next=a.next;a.prevZ&&(a.prevZ.nextZ=a.nextZ);a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function v(a,b,e){this.i=a;this.x=b;this.y=e;this.nextZ=this.prevZ=this.z=this.next=this.prev=null;this.steiner=!1}function y(a,b,e,k){for(var c=0,g=e-k;b<e;b+=k)c+=(a[g]-a[b])*(a[b+1]+a[g+1]),g=b;return c}d.deviation=function(a,b,e,k){var c=b&&b.length,g=Math.abs(y(a,
0,c?b[0]*e:a.length,e));if(c)for(var c=0,n=b.length;c<n;c++)g-=Math.abs(y(a,b[c]*e,c<n-1?b[c+1]*e:a.length,e));for(c=b=0;c<k.length;c+=3){var n=k[c]*e,d=k[c+1]*e,l=k[c+2]*e;b+=Math.abs((a[n]-a[l])*(a[d+1]-a[n+1])-(a[n]-a[d])*(a[l+1]-a[n+1]))}return 0===g&&0===b?0:Math.abs((b-g)/g)};d.flatten=function(a){for(var b=a[0][0].length,e={vertices:[],holes:[],dimensions:b},k=0,c=0;c<a.length;c++){for(var g=0;g<a[c].length;g++)for(var n=0;n<b;n++)e.vertices.push(a[c][g][n]);0<c&&(k+=a[c-1].length,e.holes.push(k))}return e};
f.earcut=d})},"dojo/_base/event":function(){define(["./kernel","../on","../has","../dom-geometry"],function(f,d,m,h){if(d._fixEvent){var c=d._fixEvent;d._fixEvent=function(a,d){(a=c(a,d))&&h.normalizeEvent(a);return a}}var a={fix:function(a,c){return d._fixEvent?d._fixEvent(a,c):a},stop:function(a){m("dom-addeventlistener")||a&&a.preventDefault?(a.preventDefault(),a.stopPropagation()):(a=a||window.event,a.cancelBubble=!0,d._preventDefault.call(a))}};f.fixEvent=a.fix;f.stopEvent=a.stop;return a})},
"com/huayun/webgis/utils/animation":function(){define(["exports"],function(f){f.polyIn=function(d){return Math.pow(d,4)};f.polyOut=function(d){return 1-Math.pow(1-d,4)}})},"dojo/errors/create":function(){define(["../_base/lang"],function(f){return function(d,m,h,c){h=h||Error;var a=function(c){if(h===Error){Error.captureStackTrace&&Error.captureStackTrace(this,a);var g=Error.call(this,c),e;for(e in g)g.hasOwnProperty(e)&&(this[e]=g[e]);this.message=c;this.stack=g.stack}else h.apply(this,arguments);
m&&m.apply(this,arguments)};a.prototype=f.delegate(h.prototype,c);a.prototype.name=d;return a.prototype.constructor=a}})},"com/huayun/gl/shaders/linePattern":function(){define(["exports","../../webgis/data/uniform"],function(f,d){f.linePatternVS="precision highp float;\n\n#define scale 0.01587301\n// #define scale 0.007936508\n\nattribute vec3 a_pos;\nattribute vec4 a_data;\nattribute vec2 a_uv;\nattribute vec2 a_normal;\n\nuniform mat4 u_matrix;\nuniform mediump float u_ratio;\nuniform vec2 u_units_to_pixels;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying float v_gamma_scale;\nvarying highp float v_linesofar;\nvarying vec2 v_uv;\n\nuniform highp vec4 u_color;\nuniform lowp float u_blur;\nuniform lowp float u_opacity;\nuniform mediump float u_gapwidth;\nuniform lowp float u_offset;\nuniform mediump float u_width;\n\nvoid main() {\n    highp vec4 color \x3d u_color;\n    lowp float blur \x3d u_blur;\n    lowp float opacity \x3d u_opacity;\n    mediump float gapwidth \x3d u_gapwidth;\n    lowp float offset \x3d u_offset;\n    mediump float width \x3d u_width;\n\n    // the distance over which the line edge fades out.\n    // Retina devices need a smaller distance to avoid aliasing.\n    float ANTIALIASING \x3d 0.5;\n\n    vec2 a_extrude \x3d a_data.xy - 128.0;\n    float a_direction \x3d mod(a_data.z, 4.0) - 1.0;\n\n    v_linesofar \x3d (floor(a_data.z / 4.0) + a_data.w * 64.0) * 2.0;\n\n    vec2 pos \x3d a_pos.xy;\n\n    mediump vec2 normal \x3d a_normal;\n    normal.y \x3d normal.y * 2.0 - 1.0;\n    v_normal \x3d normal;\n\n    // these transformations used to be applied in the JS and native code bases.\n    // moved them into the shader for clarity and simplicity.\n    gapwidth \x3d gapwidth / 2.0;\n    float halfwidth \x3d width / 2.0;\n    offset \x3d -1.0 * offset;\n\n    float inset \x3d gapwidth + (gapwidth \x3e 0.0 ? ANTIALIASING : 0.0);\n    float outset \x3d gapwidth + halfwidth * (gapwidth \x3e 0.0 ? 2.0 : 1.0) + (halfwidth \x3d\x3d 0.0 ? 0.0 : ANTIALIASING);\n\n    // Scale the extrusion vector down to a normal and then up by the line width\n    // of this vertex.\n    mediump vec2 dist \x3d outset * a_extrude * scale;\n\n    // Calculate the offset when drawing a line that is to the side of the actual line.\n    // We do this by creating a vector that points towards the extrude, but rotate\n    // it when we're drawing round end points (a_direction \x3d -1 or 1) since their\n    // extrude vector points in another direction.\n    mediump float u \x3d 0.5 * a_direction;\n    mediump float t \x3d 1.0 - abs(u);\n    mediump vec2 offset2 \x3d offset * a_extrude * scale * normal.y * mat2(t, -u, u, t);\n\n    vec4 projected_extrude \x3d u_matrix * vec4(dist / u_ratio, 0.0, 0.0);\n    gl_Position \x3d u_matrix * vec4(pos + offset2 / u_ratio, a_pos.z, 1.0) + projected_extrude;\n\n    // calculate how much the perspective view squishes or stretches the extrude\n    float extrude_length_without_perspective \x3d length(dist);\n    float extrude_length_with_perspective \x3d length(projected_extrude.xy / gl_Position.w * u_units_to_pixels);\n    v_gamma_scale \x3d extrude_length_without_perspective / extrude_length_with_perspective;\n\n    v_width2 \x3d vec2(outset, inset);\n    v_uv \x3d a_uv;\n}";
f.linePatternFS="precision mediump float;\n\nvarying vec2 v_width2;\nvarying vec2 v_normal;\nvarying float v_gamma_scale;\nvarying vec2 v_uv;\nuniform sampler2D u_texture;\nuniform highp vec4 u_color;\nuniform lowp float u_opacity;\n\nvoid main() {\n    gl_FragColor \x3d texture2D(u_texture, v_uv);\n//    gl_FragColor \x3d vec4(1.0, 0.0, 1.0, 1.0);\n}";f.linePatternUniforms=function(f,h){return{u_matrix:new d.UniformMatrix4f(f,h.u_matrix),u_ratio:new d.Uniform1f(f,h.u_ratio),u_units_to_pixels:new d.Uniform2f(f,
h.u_units_to_pixels),u_blur:new d.Uniform1f(f,h.u_blur),u_opacity:new d.Uniform1f(f,h.u_opacity),u_gapwidth:new d.Uniform1f(f,h.u_gapwidth),u_offset:new d.Uniform1f(f,h.u_offset),u_width:new d.Uniform1f(f,h.u_width),u_texture:new d.Uniform1i(f,h.u_texture)}}})},"com/huayun/webgis/symbols/BaseSymbol":function(){define([],function(){return function(f){this.maxScale=this.minScale=0;this.fixedSize=f.fixedSize||f.isFixed||!0;this.fixed={isFixed:this.fixedSize,addratio:0}}})},"com/huayun/webgis/gl/glUtils":function(){define(["exports"],
function(f){f.generateFBO=function(d,f,h){var c=d.gl,a=c.createTexture();c.bindTexture(c.TEXTURE_2D,a);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.NEAREST);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.LINEAR);var g=d.createFramebuffer(f,h);c.texImage2D(c.TEXTURE_2D,0,c.RGBA,f,h,0,c.RGBA,d.extTextureHalfFloat?d.extTextureHalfFloat.HALF_FLOAT_OES:c.UNSIGNED_BYTE,
null);g.colorAttachment.set(a);return g}})},"com/huayun/webgis/layers/support/funcUtils":function(){define(["exports","com/huayun/webgis/geometry/Point2D","./expression/Interpolate","custom/gl-matrix-min"],function(f,d,m,h){function c(b,e,k,g){if(!(k>=g)){for(var n=b[k+g>>1],d=k-1,l=g+1;;){do d++;while(b[d]<n);do l--;while(b[l]>n);if(d>=l)break;a(b,d,l);a(e,3*d,3*l);a(e,3*d+1,3*l+1);a(e,3*d+2,3*l+2)}c(b,e,k,l);c(b,e,l+1,g)}}function a(a,b,e){var k=a[b];a[b]=a[e];a[e]=k}function g(a,b,e){var k=b[0];
b=b[1];a[0]=e[0]*k+e[4]*b+e[12];a[1]=e[1]*k+e[5]*b+e[13];a[3]=e[3]*k+e[7]*b+e[15];return a}function l(a,b,e,k){return a===p.horizontal&&Math.abs(e.y-b.y)>Math.abs(e.x-b.x)*k?{useVertical:!0}:(a===p.vertical?b.y<e.y:b.x>e.x)?{needsFlipping:!0}:null}function e(a,b){a=[a.x,a.y,0,1];g(a,a,b);b=a[3];return{point:new d(a[0]/b,a[1]/b),signedDistanceFromCamera:b}}function b(a,b,c,g,n,l,p,h,f,m,B,E,C){var t=g?a-b:a+b;a=0<t?1:-1;b=0;g&&(a*=-1,b=Math.PI);0>a&&(b+=Math.PI);p=g=0<a?h+p:h+p+1;for(var q=n,r=0,v=
0,t=Math.abs(t);r+v<=t;){g+=a;if(g<h||g>=f)return null;n=q;q=E[g];if(void 0===q){var q=new d(m.getx(g),m.gety(g)),z=e(q,B);0<z.signedDistanceFromCamera?q=E[g]=z.point:(z=g-a,z=0===r?l:new d(m.getx(z),m.gety(z)),q=k(z,q,n,t-r+1,B))}r+=v;v=n.dist(q)}h=(t-r)/v;l=q.sub(n);h=l.mult(h)._add(n);h._add(l._unit()._perp()._mult(c*a));return{point:h,angle:b+Math.atan2(q.y-n.y,q.x-n.x),tileDistance:C?{prevTileDistance:g-a===p?0:m.gettileUnitDistanceFromAnchor(g-a),lastSegmentViewportDistance:t-r}:null}}function k(a,
b,k,c,g){a=e(a.add(a.sub(b)._unit()),g).point;a=k.sub(a);return k.add(a._mult(c/a.mag()))}f.pick=function(a,b){for(var e={},k=0;k<b.length;k++){var c=b[k];c in a&&(e[c]=a[c])}return e};f.bindAll=function(a,b){a.forEach(function(a){b[a]&&(b[a]=b[a].bind(b))})};f.asyncAll=function(a,b,e){if(!a.length)return e(null,[]);var k=a.length,c=Array(a.length),g=null;a.forEach(function(a,n){b(a,function(a,b){a&&(g=a);c[n]=b;0===--k&&e(g,c)})})};f.calculateKey=function(a,b,e,k){return b+"/"+e+"/"+k};f.now=self.performance&&
self.performance.now?self.performance.now.bind(self.performance):Date.now.bind(Date);var n={"Latin-1 Supplement":function(a){return 128<=a&&255>=a},Arabic:function(a){return 1536<=a&&1791>=a},"Arabic Supplement":function(a){return 1872<=a&&1919>=a},"Arabic Extended-A":function(a){return 2208<=a&&2303>=a},"Hangul Jamo":function(a){return 4352<=a&&4607>=a},"Unified Canadian Aboriginal Syllabics":function(a){return 5120<=a&&5759>=a},Khmer:function(a){return 6016<=a&&6143>=a},"Unified Canadian Aboriginal Syllabics Extended":function(a){return 6320<=
a&&6399>=a},"General Punctuation":function(a){return 8192<=a&&8303>=a},"Letterlike Symbols":function(a){return 8448<=a&&8527>=a},"Number Forms":function(a){return 8528<=a&&8591>=a},"Miscellaneous Technical":function(a){return 8960<=a&&9215>=a},"Control Pictures":function(a){return 9216<=a&&9279>=a},"Optical Character Recognition":function(a){return 9280<=a&&9311>=a},"Enclosed Alphanumerics":function(a){return 9312<=a&&9471>=a},"Geometric Shapes":function(a){return 9632<=a&&9727>=a},"Miscellaneous Symbols":function(a){return 9728<=
a&&9983>=a},"Miscellaneous Symbols and Arrows":function(a){return 11008<=a&&11263>=a},"CJK Radicals Supplement":function(a){return 11904<=a&&12031>=a},"Kangxi Radicals":function(a){return 12032<=a&&12255>=a},"Ideographic Description Characters":function(a){return 12272<=a&&12287>=a},"CJK Symbols and Punctuation":function(a){return 12288<=a&&12351>=a},Hiragana:function(a){return 12352<=a&&12447>=a},Katakana:function(a){return 12448<=a&&12543>=a},Bopomofo:function(a){return 12544<=a&&12591>=a},"Hangul Compatibility Jamo":function(a){return 12592<=
a&&12687>=a},Kanbun:function(a){return 12688<=a&&12703>=a},"Bopomofo Extended":function(a){return 12704<=a&&12735>=a},"CJK Strokes":function(a){return 12736<=a&&12783>=a},"Katakana Phonetic Extensions":function(a){return 12784<=a&&12799>=a},"Enclosed CJK Letters and Months":function(a){return 12800<=a&&13055>=a},"CJK Compatibility":function(a){return 13056<=a&&13311>=a},"CJK Unified Ideographs Extension A":function(a){return 13312<=a&&19903>=a},"Yijing Hexagram Symbols":function(a){return 19904<=
a&&19967>=a},"CJK Unified Ideographs":function(a){return 19968<=a&&40959>=a},"Yi Syllables":function(a){return 40960<=a&&42127>=a},"Yi Radicals":function(a){return 42128<=a&&42191>=a},"Hangul Jamo Extended-A":function(a){return 43360<=a&&43391>=a},"Hangul Syllables":function(a){return 44032<=a&&55215>=a},"Hangul Jamo Extended-B":function(a){return 55216<=a&&55295>=a},"Private Use Area":function(a){return 57344<=a&&63743>=a},"CJK Compatibility Ideographs":function(a){return 63744<=a&&64255>=a},"Arabic Presentation Forms-A":function(a){return 64336<=
a&&65023>=a},"Vertical Forms":function(a){return 65040<=a&&65055>=a},"CJK Compatibility Forms":function(a){return 65072<=a&&65103>=a},"Small Form Variants":function(a){return 65104<=a&&65135>=a},"Arabic Presentation Forms-B":function(a){return 65136<=a&&65279>=a},"Halfwidth and Fullwidth Forms":function(a){return 65280<=a&&65519>=a}};f.isChar=n;f.allowsLetterSpacing=function(a){for(var b=0;b<a.length;b+=1){var e=a[b].charCodeAt(0);if(n.Arabic(e)||n["Arabic Supplement"](e)||n["Arabic Extended-A"](e)||
n["Arabic Presentation Forms-A"](e)||n["Arabic Presentation Forms-B"](e))return!1}return!0};f.charHasUprightVerticalOrientation=function(a){return 746===a||747===a?!0:4352>a?!1:n["Bopomofo Extended"](a)||n.Bopomofo(a)||n["CJK Compatibility Forms"](a)&&!(65097<=a&&65103>=a)||n["CJK Compatibility Ideographs"](a)||n["CJK Compatibility"](a)||n["CJK Radicals Supplement"](a)||n["CJK Strokes"](a)||n["CJK Symbols and Punctuation"](a)&&!(12296<=a&&12305>=a||12308<=a&&12319>=a)&&12336!==a||n["CJK Unified Ideographs Extension A"](a)||
n["CJK Unified Ideographs"](a)||n["Enclosed CJK Letters and Months"](a)||n["Hangul Compatibility Jamo"](a)||n["Hangul Jamo Extended-A"](a)||n["Hangul Jamo Extended-B"](a)||n["Hangul Jamo"](a)||n["Hangul Syllables"](a)||n.Hiragana(a)||n["Ideographic Description Characters"](a)||n.Kanbun(a)||n["Kangxi Radicals"](a)||n["Katakana Phonetic Extensions"](a)||n.Katakana(a)&&12540!==a||n["Halfwidth and Fullwidth Forms"](a)&&!(65288===a||65289===a||65293===a||65306<=a&&65310>=a||65339===a||65341===a||65343===
a||65371<=a&&65503>=a||65507===a||65512<=a&&65519>=a)||n["Small Form Variants"](a)&&!(65112<=a&&65118>=a||65123<=a&&65126>=a)||n["Unified Canadian Aboriginal Syllabics"](a)||n["Unified Canadian Aboriginal Syllabics Extended"](a)||n["Vertical Forms"](a)||n["Yijing Hexagram Symbols"](a)||n["Yi Syllables"](a)||n["Yi Radicals"](a)?!0:!1};f.sort=c;f.swap=a;f.supportsPropertyExpression=function(a){return"data-driven"===a["property-type"]||"cross-faded-data-driven"===a["property-type"]};f.paintAttributeNames=
function(a,b){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from"],"fill-pattern":["pattern_to","pattern_from"],"fill-extrusion-pattern":["pattern_to","pattern_from"]}[a]||
[a.replace(b+"-","").replace(/-/g,"_")]};f.getLabelPlaneMatrix=function(a,b,e,k,c){var g=h.mat4.create();b?(h.mat4.scale(g,g,[1/c,1/c,1]),e||h.mat4.rotateZ(g,g,k.angle)):h.mat4.multiply(g,k.labelPlaneMatrix,a);return g};f.getGlCoordMatrix=function(a,b,e,k,c){return b?(a=h.mat4.clone(a),h.mat4.scale(a,a,[c,c,1]),e||h.mat4.rotateZ(a,a,-k.angle),a):k.glCoordMatrix};f.translatePosMatrix=function(a,b,e,k,c,g,n){if(!e[0]&&!e[1])return a;if(g=c?"map"===k?g:0:"viewport"===k?-g:0)k=Math.sin(g),g=Math.cos(g),
e=[e[0]*g-e[1]*k,e[0]*k+e[1]*g];n=[c?e[0]:pixelsToTileUnits(b,e[0],n),c?e[1]:pixelsToTileUnits(b,e[1],n),0];b=new Float32Array(16);e=n[0];c=n[1];n=n[2];var d,l,p,q,r,h,f,t,m,v;a===b?(b[12]=a[0]*e+a[4]*c+a[8]*n+a[12],b[13]=a[1]*e+a[5]*c+a[9]*n+a[13],b[14]=a[2]*e+a[6]*c+a[10]*n+a[14],b[15]=a[3]*e+a[7]*c+a[11]*n+a[15]):(k=a[0],g=a[1],d=a[2],l=a[3],p=a[4],q=a[5],r=a[6],h=a[7],f=a[8],t=a[9],m=a[10],v=a[11],b[0]=k,b[1]=g,b[2]=d,b[3]=l,b[4]=p,b[5]=q,b[6]=r,b[7]=h,b[8]=f,b[9]=t,b[10]=m,b[11]=v,b[12]=k*e+
p*c+f*n+a[12],b[13]=g*e+q*c+t*n+a[13],b[14]=d*e+r*c+m*n+a[14],b[15]=l*e+h*c+v*n+a[15]);return b};f.evaluateSizeForZoom=function(a,b){var e=0,k=0;if("constant"===a.kind)k=a.layoutSize;else if("source"!==a.kind){var c=a.interpolationType,g=a.minZoom,n=a.maxZoom;c?(b=m.interpolationFactor(c,b,g,n),b=Math.min(1,Math.max(0,b))):b=0;"camera"===a.kind?k=a.minSize*(1-b)+a.maxSize*b:e=b}return{uSizeT:e,uSize:k}};f.xyTransformMat4=g;f.evaluateSizeForFeature=function(a,b,e){var k=b.uSizeT,c=e.lowerSize;e=e.upperSize;
return"source"===a.kind?c/256:"composite"===a.kind?c/256*(1-k)+e/256*k:b.uSize};f.transformMat4=function(a,b,e){var k=b[0],c=b[1],g=b[2];b=b[3];a[0]=e[0]*k+e[4]*c+e[8]*g+e[12]*b;a[1]=e[1]*k+e[5]*c+e[9]*g+e[13]*b;a[2]=e[2]*k+e[6]*c+e[10]*g+e[14]*b;a[3]=e[3]*k+e[7]*c+e[11]*g+e[15]*b;return a};var p={horizontal:1,vertical:2,horizontalOnly:3};f.placeGlyphsAlongLine=function(a,c,g,n,p,h,f,m,w,A,B,E,C,F){c/=24;var q=a.lineOffsetX*c,r=a.lineOffsetY*c;if(1<a.numGlyphs){p=a.glyphStartIndex+a.numGlyphs;var t=
a.lineStartIndex,v=a.lineStartIndex+a.lineLength,z;var u=a.glyphStartIndex+a.numGlyphs;z=a.lineStartIndex;var y=a.lineStartIndex+a.lineLength,x=m.getoffsetX(a.glyphStartIndex),u=m.getoffsetX(u-1);z=(x=b(c*x,q,r,g,B,E,a.segment,z,y,w,h,C,!1))?(z=b(c*u,q,r,g,B,E,a.segment,z,y,w,h,C,!1))?{first:x,last:z}:null:null;if(!z)return{notEnoughRoom:!0};y=e(z.first.point,f).point;f=e(z.last.point,f).point;if(n&&!g&&(F=l(a.writingMode,y,f,F)))return F;F=[z.first];for(n=a.glyphStartIndex+1;n<p-1;n++)F.push(b(c*
m.getoffsetX(n),q,r,g,B,E,a.segment,t,v,w,h,C,!1));F.push(z.last)}else{if(n&&!g&&(t=e(E,p).point,v=a.lineStartIndex+a.segment+1,v=new d(w.getx(v),w.gety(v)),n=e(v,p),p=0<n.signedDistanceFromCamera?n.point:k(E,v,t,1,p),F=l(a.writingMode,t,p,F)))return F;a=b(c*m.getoffsetX(a.glyphStartIndex),q,r,g,B,E,a.segment,a.lineStartIndex,a.lineStartIndex+a.lineLength,w,h,C,!1);if(!a)return{notEnoughRoom:!0};F=[a]}a=0;for(g=F;a<g.length;a+=1)w=g[a],h=A,m=w.point,w=w.angle,h.emplaceBack(m.x,m.y,w),h.emplaceBack(m.x,
m.y,w),h.emplaceBack(m.x,m.y,w),h.emplaceBack(m.x,m.y,w);return{}}})},"dojo/dom-class":function(){define(["./_base/lang","./_base/array","./dom"],function(f,d,m){function h(e){if("string"==typeof e||e instanceof String){if(e&&!a.test(e))return g[0]=e,g;e=e.split(a);e.length&&!e[0]&&e.shift();e.length&&!e[e.length-1]&&e.pop();return e}return e?d.filter(e,function(a){return a}):[]}var c,a=/\s+/,g=[""],l={};return c={contains:function(a,b){return 0<=(" "+m.byId(a).className+" ").indexOf(" "+b+" ")},
add:function(a,b){a=m.byId(a);b=h(b);var e=a.className,c,e=e?" "+e+" ":" ";c=e.length;for(var g=0,d=b.length,l;g<d;++g)(l=b[g])&&0>e.indexOf(" "+l+" ")&&(e+=l+" ");c<e.length&&(a.className=e.substr(1,e.length-2))},remove:function(a,b){a=m.byId(a);var e;if(void 0!==b){b=h(b);e=" "+a.className+" ";for(var c=0,g=b.length;c<g;++c)e=e.replace(" "+b[c]+" "," ");e=f.trim(e)}else e="";a.className!=e&&(a.className=e)},replace:function(a,b,k){a=m.byId(a);l.className=a.className;c.remove(l,k);c.add(l,b);a.className!==
l.className&&(a.className=l.className)},toggle:function(a,b,k){a=m.byId(a);if(void 0===k){b=h(b);for(var e=0,g=b.length,d;e<g;++e)d=b[e],c[c.contains(a,d)?"remove":"add"](a,d)}else c[k?"add":"remove"](a,b);return k}}})},"com/huayun/webgis/gl/mode":function(){define(["exports","../utils/Color","../utils/Constant"],function(f,d,m){var h=function(a,c,e){this.func=a;this.mask=c;this.range=e};h.ReadOnly=!1;h.ReadWrite=!0;h.disabled=new h(m.glConstant.ALWAYS,h.ReadOnly,[0,1]);h.opaque=new h(m.glConstant.LEQUAL,
h.ReadWrite,[0,1]);var c=function(a,c,e){this.enable=a;this.mode=c;this.frontFace=e};c.disabled=new c(!1,m.glConstant.BACK,m.glConstant.CCW);c.backCCW=new c(!0,m.glConstant.BACK,m.glConstant.CCW);var a=function(a,c,e){this.blendFunction=a;this.blendColor=c;this.mask=e};a.Replace=[m.glConstant.ONE,m.glConstant.ZERO];a.disabled=new a(a.Replace,d.transparent,[!1,!1,!1,!1]);a.unblended=new a(a.Replace,d.transparent,[!0,!0,!0,!0]);a.alphaBlended=new a([m.glConstant.ONE,m.glConstant.ONE_MINUS_SRC_ALPHA],
d.transparent,[!0,!0,!0,!0]);a.srcBlended=new a([m.glConstant.SRC_ALPHA,m.glConstant.ONE_MINUS_SRC_ALPHA],d.transparent,[!0,!0,!0,!0]);d=function(a,c,e,b,k,n){this.test=a;this.ref=c;this.mask=e;this.fail=b;this.depthFail=k;this.pass=n};d.disabled=new d({func:m.glConstant.ALWAYS,mask:0},0,0,m.glConstant.KEEP,m.glConstant.KEEP,m.glConstant.KEEP);f.DepthMode=h;f.CullFaceMode=c;f.ColorMode=a;f.StencilMode=d})},"com/huayun/webgis/geometry/MultiPolygon":function(){define(["./Geometry","./Extent"],function(f,
d){function m(a){var c=0,d=-1;a.polygons.forEach(function(a,b){a.area>c&&(c=a.area,d=b)});return d}var h=function(a,c){f.call(this);this.type="multipolygon";this.polygons=a;this.spatialReference=c;this._extent=null};f&&(h.__proto__=f);h.prototype=Object.create(f&&f.prototype);h.prototype.constructor=h;var c={length:{configurable:!1},extent:{configurable:!1}};c.length.get=function(){return this.path.length};c.extent.get=function(){if(!this._extent){for(var a=this.polygons,c=a[0],l=c.extent.xmin,e=
c.extent.ymin,b=c.extent.xmax,c=c.extent.ymax,k=1,n=a.length;k<n;k++){var p=a[k];l>p.extent.xmin&&(l=p.extent.xmin);e>p.extent.ymin&&(e=p.extent.ymin);b<p.extent.xmax&&(b=p.extent.xmax);c<p.extent.ymax&&(c=p.extent.ymax)}this._extent=new d(l,e,b,c)}return this._extent};h.prototype={setPath:function(a){this.path=a;this._extent=null},addRing:function(a){this.path.push(a);this._extent=null},update:function(a,c){this.path.forEach(function(g){g.forEach(function(e){e.update(a,c)})});this._extent=null},
_getMaxAreaIndex:function(){return m(this)},getMaxAreaPolygon:function(){var a=this._getMaxAreaIndex();return this.polygons[a]}};Object.defineProperties(h.prototype,c);return h})},"dojo/_base/sniff":function(){define(["./kernel","./lang","../sniff"],function(f,d,m){f._name="browser";d.mixin(f,{isBrowser:!0,isFF:m("ff"),isIE:m("ie"),isKhtml:m("khtml"),isWebKit:m("webkit"),isMozilla:m("mozilla"),isMoz:m("mozilla"),isOpera:m("opera"),isSafari:m("safari"),isChrome:m("chrome"),isMac:m("mac"),isIos:m("ios"),
isAndroid:m("android"),isWii:m("wii"),isQuirks:m("quirks"),isAir:m("air")});return m})},"com/huayun/webgis/geometry/Polygon":function(){define(["./Geometry","./Extent"],function(f,d){var m=function(c,a){f.call(this);this.type="polygon";this.path=c;this.spatialReference=a;this._area=this._extent=null};f&&(m.__proto__=f);m.prototype=Object.create(f&&f.prototype);m.prototype.constructor=m;var h={length:{configurable:!1},extent:{configurable:!1},area:{configurable:!1}};h.length.get=function(){return this.path.length};
h.extent.get=function(){if(!this._extent){var c=this.path,a,g,l,e;a=l=c[0][0].x;g=e=c[0][0].y;for(var b=c.length,k=0;k<b;k++)for(var n=c[k],p=n.length,h=0;h<p;h++){var r=n[h];a=Math.min(a,r.x);g=Math.min(g,r.y);l=Math.max(l,r.x);e=Math.max(e,r.y)}this._extent=new d(a,g,l,e)}return this._extent};h.area.get=function(){this._area||(this._area=this.calculateArea());return this._area};m.prototype={setPath:function(c){this.path=c;this._extent=null},addRing:function(c){this.path.push(c);this._extent=null},
update:function(c,a){this.path.forEach(function(g){g.forEach(function(g){g.update(c,a)})});this._extent=null},calculateArea:function(){for(var c=0,a=0,g=this.path,d=0;d<g.length;d++){for(var e=g[d],b=0;b<e.length-1;b++)c=.5*(e[b+1].x-e[b].x)*(e[b+1].y+e[b].y),a+=c;c=.5*(e[0].x-e[e.length-1].x)*(e[0].y+e[e.length-1].y);a+=c}return Math.abs(a)}};Object.defineProperties(m.prototype,h);return m})},"com/huayun/webgis/geometry/Point":function(){define(["./Geometry","./Extent"],function(f,d){var m=function(c,
a,g,d){f.call(this);Array.isArray(c)?(this.x=c[0],this.y=c[1],this.z=c[2]):(this.x=c,this.y=a,this.z=g);this.hasZ=void 0===this.z;this.type="point";this.spatialReference=d};f&&(m.__proto__=f);m.prototype=Object.create(f&&f.prototype);m.prototype.constructor=m;m.prototype={clone:function(){return new m(this.x,this.y,this.z)},add:function(c){return this.clone()._add(c)},sub:function(c){return this.clone()._sub(c)},multByPoint:function(c){return this.clone()._multByPoint(c)},divByPoint:function(c){return this.clone()._divByPoint(c)},
mult:function(c){return this.clone()._mult(c)},div:function(c){return this.clone()._div(c)},rotate:function(c){return this.clone()._rotate(c)},radianJS:function(c){return Math.atan2(-(c.y-this.y),c.x-this.x)},rotateAround:function(c,a){return this.clone()._rotateAround(c,a)},matMult:function(c){return this.clone()._matMult(c)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*
this.x+this.y*this.y)},equals:function(c){return this.x===c.x&&this.y===c.y},dist:function(c){return Math.sqrt(this.distSqr(c))},distSqr:function(c){var a=c.x-this.x;c=c.y-this.y;return a*a+c*c},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(c){return Math.atan2(this.y-c.y,this.x-c.x)},angleWith:function(c){return this.angleWithSep(c.x,c.y)},angleWithSep:function(c,a){return Math.atan2(this.x*a-this.y*c,this.x*c+this.y*a)},_matMult:function(c){var a=c[2]*this.x+c[3]*this.y;this.x=
c[0]*this.x+c[1]*this.y;this.y=a;return this},_add:function(c){this.x+=c.x;this.y+=c.y;return this},_sub:function(c){this.x-=c.x;this.y-=c.y;return this},_mult:function(c){this.x*=c;this.y*=c;return this},_div:function(c){this.x/=c;this.y/=c;return this},_multByPoint:function(c){this.x*=c.x;this.y*=c.y;return this},_divByPoint:function(c){this.x/=c.x;this.y/=c.y;return this},_unit:function(){this._div(this.mag());return this},_perp:function(){var c=this.y;this.y=this.x;this.x=-c;return this},_rotate:function(c){var a=
Math.cos(c);c=Math.sin(c);var g=c*this.x+a*this.y;this.x=a*this.x-c*this.y;this.y=g;return this},_rotateAround:function(c,a){var g=Math.cos(c);c=Math.sin(c);var d=a.y+c*(this.x-a.x)+g*(this.y-a.y);this.x=a.x+g*(this.x-a.x)-c*(this.y-a.y);this.y=d;return this},_round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this},radian:function(c){return Math.atan2(c.y-this.y,c.x-this.x)},calculateOtherPoint:function(c,a){return new m(Math.cos(a)*c+this.x,Math.sin(a)*c+this.y)},interpolate:function(c,
a){return new m(this.x*a+c.x*(1-a),this.y*a+c.y*(1-a))},calculateOtherPoint2:function(c,a){c=Math.atan2(c.y-this.y,c.x-this.x);return new m(this.x-a*Math.sin(c),this.y+a*Math.cos(c))},calculateOtherPoint3:function(c,a){c=Math.atan2(c.y-this.y,c.x-this.x);return new m(this.x+a*Math.sin(c),this.y-a*Math.cos(c))}};m.prototype.update=function(c,a,g){this.x+=c;this.y+=a;g&&(this.z+=g)};m.convert=function(c){return c instanceof m?c:Array.isArray(c)?new m(c[0],c[1]):c};var h={extent:{configurable:!1}};h.extent.get=
function(){this._extent||(this._extent=new d(this.x,this.y,this.x,this.y));return this._extent};Object.defineProperties(m.prototype,h);return m})},"com/huayun/webgis/gl/uniform":function(){define(["exports","../utils/Color"],function(f,d){var m=function(a,b){this.gl=a.gl;this.location=b},h=function(a){function b(b,e){a.call(this,b,e);this.current=0}a&&(b.__proto__=a);b.prototype=Object.create(a&&a.prototype);b.prototype.constructor=b;b.prototype.set=function(a){this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,
a))};return b}(m),c=function(a){function b(b,e){a.call(this,b,e);this.current=0}a&&(b.__proto__=a);b.prototype=Object.create(a&&a.prototype);b.prototype.constructor=b;b.prototype.set=function(a){this.current!==a&&(this.current=a,this.gl.uniform1f(this.location,a))};return b}(m),a=function(a){function b(b,e){a.call(this,b,e);this.current=[0,0]}a&&(b.__proto__=a);b.prototype=Object.create(a&&a.prototype);b.prototype.constructor=b;b.prototype.set=function(a){if(a[0]!==this.current[0]||a[1]!==this.current[1])this.current=
a,this.gl.uniform2f(this.location,a[0],a[1])};return b}(m),g=function(a){function b(b,e){a.call(this,b,e);this.current=[0,0,0]}a&&(b.__proto__=a);b.prototype=Object.create(a&&a.prototype);b.prototype.constructor=b;b.prototype.set=function(a){if(a[0]!==this.current[0]||a[1]!==this.current[1]||a[2]!==this.current[2])this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2])};return b}(m),l=function(a){function b(b,e){a.call(this,b,e);this.current=[0,0,0,0]}a&&(b.__proto__=a);b.prototype=Object.create(a&&
a.prototype);b.prototype.constructor=b;b.prototype.set=function(a){if(a[0]!==this.current[0]||a[1]!==this.current[1]||a[2]!==this.current[2]||a[3]!==this.current[3])this.current=a,this.gl.uniform4f(this.location,a[0],a[1],a[2],a[3])};return b}(m),e=function(a){function b(b,e){a.call(this,b,e);this.current=d.transparent}a&&(b.__proto__=a);b.prototype=Object.create(a&&a.prototype);b.prototype.constructor=b;b.prototype.set=function(a){if(a.r!==this.current.r||a.g!==this.current.g||a.b!==this.current.b||
a.a!==this.current.a)this.current=a,this.gl.uniform4f(this.location,a.r,a.g,a.b,a.a)};return b}(m),b=new Float32Array(16),m=function(a){function e(e,k){a.call(this,e,k);this.current=b}a&&(e.__proto__=a);e.prototype=Object.create(a&&a.prototype);e.prototype.constructor=e;e.prototype.set=function(a){if(a[12]!==this.current[12]||a[0]!==this.current[0])this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);else for(var b=1;16>b;b++)if(a[b]!==this.current[b]){this.current=a;this.gl.uniformMatrix4fv(this.location,
!1,a);break}};return e}(m);f.Uniform1f=c;f.Uniform1i=h;f.Uniform2f=a;f.Uniform3f=g;f.Uniform4f=l;f.UniformMatrix4f=m;f.UniformColor=e})},"dojo/throttle":function(){define([],function(){return function(f,d){var m=!0;return function(){m&&(m=!1,f.apply(this,arguments),setTimeout(function(){m=!0},d))}}})},"dojo/has":function(){define(["./global","require","module"],function(f,d,m){var h=d.has||function(){};h.add("dom-addeventlistener",!!document.addEventListener);h.add("touch","ontouchstart"in document||
"onpointerdown"in document&&0<navigator.maxTouchPoints||window.navigator.msMaxTouchPoints);h.add("touch-events","ontouchstart"in document);h.add("pointer-events","pointerEnabled"in window.navigator?window.navigator.pointerEnabled:"PointerEvent"in window);h.add("MSPointer",window.navigator.msPointerEnabled);h.add("touch-action",h("touch")&&h("pointer-events"));h.add("device-width",screen.availWidth||innerWidth);f=document.createElement("form");h.add("dom-attributes-explicit",0==f.attributes.length);
h.add("dom-attributes-specified-flag",0<f.attributes.length&&40>f.attributes.length);h.clearElement=function(c){c.innerHTML="";return c};h.normalize=function(c,a){var g=c.match(/[\?:]|[^:\?]*/g),d=0,e=function(a){var b=g[d++];if(":"==b)return 0;if("?"==g[d++]){if(!a&&h(b))return e();e(!0);return e(a)}return b||0};return(c=e())&&a(c)};h.load=function(c,a,g){c?a([c],g):g()};return h})},"com/huayun/webgis/Graphic":function(){define(["./utils/Color"],function(f){function d(c){this.id=void 0===c.id?m++:
c.id;this.feature=c.feature;this.layer=c.layer;this.symbol=c.symbol;this.position=null;this.visible=void 0===c.visible?!0:c.visible;this.selectEnabled=void 0===c.selectEnabled?!0:c.selectEnabled;this._glow=null;this.buckets=[];this.isChangeSymbol=!0;this.renderer=c.renderer?c.renderer:null}var m=0;d.prototype.setVisible=function(c){this.visible=value};d.prototype.updatePosition=function(c,a,g){this.position[0]+=c;this.position[1]+=a;g&&(this.position[2]+=g)};d.prototype.updateGeometry=function(c,
a){this.layer.indexNeedUpdate=!0;this.feature.geometry.update(c,a)};d.prototype.getAttribute=function(c){return this.feature.attributes.find(function(a){return a.name&&a.name.toLowerCase()===c.toLowerCase()})};d.prototype.updateSymbol=function(c){this.symbol=c;this.layer.layerView.view.threeRender()};d.prototype.reset=function(){var c=this.buckets;c&&c.forEach(function(a){a.destroy()});this.buckets=[]};d.prototype.destroy=function(){this.buckets.forEach(function(c){c.destroy()});this.buckets=[]};
var h={glow:{configurable:!0}};h.glow.set=function(c){c&&c.color?(this._glow=c,c=f.parse(c.color),this._glow.color=[c.r,c.g,c.b,c.a]):this._glow=null};h.glow.get=function(){return this._glow};Object.defineProperties(d.prototype,h);return d})},"com/huayun/webgis/symbols/support/glyphManager":function(){define("require exports dojo/request ../../gl/TinySDF ../../utils/image ../../data/Pbf".split(" "),function(f,d,m,h,c,a){function g(a,b,e){1===a?b.id=e.readVarint():2===a?b.bitmap=e.readBytes():3===
a?b.width=e.readVarint():4===a?b.height=e.readVarint():5===a?b.left=e.readSVarint():6===a?b.top=e.readSVarint():7===a&&(b.advance=e.readVarint())}function l(a,b,e){if(3===a){a=e.readMessage(g,{});e=a.width;var k=a.height,n=a.left,d=a.top,l=a.advance;b.push({id:a.id,bitmap:new c.AlphaImage({width:e+6,height:k+6},a.bitmap),metrics:{width:e,height:k,left:n,top:d,advance:l}})}}function e(a,b,e){1===a&&e.readMessage(l,b)}function b(b,k,c){k*=256;var g=k+255;b="font/{fontstack}/{range}.pbf".replace("{fontstack}",
b).replace("{range}",k+"-"+g);m(f.toUrl(b),{handleAs:"arraybuffer"}).then(function(b){var k={},g=0;for(b=(new a(b)).readFields(e,[]);g<b.length;g+=1){var n=b[g];k[n.id]=n}c(null,k)}).catch(function(a){c(a)})}var k={};d.getGlyphs=function(a){var b={},e;for(e in a){b[e]={};for(var g=0,n=a[e];g<n.length;g++){var d=n[g],l=k[e];l||(l=k[e]={glyphs:{}});var f=l.glyphs[d];if(!f){var f=l,m=e,l=d,x;var w=m,A=w.split(" ");x=1===A.length?{fontWeight:"400",fontFamily:w}:2===A.length?{fontWeight:A[0],fontFamily:A[1]}:
void 0;w=x.fontFamily;A=f.tinySDF;A||(A=x.fontWeight,/bold/i.test(m)?A="900":/medium/i.test(m)?A="500":/light/i.test(m)&&(A="200"),A=f.tinySDF=new h(24,1,8,.25,w,A));f=String.fromCharCode(l);f=255>l?{id:l,bitmap:new c.AlphaImage({width:26,height:26},A.draw(f)),metrics:{width:24,height:24,left:0,top:-8,advance:A.measureText(f).width}}:{id:l,bitmap:new c.AlphaImage({width:26,height:26},A.draw(f)),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}b[e][d]=f}}return b};d.getGlyphsFromPbf=function(a,
e){for(var c in a)for(var g=0,n=a[c];g<n.length;g++){var d=n[g],l=k[c];l||(l=k[c]={glyphs:{},requests:{}});var p=l.glyphs[d];if(p)e(null,{stack:c,id:d,glyph:p});else{var h=Math.floor(d/256),f=l.requests[h];f||(f=l.requests[h]=[],b(c,h,function(a,b){if(b)for(var e in b)l.glyphs[+e]=b[+e];e=0;for(var k=f;e<k.length;e+=1)(0,k[e])(a,b);delete l.requests[h]}));f.push(function(a,b){a?e(a):b&&e(null,{stack:c,id:d,glyph:b[d]||null})})}}}})},"com/huayun/webgis/data/struct":function(){define(["exports"],function(f){var d=
function(a,c){this._structArray=a;this._pos1=c*this.size;this._pos2=this._pos1/2;this._pos4=this._pos1/4;this._pos8=this._pos1/8},m=function(a){function c(){a.apply(this,arguments)}a&&(c.__proto__=a);c.prototype=Object.create(a&&a.prototype);c.prototype.constructor=c;var d={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},
key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},radialTextOffset:{configurable:!0}};d.anchorX.get=function(){return this._structArray.int16[this._pos2+0]};d.anchorX.set=function(a){this._structArray.int16[this._pos2+
0]=a};d.anchorY.get=function(){return this._structArray.int16[this._pos2+1]};d.anchorY.set=function(a){this._structArray.int16[this._pos2+1]=a};d.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]};d.rightJustifiedTextSymbolIndex.set=function(a){this._structArray.int16[this._pos2+2]=a};d.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]};d.centerJustifiedTextSymbolIndex.set=function(a){this._structArray.int16[this._pos2+
3]=a};d.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]};d.leftJustifiedTextSymbolIndex.set=function(a){this._structArray.int16[this._pos2+4]=a};d.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]};d.verticalPlacedTextSymbolIndex.set=function(a){this._structArray.int16[this._pos2+5]=a};d.key.get=function(){return this._structArray.uint16[this._pos2+6]};d.key.set=function(a){this._structArray.uint16[this._pos2+6]=a};d.textBoxStartIndex.get=
function(){return this._structArray.uint16[this._pos2+7]};d.textBoxStartIndex.set=function(a){this._structArray.uint16[this._pos2+7]=a};d.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+8]};d.textBoxEndIndex.set=function(a){this._structArray.uint16[this._pos2+8]=a};d.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]};d.iconBoxStartIndex.set=function(a){this._structArray.uint16[this._pos2+9]=a};d.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+
10]};d.iconBoxEndIndex.set=function(a){this._structArray.uint16[this._pos2+10]=a};d.featureIndex.get=function(){return this._structArray.uint16[this._pos2+11]};d.featureIndex.set=function(a){this._structArray.uint16[this._pos2+11]=a};d.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+12]};d.numHorizontalGlyphVertices.set=function(a){this._structArray.uint16[this._pos2+12]=a};d.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+13]};
d.numVerticalGlyphVertices.set=function(a){this._structArray.uint16[this._pos2+13]=a};d.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+14]};d.numIconVertices.set=function(a){this._structArray.uint16[this._pos2+14]=a};d.crossTileID.get=function(){return this._structArray.uint32[this._pos4+8]};d.crossTileID.set=function(a){this._structArray.uint32[this._pos4+8]=a};d.textBoxScale.get=function(){return this._structArray.float32[this._pos4+9]};d.textBoxScale.set=function(a){this._structArray.float32[this._pos4+
9]=a};d.radialTextOffset.get=function(){return this._structArray.float32[this._pos4+10]};d.radialTextOffset.set=function(a){this._structArray.float32[this._pos4+10]=a};Object.defineProperties(c.prototype,d);return c}(d);m.prototype.size=44;var h=function(a){function c(){a.apply(this,arguments)}a&&(c.__proto__=a);c.prototype=Object.create(a&&a.prototype);c.prototype.constructor=c;var d={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},
vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0}};d.anchorX.get=function(){return this._structArray.int16[this._pos2+0]};d.anchorX.set=function(a){this._structArray.int16[this._pos2+0]=a};d.anchorY.get=function(){return this._structArray.int16[this._pos2+
1]};d.anchorY.set=function(a){this._structArray.int16[this._pos2+1]=a};d.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]};d.glyphStartIndex.set=function(a){this._structArray.uint16[this._pos2+2]=a};d.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]};d.numGlyphs.set=function(a){this._structArray.uint16[this._pos2+3]=a};d.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]};d.vertexStartIndex.set=function(a){this._structArray.uint32[this._pos4+
2]=a};d.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]};d.lineStartIndex.set=function(a){this._structArray.uint32[this._pos4+3]=a};d.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]};d.lineLength.set=function(a){this._structArray.uint32[this._pos4+4]=a};d.segment.get=function(){return this._structArray.uint16[this._pos2+10]};d.segment.set=function(a){this._structArray.uint16[this._pos2+10]=a};d.lowerSize.get=function(){return this._structArray.uint16[this._pos2+
11]};d.lowerSize.set=function(a){this._structArray.uint16[this._pos2+11]=a};d.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]};d.upperSize.set=function(a){this._structArray.uint16[this._pos2+12]=a};d.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]};d.lineOffsetX.set=function(a){this._structArray.float32[this._pos4+7]=a};d.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]};d.lineOffsetY.set=function(a){this._structArray.float32[this._pos4+
8]=a};d.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]};d.writingMode.set=function(a){this._structArray.uint8[this._pos1+36]=a};d.hidden.get=function(){return this._structArray.uint8[this._pos1+37]};d.hidden.set=function(a){this._structArray.uint8[this._pos1+37]=a};d.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]};d.crossTileID.set=function(a){this._structArray.uint32[this._pos4+10]=a};Object.defineProperties(c.prototype,d);return c}(d);h.prototype.size=
44;var c=function(a){function c(){a.apply(this,arguments)}a&&(c.__proto__=a);c.prototype=Object.create(a&&a.prototype);c.prototype.constructor=c;var d={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},radius:{configurable:!0},signedDistanceFromAnchor:{configurable:!0},anchorPoint:{configurable:!0}};d.anchorPointX.get=
function(){return this._structArray.int16[this._pos2+0]};d.anchorPointX.set=function(a){this._structArray.int16[this._pos2+0]=a};d.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]};d.anchorPointY.set=function(a){this._structArray.int16[this._pos2+1]=a};d.x1.get=function(){return this._structArray.int16[this._pos2+2]};d.x1.set=function(a){this._structArray.int16[this._pos2+2]=a};d.y1.get=function(){return this._structArray.int16[this._pos2+3]};d.y1.set=function(a){this._structArray.int16[this._pos2+
3]=a};d.x2.get=function(){return this._structArray.int16[this._pos2+4]};d.x2.set=function(a){this._structArray.int16[this._pos2+4]=a};d.y2.get=function(){return this._structArray.int16[this._pos2+5]};d.y2.set=function(a){this._structArray.int16[this._pos2+5]=a};d.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]};d.featureIndex.set=function(a){this._structArray.uint32[this._pos4+3]=a};d.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]};d.sourceLayerIndex.set=
function(a){this._structArray.uint16[this._pos2+8]=a};d.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]};d.bucketIndex.set=function(a){this._structArray.uint16[this._pos2+9]=a};d.radius.get=function(){return this._structArray.int16[this._pos2+10]};d.radius.set=function(a){this._structArray.int16[this._pos2+10]=a};d.signedDistanceFromAnchor.get=function(){return this._structArray.int16[this._pos2+11]};d.signedDistanceFromAnchor.set=function(a){this._structArray.int16[this._pos2+
11]=a};d.anchorPoint.get=function(){return new pointGeometry(this.anchorPointX,this.anchorPointY)};Object.defineProperties(c.prototype,d);return c}(d);c.prototype.size=24;d=function(a){function c(){a.apply(this,arguments)}a&&(c.__proto__=a);c.prototype=Object.create(a&&a.prototype);c.prototype.constructor=c;var d={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};d.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]};d.featureIndex.set=
function(a){this._structArray.uint32[this._pos4+0]=a};d.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]};d.sourceLayerIndex.set=function(a){this._structArray.uint16[this._pos2+2]=a};d.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]};d.bucketIndex.set=function(a){this._structArray.uint16[this._pos2+3]=a};Object.defineProperties(c.prototype,d);return c}(d);d.prototype.size=8;f.SymbolInstanceStruct=m;f.PlacedSymbolStruct=h;f.CollisionBoxStruct=c;
f.FeatureIndexStruct=d})},"com/huayun/webgis/action/ActiveMapAction":function(){define(["dojo/_base/declare","./ActiveAction"],function(f,d){return f("com.huayun.webgis.action.ActiveMapAction",[d],{map:null,constructor:function(d){this.map=null},active:function(){},invalid:function(){},doActive:function(d){}})})},"com/huayun/webgis/request":function(){define("require dojo/_base/config dojo/Deferred dojo/_base/lang dojo/_base/url dojo/request dojo/io-query dojo/when ./core/global ./core/deferredUtils".split(" "),
function(f,d,m,h,c,a,g,l,e,b){function k(a){var b=g.objectToQuery(a.content),e=new Image;e.setAttribute("crossOrigin","Anonymous");var k=!1,c=new m(function(a){k=!0;e.onload=e.onerror=e.onabort=null;e.src=""}),b=function(a){e.onload=e.onerror=e.onabort=null;k||c.reject("fa")};e.onload=function(){e.onload=e.onerror=e.onabort=null;k||c.resolve(this)};e.onerror=b;e.onabort=b;e.alt="";e.src=a.url;return c.promise}function n(a,b,e,c){(function(a){a._pendingDfd=k(e);if(a._pendingDfd){var b=!!a._pendingDfd.response;
(a._pendingDfd.response||a._pendingDfd).then(function(a){if(!b||!a.data)return a},function(a){}).then(function(e){var k=b?e.data:e;e=b?e.getHeader.bind(e):t;a.ioArgs=a._pendingDfd&&a._pendingDfd.ioArgs;a.resolve({data:k,url:c.url,requestOptions:c.requestOptions,getHeader:e});a._pendingDfd=null},function(a){})}})(a);return a.promise}function p(a,e){var k=h.mixin({},e),g={url:a,requestOptions:h.mixin({},e)};k.handleAs=k.responseType;delete k.responseType;"array-buffer"===k.handleAs&&(k.handleAs="arraybuffer");
k.url=a;k.urlObj=new c(k.url);var d=b.makeDeferredCancellingPending();l().always(function(){n(d,!1,k,g)});return d.promise}var t=function(){return null};p._makeRequest=k;p._processRequest=n;p.setRequestPreCallback=function(a){};return p})},"com/huayun/webgis/gl/ImagePosition":function(){define([],function(){var f=function(d,h){var c=h.pixelRatio;h=h.version;this.paddedRect=d;this.pixelRatio=c;this.version=h},d={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};
d.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]};d.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]};d.tlbr.get=function(){return this.tl.concat(this.br)};d.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]};Object.defineProperties(f.prototype,d);return f})},"com/huayun/webgis/views/View":function(){define(["../../core/EventEmitter"],function(f){f=function(d){this.id=
d.id?d.id:"sceneView";this.container=d.container;this.map=d.map;this.extent=d.extent;this.allLayerViews=[]};f.prototype.refresh=function(){throw Error("\u65e0\u6cd5\u8c03\u7528\u57fa\u7c7bView\u7684refresh");};return f})},"com/huayun/webgis/core/deferredUtils":function(){define(["dojo/Deferred"],function(f){var d={makeDeferredCancellingPending:function(){var m={},h=d._dfdCanceller.bind(null,m),h=new f(h);return m.deferred=h},_dfdCanceller:function(d){d=d.deferred?d.deferred:d;d.canceled=!0;var h=
d._pendingDfd;d.isResolved()||!h||h.isResolved()||h.cancel();d._pendingDfd=null},_fixDfd:function(d){var h=d.then;d.then=function(c,a,g){if(c){var d=c;c=function(a){return a&&a._argsArray?d.apply(null,a):d(a)}}return h.call(this,c,a,g)};return d},_resDfd:function(d,h,c){var a=h.length;1===a?c?d.reject(h[0]):d.resolve(h[0]):1<a?(h._argsArray=!0,d.resolve(h)):d.resolve()}};return d})},"com/huayun/webgis/layers/Layer":function(){define([],function(){function f(d){d=void 0===d?{}:d;this.id=d.id||"layer";
this.opacity=void 0===d.opacity?1:d.opacity;this.visible=void 0===d.visible?!0:d.visible;this.selectEnabled=void 0===d.selectEnabled?!0:d.selectEnabled;this.controlEnabled=void 0===d.controlEnabled?!0:d.controlEnabled}f.prototype.createLayerView=function(d,f){throw Error("\u4e0d\u80fd\u8c03\u7528\u57fa\u7c7b\u7684createLayerView\u65b9\u6cd5");};f.prototype.refresh=function(){};f.prototype.setVisible=function(){};return f})},"com/huayun/webgis/action/measurements/LengthMeasurement":function(){define("dojo/_base/declare dojo/on dojo/dom dojo/query dojo/topic dojo/dom-class dojo/throttle dojo/dom-construct dojo/_base/window ../../geometry/Polyline ../../Graphic ../../Feature ../../symbols/LineSymbol ../../symbols/PointSymbol ../../symbols/TextSymbol ../../geometry/Point2D ../ActiveMapAction".split(" "),
function(f,d,m,h,c,a,g,l,e,b,k,n,p,t,r,q,u){return f("com.huayun.webgis.action.draws.LineDraw",[u],{constructor:function(a){this.view=a.view;this.view.selectEnabled=!1;this.isActive=!0;this.drawLayer=this.view.map.findLayerById("drawLayer");this._lastPoint=this._mouseClickMove=this._dblMouseClick=this._mouseClick=null;this._vertexArr=[];this.cacheLength=0;this._lineGraphicList=[];this._preClick=this._isNew=!0;this._lineGraphicHash={};this._symbol=new p({color:"#009688",width:3});this._vertexSymbol=
new t({radius:5,color:"#0000FF",pitchWithMap:!1,scaleWithPitch:!1});this._currentGraphic=null;var b=this;c.subscribe("measurement-delete",function(a){(a=b._lineGraphicHash[a])&&0<a.length&&a.forEach(function(a){b.drawLayer.removeGraphic(a)})});c.subscribe("frameUpdate",function(){this.toLocal()}.bind(this))},active:function(){this.state||(this.state=!0,this.view.panEnabled=!1,this.view.selectEnabled=!1,this._mouseClick=d(this.view.domNode,"click",this._onMouseClick.bind(this)),this._dblMouseClick=
d(this.view.domNode,"dblclick",this._onDoubleMouseClick.bind(this)),a.add(this.view.domNode,"draw-cursor-style"))},_onMouseClick:function(a){a.preventDefault();a.stopPropagation();var b=this.view.screenToGeometry(a.x,a.y);this._mouseClickMove||(this._mouseClickMove=d(this.view.domNode,"mousemove",g(this._onMouseMove.bind(this),20)));null===this._lastPoint?(this._lineGraphicList=[],this.doAction(b)):a.x!==this._lastPoint.x&&a.y!==this._lastPoint.y&&this.doAction(b);this._lastPoint={x:a.x,y:a.y}},_onMouseMove:function(a){a=
this.view.screenToGeometry(a.x,a.y);this.drawLayer.removeGraphic(this._currentGraphic);var e=new b,c=new n({attribute:null,geometry:e}),c=new k({feature:c,symbol:this._symbol});this._preClick?(this._vertexArr.push(new q(a.x,a.y)),this._preClick=!1):this._vertexArr.splice(this._vertexArr.length-1,1,new q(a.x,a.y));e.setPath([this._vertexArr]);this._currentGraphic=c;this.drawLayer.addGraphic(c);this.drawLayer.layerView.view.threeRender()},_onDoubleMouseClick:function(a){a.preventDefault();a.stopPropagation();
this._currentGraphic.rg=this._lineGraphicList;this.showDeleButton(a,this._currentGraphic.id);this.invalid()},showDeleButton:function(a,b){var e=this,k=l.create("div",{className:"graphicClose",style:{width:"8px",height:"8px",position:"absolute",color:"red",border:"2px solid red",display:"block",cursor:"pointer",fontSize:"4px",margin:"0 auto",lineHeight:"8px",backgroundColor:"white"},innerHTML:"\u00d7"},document.body);d(k,"click",function(a){a=e.drawLayer.graphics;for(var k,c=0,g=a.length;c<g&&(k=a[c],
k.id!==b);c++);k&&(e.drawLayer.removeGraphic(k),k.rg.forEach(function(a){e.drawLayer.removeGraphic(a)}),l.destroy(this))});k.style.left=a.clientX+5+"px";k.style.top=a.clientY+5+"px";return k},toLocal:function(){for(var a=this.drawLayer.graphics,b=[],e=0;e<a.length;e++)if("rg"in a[e])for(var k=a[e].rg.length-1;-1<k;k--)if(k==a[e].rg.length-2){b.push(a[e].rg[k]);break}for(a=b.length-1;-1<a;a--)e=b[a],e=this.view.geometryToScreen(e.feature.geometry.x,e.feature.geometry.y),h(".graphicClose")[a].style.left=
e.x+3+"px",h(".graphicClose")[a].style.top=e.y+3+"px"},invalid:function(){this.state&&(this._endDrawMethod(),this.state=!1,this.view.panEnabled=!0,this.view.selectEnabled=!0,null!==this._mouseClick&&(this._mouseClick.remove(),this._mouseClick=null),null!==this._dblMouseClick&&(this._dblMouseClick.remove(),this._dblMouseClick=null),a.remove(this.view.domNode,"draw-cursor-style"))},doAction:function(a){this._drawVertex(a)},_drawVertex:function(a){var b=new q(a.x,a.y),e=new n({attribute:null,geometry:b}),
e=new k({feature:e,symbol:this._vertexSymbol});this.drawLayer.addGraphic(e);this._lineGraphicList.push(e);e=this._vertexArr.length;this._preClick=!0;this._isNew?(this._vertexArr.push(new q(b.x,b.y)),this._addDistanceTip(b,"\u8d77\u70b9"),this._isNew=!1):(this._vertexArr.splice(this._vertexArr.length-1,1,new q(a.x,a.y)),this.cacheLength+=this._calLineLength(this._vertexArr[e-2],this._vertexArr[e-1]),this._addDistanceTip(b,this._distanceToTip(this.cacheLength)));this.drawLayer.layerView.view.threeRender()},
_addDistanceTip:function(a,b){b=new r({text:b,color:"#009688",size:12,offset:[-6,3]});a=new n({attribute:null,geometry:new q(a.x,a.y)});a=new k({feature:a,symbol:b});this.drawLayer.addGraphic(a);this._lineGraphicList.push(a)},_calLineLength:function(a,b){return Math.sqrt((b.x-a.x)*(b.x-a.x)+(b.y-a.y)*(b.y-a.y))},_distanceToTip:function(a){return 1E3>a?a.toFixed(2)+"\u7c73":(a/1E3).toFixed(2)+"\u5343\u7c73"},_endDrawMethod:function(){this._lineGraphicHash[this._currentGraphic.id]=this._lineGraphicList;
this.cacheLength=0;null!==this._mouseClickMove&&(this._mouseClickMove.remove(),this._mouseClickMove=null);this._vertexArr=[];this._lineGraphicList=this._lastPoint=this._currentGraphic=null;this._isNew=!0}})})},"dojo/_base/url":function(){define(["./kernel"],function(f){var d=/^(([^:/?#]+):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?$/,m=/^((([^\[:]+):)?([^@]+)@)?(\[([^\]]+)\]|([^\[:]*))(:([0-9]+))?$/,h=function(){for(var c=arguments,a=[c[0]],g=1;g<c.length;g++)if(c[g]){var l=new h(c[g]+""),a=new h(a[0]+
"");if(""==l.path&&!l.scheme&&!l.authority&&!l.query)null!=l.fragment&&(a.fragment=l.fragment),l=a;else if(!l.scheme&&(l.scheme=a.scheme,!l.authority&&(l.authority=a.authority,"/"!=l.path.charAt(0)))){for(var a=(a.path.substring(0,a.path.lastIndexOf("/")+1)+l.path).split("/"),e=0;e<a.length;e++)"."==a[e]?e==a.length-1?a[e]="":(a.splice(e,1),e--):0<e&&(1!=e||""!=a[0])&&".."==a[e]&&".."!=a[e-1]&&(e==a.length-1?(a.splice(e,1),a[e-1]=""):(a.splice(e-1,2),e-=2));l.path=a.join("/")}a=[];l.scheme&&a.push(l.scheme,
":");l.authority&&a.push("//",l.authority);a.push(l.path);l.query&&a.push("?",l.query);l.fragment&&a.push("#",l.fragment)}this.uri=a.join("");c=this.uri.match(d);this.scheme=c[2]||(c[1]?"":null);this.authority=c[4]||(c[3]?"":null);this.path=c[5];this.query=c[7]||(c[6]?"":null);this.fragment=c[9]||(c[8]?"":null);null!=this.authority&&(c=this.authority.match(m),this.user=c[3]||null,this.password=c[4]||null,this.host=c[6]||c[7],this.port=c[9]||null)};h.prototype.toString=function(){return this.uri};
return f._Url=h})},"com/huayun/webgis/gl/programConfig":function(){define("exports ../data/FeaturePositionMap ../layers/support/style/PossiblyEvaluatedPropertyValue ./constantBinder ./dataTransfer ../utils/utils".split(" "),function(f,d,m,h,c,a){var g=function(){this.binders={};this.cacheKey="";this._buffers=[];this._featureMap=new d;this._bufferOffset=0};g.createDynamic=function(e,b,k){var c=new g,d=[],l;for(l in e.paint._values)if(k(l)){var r=e.paint.get(l);if(r instanceof m&&a.supportsPropertyExpression(r.property.specification)){var q=
a.paintAttributeNames(l,e.type),f=r.property.specification.type,z=r.property.useIntegerZoom;if("cross-faded"===r.property.specification["property-type"]||"cross-faded-data-driven"===r.property.specification["property-type"])if("constant"===r.value.kind)c.binders[l]=new h.CrossFadedConstantBinder(r.value.value,q,f),d.push("/u_"+l);else{var v=a.layoutType(l,f,"source");c.binders[l]=new h.CrossFadedCompositeBinder(r.value,q,f,z,b,v,e.id);d.push("/a_"+l)}else"constant"===r.value.kind?(c.binders[l]=new h.ConstantBinder(r.value.value,
q,f),d.push("/u_"+l)):"source"===r.value.kind?(z=a.layoutType(l,f,"source"),c.binders[l]=new h.SourceExpressionBinder(r.value,q,f,z),d.push("/a_"+l)):(v=a.layoutType(l,f,"composite"),c.binders[l]=new h.CompositeExpressionBinder(r.value,q,f,z,b,v),d.push("/z_"+l))}}c.cacheKey=d.sort().join("");return c};g.prototype.populatePaintArrays=function(a,b,k,c){for(var e in this.binders)this.binders[e].populatePaintArray(a,b,c);void 0!==b.id&&this._featureMap.add(+b.id,k,this._bufferOffset,a);this._bufferOffset=
a};g.prototype.setConstantPatternPositions=function(a,b){for(var e in this.binders)this.binders[e].setConstantPatternPositions(a,b)};g.prototype.updatePaintArrays=function(a,b,k,c){var e=!1,g;for(g in a)for(var d=0,n=this._featureMap.getPositions(+g);d<n.length;d+=1){var l=n[d],f=b.feature(l.index),m;for(m in this.binders){var y=this.binders[m];y instanceof h.ConstantBinder||y instanceof h.CrossFadedConstantBinder||!0!==y.expression.isStateDependent||(e=k.paint.get(m),y.expression=e.value,y.updatePaintArray(l.start,
l.end,f,a[g],c),e=!0)}}return e};g.prototype.defines=function(){var a=[],b;for(b in this.binders)a.push.apply(a,this.binders[b].defines());return a};g.prototype.getPaintVertexBuffers=function(){return this._buffers};g.prototype.getUniforms=function(a,b){var e=[],c;for(c in this.binders)for(var g=this.binders[c],d=0,l=g.uniformNames;d<l.length;d+=1){var q=l[d];if(b[q]){var h=g.getBinding(a,b[q]);e.push({name:q,property:c,binding:h})}}return e};g.prototype.setUniforms=function(a,b,k,c){for(var e=0;e<
b.length;e+=1){var g=b[e],d=g.name,n=g.property;this.binders[n].setUniforms(a,g.binding,c,k.get(n),d)}};g.prototype.setUniform=function(a,b,k,c){this.binders[b].setUniform(a,k,c)};g.prototype.updatePatternPaintBuffers=function(a){var b=[],e;for(e in this.binders){var c=this.binders[e];c instanceof h.CrossFadedCompositeBinder?(c=2===a.fromScale?c.zoomInPaintVertexBuffer:c.zoomOutPaintVertexBuffer)&&b.push(c):(c instanceof h.SourceExpressionBinder||c instanceof h.CompositeExpressionBinder)&&c.paintVertexBuffer&&
b.push(c.paintVertexBuffer)}this._buffers=b};g.prototype.upload=function(a){for(var b in this.binders)this.binders[b].upload(a);a=[];for(var e in this.binders)b=this.binders[e],(b instanceof h.SourceExpressionBinder||b instanceof h.CompositeExpressionBinder)&&b.paintVertexBuffer&&a.push(b.paintVertexBuffer);this._buffers=a};g.prototype.destroy=function(){for(var a in this.binders)this.binders[a].destroy()};var l=function(a,b,c,d){void 0===d&&(d=function(){return!0});this.programConfigurations={};
for(var e=0;e<b.length;e+=1){var k=b[e];this.programConfigurations[k.id]=g.createDynamic(k,c,d);this.programConfigurations[k.id].layoutAttributes=a}this.needsUpload=!1};l.prototype.populatePaintArrays=function(a,b,c,g){for(var e in this.programConfigurations)this.programConfigurations[e].populatePaintArrays(a,b,c,g);this.needsUpload=!0};l.prototype.updatePaintArrays=function(a,b,c,g){for(var e=0;e<c.length;e+=1){var k=c[e];this.needsUpload=this.programConfigurations[k.id].updatePaintArrays(a,b,k,
g)||this.needsUpload}};l.prototype.get=function(a){return this.programConfigurations[a]};l.prototype.upload=function(a){if(this.needsUpload){for(var b in this.programConfigurations)this.programConfigurations[b].upload(a);this.needsUpload=!1}};l.prototype.destroy=function(){for(var a in this.programConfigurations)this.programConfigurations[a].destroy()};f.ProgramConfiguration=g;f.ProgramConfigurationSet=l;c.register("FeaturePositionMap",d);c.register("ProgramConfiguration",g,{omit:["_buffers"]});c.register("ProgramConfigurationSet",
l)})},"com/huayun/webgis/layers/support/SourceFeatureState":function(){define(["../../utils/utils"],function(f){var d=function(){this.state={};this.stateChanges={};this.deletedStates={}};d.prototype.updateState=function(d,h,c){for(var a=0;a<h.length;a++){var g=String(h[a]);this.stateChanges[d]=this.stateChanges[d]||{};this.stateChanges[d][g]=this.stateChanges[d][g]||{};f.extend(this.stateChanges[d][g],c);if(null===this.deletedStates[d]){this.deletedStates[d]={};for(var l in this.state[d])l!==g&&(this.deletedStates[d][l]=
null)}else if(this.deletedStates[d]&&null===this.deletedStates[d][g]){this.deletedStates[d][g]={};for(var e in this.state[d][g])c[e]||(this.deletedStates[d][g][e]=null)}else for(var b in c)this.deletedStates[d]&&this.deletedStates[d][g]&&null===this.deletedStates[d][g][b]&&delete this.deletedStates[d][g][b]}};d.prototype.removeFeatureState=function(d,h,c){if(null!==this.deletedStates[d]){var a=String(h);this.deletedStates[d]=this.deletedStates[d]||{};if(c&&void 0!==h&&0<=h)null!==this.deletedStates[d][a]&&
(this.deletedStates[d][a]=this.deletedStates[d][a]||{},this.deletedStates[d][a][c]=null);else if(void 0!==h&&0<=h)if(this.stateChanges[d]&&this.stateChanges[d][a])for(c in this.deletedStates[d][a]={},this.stateChanges[d][a])this.deletedStates[d][a][c]=null;else this.deletedStates[d][a]=null;else this.deletedStates[d]=null}};d.prototype.getState=function(d,h){var c=String(h),c=f.extend({},(this.state[d]||{})[c],(this.stateChanges[d]||{})[c]);if(null===this.deletedStates[d])return{};if(this.deletedStates[d]){d=
this.deletedStates[d][h];if(null===d)return{};for(var a in d)delete c[a]}return c};d.prototype.initializeTileState=function(d,h){d.setFeatureState(this.state,h)};d.prototype.coalesceChanges=function(d,h){var c={},a;for(a in this.stateChanges){this.state[a]=this.state[a]||{};var g={},l;for(l in this.stateChanges[a])this.state[a][l]||(this.state[a][l]={}),f.extend(this.state[a][l],this.stateChanges[a][l]),g[l]=this.state[a][l];c[a]=g}for(var e in this.deletedStates){this.state[e]=this.state[e]||{};
a={};if(null===this.deletedStates[e])for(var b in this.state[e])a[b]={},this.state[e][b]={};else for(var k in this.deletedStates[e]){if(null===this.deletedStates[e][k])this.state[e][k]={};else for(g=0,l=Object.keys(this.deletedStates[e][k]);g<l.length;g+=1)delete this.state[e][k][l[g]];a[k]=this.state[e][k]}c[e]=c[e]||{};f.extend(c[e],a)}this.stateChanges={};this.deletedStates={};if(0!==Object.keys(c).length)for(var n in d)d[n].setFeatureState(c,h)};return d})},"com/huayun/webgis/renderer/RectRenderer":function(){define("./Renderer ../gl/mode ../data/bucket/RectBucket ../geometry/Point ../gl/programCache ../utils/MathUtils".split(" "),
function(f,d,m,h,c,a){function g(){}f&&(g.__proto__=f);g.prototype=Object.create(f&&f.prototype);g.prototype.constructor=g;g.prototype.add=function(a,e,b,c){var k=new m,d=e.position||a.viewpoint.center||[0,0],g=d[0],d=d[1];k.addFeature([[new h(b.x-g,b.y-d,0)]],c);k.upload(a.context);e.buckets.push(k);e.position=[g,d];e.center=b};g.prototype.draw=function(a,e,b,k,g,p){void 0===p&&(p=0);b=a.context;var n=b.gl;g=g?g.depthModeForSublayer(0,d.DepthMode.ReadWrite):new d.DepthMode(n.LEQUAL,d.DepthMode.ReadWrite,
[.9,.9]);var l=d.StencilMode.disabled,q=d.ColorMode.alphaBlended,h=c.useProgramSimplify(b,"rect",{layoutAttributes:[{name:"a_pos",type:"Float32",components:2,offset:0},{name:"a_size",type:"Float32",components:4,offset:8}]}),f=k.uniforms,m=e.position;f.u_camera_to_center_distance=a.viewpoint.cameraToCenterDistance;f.u_extrude_scale=a.viewpoint.pixelsToGLUnits;var y=e.buckets[p],x=this.getRealScale(k.fixed,a.scale,k.minScale),w=1,A=a.resolution;k.markerSize?(x*=e.markerScaleFactor||1,w=Math.min(k.markerSize/
k.widthWithStroke,k.markerSize/k.heightWithStroke),x*=w):e.symbol.size?(e.scaleFactor=e.scaleFactor||1,x*=e.scaleFactor,w=Math.min(e.symbol.size/k.widthWithStroke,e.symbol.size/k.heightWithStroke),x*=w):(e.scaleFactor=e.scaleFactor||1,x*=e.scaleFactor);f.u_size=x;f.u_radian=e.rotation?k.angle+e.rotation:k.angle;f.u_radian||(f.u_radian=0);var w=k.dx*x*A,A=k.dy*x*A,B=Math.sin(f.u_radian),E=Math.cos(f.u_radian),x=w*E-A*B,w=A*E+w*B;f.u_matrix=a.viewpoint.getMatrixForPoint(m[0]+x,m[1]+w);f.u_color=k.color;
e["_rectOffset"+p]={dx:x,dy:w,size:k.uniforms.u_size};h.draw(b,n.TRIANGLES,g,l,q,d.CullFaceMode.disabled,f,e.id+"-rect"+p,y.layoutVertexBuffer,y.indexBuffer,y.segments)};g.prototype.drawGlow=function(a,e,b,k,g,p){var n=e.glow;if(n){void 0===p&&(p=0);b=a.context;var l=b.gl;g=g?g.depthModeForSublayer(0,d.DepthMode.ReadOnly):new d.DepthMode(l.LEQUAL,d.DepthMode.ReadOnly,[.9,.9]);var q=d.StencilMode.disabled,h=d.ColorMode.alphaBlended,f=c.useProgramSimplify(b,"rect",{layoutAttributes:[{name:"a_pos",type:"Float32",
components:2,offset:0},{name:"a_size",type:"Float32",components:4,offset:8}]}),m=k.uniforms,y=e.position;m.u_camera_to_center_distance=a.viewpoint.cameraToCenterDistance;m.u_extrude_scale=a.viewpoint.pixelsToGLUnits;var x=e.buckets[p],w=this.getRealScale(k.fixed,a.scale,k.minScale),A=1,B=a.resolution;k.markerSize?(w*=e.markerScaleFactor,A=Math.min(k.markerSize/k.widthWithStroke,k.markerSize/k.heightWithStroke),w*=A):e.symbol.size?(e.scaleFactor=e.scaleFactor||1,w*=e.scaleFactor,A=Math.min(e.symbol.size/
k.widthWithStroke,e.symbol.size/k.heightWithStroke),w*=A):(e.scaleFactor=e.scaleFactor||1,w*=e.scaleFactor);m.u_size=w;m.u_radian=e.rotation?k.angle+e.rotation:k.angle;var A=k.dx*w*B,w=k.dy*w*B,B=Math.sin(m.u_radian),E=Math.cos(m.u_radian),n=n.color;m.u_matrix=a.viewpoint.getMatrixForPoint(y[0]+(A*E-w*B),y[1]+(w*E+A*B));0<k.strokeWidth&&0!==k.stroke[3]&&(m.u_color=n,m.u_is_stroke=1,f.draw(b,l.TRIANGLES,g,q,h,d.CullFaceMode.disabled,m,e.id+"-rect"+p,x.layoutVertexBuffer,x.indexBuffer,x.segments));
m.u_is_stroke=0;m.u_color=n;f.draw(b,l.TRIANGLES,g,q,h,d.CullFaceMode.disabled,m,e.id+"-rect"+p,x.layoutVertexBuffer,x.indexBuffer,x.segments)}};g.prototype.calculateExtent=function(c,e,b,k,d,g){g||(g=0);var n=e["_rectOffset"+g],l=n.size;g=b.x;b=b.y;c=c.resolution;var q,p;0<k.strokeWidth?(q=k.widthWithStroke,p=k.heightWithStroke):(q=k.width,p=k.height);q=q/2*l;l*=p/2;k=e.rotation?k.angle+e.rotation:k.angle;g+=n.dx;b+=n.dy;k=a.sizeAfterRotated([{x:q,y:l},{x:q,y:-l},{x:-q,y:-l},{x:-q,y:l}],k);d.push({id:e.id,
g:e,minX:g+k.xmin*c,minY:b+k.ymin*c,maxX:g+k.xmax*c,maxY:b+k.ymax*c,type:"rect"})};return g})},"com/huayun/webgis/data/bucket/RectBucket":function(){define(["../ArrayType","../../gl/SegmentVector","../../utils/earcut","../../utils/utils","../../utils/Constant"],function(f,d,m,h,c){function a(){this.layoutVertexArray=new f.StructArrayLayout6fb24;this.indexArray=new f.StructArrayLayout3ui6;this.segments=new d}a.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),
this.indexBuffer.destroy(),this.segments.destroy())};a.prototype.addFeature=function(a,c){var e=c.width,b=c.height,k=c.widthWithStroke;c=c.heightWithStroke;for(var d=0;d<a.length;d+=1)for(var g=0,l=a[d];g<l.length;g+=1){var h=l[g],q=h.x,h=h.y,f=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),m=f.vertexLength;this.layoutVertexArray.emplaceBack(q,h,-e,-b,-k,-c);this.layoutVertexArray.emplaceBack(q,h,e,-b,k,-c);this.layoutVertexArray.emplaceBack(q,h,e,b,k,c);this.layoutVertexArray.emplaceBack(q,
h,-e,b,-k,c);this.indexArray.emplaceBack(m,m+1,m+2);this.indexArray.emplaceBack(m,m+3,m+2);f.vertexLength+=4;f.primitiveLength+=2}};a.prototype.upload=function(a){this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,[{name:"a_pos",type:"Float32",components:2,offset:0},{name:"a_size",type:"Float32",components:4,offset:8}]);this.indexBuffer=a.createIndexBuffer(this.indexArray)};return a})},"com/huayun/webgis/data/uniform":function(){define(["exports","../utils/Color"],function(f,d){var m=
function(a,b){this.gl=a.gl;this.location=b},h=function(a){function b(b,e){a.call(this,b,e);this.current=0}a&&(b.__proto__=a);b.prototype=Object.create(a&&a.prototype);b.prototype.constructor=b;b.prototype.set=function(a){this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,a))};return b}(m),c=function(a){function b(b,e){a.call(this,b,e);this.current=0}a&&(b.__proto__=a);b.prototype=Object.create(a&&a.prototype);b.prototype.constructor=b;b.prototype.set=function(a){this.current!==a&&(this.current=
a,this.gl.uniform1f(this.location,a))};return b}(m),a=function(a){function b(b,e){a.call(this,b,e);this.current=0}a&&(b.__proto__=a);b.prototype=Object.create(a&&a.prototype);b.prototype.constructor=b;b.prototype.set=function(a){this.current!==a&&(this.current=a,this.gl.uniform1fv(this.location,a))};return b}(m),g=function(a){function b(b,e){a.call(this,b,e);this.current=[0,0]}a&&(b.__proto__=a);b.prototype=Object.create(a&&a.prototype);b.prototype.constructor=b;b.prototype.set=function(a){if(a[0]!==
this.current[0]||a[1]!==this.current[1])this.current=a,this.gl.uniform2f(this.location,a[0],a[1])};return b}(m),l=function(a){function b(b,e){a.call(this,b,e);this.current=[0,0,0]}a&&(b.__proto__=a);b.prototype=Object.create(a&&a.prototype);b.prototype.constructor=b;b.prototype.set=function(a){if(a[0]!==this.current[0]||a[1]!==this.current[1]||a[2]!==this.current[2])this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2])};return b}(m),e=function(a){function b(b,e){a.call(this,b,e);this.current=
[0,0,0,0]}a&&(b.__proto__=a);b.prototype=Object.create(a&&a.prototype);b.prototype.constructor=b;b.prototype.set=function(a){if(a[0]!==this.current[0]||a[1]!==this.current[1]||a[2]!==this.current[2]||a[3]!==this.current[3])this.current=a,this.gl.uniform4f(this.location,a[0],a[1],a[2],a[3])};return b}(m),b=function(a){function b(b,e){a.call(this,b,e);this.current=d.transparent}a&&(b.__proto__=a);b.prototype=Object.create(a&&a.prototype);b.prototype.constructor=b;b.prototype.set=function(a){if(a.r!==
this.current.r||a.g!==this.current.g||a.b!==this.current.b||a.a!==this.current.a)this.current=a,this.gl.uniform4f(this.location,a.r,a.g,a.b,a.a)};return b}(m),m=function(a){function b(b,e){a.call(this,b,e);this.current=new Float32Array(16)}a&&(b.__proto__=a);b.prototype=Object.create(a&&a.prototype);b.prototype.constructor=b;b.prototype.set=function(a){if(a[12]!==this.current[12]||a[0]!==this.current[0])this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);else for(var b=1;16>b;b++)if(a[b]!==
this.current[b]){this.current=a;this.gl.uniformMatrix4fv(this.location,!1,a);break}};return b}(m);f.Uniform1f=c;f.Uniform1fv=a;f.Uniform1i=h;f.Uniform2f=g;f.Uniform3f=l;f.Uniform4f=e;f.UniformMatrix4f=m;f.UniformColor=b})},"com/huayun/webgis/gl/members":function(){define(["exports","../utils/Constant","../utils/utils"],function(f,d,m){function h(a,e){void 0===e&&(e=1);var b=0,c=0;a=a.map(function(a){var k=d.viewTypes[a.type].BYTES_PER_ELEMENT,g=b=m.align(b,Math.max(e,k)),n=a.components||1;c=Math.max(c,
k);b+=k*n;return{name:a.name,type:a.type,components:n,offset:g}});var k=m.align(b,Math.max(c,e));return{members:a,size:k,alignment:e}}var c=h([{name:"a_pos",components:2,type:"Int16"}],4),a=h([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),g=h([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),l=h([{name:"a_pos",components:2,type:"Int16"}],4),e=h([{name:"a_pos",components:3,type:"Int16"}]);f.members=l.members;
f.members$1=c.members;f.members$2=g.members;f.members$3=a.members;f.members$4=e.members;f.symbolLayoutAttributes=h([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"}]);f.dynamicLayoutAttributes=h([{name:"a_projected_pos",components:3,type:"Float32"}],4);f.posAttributes=h([{name:"a_pos",type:"Int16",components:2}]);f.shaderOpacityAttributes=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];f.rasterBoundsAttributes=h([{name:"a_pos",type:"Int16",components:2},
{name:"a_texture_pos",type:"Int16",components:2}]);f.imageBoundsAttributes=h([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}])})},"dojo/dom":function(){define(["./sniff","./_base/window","./_base/kernel"],function(f,d,m){if(7>=f("ie"))try{document.execCommand("BackgroundImageCache",!1,!0)}catch(a){}var h={};f("ie")?h.byId=function(a,c){if("string"!=typeof a)return a||null;var g=c||d.doc;c=a&&g.getElementById(a);if(!c||c.attributes.id.value!=a&&c.id!=a){g=
g.all[a];if(!g||g.nodeName)g=[g];for(var e=0;c=g[e++];)if(c.attributes&&c.attributes.id&&c.attributes.id.value==a||c.id==a)return c}else return c;return null}:h.byId=function(a,c){return("string"==typeof a?(c||d.doc).getElementById(a):a)||null};m=m.global.document||null;f.add("dom-contains",!(!m||!m.contains));h.isDescendant=f("dom-contains")?function(a,c){return!(!(c=h.byId(c))||!c.contains(h.byId(a)))}:function(a,c){try{for(a=h.byId(a),c=h.byId(c);a;){if(a==c)return!0;a=a.parentNode}}catch(l){}return!1};
f.add("css-user-select",function(a,c,d){if(!d)return!1;a=d.style;c=["Khtml","O","Moz","Webkit"];d=c.length;var e="userSelect";do if("undefined"!==typeof a[e])return e;while(d--&&(e=c[d]+"UserSelect"));return!1});var c=f("css-user-select");h.setSelectable=c?function(a,d){h.byId(a).style[c]=d?"":"none"}:function(a,c){a=h.byId(a);var d=a.getElementsByTagName("*"),e=d.length;if(c)for(a.removeAttribute("unselectable");e--;)d[e].removeAttribute("unselectable");else for(a.setAttribute("unselectable","on");e--;)d[e].setAttribute("unselectable",
"on")};return h})},"com/huayun/webgis/gl/GridIndex":function(){define([],function(){function f(d,f,h){var c=this.cells=[];if(d instanceof ArrayBuffer){this.arrayBuffer=d;var a=new Int32Array(this.arrayBuffer);d=a[0];f=a[1];h=a[2];this.d=f+2*h;for(var g=0;g<this.d*this.d;g++){var l=a[3+g],e=a[3+g+1];c.push(l===e?null:a.subarray(l,e))}g=a[3+c.length+1];this.keys=a.subarray(a[3+c.length],g);this.bboxes=a.subarray(g);this.insert=this._insertReadonly}else{this.d=f+2*h;for(a=0;a<this.d*this.d;a++)c.push([]);
this.keys=[];this.bboxes=[]}this.n=f;this.extent=d;this.padding=h;this.scale=f/d;this.uid=0;f=h/f*d;this.min=-f;this.max=d+f}f.prototype.insert=function(d,f,h,c,a){this._forEachCell(f,h,c,a,this._insertCell,this.uid++);this.keys.push(d);this.bboxes.push(f);this.bboxes.push(h);this.bboxes.push(c);this.bboxes.push(a)};f.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer.";};f.prototype._insertCell=function(d,f,h,c,a,g){this.cells[a].push(g)};f.prototype.query=
function(d,f,h,c,a){var g=this.min,l=this.max;if(d<=g&&f<=g&&l<=h&&l<=c&&!a)return Array.prototype.slice.call(this.keys);g=[];this._forEachCell(d,f,h,c,this._queryCell,g,{},a);return g};f.prototype._queryCell=function(d,f,h,c,a,g,l,e){a=this.cells[a];if(null!==a)for(var b=this.keys,k=this.bboxes,n=0;n<a.length;n++){var p=a[n];if(void 0===l[p]){var t=4*p;(e?e(k[t+0],k[t+1],k[t+2],k[t+3]):d<=k[t+2]&&f<=k[t+3]&&h>=k[t+0]&&c>=k[t+1])?(l[p]=!0,g.push(b[p])):l[p]=!1}}};f.prototype._forEachCell=function(d,
f,h,c,a,g,l,e){for(var b=this._convertToCellCoord(d),k=this._convertToCellCoord(f),n=this._convertToCellCoord(h),p=this._convertToCellCoord(c);b<=n;b++)for(var t=k;t<=p;t++){var r=this.d*t+b;if((!e||e(this._convertFromCellCoord(b),this._convertFromCellCoord(t),this._convertFromCellCoord(b+1),this._convertFromCellCoord(t+1)))&&a.call(this,d,f,h,c,r,g,l,e))return}};f.prototype._convertFromCellCoord=function(d){return(d-this.padding)/this.scale};f.prototype._convertToCellCoord=function(d){return Math.max(0,
Math.min(this.d-1,Math.floor(d*this.scale)+this.padding))};f.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var d=this.cells,f=3+this.cells.length+1+1,h=0,c=0;c<this.cells.length;c++)h+=this.cells[c].length;h=new Int32Array(f+h+this.keys.length+this.bboxes.length);h[0]=this.extent;h[1]=this.n;h[2]=this.padding;for(c=0;c<d.length;c++){var a=d[c];h[3+c]=f;h.set(a,f);f+=a.length}h[3+d.length]=f;h.set(this.keys,f);f+=this.keys.length;h[3+d.length+1]=f;h.set(this.bboxes,
f);f+=this.bboxes.length;return h.buffer};return f})},"com/huayun/gl/shaders/water":function(){define(["exports","../../webgis/data/uniform"],function(f,d){f.waterVS="attribute vec3 a_pos;\nuniform mat4 u_matrix;\nuniform float u_water_depth;\nvoid main() {\n    gl_Position \x3d u_matrix * vec4(a_pos.xy, a_pos.z \x3e 0.0?u_water_depth:0.0, 1.0);\n}";f.waterFS="precision mediump float;\nvoid main() {\n    gl_FragColor \x3d vec4(0.3, 0.7, 0.72, 1.0);\n}";f.waterUniforms=function(f,h){return{u_matrix:new d.UniformMatrix4f(f,
h.u_matrix),u_water_depth:new d.Uniform1f(f,h.u_water_depth)}}})},"com/huayun/webgis/geometry/Point2D":function(){define([],function(){function f(d,f){this.x=d;this.y=f;this.type="point"}f.prototype={clone:function(){return new f(this.x,this.y)},add:function(d){return this.clone()._add(d)},sub:function(d){return this.clone()._sub(d)},multByPoint:function(d){return this.clone()._multByPoint(d)},divByPoint:function(d){return this.clone()._divByPoint(d)},mult:function(d){return this.clone()._mult(d)},
div:function(d){return this.clone()._div(d)},rotate:function(d){return this.clone()._rotate(d)},rotateAround:function(d,f){return this.clone()._rotateAround(d,f)},matMult:function(d){return this.clone()._matMult(d)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(d){return this.x===d.x&&this.y===d.y},dist:function(d){return Math.sqrt(this.distSqr(d))},
distSqr:function(d){var f=d.x-this.x;d=d.y-this.y;return f*f+d*d},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(d){return Math.atan2(this.y-d.y,this.x-d.x)},angleWith:function(d){return this.angleWithSep(d.x,d.y)},angleWithSep:function(d,f){return Math.atan2(this.x*f-this.y*d,this.x*d+this.y*f)},_matMult:function(d){var f=d[2]*this.x+d[3]*this.y;this.x=d[0]*this.x+d[1]*this.y;this.y=f;return this},_add:function(d){this.x+=d.x;this.y+=d.y;return this},_sub:function(d){this.x-=
d.x;this.y-=d.y;return this},_mult:function(d){this.x*=d;this.y*=d;return this},_div:function(d){this.x/=d;this.y/=d;return this},_multByPoint:function(d){this.x*=d.x;this.y*=d.y;return this},_divByPoint:function(d){this.x/=d.x;this.y/=d.y;return this},_unit:function(){this._div(this.mag());return this},_perp:function(){var d=this.y;this.y=this.x;this.x=-d;return this},_rotate:function(d){var f=Math.cos(d);d=Math.sin(d);var h=d*this.x+f*this.y;this.x=f*this.x-d*this.y;this.y=h;return this},_rotateAround:function(d,
f){var h=Math.cos(d);d=Math.sin(d);var c=f.y+d*(this.x-f.x)+h*(this.y-f.y);this.x=f.x+h*(this.x-f.x)-d*(this.y-f.y);this.y=c;return this},_round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this}};f.convert=function(d){return d instanceof f?d:Array.isArray(d)?new f(d[0],d[1]):d};return f})},"dojo/keys":function(){define(["./_base/kernel","./sniff"],function(f,d){return f.keys={BACKSPACE:8,TAB:9,CLEAR:12,ENTER:13,SHIFT:16,CTRL:17,ALT:18,META:d("webkit")?91:224,PAUSE:19,CAPS_LOCK:20,
ESCAPE:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT_ARROW:37,UP_ARROW:38,RIGHT_ARROW:39,DOWN_ARROW:40,INSERT:45,DELETE:46,HELP:47,LEFT_WINDOW:91,RIGHT_WINDOW:92,SELECT:93,NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,NUMPAD_MULTIPLY:106,NUMPAD_PLUS:107,NUMPAD_ENTER:108,NUMPAD_MINUS:109,NUMPAD_PERIOD:110,NUMPAD_DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,
F13:124,F14:125,F15:126,NUM_LOCK:144,SCROLL_LOCK:145,UP_DPAD:175,DOWN_DPAD:176,LEFT_DPAD:177,RIGHT_DPAD:178,copyKey:d("mac")&&!d("air")?d("safari")?91:224:17}})},"com/huayun/gl/shaders/rect":function(){define(["exports","../../webgis/data/uniform"],function(f,d){f.rectVS="attribute vec2 a_pos;\nattribute vec4 a_size;\n\nuniform mat4 u_matrix;\nuniform lowp float u_device_pixel_ratio;\nuniform highp float u_camera_to_center_distance;\nuniform mediump vec2 u_extrude_scale;\nuniform highp float u_radian;\nuniform bool u_is_stroke;\n\nuniform highp float u_size;\n\nvoid main() {\n    gl_Position \x3d u_matrix * vec4(a_pos, 0.0, 1.0);\n    highp float angle_sin \x3d sin(u_radian);\n    highp float angle_cos \x3d cos(u_radian);\n    mat2 rotation_matrix \x3d mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);\n    vec2 core_size \x3d a_size.xy / 2.0;\n    vec2 stroke_size \x3d a_size.zw / 2.0;\n    vec2 rotated_extrude;\n    if (u_is_stroke) {\n        rotated_extrude \x3d rotation_matrix * stroke_size * u_size;\n    } else {\n        rotated_extrude \x3d rotation_matrix * core_size * u_size;\n    }\n    gl_Position.xy +\x3d rotated_extrude * u_extrude_scale * u_camera_to_center_distance;\n}";
f.rectFS="precision mediump float;\nuniform vec4 u_color;\n\nvoid main() {\n    gl_FragColor \x3d u_color;\n}";f.rectUniforms=function(f,h){return{u_matrix:new d.UniformMatrix4f(f,h.u_matrix),u_device_pixel_ratio:new d.Uniform1f(f,h.u_device_pixel_ratio),u_camera_to_center_distance:new d.Uniform1f(f,h.u_camera_to_center_distance),u_extrude_scale:new d.Uniform2f(f,h.u_extrude_scale),u_size:new d.Uniform1f(f,h.u_size),u_radian:new d.Uniform1f(f,h.u_radian),u_is_stroke:new d.Uniform1i(f,h.u_is_stroke),
u_color:new d.Uniform4f(f,h.u_color)}}})},"com/huayun/webgis/gl/VertexFragShader":function(){define("exports ../data/uniform ../../gl/shaders/rect ../../gl/shaders/terrain ../../gl/shaders/heightMap ../../gl/shaders/tiffTerrain ../../gl/shaders/water ../../gl/shaders/fillExtrusion ../../gl/shaders/background ../../gl/shaders/mesh ../../gl/shaders/cylinder ../../gl/shaders/cone ../../gl/shaders/line ../../gl/shaders/linePattern".split(" "),function(f,d,m,h,c,a,g,l,e,b,k,n,p,t){f.rect={vertexSource:m.rectVS,
fragmentSource:m.rectFS};f.terrain={vertexSource:h.terrainVS,fragmentSource:h.terrainFS};f.heightMap={vertexSource:c.heightMapVS,fragmentSource:c.heightMapFS};f.tifTerrain={vertexSource:a.tiffTerrainVS,fragmentSource:a.tiffTerrainFS};f.water={vertexSource:g.waterVS,fragmentSource:g.waterFS};f.fillExtrusion={vertexSource:l.fillExtrusionVS,fragmentSource:l.fillExtrusionFS};f.bg={vertexSource:e.backgroundVS,fragmentSource:e.backgroundFS};f.mesh={vertexSource:b.meshVS,fragmentSource:b.meshFS};f.cylinder=
{vertexSource:k.cylinderVS,fragmentSource:k.cylinderFS};f.cone={vertexSource:n.coneVS,fragmentSource:n.coneFS};f.myline={vertexSource:p.lineVS,fragmentSource:p.lineFS};f.linePattern={vertexSource:t.linePatternVS,fragmentSource:t.linePatternFS};f.line={vertexSource:"#ifdef GL_ES\nprecision highp float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\n\nvec2 unpack_float(const float packedValue) {\n    int packedIntValue \x3d int(packedValue);\n    int v0 \x3d packedIntValue / 256;\n    return vec2(v0, packedIntValue - v0 * 256);\n}\nvec4 decode_color(const vec2 encodedColor) {\n    return vec4(\n        unpack_float(encodedColor[0]) / 255.0,\n        unpack_float(encodedColor[1]) / 255.0\n    );\n}\n\nfloat unpack_mix_vec2(const vec2 packedValue, const float t) {\n    return mix(packedValue[0], packedValue[1], t);\n}\n\nvec4 unpack_mix_color(const vec4 packedColors, const float t) {\n    vec4 minColor \x3d decode_color(vec2(packedColors[0], packedColors[1]));\n    vec4 maxColor \x3d decode_color(vec2(packedColors[2], packedColors[3]));\n    return mix(minColor, maxColor, t);\n}\n\n#define scale 0.015873016\n\nattribute vec2 a_pos_normal;\nattribute vec4 a_data;\n\nuniform mat4 u_matrix;\nuniform mediump float u_ratio;\nuniform vec2 u_units_to_pixels;\nuniform lowp float u_device_pixel_ratio;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying float v_gamma_scale;\nvarying highp float v_linesofar;\n\n\n#ifndef HAS_UNIFORM_u_color\nuniform lowp float u_color_t;\nattribute highp vec4 a_color;\nvarying highp vec4 color;\n#else\nuniform highp vec4 u_color;\n#endif\n\n\n#ifndef HAS_UNIFORM_u_blur\nuniform lowp float u_blur_t;\nattribute lowp vec2 a_blur;\nvarying lowp float blur;\n#else\nuniform lowp float u_blur;\n#endif\n\n\n#ifndef HAS_UNIFORM_u_opacity\nuniform lowp float u_opacity_t;\nattribute lowp vec2 a_opacity;\nvarying lowp float opacity;\n#else\nuniform lowp float u_opacity;\n#endif\n\n\n#ifndef HAS_UNIFORM_u_gapwidth\nuniform lowp float u_gapwidth_t;\nattribute mediump vec2 a_gapwidth;\n#else\nuniform mediump float u_gapwidth;\n#endif\n\n\n#ifndef HAS_UNIFORM_u_offset\nuniform lowp float u_offset_t;\nattribute lowp vec2 a_offset;\n#else\nuniform lowp float u_offset;\n#endif\n\n\n#ifndef HAS_UNIFORM_u_width\nuniform lowp float u_width_t;\nattribute mediump vec2 a_width;\n#else\nuniform mediump float u_width;\n#endif\n\n\nvoid main() {\n\n    #ifndef HAS_UNIFORM_u_color\n        color \x3d unpack_mix_color(a_color, u_color_t);\n    #else\n        highp vec4 color \x3d u_color;\n    #endif\n\n\n    #ifndef HAS_UNIFORM_u_blur\n        blur \x3d unpack_mix_vec2(a_blur, u_blur_t);\n    #else\n        lowp float blur \x3d u_blur;\n    #endif\n\n\n    #ifndef HAS_UNIFORM_u_opacity\n        opacity \x3d unpack_mix_vec2(a_opacity, u_opacity_t);\n    #else\n        lowp float opacity \x3d u_opacity;\n    #endif\n\n\n    #ifndef HAS_UNIFORM_u_gapwidth\n        mediump float gapwidth \x3d unpack_mix_vec2(a_gapwidth, u_gapwidth_t);\n    #else\n        mediump float gapwidth \x3d u_gapwidth;\n    #endif\n\n\n    #ifndef HAS_UNIFORM_u_offset\n        lowp float offset \x3d unpack_mix_vec2(a_offset, u_offset_t);\n    #else\n        lowp float offset \x3d u_offset;\n    #endif\n\n\n    #ifndef HAS_UNIFORM_u_width\n        mediump float width \x3d unpack_mix_vec2(a_width, u_width_t);\n    #else\n        mediump float width \x3d u_width;\n    #endif\n\n\n    // the distance over which the line edge fades out.\n    // Retina devices need a smaller distance to avoid aliasing.\n    float ANTIALIASING \x3d 1.0 / u_device_pixel_ratio / 2.0;\n\n    vec2 a_extrude \x3d a_data.xy - 128.0;\n    float a_direction \x3d mod(a_data.z, 4.0) - 1.0;\n\n    v_linesofar \x3d (floor(a_data.z / 4.0) + a_data.w * 64.0) * 2.0;\n\n    vec2 pos \x3d floor(a_pos_normal * 0.5);\n\n    // x is 1 if it's a round cap, 0 otherwise\n    // y is 1 if the normal points up, and -1 if it points down\n    // We store these in the least significant bit of a_pos_normal\n    mediump vec2 normal \x3d a_pos_normal - 2.0 * pos;\n    normal.y \x3d normal.y * 2.0 - 1.0;\n    v_normal \x3d normal;\n\n    // these transformations used to be applied in the JS and native code bases.\n    // moved them into the shader for clarity and simplicity.\n    gapwidth \x3d gapwidth / 2.0;\n    float halfwidth \x3d width / 2.0;\n    offset \x3d -1.0 * offset;\n\n    float inset \x3d gapwidth + (gapwidth \x3e 0.0 ? ANTIALIASING : 0.0);\n    float outset \x3d gapwidth + halfwidth * (gapwidth \x3e 0.0 ? 2.0 : 1.0) + (halfwidth \x3d\x3d 0.0 ? 0.0 : ANTIALIASING);\n\n    // Scale the extrusion vector down to a normal and then up by the line width\n    // of this vertex.\n    mediump vec2 dist \x3d outset * a_extrude * scale;\n\n    // Calculate the offset when drawing a line that is to the side of the actual line.\n    // We do this by creating a vector that points towards the extrude, but rotate\n    // it when we're drawing round end points (a_direction \x3d -1 or 1) since their\n    // extrude vector points in another direction.\n    mediump float u \x3d 0.5 * a_direction;\n    mediump float t \x3d 1.0 - abs(u);\n    mediump vec2 offset2 \x3d offset * a_extrude * scale * normal.y * mat2(t, -u, u, t);\n\n    vec4 projected_extrude \x3d u_matrix * vec4(dist / u_ratio, 0.0, 0.0);\n    gl_Position \x3d u_matrix * vec4(pos + offset2 / u_ratio, 1.1, 1.0) + projected_extrude;\n\n    // calculate how much the perspective view squishes or stretches the extrude\n    float extrude_length_without_perspective \x3d length(dist);\n    float extrude_length_with_perspective \x3d length(projected_extrude.xy / gl_Position.w * u_units_to_pixels);\n    v_gamma_scale \x3d extrude_length_without_perspective / extrude_length_with_perspective;\n\n    v_width2 \x3d vec2(outset, inset);\n}",
fragmentSource:"#ifdef GL_ES\nprecision mediump float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nuniform lowp float u_device_pixel_ratio;\nvarying vec2 v_width2;\nvarying vec2 v_normal;\nvarying float v_gamma_scale;\n#ifndef HAS_UNIFORM_u_color\nvarying highp vec4 color;\n#else\nuniform highp vec4 u_color;\n#endif\n#ifndef HAS_UNIFORM_u_blur\nvarying lowp float blur;\n#else\nuniform lowp float u_blur;\n#endif\n#ifndef HAS_UNIFORM_u_opacity\nvarying lowp float opacity;\n#else\nuniform lowp float u_opacity;\n#endif\nvoid main() {\n    #ifdef HAS_UNIFORM_u_color\n        highp vec4 color \x3d u_color;\n    #endif\n    #ifdef HAS_UNIFORM_u_blur\n        lowp float blur \x3d u_blur;\n    #endif\n    #ifdef HAS_UNIFORM_u_opacity\n        lowp float opacity \x3d u_opacity;\n    #endif\n        float dist \x3d length(v_normal) * v_width2.s;\n        float blur2 \x3d (blur + 1.0 / u_device_pixel_ratio) * v_gamma_scale;\n        float alpha \x3d clamp(min(dist - (v_width2.t - blur2), v_width2.s - dist) / blur2, 0.0, 1.0);\n        gl_FragColor \x3d color * (alpha * opacity);\n    #ifdef OVERDRAW_INSPECTOR\n        gl_FragColor \x3d vec4(1.0);\n    #endif\n}\n"};
p=function(a,b){return{u_matrix:new d.UniformMatrix4f(a,b.u_matrix),u_ratio:new d.Uniform1f(a,b.u_ratio),u_units_to_pixels:new d.Uniform2f(a,b.u_units_to_pixels),u_color:new d.Uniform4f(a,b.u_color),u_blur:new d.Uniform1f(a,b.u_blur),u_opacity:new d.Uniform1f(a,b.u_opacity),u_gapwidth:new d.Uniform1f(a,b.u_gapwidth),u_offset:new d.Uniform1f(a,b.u_offset),u_width:new d.Uniform1f(a,b.u_width)}};f.clippingMask={vertexSource:"#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif\n\nattribute vec2 a_pos;\nuniform mat4 u_matrix;\n\nvoid main() {\n    gl_Position \x3d u_matrix * vec4(a_pos, 0, 1);\n}",
fragmentSource:"#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif\nvoid main() {\n    gl_FragColor \x3d vec4(1.0);\n}"};f.background={vertexSource:"#ifdef GL_ES\nprecision highp float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\n\nattribute vec2 a_pos;\n\nuniform mat4 u_matrix;\n\nvoid main() {\n    gl_Position \x3d u_matrix * vec4(a_pos, -1, 1);\n}",
fragmentSource:"#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif\n\nuniform vec4 u_color;\nuniform float u_opacity;\n\nvoid main() {\n    gl_FragColor \x3d u_color * u_opacity;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor \x3d vec4(1.0);\n#endif\n}"};f.fill={vertexSource:"#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif\n\nvec2 unpack_float(const float packedValue) {\n    int packedIntValue \x3d int(packedValue);\n    int v0 \x3d packedIntValue / 256;\n    return vec2(v0, packedIntValue - v0 * 256);\n}\n\nvec4 decode_color(const vec2 encodedColor) {\n    return vec4(\n        unpack_float(encodedColor[0]) / 255.0,\n        unpack_float(encodedColor[1]) / 255.0\n    );\n}\n\nfloat unpack_mix_vec2(const vec2 packedValue, const float t) {\n    return mix(packedValue[0], packedValue[1], t);\n}\n\nvec4 unpack_mix_color(const vec4 packedColors, const float t) {\n    vec4 minColor \x3d decode_color(vec2(packedColors[0], packedColors[1]));\n    vec4 maxColor \x3d decode_color(vec2(packedColors[2], packedColors[3]));\n    return mix(minColor, maxColor, t);\n}\n\nattribute vec2 a_pos;\nuniform mat4 u_matrix;\n#ifndef HAS_UNIFORM_u_color\nuniform lowp float u_color_t;\nattribute highp vec4 a_color;\nvarying highp vec4 color;\n#else\nuniform highp vec4 u_color;\n#endif\n\n#ifndef HAS_UNIFORM_u_opacity\nuniform lowp float u_opacity_t;\nattribute lowp vec2 a_opacity;\nvarying lowp float opacity;\n#else\nuniform lowp float u_opacity;\n#endif\n\nvoid main() {\n    #ifndef HAS_UNIFORM_u_color\n        color \x3d unpack_mix_color(a_color, u_color_t);\n    #else\n        highp vec4 color \x3d u_color;\n    #endif\n\n    #ifndef HAS_UNIFORM_u_opacity\n        opacity \x3d unpack_mix_vec2(a_opacity, u_opacity_t);\n    #else\n        lowp float opacity \x3d u_opacity;\n    #endif\n\n    gl_Position \x3d u_matrix * vec4(a_pos, 0, 1);\n}",
fragmentSource:"#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif\n\n#ifndef HAS_UNIFORM_u_color\nvarying highp vec4 color;\n#else\nuniform highp vec4 u_color;\n#endif\n\n#ifndef HAS_UNIFORM_u_opacity\nvarying lowp float opacity;\n#else\nuniform lowp float u_opacity;\n#endif\n\nvoid main() {\n    #ifdef HAS_UNIFORM_u_color\n        highp vec4 color \x3d u_color;\n    #endif\n\n    #ifdef HAS_UNIFORM_u_opacity\n        lowp float opacity \x3d u_opacity;\n    #endif\n\n    gl_FragColor \x3d color * opacity;\n    #ifdef OVERDRAW_INSPECTOR\n        gl_FragColor \x3d vec4(1.0);\n    #endif\n}"};
f.lineSDF={vertexSource:"#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif\n\nvec2 unpack_float(const float packedValue) {\n    int packedIntValue \x3d int(packedValue);\n    int v0 \x3d packedIntValue / 256;\n    return vec2(v0, packedIntValue - v0 * 256);\n}\n\nvec4 decode_color(const vec2 encodedColor) {\n    return vec4(\n        unpack_float(encodedColor[0]) / 255.0,\n        unpack_float(encodedColor[1]) / 255.0\n    );\n}\n\nfloat unpack_mix_vec2(const vec2 packedValue, const float t) {\n    return mix(packedValue[0], packedValue[1], t);\n}\n\nvec4 unpack_mix_color(const vec4 packedColors, const float t) {\n    vec4 minColor \x3d decode_color(vec2(packedColors[0], packedColors[1]));\n    vec4 maxColor \x3d decode_color(vec2(packedColors[2], packedColors[3]));\n    return mix(minColor, maxColor, t);\n}\n\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\n\nattribute vec2 a_pos_normal;\nattribute vec4 a_data;\n\nuniform mat4 u_matrix;\nuniform mediump float u_ratio;\nuniform lowp float u_device_pixel_ratio;\nuniform vec2 u_patternscale_a;\nuniform float u_tex_y_a;\nuniform vec2 u_patternscale_b;\nuniform float u_tex_y_b;\nuniform vec2 u_units_to_pixels;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying vec2 v_tex_a;\nvarying vec2 v_tex_b;\nvarying float v_gamma_scale;\n\n#ifndef HAS_UNIFORM_u_color\nuniform lowp float u_color_t;\nattribute highp vec4 a_color;\nvarying highp vec4 color;\n#else\nuniform highp vec4 u_color;\n#endif\n\n#ifndef HAS_UNIFORM_u_blur\nuniform lowp float u_blur_t;\nattribute lowp vec2 a_blur;\nvarying lowp float blur;\n#else\nuniform lowp float u_blur;\n#endif\n\n#ifndef HAS_UNIFORM_u_opacity\nuniform lowp float u_opacity_t;\nattribute lowp vec2 a_opacity;\nvarying lowp float opacity;\n#else\nuniform lowp float u_opacity;\n#endif\n\n#ifndef HAS_UNIFORM_u_gapwidth\nuniform lowp float u_gapwidth_t;\nattribute mediump vec2 a_gapwidth;\n#else\nuniform mediump float u_gapwidth;\n#endif\n\n#ifndef HAS_UNIFORM_u_offset\nuniform lowp float u_offset_t;\nattribute lowp vec2 a_offset;\n#else\nuniform lowp float u_offset;\n#endif\n\n#ifndef HAS_UNIFORM_u_width\nuniform lowp float u_width_t;\nattribute mediump vec2 a_width;\nvarying mediump float width;\n#else\nuniform mediump float u_width;\n#endif\n\n#ifndef HAS_UNIFORM_u_floorwidth\nuniform lowp float u_floorwidth_t;\nattribute lowp vec2 a_floorwidth;\nvarying lowp float floorwidth;\n#else\nuniform lowp float u_floorwidth;\n#endif\n\nvoid main() {\n    #ifndef HAS_UNIFORM_u_color\n        color \x3d unpack_mix_color(a_color, u_color_t);\n    #else\n        highp vec4 color \x3d u_color;\n    #endif\n\n    #ifndef HAS_UNIFORM_u_blur\n        blur \x3d unpack_mix_vec2(a_blur, u_blur_t);\n    #else\n        lowp float blur \x3d u_blur;\n    #endif\n\n    #ifndef HAS_UNIFORM_u_opacity\n        opacity \x3d unpack_mix_vec2(a_opacity, u_opacity_t);\n    #else\n        lowp float opacity \x3d u_opacity;\n    #endif\n\n    #ifndef HAS_UNIFORM_u_gapwidth\n        mediump float gapwidth \x3d unpack_mix_vec2(a_gapwidth, u_gapwidth_t);\n    #else\n        mediump float gapwidth \x3d u_gapwidth;\n    #endif\n\n    #ifndef HAS_UNIFORM_u_offset\n        lowp float offset \x3d unpack_mix_vec2(a_offset, u_offset_t);\n    #else\n        lowp float offset \x3d u_offset;\n    #endif\n\n    #ifndef HAS_UNIFORM_u_width\n        width \x3d unpack_mix_vec2(a_width, u_width_t);\n    #else\n        mediump float width \x3d u_width;\n    #endif\n\n    #ifndef HAS_UNIFORM_u_floorwidth\n        floorwidth \x3d unpack_mix_vec2(a_floorwidth, u_floorwidth_t);\n    #else\n        lowp float floorwidth \x3d u_floorwidth;\n    #endif\n\n    float ANTIALIASING \x3d 1.0 / u_device_pixel_ratio / 2.0;\n    vec2 a_extrude \x3d a_data.xy - 128.0;\n    float a_direction \x3d mod(a_data.z, 4.0) - 1.0;\n    float a_linesofar \x3d (floor(a_data.z / 4.0) + a_data.w * 64.0) * LINE_DISTANCE_SCALE;\n\n    vec2 pos \x3d floor(a_pos_normal * 0.5);\n\n    mediump vec2 normal \x3d a_pos_normal - 2.0 * pos;\n    normal.y \x3d normal.y * 2.0 - 1.0;\n    v_normal \x3d normal;\n\n    gapwidth \x3d gapwidth / 2.0;\n    float halfwidth \x3d width / 2.0;\n    offset \x3d -1.0 * offset;\n    float inset \x3d gapwidth + (gapwidth \x3e 0.0 ? ANTIALIASING : 0.0);\n    float outset \x3d gapwidth + halfwidth * (gapwidth \x3e 0.0 ? 2.0 : 1.0) + (halfwidth \x3d\x3d 0.0 ? 0.0 : ANTIALIASING);\n    mediump vec2 dist \x3doutset * a_extrude * scale;\n    mediump float u \x3d 0.5 * a_direction;\n    mediump float t \x3d 1.0 - abs(u);\n    mediump vec2 offset2 \x3d offset * a_extrude * scale * normal.y * mat2(t, -u, u, t);\n    vec4 projected_extrude \x3d u_matrix * vec4(dist / u_ratio, 0.0, 0.0);\n    gl_Position \x3d u_matrix * vec4(pos + offset2 / u_ratio, 1.1, 1.0) + projected_extrude;\n    float extrude_length_without_perspective \x3d length(dist);\n    float extrude_length_with_perspective \x3d length(projected_extrude.xy / gl_Position.w * u_units_to_pixels);\n    v_gamma_scale \x3d extrude_length_without_perspective / extrude_length_with_perspective;\n    v_tex_a \x3d vec2(a_linesofar * u_patternscale_a.x / floorwidth, normal.y * u_patternscale_a.y + u_tex_y_a);\n    v_tex_b \x3d vec2(a_linesofar * u_patternscale_b.x / floorwidth, normal.y * u_patternscale_b.y + u_tex_y_b);\n    v_width2 \x3d vec2(outset, inset);\n}",
fragmentSource:"#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif\n\nuniform lowp float u_device_pixel_ratio;\nuniform sampler2D u_image;\nuniform float u_sdfgamma;\nuniform float u_mix;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying vec2 v_tex_a;\nvarying vec2 v_tex_b;\nvarying float v_gamma_scale;\n\n#ifndef HAS_UNIFORM_u_color\nvarying highp vec4 color;\n#else\nuniform highp vec4 u_color;\n#endif\n\n#ifndef HAS_UNIFORM_u_blur\nvarying lowp float blur;\n#else\nuniform lowp float u_blur;\n#endif\n\n#ifndef HAS_UNIFORM_u_opacity\nvarying lowp float opacity;\n#else\nuniform lowp float u_opacity;\n#endif\n\n#ifndef HAS_UNIFORM_u_width\nvarying mediump float width;\n#else\nuniform mediump float u_width;\n#endif\n\n#ifndef HAS_UNIFORM_u_floorwidth\nvarying lowp float floorwidth;\n#else\nuniform lowp float u_floorwidth;\n#endif\n\nvoid main() {\n    #ifdef HAS_UNIFORM_u_color\n        highp vec4 color \x3d u_color;\n    #endif\n\n    #ifdef HAS_UNIFORM_u_blur\n        lowp float blur \x3d u_blur;\n    #endif\n\n    #ifdef HAS_UNIFORM_u_opacity\n        lowp float opacity \x3d u_opacity;\n    #endif\n\n    #ifdef HAS_UNIFORM_u_width\n        mediump float width \x3d u_width;\n    #endif\n\n    #ifdef HAS_UNIFORM_u_floorwidth\n        lowp float floorwidth \x3d u_floorwidth;\n    #endif\n    float dist \x3d length(v_normal) * v_width2.s;\n\n    float blur2 \x3d (blur + 1.0 / u_device_pixel_ratio) * v_gamma_scale;\n    float alpha \x3d clamp(min(dist - (v_width2.t - blur2), v_width2.s - dist) / blur2, 0.0, 1.0);\n    float sdfdist_a \x3d texture2D(u_image, v_tex_a).a;\n    float sdfdist_b \x3d texture2D(u_image, v_tex_b).a;\n    float sdfdist \x3d mix(sdfdist_a, sdfdist_b, u_mix);\n    alpha *\x3d smoothstep(0.5 - u_sdfgamma / floorwidth, 0.5 + u_sdfgamma / floorwidth, sdfdist);\n\n    gl_FragColor \x3d color * (alpha * opacity);\n\n    #ifdef OVERDRAW_INSPECTOR\n        gl_FragColor \x3d vec4(1.0);\n    #endif\n}"};
f.symbolSDF={vertexSource:"#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif\n\nvec2 unpack_float(const float packedValue) {\n    int packedIntValue \x3d int(packedValue);\n    int v0 \x3d packedIntValue / 256;\n    return vec2(v0, packedIntValue - v0 * 256);\n}\nvec2 unpack_opacity(const float packedOpacity) {\n    int intOpacity \x3d int(packedOpacity) / 2;\n    return vec2(float(intOpacity) / 127.0, mod(packedOpacity, 2.0));\n}\nvec4 decode_color(const vec2 encodedColor) {\n    return vec4(\n        unpack_float(encodedColor[0]) / 255.0,\n        unpack_float(encodedColor[1]) / 255.0\n    );\n}\nfloat unpack_mix_vec2(const vec2 packedValue, const float t) {\n    return mix(packedValue[0], packedValue[1], t);\n}\nvec4 unpack_mix_color(const vec4 packedColors, const float t) {\n    vec4 minColor \x3d decode_color(vec2(packedColors[0], packedColors[1]));\n    vec4 maxColor \x3d decode_color(vec2(packedColors[2], packedColors[3]));\n    return mix(minColor, maxColor, t);\n}\nconst float PI \x3d 3.141592653589793;\n\nattribute vec4 a_pos_offset;\nattribute vec4 a_data;\nattribute vec3 a_projected_pos;\nattribute float a_fade_opacity;\n\nuniform bool u_is_size_zoom_constant;\nuniform bool u_is_size_feature_constant;\nuniform highp float u_size_t; \nuniform highp float u_size; \nuniform mat4 u_matrix;\nuniform mat4 u_label_plane_matrix;\nuniform mat4 u_coord_matrix;\nuniform bool u_is_text;\nuniform bool u_pitch_with_map;\nuniform highp float u_pitch;\nuniform bool u_rotate_symbol;\nuniform highp float u_aspect_ratio;\nuniform highp float u_camera_to_center_distance;\nuniform float u_fade_change;\nuniform vec2 u_texsize;\n\nvarying vec2 v_data0;\nvarying vec3 v_data1;\n\n#ifndef HAS_UNIFORM_u_fill_color\nuniform lowp float u_fill_color_t;\nattribute highp vec4 a_fill_color;\nvarying highp vec4 fill_color;\n#else\nuniform highp vec4 u_fill_color;\n#endif\n\n#ifndef HAS_UNIFORM_u_halo_color\nuniform lowp float u_halo_color_t;\nattribute highp vec4 a_halo_color;\nvarying highp vec4 halo_color;\n#else\nuniform highp vec4 u_halo_color;\n#endif\n\n#ifndef HAS_UNIFORM_u_opacity\nuniform lowp float u_opacity_t;\nattribute lowp vec2 a_opacity;\nvarying lowp float opacity;\n#else\nuniform lowp float u_opacity;\n#endif\n\n#ifndef HAS_UNIFORM_u_halo_width\nuniform lowp float u_halo_width_t;\nattribute lowp vec2 a_halo_width;\nvarying lowp float halo_width;\n#else\nuniform lowp float u_halo_width;\n#endif\n\n#ifndef HAS_UNIFORM_u_halo_blur\nuniform lowp float u_halo_blur_t;\nattribute lowp vec2 a_halo_blur;\nvarying lowp float halo_blur;\n#else\nuniform lowp float u_halo_blur;\n#endif\n\nvoid main() { \n    #ifndef HAS_UNIFORM_u_fill_color\n        fill_color \x3d unpack_mix_color(a_fill_color, u_fill_color_t);\n    #else\n        highp vec4 fill_color \x3d u_fill_color;\n    #endif\n    \n        \n    #ifndef HAS_UNIFORM_u_halo_color\n        halo_color \x3d unpack_mix_color(a_halo_color, u_halo_color_t);\n    #else\n        highp vec4 halo_color \x3d u_halo_color;\n    #endif\n    \n        \n    #ifndef HAS_UNIFORM_u_opacity\n        opacity \x3d unpack_mix_vec2(a_opacity, u_opacity_t);\n    #else\n        lowp float opacity \x3d u_opacity;\n    #endif\n    \n        \n    #ifndef HAS_UNIFORM_u_halo_width\n        halo_width \x3d unpack_mix_vec2(a_halo_width, u_halo_width_t);\n    #else\n        lowp float halo_width \x3d u_halo_width;\n    #endif\n    \n        \n    #ifndef HAS_UNIFORM_u_halo_blur\n        halo_blur \x3d unpack_mix_vec2(a_halo_blur, u_halo_blur_t);\n    #else\n        lowp float halo_blur \x3d u_halo_blur;\n    #endif\n    vec2 a_pos \x3d a_pos_offset.xy;\n    vec2 a_offset \x3d a_pos_offset.zw;\n\n    vec2 a_tex \x3d a_data.xy;\n    vec2 a_size \x3d a_data.zw;\n\n    highp float segment_angle \x3d -a_projected_pos[2];\n    float size;\n    if (!u_is_size_zoom_constant \x26\x26 !u_is_size_feature_constant) {\n        size \x3d mix(a_size[0], a_size[1], u_size_t) / 256.0;\n    } else if (u_is_size_zoom_constant \x26\x26 !u_is_size_feature_constant) {\n        size \x3d a_size[0] / 256.0;\n    } else if (!u_is_size_zoom_constant \x26\x26 u_is_size_feature_constant) {\n        size \x3d u_size;\n    } else {\n        size \x3d u_size;\n    }\n    vec4 projectedPoint \x3d u_matrix * vec4(a_pos, 0, 1);\n    highp float camera_to_anchor_distance \x3d projectedPoint.w;\n    highp float distance_ratio \x3d u_pitch_with_map ? camera_to_anchor_distance / u_camera_to_center_distance : u_camera_to_center_distance / camera_to_anchor_distance;\n    highp float perspective_ratio \x3d clamp( 0.5 + 0.5 * distance_ratio, 0.0, 4.0);\n    size *\x3d perspective_ratio;\n    float fontScale \x3d u_is_text ? size / 24.0 : size;\n    highp float symbol_rotation \x3d 0.0;\n    if (u_rotate_symbol) {\n        vec4 offsetProjectedPoint \x3d u_matrix * vec4(a_pos + vec2(1, 0), 0, 1);\n        vec2 a \x3d projectedPoint.xy / projectedPoint.w;\n        vec2 b \x3d offsetProjectedPoint.xy / offsetProjectedPoint.w;\n        symbol_rotation \x3d atan((b.y - a.y) / u_aspect_ratio, b.x - a.x);\n    }\n    highp float angle_sin \x3d sin(segment_angle + symbol_rotation);\n    highp float angle_cos \x3d cos(segment_angle + symbol_rotation);\n    mat2 rotation_matrix \x3d mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);\n    vec4 projected_pos \x3d u_label_plane_matrix * vec4(a_projected_pos.xy, 0.0, 1.0);\n    gl_Position \x3d u_coord_matrix * vec4(projected_pos.xy / projected_pos.w + rotation_matrix * (a_offset / 32.0 * fontScale), 0.0, 1.0);\n    float gamma_scale \x3d gl_Position.w;\n    vec2 tex \x3d a_tex / u_texsize;\n    vec2 fade_opacity \x3d unpack_opacity(a_fade_opacity);\n    float fade_change \x3d fade_opacity[1] \x3e 0.5 ? u_fade_change : -u_fade_change;\n    float interpolated_fade_opacity \x3d max(0.0, min(1.0, fade_opacity[0] + fade_change));\n    v_data0 \x3d vec2(tex.x, tex.y);\n    v_data1 \x3d vec3(gamma_scale, size, interpolated_fade_opacity);\n}",
fragmentSource:"#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif\n\n#define SDF_PX 8.0\nuniform bool u_is_halo;\nuniform sampler2D u_texture;\nuniform highp float u_gamma_scale;\nuniform lowp float u_device_pixel_ratio;\nuniform bool u_is_text;\n\nvarying vec2 v_data0;\nvarying vec3 v_data1;\n\n#ifndef HAS_UNIFORM_u_fill_color\nvarying highp vec4 fill_color;\n#else\nuniform highp vec4 u_fill_color;\n#endif\n\n#ifndef HAS_UNIFORM_u_halo_color\nvarying highp vec4 halo_color;\n#else\nuniform highp vec4 u_halo_color;\n#endif\n\n#ifndef HAS_UNIFORM_u_opacity\nvarying lowp float opacity;\n#else\nuniform lowp float u_opacity;\n#endif\n\n#ifndef HAS_UNIFORM_u_halo_width\nvarying lowp float halo_width;\n#else\nuniform lowp float u_halo_width;\n#endif\n\n#ifndef HAS_UNIFORM_u_halo_blur\nvarying lowp float halo_blur;\n#else\nuniform lowp float u_halo_blur;\n#endif\nvoid main() {\n    #ifdef HAS_UNIFORM_u_fill_color\n        highp vec4 fill_color \x3d u_fill_color;\n    #endif\n    #ifdef HAS_UNIFORM_u_halo_color\n        highp vec4 halo_color \x3d u_halo_color;\n    #endif\n    #ifdef HAS_UNIFORM_u_opacity\n        lowp float opacity \x3d u_opacity;\n    #endif\n    #ifdef HAS_UNIFORM_u_halo_width\n        lowp float halo_width \x3d u_halo_width;\n    #endif\n    #ifdef HAS_UNIFORM_u_halo_blur\n        lowp float halo_blur \x3d u_halo_blur;\n    #endif\n\n    float EDGE_GAMMA \x3d 0.105 / u_device_pixel_ratio;\n    vec2 tex \x3d v_data0.xy;\n    float gamma_scale \x3d v_data1.x;\n    float size \x3d v_data1.y;\n    float fade_opacity \x3d v_data1[2];\n    float fontScale \x3d u_is_text ? size / 24.0 : size;\n    lowp vec4 color \x3d fill_color;\n    highp float gamma \x3d EDGE_GAMMA / (fontScale * u_gamma_scale);\n    lowp float buff \x3d (256.0 - 64.0) / 256.0;\n    if (u_is_halo) {\n        color \x3d halo_color;\n        gamma \x3d (halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (fontScale * u_gamma_scale);\n        buff \x3d (6.0 - halo_width / fontScale) / SDF_PX;\n    }\n    lowp float dist \x3d texture2D(u_texture, tex).a;\n    highp float gamma_scaled \x3d gamma * gamma_scale;\n    highp float alpha \x3d smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);\n    gl_FragColor \x3d color * (alpha * opacity * fade_opacity);\n    #ifdef OVERDRAW_INSPECTOR\n        gl_FragColor \x3d vec4(1.0);\n    #endif\n}"};
f.symbolIcon={vertexSource:"#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif\n\nvec2 unpack_opacity(const float packedOpacity) {\n    int intOpacity \x3d int(packedOpacity) / 2;\n    return vec2(float(intOpacity) / 127.0, mod(packedOpacity, 2.0));\n}\n\nfloat unpack_mix_vec2(const vec2 packedValue, const float t) {\n    return mix(packedValue[0], packedValue[1], t);\n}\n\nconst float PI \x3d 3.141592653589793;\nattribute vec4 a_pos_offset;\nattribute vec4 a_data;\nattribute vec3 a_projected_pos;\nattribute float a_fade_opacity;\n\nuniform bool u_is_size_zoom_constant;\nuniform bool u_is_size_feature_constant;\nuniform highp float u_size_t;\nuniform highp float u_size;\nuniform highp float u_camera_to_center_distance;\nuniform highp float u_pitch;\nuniform bool u_rotate_symbol;\nuniform highp float u_aspect_ratio;\nuniform float u_fade_change;\n\nuniform mat4 u_matrix;\nuniform mat4 u_label_plane_matrix;\nuniform mat4 u_coord_matrix;\n\nuniform bool u_is_text;\nuniform bool u_pitch_with_map;\n\nuniform vec2 u_texsize;\n\nvarying vec2 v_tex;\nvarying float v_fade_opacity;\n\n#ifndef HAS_UNIFORM_u_opacity\nuniform lowp float u_opacity_t;\nattribute lowp vec2 a_opacity;\nvarying lowp float opacity;\n#else\nuniform lowp float u_opacity;\n#endif\n\nvoid main() {\n    \n    #ifndef HAS_UNIFORM_u_opacity\n        opacity \x3d unpack_mix_vec2(a_opacity, u_opacity_t);\n    #else\n        lowp float opacity \x3d u_opacity;\n    #endif\n\n    vec2 a_pos \x3d a_pos_offset.xy;\n    vec2 a_offset \x3d a_pos_offset.zw;\n\n    vec2 a_tex \x3d a_data.xy;\n    vec2 a_size \x3d a_data.zw;\n\n    highp float segment_angle \x3d -a_projected_pos[2];\n\n    float size;\n    if (!u_is_size_zoom_constant \x26\x26 !u_is_size_feature_constant) {\n        size \x3d mix(a_size[0], a_size[1], u_size_t) / 256.0;\n    } else if (u_is_size_zoom_constant \x26\x26 !u_is_size_feature_constant) {\n        size \x3d a_size[0] / 256.0;\n    } else if (!u_is_size_zoom_constant \x26\x26 u_is_size_feature_constant) {\n        size \x3d u_size;\n    } else {\n        size \x3d u_size;\n    }\n\n    vec4 projectedPoint \x3d u_matrix * vec4(a_pos, 0, 1);\n    highp float camera_to_anchor_distance \x3d projectedPoint.w;\n    highp float distance_ratio \x3d u_pitch_with_map ? camera_to_anchor_distance / u_camera_to_center_distance : u_camera_to_center_distance / camera_to_anchor_distance;\n    highp float perspective_ratio \x3d clamp(0.5 + 0.5 * distance_ratio, 0.0, 4.0);\n\n    size *\x3d perspective_ratio;\n\n    float fontScale \x3d u_is_text ? size / 24.0 : size;\n\n    highp float symbol_rotation \x3d 0.0;\n    if (u_rotate_symbol) {\n        vec4 offsetProjectedPoint \x3d u_matrix * vec4(a_pos + vec2(1, 0), 0, 1);\n        vec2 a \x3d projectedPoint.xy / projectedPoint.w;\n        vec2 b \x3d offsetProjectedPoint.xy / offsetProjectedPoint.w;\n        symbol_rotation \x3d atan((b.y - a.y) / u_aspect_ratio, b.x - a.x);\n    }\n    highp float angle_sin \x3d sin(segment_angle + symbol_rotation);\n    highp float angle_cos \x3d cos(segment_angle + symbol_rotation);\n    mat2 rotation_matrix \x3d mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);\n    vec4 projected_pos \x3d u_label_plane_matrix * vec4(a_projected_pos.xy, 0.0, 1.0);\n    gl_Position \x3d u_coord_matrix * vec4(projected_pos.xy / projected_pos.w + rotation_matrix * (a_offset / 32.0 * fontScale), 0.99, 1.0);\n    v_tex \x3d a_tex / u_texsize;\n    vec2 fade_opacity \x3d unpack_opacity(a_fade_opacity);\n    float fade_change \x3d fade_opacity[1] \x3e 0.5 ? u_fade_change : -u_fade_change;\n    v_fade_opacity \x3d max(0.0, min(1.0, fade_opacity[0] + fade_change));\n}",
fragmentSource:"#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif\nuniform sampler2D u_texture;\nvarying vec2 v_tex;\nvarying float v_fade_opacity;\n\n#ifndef HAS_UNIFORM_u_opacity\nvarying lowp float opacity;\n#else\nuniform lowp float u_opacity;\n#endif\n\nvoid main() {\n    #ifdef HAS_UNIFORM_u_opacity\n        lowp float opacity \x3d u_opacity;\n    #endif\n    lowp float alpha \x3d opacity * v_fade_opacity;\n    gl_FragColor \x3d texture2D(u_texture, v_tex) * alpha;\n\n    #ifdef OVERDRAW_INSPECTOR\n        gl_FragColor \x3d vec4(1.0);\n    #endif\n}"};
f.heatmap={vertexSource:"#define HAS_UNIFORM_u_radius\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif\n\nfloat unpack_mix_vec2(const vec2 packedValue, const float t) {\n    return mix(packedValue[0], packedValue[1], t);\n}\n\nuniform mat4 u_matrix;\nuniform float u_extrude_scale;\nuniform float u_opacity;\nuniform float u_intensity;\n\nattribute vec2 a_pos;\n\nvarying vec2 v_extrude;\n\n\n#ifndef HAS_UNIFORM_u_weight\nuniform lowp float u_weight_t;\nattribute highp vec2 a_weight;\nvarying highp float weight;\n#else\nuniform highp float u_weight;\n#endif\n\n\n#ifndef HAS_UNIFORM_u_radius\nuniform lowp float u_radius_t;\nattribute mediump vec2 a_radius;\n#else\nuniform mediump float u_radius;\n#endif\n\n\nconst highp float ZERO \x3d 1.0 / 255.0 / 16.0;\n\n// #define GAUSS_COEF 0.3989422804014327\n#define GAUSS_COEF 1.0\n\nvoid main(void) {\n\n    #ifndef HAS_UNIFORM_u_weight\n    weight \x3d unpack_mix_vec2(a_weight, u_weight_t);\n    #else\n    highp float weight \x3d u_weight;\n    #endif\n\n\n    #ifndef HAS_UNIFORM_u_radius\n    mediump float radius \x3d unpack_mix_vec2(a_radius, u_radius_t);\n    #else\n    mediump float radius \x3d u_radius;\n    #endif\n\n\n    vec2 unscaled_extrude \x3d vec2(mod(a_pos, 2.0) * 2.0 - 1.0);\n\n    // S \x3d sqrt(-2.0 * log(ZERO / (weight * u_intensity * GAUSS_COEF))) / 3.0\n    float S \x3d sqrt(-2.0 * log(ZERO / weight / u_intensity / GAUSS_COEF)) / 3.0;\n\n    // Pass the varying in units of radius\n    v_extrude \x3d S * unscaled_extrude;\n\n    // Scale by radius and the zoom-based scale factor to produce actual\n    // mesh position\n    vec2 extrude \x3d v_extrude * radius * u_extrude_scale;\n\n    // multiply a_pos by 0.5, since we had it * 2 in order to sneak\n    // in extrusion data\n    vec4 pos \x3d vec4(floor(a_pos * 0.5) + extrude, 0, 1);\n\n    gl_Position \x3d u_matrix * pos;\n}",
fragmentSource:"#define HAS_UNIFORM_u_radius\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif\n\nuniform highp float u_intensity;\n\nvarying vec2 v_extrude;\n\n\n#ifndef HAS_UNIFORM_u_weight\nvarying highp float weight;\n#else\nuniform highp float u_weight;\n#endif\n\n\n// Gaussian kernel coefficient: 1 / sqrt(2 * PI)\n#define GAUSS_COEF 0.3989422804014327\n\nvoid main() {\n\n    #ifdef HAS_UNIFORM_u_weight\n    highp float weight \x3d u_weight;\n    #endif\n\n\n    // Kernel density estimation with a Gaussian kernel of size 5x5\n    float d \x3d -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);\n    float val \x3d weight * u_intensity * GAUSS_COEF * exp(d);\n\n    gl_FragColor \x3d vec4(val, 1.0, 1.0, 1.0);\n\n    #ifdef OVERDRAW_INSPECTOR\n    gl_FragColor \x3d vec4(1.0);\n    #endif\n}"};
f.heatmapTexture={vertexSource:"#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif\n\nuniform mat4 u_matrix;\nuniform vec2 u_world;\nattribute vec2 a_pos;\nvarying vec2 v_pos;\n\nvoid main() {\n    gl_Position \x3d u_matrix * vec4(a_pos * u_world, 0, 1);\n\n    v_pos.x \x3d a_pos.x;\n    v_pos.y \x3d 1.0 - a_pos.y;\n}",fragmentSource:"#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif\n\nuniform sampler2D u_image;\nuniform sampler2D u_color_ramp;\nuniform float u_opacity;\nvarying vec2 v_pos;\n\nvoid main() {\n    float t \x3d texture2D(u_image, v_pos).r;\n    vec4 color \x3d texture2D(u_color_ramp, vec2(t, 0.5));\n    gl_FragColor \x3d color * u_opacity;\n\n    #ifdef OVERDRAW_INSPECTOR\n    gl_FragColor \x3d vec4(0.0);\n    #endif\n}"};
f.raster={vertexSource:"#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif\n\nuniform mat4 u_matrix;\nuniform vec2 u_tl_parent;\nuniform float u_scale_parent;\nuniform float u_buffer_scale;\n\nattribute vec2 a_pos;\nattribute vec2 a_texture_pos;\n\nvarying vec2 v_pos0;\nvarying vec2 v_pos1;\n\nvoid main() {\n    gl_Position \x3d u_matrix * vec4(a_pos, 0, 1);\n    v_pos0 \x3d (((a_texture_pos / 8192.0) - 0.5) / u_buffer_scale ) + 0.5;\n    v_pos1 \x3d (v_pos0 * u_scale_parent) + u_tl_parent;\n}",
fragmentSource:"#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif\n\nuniform float u_fade_t;\nuniform float u_opacity;\nuniform sampler2D u_image0;\nuniform sampler2D u_image1;\nvarying vec2 v_pos0;\nvarying vec2 v_pos1;\n\nuniform float u_brightness_low;\nuniform float u_brightness_high;\n\nuniform float u_saturation_factor;\nuniform float u_contrast_factor;\nuniform vec3 u_spin_weights;\n\nvoid main() {\n    vec4 color0 \x3d texture2D(u_image0, v_pos0);\n    vec4 color1 \x3d texture2D(u_image1, v_pos1);\n    if (color0.a \x3e 0.0) {\n        color0.rgb \x3d color0.rgb / color0.a;\n    }\n    if (color1.a \x3e 0.0) {\n        color1.rgb \x3d color1.rgb / color1.a;\n    }\n    vec4 color \x3d mix(color0, color1, u_fade_t);\n    color.a *\x3d u_opacity;\n    vec3 rgb \x3d color.rgb;\n\n    // spin\n    rgb \x3d vec3(\n    dot(rgb, u_spin_weights.xyz),\n    dot(rgb, u_spin_weights.zxy),\n    dot(rgb, u_spin_weights.yzx));\n\n    // saturation\n    float average \x3d (color.r + color.g + color.b) / 3.0;\n    rgb +\x3d (average - rgb) * u_saturation_factor;\n\n    // contrast\n    rgb \x3d (rgb - 0.5) * u_contrast_factor + 0.5;\n\n    // brightness\n    vec3 u_high_vec \x3d vec3(u_brightness_low, u_brightness_low, u_brightness_low);\n    vec3 u_low_vec \x3d vec3(u_brightness_high, u_brightness_high, u_brightness_high);\n\n    gl_FragColor \x3d vec4(mix(u_high_vec, u_low_vec, rgb) * color.a, color.a);\n}"};
f.image={vertexSource:"#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif\n\nuniform mat4 u_matrix;\nattribute vec2 a_pos;\nattribute vec2 a_texture_pos;\nvarying vec2 v_pos;\n\nvoid main() {\n    // gl_Position \x3d u_matrix * vec4(a_pos, 0.0, 1.0);\n    gl_Position \x3d u_matrix * vec4(a_pos, 0.0, 1.0);\n    v_pos \x3d a_texture_pos/8192.0;\n}",fragmentSource:"#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif\n\nuniform sampler2D u_image;\nuniform float u_opacity;\nvarying vec2 v_pos;\n\nvoid main() {\n    vec4 color \x3d texture2D(u_image, v_pos);\n    gl_FragColor \x3d color * u_opacity;\n}"};
f.circle={vertexSource:"uniform mat4 u_matrix;\n  uniform bool u_scale_with_map;\n  uniform bool u_pitch_with_map;\n  uniform vec2 u_extrude_scale;\n  uniform lowp float u_device_pixel_ratio;\n  uniform highp float u_camera_to_center_distance;\n  attribute vec2 a_pos;\n  attribute vec2 a_data;\n  varying vec3 v_data;\n  varying vec4 v_color;\n  uniform mediump float radius;\n  uniform mediump float stroke_width;\n  void main(void) {\n    vec2 extrude \x3d a_data;\n    vec2 circle_center \x3d a_pos;\n    if (u_pitch_with_map) {\n      vec2 corner_position \x3d circle_center;\n      if (u_scale_with_map) {\n        corner_position +\x3d extrude * (radius + stroke_width) * u_extrude_scale;\n      } else {\n        vec4 projected_center \x3d u_matrix * vec4(circle_center, 0, 1);\n        corner_position +\x3d extrude * (radius + stroke_width) * u_extrude_scale * (projected_center.w / u_camera_to_center_distance);\n      }\n\n      gl_Position \x3d u_matrix * vec4(corner_position, 0, 1);\n    } else {\n      gl_Position \x3d u_matrix * vec4(circle_center, 0, 1);\n\n      if (u_scale_with_map) {\n        gl_Position.xy +\x3d extrude * (radius + stroke_width) * u_extrude_scale * u_camera_to_center_distance;\n      } else {\n        gl_Position.xy +\x3d extrude * (radius + stroke_width) * u_extrude_scale * gl_Position.w;\n      }\n    }\n    lowp float antialiasblur \x3d 1.0 / u_device_pixel_ratio / (radius + stroke_width);\n\n    v_data \x3d vec3(extrude.x, extrude.y, antialiasblur);\n  }",
fragmentSource:"precision mediump float;\n  varying vec3 v_data;\n  uniform highp vec4 color;\n  uniform mediump float radius;\n  uniform lowp float blur;\n  uniform lowp float opacity;\n  uniform highp vec4 stroke_color;\n  uniform mediump float stroke_width;\n  uniform lowp float stroke_opacity;\n\n  void main() {\n\n    vec2 extrude \x3d v_data.xy;\n    float extrude_length \x3d length(extrude);\n\n    lowp float antialiasblur \x3d v_data.z;\n    float antialiased_blur \x3d -max(blur, antialiasblur);\n\n    float opacity_t \x3d smoothstep(0.0, antialiased_blur, extrude_length - 1.0);\n\n    float color_t \x3d stroke_width \x3c 0.01 ? 0.0 : smoothstep(\n    antialiased_blur,\n    0.0,\n    extrude_length - radius / (radius + stroke_width)\n    );\n\n    gl_FragColor \x3d opacity_t * mix(color * opacity, stroke_color * stroke_opacity, color_t);\n  }"};
f.circles={vertexSource:"#define HAS_UNIFORM_u_stroke_color\n#define HAS_UNIFORM_u_stroke_width\n#define HAS_UNIFORM_u_opacity\n#define HAS_UNIFORM_u_blur\n#define HAS_UNIFORM_u_stroke_opacity\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif\n\nvec2 unpack_float(const float packedValue) {\n    int packedIntValue \x3d int(packedValue);\n    int v0 \x3d packedIntValue / 256;\n    return vec2(v0, packedIntValue - v0 * 256);\n}\n\nvec4 decode_color(const vec2 encodedColor) {\n    return vec4(\n    unpack_float(encodedColor[0]) / 255.0,\n    unpack_float(encodedColor[1]) / 255.0\n    );\n}\n\nfloat unpack_mix_vec2(const vec2 packedValue, const float t) {\n    return mix(packedValue[0], packedValue[1], t);\n}\n\nvec4 unpack_mix_color(const vec4 packedColors, const float t) {\n    vec4 minColor \x3d decode_color(vec2(packedColors[0], packedColors[1]));\n    vec4 maxColor \x3d decode_color(vec2(packedColors[2], packedColors[3]));\n    return mix(minColor, maxColor, t);\n}\n\nuniform mat4 u_matrix;\nuniform bool u_scale_with_map;\nuniform bool u_pitch_with_map;\nuniform vec2 u_extrude_scale;\nuniform lowp float u_device_pixel_ratio;\nuniform highp float u_camera_to_center_distance;\n\nattribute vec2 a_pos;\n\nvarying vec3 v_data;\n\n\n#ifndef HAS_UNIFORM_u_color\nuniform lowp float u_color_t;\nattribute highp vec4 a_color;\nvarying highp vec4 color;\n#else\nuniform highp vec4 u_color;\n#endif\n\n\n#ifndef HAS_UNIFORM_u_radius\nuniform lowp float u_radius_t;\nattribute mediump vec2 a_radius;\nvarying mediump float radius;\n#else\nuniform mediump float u_radius;\n#endif\n\n\n#ifndef HAS_UNIFORM_u_blur\nuniform lowp float u_blur_t;\nattribute lowp vec2 a_blur;\nvarying lowp float blur;\n#else\nuniform lowp float u_blur;\n#endif\n\n\n#ifndef HAS_UNIFORM_u_opacity\nuniform lowp float u_opacity_t;\nattribute lowp vec2 a_opacity;\nvarying lowp float opacity;\n#else\nuniform lowp float u_opacity;\n#endif\n\n\n#ifndef HAS_UNIFORM_u_stroke_color\nuniform lowp float u_stroke_color_t;\nattribute highp vec4 a_stroke_color;\nvarying highp vec4 stroke_color;\n#else\nuniform highp vec4 u_stroke_color;\n#endif\n\n\n#ifndef HAS_UNIFORM_u_stroke_width\nuniform lowp float u_stroke_width_t;\nattribute mediump vec2 a_stroke_width;\nvarying mediump float stroke_width;\n#else\nuniform mediump float u_stroke_width;\n#endif\n\n\n#ifndef HAS_UNIFORM_u_stroke_opacity\nuniform lowp float u_stroke_opacity_t;\nattribute lowp vec2 a_stroke_opacity;\nvarying lowp float stroke_opacity;\n#else\nuniform lowp float u_stroke_opacity;\n#endif\n\n\nvoid main(void) {\n\n    #ifndef HAS_UNIFORM_u_color\n    color \x3d unpack_mix_color(a_color, u_color_t);\n    #else\n    highp vec4 color \x3d u_color;\n    #endif\n\n\n    #ifndef HAS_UNIFORM_u_radius\n    radius \x3d unpack_mix_vec2(a_radius, u_radius_t);\n    #else\n    mediump float radius \x3d u_radius;\n    #endif\n\n\n    #ifndef HAS_UNIFORM_u_blur\n    blur \x3d unpack_mix_vec2(a_blur, u_blur_t);\n    #else\n    lowp float blur \x3d u_blur;\n    #endif\n\n\n    #ifndef HAS_UNIFORM_u_opacity\n    opacity \x3d unpack_mix_vec2(a_opacity, u_opacity_t);\n    #else\n    lowp float opacity \x3d u_opacity;\n    #endif\n\n\n    #ifndef HAS_UNIFORM_u_stroke_color\n    stroke_color \x3d unpack_mix_color(a_stroke_color, u_stroke_color_t);\n    #else\n    highp vec4 stroke_color \x3d u_stroke_color;\n    #endif\n\n\n    #ifndef HAS_UNIFORM_u_stroke_width\n    stroke_width \x3d unpack_mix_vec2(a_stroke_width, u_stroke_width_t);\n    #else\n    mediump float stroke_width \x3d u_stroke_width;\n    #endif\n\n\n    #ifndef HAS_UNIFORM_u_stroke_opacity\n    stroke_opacity \x3d unpack_mix_vec2(a_stroke_opacity, u_stroke_opacity_t);\n    #else\n    lowp float stroke_opacity \x3d u_stroke_opacity;\n    #endif\n\n\n    // unencode the extrusion vector that we snuck into the a_pos vector\n    vec2 extrude \x3d vec2(mod(a_pos, 2.0) * 2.0 - 1.0);\n\n    // multiply a_pos by 0.5, since we had it * 2 in order to sneak\n    // in extrusion data\n    vec2 circle_center \x3d floor(a_pos * 0.5);\n    if (u_pitch_with_map) {\n        vec2 corner_position \x3d circle_center;\n        if (u_scale_with_map) {\n            corner_position +\x3d extrude * (radius + stroke_width) * u_extrude_scale;\n        } else {\n            // Pitching the circle with the map effectively scales it with the map\n            // To counteract the effect for pitch-scale: viewport, we rescale the\n            // whole circle based on the pitch scaling effect at its central point\n            vec4 projected_center \x3d u_matrix * vec4(circle_center, 0, 1);\n            corner_position +\x3d extrude * (radius + stroke_width) * u_extrude_scale * (projected_center.w / u_camera_to_center_distance);\n        }\n\n        gl_Position \x3d u_matrix * vec4(corner_position, 2, 1);\n    } else {\n        gl_Position \x3d u_matrix * vec4(circle_center, 2, 1);\n\n        if (u_scale_with_map) {\n            gl_Position.xy +\x3d extrude * (radius + stroke_width) * u_extrude_scale * u_camera_to_center_distance;\n        } else {\n            gl_Position.xy +\x3d extrude * (radius + stroke_width) * u_extrude_scale * gl_Position.w;\n        }\n    }\n\n        // This is a minimum blur distance that serves as a faux-antialiasing for\n        // the circle. since blur is a ratio of the circle's size and the intent is\n        // to keep the blur at roughly 1px, the two are inversely related.\n        lowp float antialiasblur \x3d 1.0 / u_device_pixel_ratio / (radius + stroke_width);\n\n    v_data \x3d vec3(extrude.x, extrude.y, antialiasblur);\n}",
fragmentSource:"#define HAS_UNIFORM_u_stroke_color\n#define HAS_UNIFORM_u_stroke_width\n#define HAS_UNIFORM_u_opacity\n#define HAS_UNIFORM_u_blur\n#define HAS_UNIFORM_u_stroke_opacity\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif\n\nvarying vec3 v_data;\n\n\n#ifndef HAS_UNIFORM_u_color\nvarying highp vec4 color;\n#else\nuniform highp vec4 u_color;\n#endif\n\n\n#ifndef HAS_UNIFORM_u_radius\nvarying mediump float radius;\n#else\nuniform mediump float u_radius;\n#endif\n\n\n#ifndef HAS_UNIFORM_u_blur\nvarying lowp float blur;\n#else\nuniform lowp float u_blur;\n#endif\n\n\n#ifndef HAS_UNIFORM_u_opacity\nvarying lowp float opacity;\n#else\nuniform lowp float u_opacity;\n#endif\n\n\n#ifndef HAS_UNIFORM_u_stroke_color\nvarying highp vec4 stroke_color;\n#else\nuniform highp vec4 u_stroke_color;\n#endif\n\n\n#ifndef HAS_UNIFORM_u_stroke_width\nvarying mediump float stroke_width;\n#else\nuniform mediump float u_stroke_width;\n#endif\n\n\n#ifndef HAS_UNIFORM_u_stroke_opacity\n#ifndef HAS_UNIFORM_u_stroke_opacity\nvarying lowp float stroke_opacity;\n#else\nuniform lowp float u_stroke_opacity;\n#endif\n\n\nvoid main() {\n\n    #ifdef HAS_UNIFORM_u_color\n    highp vec4 color \x3d u_color;\n    #endif\n\n\n    #ifdef HAS_UNIFORM_u_radius\n    mediump float radius \x3d u_radius;\n    #endif\n\n\n    #ifdef HAS_UNIFORM_u_blur\n    lowp float blur \x3d u_blur;\n    #endif\n\n\n    #ifdef HAS_UNIFORM_u_opacity\n    lowp float opacity \x3d u_opacity;\n    #endif\n\n\n    #ifdef HAS_UNIFORM_u_stroke_color\n    highp vec4 stroke_color \x3d u_stroke_color;\n    #endif\n\n\n    #ifdef HAS_UNIFORM_u_stroke_width\n    mediump float stroke_width \x3d u_stroke_width;\n    #endif\n\n\n    #ifdef HAS_UNIFORM_u_stroke_opacity\n    lowp float stroke_opacity \x3d u_stroke_opacity;\n    #endif\n\n\n    vec2 extrude \x3d v_data.xy;\n    float extrude_length \x3d length(extrude);\n\n    lowp float antialiasblur \x3d v_data.z;\n    float antialiased_blur \x3d -max(blur, antialiasblur);\n\n    float opacity_t \x3d smoothstep(0.0, antialiased_blur, extrude_length - 1.0);\n\n    float color_t \x3d stroke_width \x3c 0.01 ? 0.0 : smoothstep(\n    antialiased_blur,\n    0.0,\n    extrude_length - radius / (radius + stroke_width)\n    );\n\n    gl_FragColor \x3d opacity_t * mix(color * opacity, stroke_color * stroke_opacity, color_t);\n\n}"};
f.basicLine={vertexSource:"precision highp float;\n\n    #define scale 0.01587301\n    // #define scale 0.007936508\n\n    attribute vec2 a_pos;\n    attribute vec4 a_data;\n    attribute vec2 a_normal;\n\n    uniform mat4 u_matrix;\n    uniform mediump float u_ratio;\n    uniform vec2 u_units_to_pixels;\n\n    varying vec2 v_normal;\n    varying vec2 v_width2;\n    varying float v_gamma_scale;\n    varying highp float v_linesofar;\n\n    uniform highp vec4 u_color;\n    uniform lowp float u_blur;\n    uniform lowp float u_opacity;\n    uniform mediump float u_gapwidth;\n    uniform lowp float u_offset;\n    uniform mediump float u_width;\n\n    void main() {\n        highp vec4 color \x3d u_color;\n        lowp float blur \x3d u_blur;\n        lowp float opacity \x3d u_opacity;\n        mediump float gapwidth \x3d u_gapwidth;\n        lowp float offset \x3d u_offset;\n        mediump float width \x3d u_width;\n\n        // the distance over which the line edge fades out.\n        // Retina devices need a smaller distance to avoid aliasing.\n        float ANTIALIASING \x3d 0.5;\n\n        vec2 a_extrude \x3d a_data.xy - 128.0;\n        float a_direction \x3d mod(a_data.z, 4.0) - 1.0;\n\n        v_linesofar \x3d (floor(a_data.z / 4.0) + a_data.w * 64.0) * 2.0;\n\n        vec2 pos \x3d a_pos;\n\n        mediump vec2 normal \x3d a_normal;\n        normal.y \x3d normal.y * 2.0 - 1.0;\n        v_normal \x3d normal;\n\n        // these transformations used to be applied in the JS and native code bases.\n        // moved them into the shader for clarity and simplicity.\n        gapwidth \x3d gapwidth / 2.0;\n        float halfwidth \x3d width / 2.0;\n        offset \x3d -1.0 * offset;\n\n        float inset \x3d gapwidth + (gapwidth \x3e 0.0 ? ANTIALIASING : 0.0);\n        float outset \x3d gapwidth + halfwidth * (gapwidth \x3e 0.0 ? 2.0 : 1.0) + (halfwidth \x3d\x3d 0.0 ? 0.0 : ANTIALIASING);\n\n        // Scale the extrusion vector down to a normal and then up by the line width\n        // of this vertex.\n        mediump vec2 dist \x3d outset * a_extrude * scale;\n\n        // Calculate the offset when drawing a line that is to the side of the actual line.\n        // We do this by creating a vector that points towards the extrude, but rotate\n        // it when we're drawing round end points (a_direction \x3d -1 or 1) since their\n        // extrude vector points in another direction.\n        mediump float u \x3d 0.5 * a_direction;\n        mediump float t \x3d 1.0 - abs(u);\n        mediump vec2 offset2 \x3d offset * a_extrude * scale * normal.y * mat2(t, -u, u, t);\n\n        vec4 projected_extrude \x3d u_matrix * vec4(dist / u_ratio, 0.0, 0.0);\n        gl_Position \x3d u_matrix * vec4(pos + offset2 / u_ratio, 0.0, 1.0) + projected_extrude;\n\n        // calculate how much the perspective view squishes or stretches the extrude\n        float extrude_length_without_perspective \x3d length(dist);\n        float extrude_length_with_perspective \x3d length(projected_extrude.xy / gl_Position.w * u_units_to_pixels);\n        v_gamma_scale \x3d extrude_length_without_perspective / extrude_length_with_perspective;\n\n        v_width2 \x3d vec2(outset, inset);\n    }",
fragmentSource:"precision mediump float;\n\n    varying vec2 v_width2;\n    varying vec2 v_normal;\n    varying float v_gamma_scale;\n    uniform highp vec4 u_color;\n    uniform lowp float u_opacity;\n\n    void main() {\n\n\n        highp vec4 color \x3d u_color;\n        lowp float blur \x3d 0.0;\n        lowp float opacity \x3d u_opacity;\n        lowp float u_device_pixel_ratio \x3d 1.0;\n\n        float dist \x3d length(v_normal) * v_width2.s;\n\n        float blur2 \x3d (blur + 1.0 / u_device_pixel_ratio) * v_gamma_scale;\n        float alpha \x3d clamp(min(dist - (v_width2.t - blur2), v_width2.s - dist) / blur2, 0.0, 1.0);\n        gl_FragColor \x3d color * (alpha * opacity);\n        // gl_FragColor \x3d vec4(0.0, 1.0, 0.0, 1.0);\n    }"};
f.basicFill={vertexSource:"attribute vec2 a_pos;\n    uniform mat4 u_matrix;\n    void main() {\n        gl_Position \x3d u_matrix * vec4(a_pos, 0.0, 1.0);\n    }",fragmentSource:"precision mediump float;\n    uniform highp vec4 u_color;\n    uniform lowp float u_opacity;\n    void main() {\n        gl_FragColor \x3d u_color * u_opacity;\n    }"};f.basicLineSDF={vertexSource:"#define scale 0.015873016\n  #define LINE_DISTANCE_SCALE 2.0\n  attribute vec2 a_pos;\n  attribute vec4 a_data;\n  attribute vec2 a_normal;\n\n  uniform mat4 u_matrix;\n  uniform mediump float u_ratio;\n  uniform vec2 u_patternscale_a;\n  uniform float u_tex_y_a;\n  uniform vec2 u_patternscale_b;\n  uniform float u_tex_y_b;\n  uniform vec2 u_units_to_pixels;\n\n  varying vec2 v_normal;\n  varying vec2 v_width2;\n  varying vec2 v_tex_a;\n  varying vec2 v_tex_b;\n  varying float v_gamma_scale;\n\n  uniform highp vec4 u_color;\n  uniform lowp float u_blur;\n  uniform lowp float u_opacity;\n  uniform mediump float u_gapwidth;\n  uniform lowp float u_offset;\n  uniform mediump float u_width;\n  uniform lowp float u_floorwidth;\n\n  void main() {\n    highp vec4 color \x3d u_color;\n    lowp float blur \x3d u_blur;\n    lowp float opacity \x3d u_opacity;\n    mediump float gapwidth \x3d u_gapwidth;\n    lowp float offset \x3d u_offset;\n    mediump float width \x3d u_width;\n    lowp float floorwidth \x3d u_floorwidth;\n\n    float ANTIALIASING \x3d 1.0 / 1.0 / 2.0;\n\n    vec2 a_extrude \x3d a_data.xy - 128.0;\n    float a_direction \x3d mod(a_data.z, 4.0) - 1.0;\n    float a_linesofar \x3d (floor(a_data.z / 4.0) + a_data.w * 64.0) * LINE_DISTANCE_SCALE;\n\n    vec2 pos \x3d a_pos;\n\n    // x is 1 if it's a round cap, 0 otherwise\n    // y is 1 if the normal points up, and -1 if it points down\n    // We store these in the least significant bit of position\n    mediump vec2 normal \x3d a_normal;\n    normal.y \x3d normal.y * 2.0 - 1.0;\n    v_normal \x3d normal;\n\n    // these transformations used to be applied in the JS and native code bases.\n    // moved them into the shader for clarity and simplicity.\n    gapwidth \x3d gapwidth / 2.0;\n    float halfwidth \x3d width / 2.0;\n    offset \x3d -1.0 * offset;\n\n    float inset \x3d gapwidth + (gapwidth \x3e 0.0 ? ANTIALIASING : 0.0);\n    float outset \x3d gapwidth + halfwidth * (gapwidth \x3e 0.0 ? 2.0 : 1.0) + (halfwidth \x3d\x3d 0.0 ? 0.0 : ANTIALIASING);\n\n    // Scale the extrusion vector down to a normal and then up by the line width\n    // of this vertex.\n    mediump vec2 dist \x3doutset * a_extrude * scale;\n\n    // Calculate the offset when drawing a line that is to the side of the actual line.\n    // We do this by creating a vector that points towards the extrude, but rotate\n    // it when we're drawing round end points (a_direction \x3d -1 or 1) since their\n    // extrude vector points in another direction.\n    mediump float u \x3d 0.5 * a_direction;\n    mediump float t \x3d 1.0 - abs(u);\n    mediump vec2 offset2 \x3d offset * a_extrude * scale * normal.y * mat2(t, -u, u, t);\n\n    vec4 projected_extrude \x3d u_matrix * vec4(dist / u_ratio, 0.0, 0.0);\n    gl_Position \x3d u_matrix * vec4(pos + offset2 / u_ratio, 0.0, 1.0) + projected_extrude;\n\n    // calculate how much the perspective view squishes or stretches the extrude\n    float extrude_length_without_perspective \x3d length(dist);\n    float extrude_length_with_perspective \x3d length(projected_extrude.xy / gl_Position.w * u_units_to_pixels);\n    v_gamma_scale \x3d extrude_length_without_perspective / extrude_length_with_perspective;\n\n    v_tex_a \x3d vec2(a_linesofar * u_patternscale_a.x / floorwidth, normal.y * u_patternscale_a.y + u_tex_y_a);\n    v_tex_b \x3d vec2(a_linesofar * u_patternscale_b.x / floorwidth, normal.y * u_patternscale_b.y + u_tex_y_b);\n\n    v_width2 \x3d vec2(outset, inset);\n  }",
fragmentSource:"precision mediump float;\n\n  uniform sampler2D u_image;\n  uniform float u_sdfgamma;\n  uniform float u_mix;\n\n  varying vec2 v_normal;\n  varying vec2 v_width2;\n  varying vec2 v_tex_a;\n  varying vec2 v_tex_b;\n  varying float v_gamma_scale;\n\n  uniform highp vec4 u_color;\n  uniform lowp float u_blur;\n  uniform lowp float u_opacity;\n  uniform mediump float u_width;\n  uniform lowp float u_floorwidth;\n\n  void main() {\n\n    highp vec4 color \x3d u_color;\n    lowp float blur \x3d u_blur;\n    lowp float opacity \x3d u_opacity;\n    mediump float width \x3d u_width;\n    lowp float floorwidth \x3d u_floorwidth;\n\n    // Calculate the distance of the pixel from the line in pixels.\n    float dist \x3d length(v_normal) * v_width2.s;\n\n    // Calculate the antialiasing fade factor. This is either when fading in\n    // the line in case of an offset line (v_width2.t) or when fading out\n    // (v_width2.s)\n    float blur2 \x3d (blur + 1.0 / 1.0) * v_gamma_scale;\n    float alpha \x3d clamp(min(dist - (v_width2.t - blur2), v_width2.s - dist) / blur2, 0.0, 1.0);\n\n    float sdfdist_a \x3d texture2D(u_image, v_tex_a).a;\n    float sdfdist_b \x3d texture2D(u_image, v_tex_b).a;\n    float sdfdist \x3d mix(sdfdist_a, sdfdist_b, u_mix);\n    alpha *\x3d smoothstep(0.5 - u_sdfgamma / floorwidth, 0.5 + u_sdfgamma / floorwidth, sdfdist);\n\n    gl_FragColor \x3d color * (alpha * opacity);\n\n    #ifdef OVERDRAW_INSPECTOR\n    gl_FragColor \x3d vec4(1.0);\n    #endif\n  }"};
f.basicSymbol={vertexSource:"const float PI \x3d 3.141592653589793;\n    attribute vec4 a_pos_offset;\n    attribute vec4 a_data;\n    attribute vec3 a_projected_pos;\n\n    uniform highp float u_size; // used when size is both zoom and feature constant\n    uniform mat4 u_matrix;\n    uniform mat4 u_label_plane_matrix;\n    uniform mat4 u_coord_matrix;\n    uniform bool u_is_text;\n    uniform bool u_pitch_with_map;\n    uniform highp float u_pitch;\n    uniform bool u_rotate_symbol;\n    uniform highp float u_aspect_ratio;\n    uniform highp float u_camera_to_center_distance;\n    uniform float u_fade_change;\n    uniform vec2 u_texsize;\n\n    varying vec2 v_data0;\n    varying vec3 v_data1;\n\n    uniform highp vec4 u_fill_color;\n    uniform highp vec4 u_halo_color;\n    uniform lowp float u_opacity;\n    uniform lowp float u_halo_width;\n    uniform lowp float u_halo_blur;\n\n    void main() {\n        highp vec4 fill_color \x3d u_fill_color;\n        highp vec4 halo_color \x3d u_halo_color;\n        lowp float opacity \x3d u_opacity;\n        lowp float halo_width \x3d u_halo_width;\n        lowp float halo_blur \x3d u_halo_blur;\n\n        vec2 a_pos \x3d a_pos_offset.xy;\n        vec2 a_offset \x3d a_pos_offset.zw;\n        vec2 a_tex \x3d a_data.xy;\n        vec2 a_size \x3d a_data.zw;\n        highp float segment_angle \x3d -a_projected_pos[2];\n        float size \x3d u_size;\n\n        vec4 projectedPoint \x3d u_matrix * vec4(a_pos, 0, 1);\n        highp float camera_to_anchor_distance \x3d projectedPoint.w;\n        highp float distance_ratio \x3d u_pitch_with_map ? camera_to_anchor_distance / u_camera_to_center_distance : u_camera_to_center_distance / camera_to_anchor_distance;\n        highp float perspective_ratio \x3d clamp(\n        0.5 + 0.5 * distance_ratio,\n        0.0, // Prevents oversized near-field symbols in pitched/overzoomed tiles\n        4.0);\n\n        size *\x3d perspective_ratio;\n        float fontScale \x3d u_is_text ? size / 24.0 : size;\n        highp float symbol_rotation \x3d 0.0;\n        if (u_rotate_symbol) {\n            vec4 offsetProjectedPoint \x3d u_matrix * vec4(a_pos + vec2(1, 0), 0, 1);\n            vec2 a \x3d projectedPoint.xy / projectedPoint.w;\n            vec2 b \x3d offsetProjectedPoint.xy / offsetProjectedPoint.w;\n            symbol_rotation \x3d atan((b.y - a.y) / u_aspect_ratio, b.x - a.x);\n        }\n\n        highp float angle_sin \x3d sin(segment_angle + symbol_rotation);\n        highp float angle_cos \x3d cos(segment_angle + symbol_rotation);\n        mat2 rotation_matrix \x3d mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);\n\n        vec4 projected_pos \x3d u_label_plane_matrix * vec4(a_projected_pos.xy, 0.0, 1.0);\n        gl_Position \x3d u_coord_matrix * vec4(projected_pos.xy / projected_pos.w + rotation_matrix * (a_offset / 32.0 * fontScale), 0.0, 1.0);\n        float gamma_scale \x3d gl_Position.w;\n\n        vec2 tex \x3d a_tex / u_texsize;\n        float interpolated_fade_opacity \x3d 1.0;\n\n        v_data0 \x3d vec2(tex.x, tex.y);\n        v_data1 \x3d vec3(gamma_scale, size, interpolated_fade_opacity);\n    }",
fragmentSource:"precision mediump float;\n\n    #define SDF_PX 8.0\n\n    uniform bool u_is_halo;\n    uniform sampler2D u_texture;\n    uniform highp float u_gamma_scale;\n    uniform lowp float u_device_pixel_ratio;\n    uniform bool u_is_text;\n\n    varying vec2 v_data0;\n    varying vec3 v_data1;\n\n    uniform highp vec4 u_fill_color;\n    uniform highp vec4 u_halo_color;\n    uniform lowp float u_opacity;\n    uniform lowp float u_halo_width;\n    uniform lowp float u_halo_blur;\n\n    void main() {\n        highp vec4 fill_color \x3d u_fill_color;\n        highp vec4 halo_color \x3d u_halo_color;\n        lowp float opacity \x3d u_opacity;\n        lowp float halo_width \x3d u_halo_width;\n        lowp float halo_blur \x3d u_halo_blur;\n\n        float EDGE_GAMMA \x3d 0.105 / u_device_pixel_ratio;\n\n        vec2 tex \x3d v_data0.xy;\n        float gamma_scale \x3d v_data1.x;\n        float size \x3d v_data1.y;\n        float fade_opacity \x3d v_data1[2];\n\n        float fontScale \x3d u_is_text ? size / 24.0 : size;\n\n        lowp vec4 color \x3d fill_color;\n        highp float gamma \x3d EDGE_GAMMA / (fontScale * u_gamma_scale);\n        lowp float buff \x3d (256.0 - 64.0) / 256.0;\n        if (u_is_halo) {\n            color \x3d halo_color;\n            gamma \x3d (halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (fontScale * u_gamma_scale);\n            buff \x3d (6.0 - halo_width / fontScale) / SDF_PX;\n        }\n        lowp float dist \x3d texture2D(u_texture, tex).a;\n        highp float gamma_scaled \x3d gamma * gamma_scale;\n        highp float alpha \x3d smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);\n        gl_FragColor \x3d color * (alpha * opacity * fade_opacity);\n    }"};
f.multiPoints={vertexSource:" attribute vec2 a_pos;\n    uniform mat4 u_matrix;\n    void main() {\n        gl_Position \x3d u_matrix * vec4(a_pos.xy,0.0, 1.0);\n        gl_PointSize \x3d 30.0;\n    }",fragmentSource:"precision mediump float;\n    void main() {\n        gl_FragColor \x3d vec4(1.0, 0.0, 0.0, 1.0);\n    }"};f.images={vertexSource:"attribute vec2 a_pos;\n    attribute vec4 a_data;\n\n    uniform highp float u_size;\n    uniform highp float u_camera_to_center_distance;\n    uniform mat4 u_matrix;\n    uniform mat4 u_label_plane_matrix;\n    uniform mat4 u_coord_matrix;\n    uniform bool u_pitch_with_map;\n    uniform vec2 u_texsize;\n    uniform lowp float u_opacity;\n    uniform bool u_rotate_symbol;\n    uniform float u_radian;\n    uniform mat4 u_modelMatrix;\n\n    varying vec2 v_tex;\n    void main() {\n        lowp float opacity \x3d u_opacity;\n        vec2 a_offset \x3d a_data.xy;\n        vec2 a_tex \x3d a_data.zw;\n        float size \x3d u_size;\n        vec4 projectedPoint \x3d u_matrix * vec4(a_pos, 10.0, 1);\n        highp float camera_to_anchor_distance \x3d projectedPoint.w;\n\n        highp float distance_ratio \x3d u_pitch_with_map ?\n        camera_to_anchor_distance / u_camera_to_center_distance\n        :u_camera_to_center_distance / camera_to_anchor_distance;\n        highp float perspective_ratio \x3d clamp(0.5 + 0.5 * distance_ratio, 0.0, 4.0);\n        size *\x3d perspective_ratio;\n        float fontScale \x3d size;\n        highp float symbol_rotation \x3d 0.0;\n        if (u_rotate_symbol) {\n            symbol_rotation \x3d u_radian;\n        }\n    highp float angle_sin \x3d sin(symbol_rotation);\n    highp float angle_cos \x3d cos(symbol_rotation);\n    mat2 rotation_matrix \x3d mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);\n        vec4 projected_pos \x3d u_label_plane_matrix * vec4(a_pos, 0.0, 1.0);\n        vec4 glP \x3d u_coord_matrix * vec4(projected_pos.xy / projected_pos.w + rotation_matrix * (a_offset / 32.0 * fontScale), 0.0, 1.0);\n        gl_Position \x3d u_modelMatrix * glP;\n        v_tex \x3d a_tex / u_texsize;\n    }",
fragmentSource:"precision mediump float;\n    uniform sampler2D u_texture;\n    varying vec2 v_tex;\n    uniform lowp float u_opacity;\n    void main() {\n        gl_FragColor \x3d texture2D(u_texture, v_tex) * u_opacity;\n    }"};f.text={vertexSource:"attribute vec2 a_pos;\n    attribute vec4 a_data;\n\n    uniform highp float u_size;\n    uniform mat4 u_matrix;\n    uniform mat4 u_label_plane_matrix;\n    uniform mat4 u_coord_matrix;\n    uniform bool u_pitch_with_map;\n    uniform highp float u_camera_to_center_distance;\n    uniform vec2 u_texsize;\n    varying vec2 v_data0;\n\n    uniform lowp float u_opacity;\n    uniform bool u_rotate_symbol;\n    uniform float u_radian;\n    #ifdef HAS_COLOR\n    attribute vec4 a_color;\n    varying vec4 v_color;\n    #else\n    uniform highp vec4 u_fill_color;\n    #endif\n\n    void main() {\n       #ifdef HAS_COLOR\n       v_color \x3d a_color;\n       #endif\n        lowp float opacity \x3d u_opacity;\n        vec2 a_offset \x3d a_data.xy;\n        vec2 a_tex \x3d a_data.zw;\n        float size \x3d u_size;\n\n        vec4 projectedPoint \x3d u_matrix * vec4(a_pos, 0, 1);\n        highp float camera_to_anchor_distance \x3d projectedPoint.w;\n        highp float distance_ratio \x3d u_pitch_with_map ?\n        camera_to_anchor_distance / u_camera_to_center_distance :\n        u_camera_to_center_distance / camera_to_anchor_distance;\n        highp float perspective_ratio \x3d clamp(\n        0.5 + 0.5 * distance_ratio,\n        0.0, // Prevents oversized near-field symbols in pitched/overzoomed tiles\n        4.0);\n        size *\x3d perspective_ratio;\n        float fontScale \x3d size / 24.0;\n        highp float symbol_rotation \x3d 0.0;\n        if (u_rotate_symbol) {\n            symbol_rotation \x3d u_radian;\n        }\n    highp float angle_sin \x3d sin(symbol_rotation);\n    highp float angle_cos \x3d cos(symbol_rotation);\n    mat2 rotation_matrix \x3d mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);\n\n        vec4 projected_pos \x3d u_label_plane_matrix * vec4(a_pos, 0.0, 1.0);\n        gl_Position \x3d u_coord_matrix * vec4(projected_pos.xy / projected_pos.w + rotation_matrix * (a_offset / 32.0 * fontScale), 0.0, 1.0);\n        float gamma_scale \x3d gl_Position.w;\n\n        vec2 tex \x3d a_tex / u_texsize;\n        float interpolated_fade_opacity \x3d 1.0;\n\n        v_data0 \x3d vec2(tex.x, tex.y);\n    }",
fragmentSource:"precision mediump float;\n    #define SDF_PX 8.0\n    uniform sampler2D u_texture;\n    uniform highp float u_gamma_scale;\n\n    varying vec2 v_data0;\n\n    #ifdef HAS_COLOR\n    varying vec4 v_color;\n    #else\n    uniform highp vec4 u_fill_color;\n    #endif\n    uniform lowp float u_opacity;\n    uniform highp float u_size;\n    uniform highp vec4 u_halo_color;\n    uniform lowp float u_halo_width;\n    uniform lowp float u_halo_blur;\n    uniform bool u_is_halo;\n\n    void main() {\n    #ifdef HAS_COLOR\n        highp vec4 fill_color \x3d v_color;\n    #else\n        highp vec4 fill_color \x3d u_fill_color;\n    #endif\n        lowp float opacity \x3d u_opacity;\n\n        float EDGE_GAMMA \x3d 0.105;\n\n        vec2 tex \x3d v_data0.xy;\n        float gamma_scale \x3d 1.0;\n        float size \x3d u_size;\n        float fade_opacity \x3d 1.0;\n        float fontScale \x3d size / 24.0;\n\n        lowp vec4 color \x3d fill_color;\n        highp float gamma \x3d EDGE_GAMMA / (fontScale * u_gamma_scale);\n        lowp float buff \x3d (256.0 - 64.0) / 256.0;\n        if (u_is_halo) {\n            color \x3d u_halo_color;\n            gamma \x3d (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (fontScale * u_gamma_scale);\n            buff \x3d (6.0 - u_halo_width / fontScale) / SDF_PX;\n        }\n        lowp float dist \x3d texture2D(u_texture, tex).a;\n        highp float gamma_scaled \x3d gamma * gamma_scale;\n        highp float alpha \x3d smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);\n\n        gl_FragColor \x3d color * (alpha * opacity * fade_opacity);\n    }"};
f.arc={vertexSource:"attribute vec3 a_pos;\n  attribute vec3 source;\n  attribute vec3 target;\n  uniform mat4 u_matrix;\n  uniform vec2 u_units_to_pixels;\n  uniform float u_device_pixel_ratio;\n\n  uniform float width;\n  uniform float height;\n  uniform float tilts;\n  uniform float numSegments;\n\n  float paraboloid(vec3 source, vec3 target, float ratio) {\n    vec3 delta \x3d target - source;\n    float dh \x3d length(delta.xy) * height;\n    float unitZ \x3d delta.z / dh;\n    float p2 \x3d unitZ * unitZ + 1.0;\n    float dir \x3d step(delta.z, 0.0);\n    float z0 \x3d mix(source.z, target.z, dir);\n    float r \x3d mix(ratio, 1.0 - ratio, dir);\n    return sqrt(r * (p2 - r)) * dh + z0;\n  }\n  vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {\n    vec2 dir_screenspace \x3d normalize(line_clipspace);\n    dir_screenspace \x3d vec2(-dir_screenspace.y, dir_screenspace.x);\n    return dir_screenspace * offset_direction * width;\n  }\n\n  float getSegmentRatio(float index) {\n    return smoothstep(0.0, 1.0, index / (numSegments - 1.0));\n  }\n\n  vec3 getPos(vec3 source, vec3 target, float segmentRatio) {\n    float z \x3d paraboloid(source, target, segmentRatio);\n    float tiltAngle \x3d radians(tilts);\n    vec2 tiltDirection \x3d normalize(target.xy - source.xy);\n    vec2 tilt \x3d vec2(-tiltDirection.y, tiltDirection.x) * z * sin(tiltAngle);\n    return vec3(mix(source.xy, target.xy, segmentRatio) + tilt,z * cos(tiltAngle));\n  }\n\n  vec2 project_pixel_size_to_clipspace(vec2 pixels) {\n    vec2 offset \x3d pixels / u_units_to_pixels * u_device_pixel_ratio * 2.0;\n    return offset;\n  }\n\n  void main(void) {\n    float segmentIndex \x3d a_pos.x;\n    float segmentRatio \x3d getSegmentRatio(segmentIndex);\n    float indexDir \x3d mix(-1.0, 1.0, step(segmentIndex, 0.0));\n    float nextSegmentRatio \x3d getSegmentRatio(segmentIndex + indexDir);\n\n    vec3 currPos \x3d getPos(source, target, segmentRatio);\n    vec3 nextPos \x3d getPos(source, target, nextSegmentRatio);\n    vec4 curr \x3d u_matrix * vec4(currPos, 1.0);\n    vec4 next \x3d u_matrix * vec4(nextPos, 1.0);\n\n    float widthPixels \x3d width;\n\n    vec3 offset \x3d vec3(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_pos.y, widthPixels), 0.0);\n    gl_Position \x3d curr + vec4(offset.xy, 0.0, 0.0);\n  }",
fragmentSource:"precision highp float;\n  uniform vec4 color;\n  uniform float opacity;\n  void main(void) {\n    gl_FragColor \x3d vec4(color.xyz, opacity);\n  }"};f.multiCircles={vertexSource:"uniform mat4 u_matrix;\n  uniform bool u_scale_with_map;\n  uniform bool u_pitch_with_map;\n  uniform vec2 u_extrude_scale;\n  uniform lowp float u_device_pixel_ratio;\n  uniform highp float u_camera_to_center_distance;\n  attribute vec2 a_pos;\n  attribute vec4 a_color;\n  varying vec3 v_data;\n  varying vec4 v_color;\n  uniform mediump float radius;\n  uniform mediump float stroke_width;\n  void main(void) {\n    vec2 extrude \x3d vec2(mod(a_pos, 2.0) * 2.0 - 1.0);\n    vec2 circle_center \x3d floor(a_pos * 0.5);\n    if (u_pitch_with_map) {\n      vec2 corner_position \x3d circle_center;\n      if (u_scale_with_map) {\n        corner_position +\x3d extrude * (radius + stroke_width) * u_extrude_scale;\n      } else {\n        vec4 projected_center \x3d u_matrix * vec4(circle_center, 0, 1);\n        corner_position +\x3d extrude * (radius + stroke_width) * u_extrude_scale * (projected_center.w / u_camera_to_center_distance);\n      }\n\n      gl_Position \x3d u_matrix * vec4(corner_position, 0, 1);\n    } else {\n      gl_Position \x3d u_matrix * vec4(circle_center, 0, 1);\n\n      if (u_scale_with_map) {\n        gl_Position.xy +\x3d extrude * (radius + stroke_width) * u_extrude_scale * u_camera_to_center_distance;\n      } else {\n        gl_Position.xy +\x3d extrude * (radius + stroke_width) * u_extrude_scale * gl_Position.w;\n      }\n    }\n    lowp float antialiasblur \x3d 1.0 / u_device_pixel_ratio / (radius + stroke_width);\n\n    v_data \x3d vec3(extrude.x, extrude.y, antialiasblur);\n    v_color \x3d a_color;\n  }",
fragmentSource:"precision mediump float;\n  varying vec3 v_data;\n  varying vec4 v_color;\n  uniform mediump float radius;\n  uniform lowp float blur;\n  uniform lowp float opacity;\n  uniform highp vec4 stroke_color;\n  uniform mediump float stroke_width;\n  uniform lowp float stroke_opacity;\n\n  void main() {\n\n    vec2 extrude \x3d v_data.xy;\n    float extrude_length \x3d length(extrude);\n\n    lowp float antialiasblur \x3d v_data.z;\n    float antialiased_blur \x3d -max(blur, antialiasblur);\n\n    float opacity_t \x3d smoothstep(0.0, antialiased_blur, extrude_length - 1.0);\n\n    float color_t \x3d stroke_width \x3c 0.01 ? 0.0 : smoothstep(\n    antialiased_blur,\n    0.0,\n    extrude_length - radius / (radius + stroke_width)\n    );\n\n    gl_FragColor \x3d opacity_t * mix(v_color * opacity, stroke_color * stroke_opacity, color_t);\n  }"};
f.multiPolygon={vertexSource:"attribute vec2 a_pos;\n    attribute vec4 a_color;\n    uniform mat4 u_matrix;\n    varying vec4 v_color;\n    void main() {\n        gl_Position \x3d u_matrix * vec4(a_pos, 0.0, 1.0);\n        v_color \x3d a_color;\n    }",fragmentSource:"precision mediump float;\n    varying vec4 v_color;\n    uniform lowp float u_opacity;\n    void main() {\n        gl_FragColor \x3d v_color * u_opacity;\n    }"};f.fan={vertexSource:"uniform mat4 u_matrix;\n  uniform bool u_scale_with_map;\n  uniform bool u_pitch_with_map;\n  uniform vec2 u_extrude_scale;\n  uniform lowp float u_device_pixel_ratio;\n  uniform highp float u_camera_to_center_distance;\n  attribute vec2 a_pos;\n  varying vec3 v_data;\n  uniform mediump float radius;\n  uniform mediump float stroke_width;\n  void main(void) {\n    vec2 extrude \x3d vec2(mod(a_pos, 2.0) * 2.0 - 1.0);\n    vec2 circle_center \x3d floor(a_pos * 0.5);\n    if (u_pitch_with_map) {\n      vec2 corner_position \x3d circle_center;\n      if (u_scale_with_map) {\n        corner_position +\x3d extrude * (radius + stroke_width) * u_extrude_scale;\n      } else {\n        vec4 projected_center \x3d u_matrix * vec4(circle_center, 0, 1);\n        corner_position +\x3d extrude * (radius + stroke_width) * u_extrude_scale * (projected_center.w / u_camera_to_center_distance);\n      }\n\n      gl_Position \x3d u_matrix * vec4(corner_position, 0, 1);\n    } else {\n      gl_Position \x3d u_matrix * vec4(circle_center, 0, 1);\n\n      if (u_scale_with_map) {\n        gl_Position.xy +\x3d extrude * (radius + stroke_width) * u_extrude_scale * u_camera_to_center_distance;\n      } else {\n        gl_Position.xy +\x3d extrude * (radius + stroke_width) * u_extrude_scale * gl_Position.w;\n      }\n    }\n    lowp float antialiasblur \x3d 1.0 / u_device_pixel_ratio / (radius + stroke_width);\n\n    v_data \x3d vec3(extrude.x, extrude.y, antialiasblur);\n  }",
fragmentSource:"precision mediump float;\n  varying vec3 v_data;\n  uniform highp vec4 color;\n  uniform mediump float radius;\n  uniform lowp float blur;\n  uniform lowp float opacity;\n  uniform highp vec4 stroke_color;\n  uniform mediump float stroke_width;\n  uniform lowp float stroke_opacity;\n  uniform int quadrant;\n  uniform bool border;\n  uniform float start;\n  uniform float end;\n  uniform float gap;\n  void main() {\n    vec2 extrude \x3d v_data.xy;\n    float extrude_length \x3d length(extrude);\n\n    lowp float antialiasblur \x3d v_data.z;\n    float antialiased_blur \x3d -max(blur, antialiasblur);\n\n    // \u5b9e\u73b0\u5706\u5f62\u6548\u679c\n    float opacity_t \x3d smoothstep(0.0, antialiased_blur, extrude_length - 1.0);\n    // \u5b9e\u73b0\u8fb9\u754c\u7ebf\u6548\u679c\n    float color_t \x3d stroke_width \x3c 0.01 ? 0.0 : smoothstep(\n    antialiased_blur,\n    0.0,\n    extrude_length - radius / (radius + stroke_width)\n    );\n\n    float tana \x3d v_data.y/v_data.x;\n    float opacity_fan \x3d 0.0;\n    if (quadrant \x3d\x3d 1) {\n      opacity_fan \x3d  step(0.0, -tana) * step(0.0, v_data.x);\n      if (border) {\n        if ((v_data.y \x3e -gap \x26\x26 v_data.x \x3e start) || (v_data.x \x3c gap \x26\x26 v_data.y \x3c -end)) {\n          color_t \x3d 1.0;\n        }\n      }\n    } else if (quadrant \x3d\x3d 2) {\n      opacity_fan \x3d  step(0.0, tana) * step(0.0, -v_data.x);\n      if (border) {\n        if ((v_data.x \x3e -gap \x26\x26 v_data.y \x3c -start) || (v_data.y \x3e -gap \x26\x26 v_data.x \x3c -end)) {\n          color_t \x3d 1.0;\n        }\n      }\n    } else if (quadrant \x3d\x3d 3) {\n      opacity_fan \x3d  step(0.0, -tana) * step(0.0, -v_data.x);\n      if (border) {\n        if ((v_data.y \x3c gap \x26\x26 v_data.x \x3c -start) || (v_data.x \x3e -gap \x26\x26 v_data.y \x3e end)) {\n          color_t \x3d 1.0;\n        }\n      }\n    } else {\n      opacity_fan \x3d step(0.0, tana) * step(0.0, v_data.x);\n      if (border) {\n        if ((v_data.x \x3c gap \x26\x26 v_data.y \x3e start) || (v_data.y \x3c gap \x26\x26 v_data.x\x3eend)) {\n          color_t \x3d 1.0;\n        }\n      }\n    }\n    gl_FragColor \x3d opacity_t * mix(color * opacity, stroke_color * stroke_opacity, color_t) * opacity_fan;\n  }"};
f.arcParticle={vertexSource:"attribute float a_ratio;\n  attribute vec3 source;\n  attribute vec3 target;\n  uniform mat4 u_matrix;\n  uniform float height;\n  uniform float tilts;\n  uniform float offset;\n\n  float paraboloid(vec3 source, vec3 target, float ratio) {\n    vec3 delta \x3d target - source;\n    float dh \x3d length(delta.xy) * height;\n    float unitZ \x3d delta.z / dh;\n    float p2 \x3d unitZ * unitZ + 1.0;\n    float dir \x3d step(delta.z, 0.0);\n    float z0 \x3d mix(source.z, target.z, dir);\n    float r \x3d mix(ratio, 1.0 - ratio, dir);\n    return sqrt(r * (p2 - r)) * dh + z0;\n  }\n\n  vec3 getPos(vec3 source, vec3 target, float segmentRatio) {\n    float z \x3d paraboloid(source, target, segmentRatio);\n    float tiltAngle \x3d radians(tilts);\n    vec2 tiltDirection \x3d normalize(target.xy - source.xy);\n    vec2 tilt \x3d vec2(-tiltDirection.y, tiltDirection.x) * z * sin(tiltAngle);\n    return vec3(mix(source.xy, target.xy, segmentRatio) + tilt,z * cos(tiltAngle));\n  }\n\n  void main(void) {\n    float segmentRatio \x3d a_ratio + offset;\n    segmentRatio \x3d segmentRatio \x3e 1.0?segmentRatio-1.0:segmentRatio;\n    vec3 currPos \x3d getPos(source, target, segmentRatio);\n    gl_Position \x3d u_matrix * vec4(currPos, 1.0);\n    gl_PointSize \x3d 20.0;\n  }",
fragmentSource:"precision highp float;\n  uniform vec4 color;\n  void main(void) {\n    float d \x3d distance(gl_PointCoord, vec2(0.5, 0.5));\nif (d \x3c 0.1) {\n    gl_FragColor \x3d vec4(0.0, 0.0, 1.0, 1.0);\n  } else if (d \x3c 0.5) {\n    gl_FragColor \x3d vec4(0.0, 0.0, 1.0, 0.5 - d);\n  } else {\n    discard;\n  }\n  }"};f.lineParticle={vertexSource:"attribute float a_ratio;\n  uniform vec3 u_source_position;\n  uniform vec3 u_target_position;\n  uniform mat4 u_matrix;\n  vec3 getPos(vec3 source, vec3 target, float segmentRatio) {\n    return source * (1.0 - segmentRatio) + target * segmentRatio;\n  }\n\n  void main(void) {\n    vec3 source \x3d u_source_position;\n    vec3 target \x3d u_target_position;\n    vec3 currPos \x3d getPos(source, target, a_ratio);\n    gl_Position \x3d u_matrix * vec4(currPos, 1.0);\n    gl_PointSize \x3d 20.0;\n  }",
fragmentSource:"precision highp float;\n  uniform vec4 color;\n  void main(void) {\n    float d \x3d distance(gl_PointCoord, vec2(0.5, 0.5));\nif (d \x3c 0.1) {\n    gl_FragColor \x3d vec4(0.0, 0.0, 1.0, 1.0);\n  } else if (d \x3c 0.5) {\n    gl_FragColor \x3d vec4(0.0, 0.0, 1.0, 0.5 - d);\n  } else {\n    discard;\n  }\n  }"};f.sprite={vertexSource:"attribute vec2 position;\n  attribute vec2 uv;\n\n  uniform vec2 scale;\n  uniform mat4 modelViewMatrix;\n  uniform mat4 projectionMatrix;\n  uniform float rotation;\n  uniform vec2 center;\n\n  varying vec2 vUv;\n\n  void main() {\n    vUv \x3d uv;\n    position \x3d position/2.0;\n    vec4 mvPosition \x3d modelViewMatrix * vec4(0.0, 0.0, 0.0, 1.0);\n\n    bool isPerspective \x3d ( projectionMatrix[ 2 ][ 3 ] \x3d\x3d - 1.0 );\n    if ( isPerspective ) scale *\x3d - mvPosition.z;\n\n    vec2 alignedPosition \x3d (position - (center - vec2(0.5))) * scale;\n    vec2 rotatedPosition;\n    rotatedPosition.x \x3d cos(rotation) * alignedPosition.x - sin(rotation) * alignedPosition.y;\n    rotatedPosition.y \x3d sin(rotation) * alignedPosition.x + cos(rotation) * alignedPosition.y;\n    mvPosition.xy +\x3d rotatedPosition;\n    gl_Position \x3d projectionMatrix * mvPosition;\n  }",
fragmentSource:"precision highp float;\n\n  varying vec2 vUv;\n  uniform sampler2D map;\n\n  void main() {\n    gl_FragColor \x3d texture2D(map, vUv);\n  }"};f.lineExtrusion={vertexSource:"attribute vec3 a_pos;\n  uniform mat4 u_matrix;\n  uniform float u_fill_extrusion_base;\n  uniform float u_fill_extrusion_height;\n\n  void main() {\n    highp float base \x3d u_fill_extrusion_base;\n    highp float height \x3d u_fill_extrusion_height;\n    base \x3d max(0.0, base);\n    height \x3d max(0.0, height);\n    gl_Position \x3d u_matrix * vec4(a_pos.xy, a_pos.z\x3e0.0 ? height : base, 1.0);\n  }",
fragmentSource:"precision mediump float;\n  uniform vec4 u_fill_extrusion_color;\n  void main() {\n    gl_FragColor \x3d u_fill_extrusion_color;\n  }"};f.moveLine={vertexSource:"attribute vec3 a_data;\n  attribute vec2 source;\n  attribute vec2 middle;\n  attribute vec2 target;\n  uniform float ratio;\n  uniform float u_len;\n  uniform float segment;\n  uniform mat4 u_matrix;\n  uniform float u_width;\n  varying float v_opacity;\n\n  vec2 getPos(float t) {\n    float left \x3d 1.0 - t;\n    return left * left * source + 2.0 * t * left * middle + t * t * target;\n  }\n\n  vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {\n    vec2 dir_screenspace \x3d normalize(line_clipspace);\n    dir_screenspace \x3d vec2(-dir_screenspace.y, dir_screenspace.x);\n    return dir_screenspace * offset_direction * width / 2.0;\n  }\n\n  void main() {\n    vec2 currPos \x3d getPos(ratio);\n    vec2 nextPos \x3d getPos(max(ratio - 1.0/segment, 0.0));\n    vec2 normal \x3d normalize(nextPos - currPos)* u_len * a_data.x;\n    vec4 curr \x3d u_matrix * vec4(currPos - normal, 0.0, 1.0);\n    vec4 next \x3d u_matrix * vec4(nextPos, 0.0, 1.0);\n\n    vec2 offsetPos \x3d getExtrusionOffset(next.xy - curr.xy, a_data.y, u_width);\n    gl_Position \x3d curr + vec4(offsetPos, 0.0, 1.0);\n    v_opacity \x3d a_data.z;\n//    gl_Position \x3d u_matrix * vec4(source, 0.0, 1.0);\n  }",
fragmentSource:"precision mediump float;\n  varying float v_opacity;\n  uniform vec4 u_color;\n  void main() {\n    gl_FragColor \x3d vec4(u_color.xyz, mix(0.0, 1.0, v_opacity));\n  }"};f.moveArc={vertexSource:"attribute vec3 a_pos;\n  attribute vec3 source;\n  attribute vec3 target;\n  uniform float u_ratio;\n  uniform float u_len;\n  uniform mat4 u_matrix;\n  uniform float u_device_pixel_ratio;\n\n  uniform float width;\n  uniform float height;\n  uniform float tilts;\n  uniform float numSegments;\n  varying float v_opacity;\n\n  float paraboloid(vec3 source, vec3 target, float ratio) {\n    vec3 delta \x3d target - source;\n    float dh \x3d length(delta.xy) * height;\n    float unitZ \x3d delta.z / dh;\n    float p2 \x3d unitZ * unitZ + 1.0;\n    float dir \x3d step(delta.z, 0.0);\n    float z0 \x3d mix(source.z, target.z, dir);\n    float r \x3d mix(ratio, 1.0 - ratio, dir);\n    return sqrt(r * (p2 - r)) * dh + z0;\n  }\n  vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {\n    vec2 dir_screenspace \x3d normalize(line_clipspace);\n    dir_screenspace \x3d vec2(-dir_screenspace.y, dir_screenspace.x);\n    return dir_screenspace * offset_direction * width;\n  }\n\n  vec3 getPos(vec3 source, vec3 target, float segmentRatio) {\n    float z \x3d paraboloid(source, target, segmentRatio);\n    float tiltAngle \x3d radians(tilts);\n    vec2 tiltDirection \x3d normalize(target.xy - source.xy);\n    vec2 tilt \x3d vec2(-tiltDirection.y, tiltDirection.x) * z * sin(tiltAngle);\n    return vec3(mix(source.xy, target.xy, segmentRatio) + tilt,z * cos(tiltAngle));\n  }\n\n  void main(void) {\n    vec3 currPos \x3d getPos(source, target, u_ratio);\n    vec3 nextPos \x3d getPos(source, target, max(u_ratio - 0.5/numSegments, 0.0));\n    vec3 normal \x3d normalize(nextPos - currPos)* u_len * a_pos.x;\n    vec4 curr \x3d u_matrix * vec4(currPos - normal , 1.0);\n    vec4 next \x3d u_matrix * vec4(nextPos, 1.0);\n\n    float widthPixels \x3d width;\n\n    vec3 offsetPos \x3d vec3(getExtrusionOffset(next.xy - curr.xy, a_pos.y, widthPixels), 0.0);\n    gl_Position \x3d curr + vec4(offsetPos.xy, 0.0, 0.0);\n    v_opacity \x3d a_pos.z;\n  }",
fragmentSource:"precision highp float;\n  uniform vec4 color;\n  varying float v_opacity;\n  void main(void) {\n    gl_FragColor \x3d vec4(color.xyz, v_opacity*0.8);\n  }"};f.blur={vertexSource:"attribute vec4 aPos;\n  varying vec2 vUv;\n  void main() {\n    vUv \x3d aPos.zw;\n    gl_Position \x3d vec4(aPos.xy, 0.0, 1.0);\n  }",fragmentSource:"precision mediump float;\n  varying vec2 vUv;\n  uniform sampler2D colorTexture;\n  uniform vec2 texSize;\n  uniform vec2 direction;\n\n  uniform float SIGMA;\n\n  float gaussianPdf(in float x, in float sigma) {\n    return 0.39894 * exp(-0.5 * x * x/(sigma * sigma))/sigma;\n  }\n  void main() {\n    vec2 invSize \x3d 1.0 / texSize;\n    float fSigma \x3d float(SIGMA);\n    float weightSum \x3d gaussianPdf(0.0, fSigma);\n    vec4 diffuseSum \x3d texture2D(colorTexture, vUv) * weightSum;\n    for (int i \x3d 1; i \x3c 8; i ++) {\n      float x \x3d float(i);\n      float w \x3d gaussianPdf(x, fSigma);\n      vec2 uvOffset \x3d direction * invSize * x;\n      vec4 sample1 \x3d texture2D(colorTexture, vUv + uvOffset);\n      vec4 sample2 \x3d texture2D(colorTexture, vUv - uvOffset);\n      diffuseSum +\x3d (sample1 + sample2) * w;\n      weightSum +\x3d 2.0 * w;\n    }\n    //    gl_FragColor \x3d vec4(diffuseSum/weightSum, 1.0);\n    // gl_FragColor \x3d vec4(diffuseSum/weightSum, 1.0);\n    gl_FragColor \x3d diffuseSum/weightSum;\n  }"};
f.bloom={vertexSource:"attribute vec4 aPos;\n  varying vec2 vUv;\n  void main() {\n    vUv \x3d aPos.zw;\n    gl_Position \x3d vec4(aPos.xy, 0.0, 1.0);\n  }",fragmentSource:"precision mediump float;\n  varying vec2 vUv;\n  uniform sampler2D blurTexture1;\n  uniform float bloomStrength;\n  uniform float bloomRadius;\n  float lerpBloomFactor(const in float factor) {\n    float mirrorFactor \x3d 1.2 - factor;\n    return mix(factor, mirrorFactor, bloomRadius);\n  }\n\n  void main() {\n    gl_FragColor \x3d bloomStrength * (lerpBloomFactor(1.0) * vec4(1.0, 1.0, 1.0, 1.0) * texture2D(blurTexture1, vUv));// +\n  }"};
f.imageFill={vertexSource:"vec2 get_pattern_pos(const vec2 pixel_coord_upper, const vec2 pixel_coord_lower,\n  const vec2 pattern_size, const float tile_units_to_pixels, const vec2 pos) {\n\n    vec2 offset \x3d mod(mod(mod(pixel_coord_upper, pattern_size) * 256.0, pattern_size) * 256.0 + pixel_coord_lower, pattern_size);\n    return (tile_units_to_pixels * pos + offset) / pattern_size;\n  }\n\n  uniform mat4 u_matrix;\n  uniform vec2 u_pixel_coord_upper;\n  uniform vec2 u_pixel_coord_lower;\n  uniform vec4 u_scale;\n\n  attribute vec2 a_pos;\n\n  varying vec2 v_pos_a;\n  varying vec2 v_pos_b;\n\n\n  uniform lowp float u_opacity;\n  uniform lowp vec4 u_pattern_from;\n  uniform lowp vec4 u_pattern_to;\n\n  void main() {\n    lowp float opacity \x3d u_opacity;\n    mediump vec4 pattern_from \x3d u_pattern_from;\n    mediump vec4 pattern_to \x3d u_pattern_to;\n\n    vec2 pattern_tl_a \x3d pattern_from.xy;\n    vec2 pattern_br_a \x3d pattern_from.zw;\n    vec2 pattern_tl_b \x3d pattern_to.xy;\n    vec2 pattern_br_b \x3d pattern_to.zw;\n\n    float pixelRatio \x3d u_scale.x;\n    float tileZoomRatio \x3d u_scale.y;\n    float fromScale \x3d u_scale.z;\n    float toScale \x3d u_scale.w;\n\n    vec2 display_size_a \x3d vec2((pattern_br_a.x - pattern_tl_a.x) / pixelRatio, (pattern_br_a.y - pattern_tl_a.y) / pixelRatio);\n    vec2 display_size_b \x3d vec2((pattern_br_b.x - pattern_tl_b.x) / pixelRatio, (pattern_br_b.y - pattern_tl_b.y) / pixelRatio);\n    gl_Position \x3d u_matrix * vec4(a_pos, 0, 1);\n\n    v_pos_a \x3d get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, fromScale * display_size_a, tileZoomRatio, a_pos);\n    v_pos_b \x3d get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, toScale * display_size_b, tileZoomRatio, a_pos);\n  }",
fragmentSource:"precision mediump float;\n\n  uniform vec2 u_texsize;\n  uniform float u_fade;\n  uniform sampler2D u_image;\n\n  varying vec2 v_pos_a;\n  varying vec2 v_pos_b;\n\n  uniform lowp float u_opacity;\n  uniform lowp vec4 u_pattern_from;\n  uniform lowp vec4 u_pattern_to;\n\n  void main() {\n    lowp float opacity \x3d u_opacity;\n    mediump vec4 pattern_from \x3d u_pattern_from;\n    mediump vec4 pattern_to \x3d u_pattern_to;\n\n\n    vec2 pattern_tl_a \x3d pattern_from.xy;\n    vec2 pattern_br_a \x3d pattern_from.zw;\n    vec2 pattern_tl_b \x3d pattern_to.xy;\n    vec2 pattern_br_b \x3d pattern_to.zw;\n\n    vec2 imagecoord \x3d mod(v_pos_a, 1.0);\n    vec2 pos \x3d mix(pattern_tl_a / u_texsize, pattern_br_a / u_texsize, imagecoord);\n    vec4 color1 \x3d texture2D(u_image, pos);\n\n    vec2 imagecoord_b \x3d mod(v_pos_b, 1.0);\n    vec2 pos2 \x3d mix(pattern_tl_b / u_texsize, pattern_br_b / u_texsize, imagecoord_b);\n    vec4 color2 \x3d texture2D(u_image, pos2);\n\n    gl_FragColor \x3d mix(color1, color2, u_fade) * opacity;\n  }"};
f.gaussianBlur={vertexSource:"attribute vec4 aPos;\n  varying vec2 vUV;\n  void main() {\n    gl_Position \x3d vec4(aPos.xy, 0.0, 1.0);\n    vUV \x3d aPos.zw;\n  }",fragmentSource:"precision mediump float;\n  uniform sampler2D uTexture;\n  uniform bool uHorizontal;\n  // uniform float uSampleStep;\n  uniform vec2 uSize;\n  varying vec2 vUV;\n\n  uniform float u_kernel[5];\n  void main() {\n    vec2 onePixel \x3d vec2(1.0) / uSize;\n    vec2 offset \x3d (uHorizontal? vec2(1, 0):vec2(0, 1));\n    vec4 colorSum \x3d\n    texture2D(uTexture, vUV) * u_kernel[0] +\n    texture2D(uTexture, vUV + onePixel * offset) * u_kernel[1] +\n    texture2D(uTexture, vUV - onePixel * offset) * u_kernel[1] +\n    texture2D(uTexture, vUV + onePixel * 2.0*offset) * u_kernel[2] +\n    texture2D(uTexture, vUV - onePixel * 2.0*offset) * u_kernel[2] +\n    texture2D(uTexture, vUV + onePixel * 3.0*offset) * u_kernel[3] +\n    texture2D(uTexture, vUV - onePixel * 3.0*offset) * u_kernel[3] +\n    texture2D(uTexture, vUV + onePixel * 4.0*offset) * u_kernel[4] +\n    texture2D(uTexture, vUV - onePixel * 4.0*offset) * u_kernel[4];\n    gl_FragColor \x3d vec4(colorSum.rgb / 0.7, colorSum.a);\n\n  }"};
f.screen={vertexSource:"attribute vec4 aPos;\n  varying vec2 vUV;\n  void main() {\n    gl_Position \x3d vec4(aPos.xy, 0.0, 1.0);\n    vUV \x3d aPos.zw;\n  }",fragmentSource:"precision highp float;\n  uniform sampler2D uTexture;\n  varying vec2 vUV;\n\n  void main() {\n    gl_FragColor \x3d texture2D(uTexture, vUV);\n  }"};f.basicFillImage={vertexSource:"attribute vec4 a_pos;\n    uniform mat4 u_matrix;\n    varying vec2 v_tex;\n    void main() {\n        v_tex \x3d a_pos.zw;\n        gl_Position \x3d u_matrix * vec4(a_pos.xy, 0.0, 1.0);\n    }",
fragmentSource:"precision mediump float;\n    uniform sampler2D u_texture;\n    varying vec2 v_tex;\n    uniform lowp float u_opacity;\n    void main() {\n        gl_FragColor \x3d texture2D(u_texture, v_tex) * u_opacity;\n    }"};f.ztText={vertexSource:"attribute vec2 a_pos;\n    attribute vec4 a_data;\n\n    uniform highp float u_size;\n    uniform mat4 u_matrix;\n    uniform mat4 u_label_plane_matrix;\n    uniform mat4 u_coord_matrix;\n    uniform bool u_pitch_with_map;\n    uniform highp float u_camera_to_center_distance;\n    uniform vec2 u_texsize;\n    varying vec2 v_data0;\n\n    uniform highp vec4 u_fill_color;\n    uniform lowp float u_opacity;\n    uniform bool u_rotate_symbol;\n    uniform float u_radian;\n\n    void main() {\n        highp vec4 fill_color \x3d u_fill_color;\n        lowp float opacity \x3d u_opacity;\n        vec2 a_offset \x3d a_data.xy;\n        vec2 a_tex \x3d a_data.zw;\n        float size \x3d u_size;\n\n        vec4 projectedPoint \x3d u_matrix * vec4(a_pos, 0.0, 1.0);\n        highp float camera_to_anchor_distance \x3d projectedPoint.w;\n        highp float distance_ratio \x3d u_pitch_with_map ?\n        camera_to_anchor_distance / u_camera_to_center_distance :\n        u_camera_to_center_distance / camera_to_anchor_distance;\n        highp float perspective_ratio \x3d clamp(\n        0.5 + 0.5 * distance_ratio,\n        0.0, // Prevents oversized near-field symbols in pitched/overzoomed tiles\n        4.0);\n        size *\x3d perspective_ratio;\n        float fontScale \x3d size / 96.0;\n        highp float symbol_rotation \x3d 0.0;\n        if (u_rotate_symbol) {\n            symbol_rotation \x3d u_radian;\n        }\n    highp float angle_sin \x3d sin(symbol_rotation);\n    highp float angle_cos \x3d cos(symbol_rotation);\n    mat2 rotation_matrix \x3d mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);\n\n        vec4 projected_pos \x3d u_label_plane_matrix * vec4(a_pos, 0.0, 1.0);\n        gl_Position \x3d u_coord_matrix * vec4(projected_pos.xy / projected_pos.w + rotation_matrix * (a_offset / 32.0 * fontScale), 0.0, 1.0);\n        float gamma_scale \x3d gl_Position.w;\n\n        vec2 tex \x3d a_tex / u_texsize;\n        float interpolated_fade_opacity \x3d 1.0;\n\n        v_data0 \x3d vec2(tex.x, tex.y);\n    }",
fragmentSource:"precision mediump float;\n    #define SDF_PX 8.0\n    uniform sampler2D u_texture;\n    uniform highp float u_gamma_scale;\n\n    varying vec2 v_data0;\n\n    uniform highp vec4 u_fill_color;\n    uniform lowp float u_opacity;\n    uniform highp float u_size;\n    uniform highp vec4 u_halo_color;\n    uniform lowp float u_halo_width;\n    uniform lowp float u_halo_blur;\n    uniform bool u_is_halo;\n    uniform lowp float u_buff;\n\n    void main() {\n        highp vec4 fill_color \x3d u_fill_color;\n        lowp float opacity \x3d u_opacity;\n        lowp float buff \x3d u_buff;\n\n        float EDGE_GAMMA \x3d 0.105;\n\n        vec2 tex \x3d v_data0.xy;\n        float gamma_scale \x3d 1.0;\n        float size \x3d u_size;\n        float fade_opacity \x3d 1.0;\n        float fontScale \x3d size / 96.0;\n\n        lowp vec4 color \x3d fill_color;\n        highp float gamma \x3d EDGE_GAMMA / (fontScale * u_gamma_scale);\n        // lowp float buff \x3d 0.45; //(256.0 - 64.0) / 256.0;\n        lowp float dist \x3d texture2D(u_texture, tex).a;\n        highp float gamma_scaled \x3d gamma * gamma_scale;\n        highp float alpha \x3d smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);\n\n        gl_FragColor \x3d color * (alpha * opacity * fade_opacity);\n        // gl_FragColor \x3d vec4(dist/255.0, dist/255.0, dist/255.0, 1.0);\n    }"};
f.fillExtrusion2={vertexSource:l.fillExtrusionVS,fragmentSource:l.fillExtrusionFS};f.programUniforms={fill:function(a,b){return{u_matrix:new d.UniformMatrix4f(a,b.u_matrix)}},line:function(a,b){return{u_matrix:new d.UniformMatrix4f(a,b.u_matrix),u_ratio:new d.Uniform1f(a,b.u_ratio),u_device_pixel_ratio:new d.Uniform1f(a,b.u_device_pixel_ratio),u_units_to_pixels:new d.Uniform2f(a,b.u_units_to_pixels)}},symbolIcon:function(a,b){return{u_is_size_zoom_constant:new d.Uniform1i(a,b.u_is_size_zoom_constant),
u_is_size_feature_constant:new d.Uniform1i(a,b.u_is_size_feature_constant),u_size_t:new d.Uniform1f(a,b.u_size_t),u_size:new d.Uniform1f(a,b.u_size),u_camera_to_center_distance:new d.Uniform1f(a,b.u_camera_to_center_distance),u_pitch:new d.Uniform1f(a,b.u_pitch),u_rotate_symbol:new d.Uniform1i(a,b.u_rotate_symbol),u_aspect_ratio:new d.Uniform1f(a,b.u_aspect_ratio),u_fade_change:new d.Uniform1f(a,b.u_fade_change),u_matrix:new d.UniformMatrix4f(a,b.u_matrix),u_label_plane_matrix:new d.UniformMatrix4f(a,
b.u_label_plane_matrix),u_coord_matrix:new d.UniformMatrix4f(a,b.u_coord_matrix),u_is_text:new d.Uniform1f(a,b.u_is_text),u_pitch_with_map:new d.Uniform1i(a,b.u_pitch_with_map),u_texsize:new d.Uniform2f(a,b.u_texsize),u_texture:new d.Uniform1i(a,b.u_texture)}},symbolSDF:function(a,b){return{u_is_size_zoom_constant:new d.Uniform1i(a,b.u_is_size_zoom_constant),u_is_size_feature_constant:new d.Uniform1i(a,b.u_is_size_feature_constant),u_size_t:new d.Uniform1f(a,b.u_size_t),u_size:new d.Uniform1f(a,b.u_size),
u_camera_to_center_distance:new d.Uniform1f(a,b.u_camera_to_center_distance),u_pitch:new d.Uniform1f(a,b.u_pitch),u_rotate_symbol:new d.Uniform1i(a,b.u_rotate_symbol),u_aspect_ratio:new d.Uniform1f(a,b.u_aspect_ratio),u_fade_change:new d.Uniform1f(a,b.u_fade_change),u_matrix:new d.UniformMatrix4f(a,b.u_matrix),u_label_plane_matrix:new d.UniformMatrix4f(a,b.u_label_plane_matrix),u_coord_matrix:new d.UniformMatrix4f(a,b.u_coord_matrix),u_is_text:new d.Uniform1f(a,b.u_is_text),u_pitch_with_map:new d.Uniform1i(a,
b.u_pitch_with_map),u_texsize:new d.Uniform2f(a,b.u_texsize),u_texture:new d.Uniform1i(a,b.u_texture),u_gamma_scale:new d.Uniform1f(a,b.u_gamma_scale),u_device_pixel_ratio:new d.Uniform1f(a,b.u_device_pixel_ratio),u_is_halo:new d.Uniform1f(a,b.u_is_halo)}},lineSDF:function(a,b){return{u_matrix:new d.UniformMatrix4f(a,b.u_matrix),u_ratio:new d.Uniform1f(a,b.u_ratio),u_device_pixel_ratio:new d.Uniform1f(a,b.u_device_pixel_ratio),u_units_to_pixels:new d.Uniform2f(a,b.u_units_to_pixels),u_patternscale_a:new d.Uniform2f(a,
b.u_patternscale_a),u_patternscale_b:new d.Uniform2f(a,b.u_patternscale_b),u_sdfgamma:new d.Uniform1f(a,b.u_sdfgamma),u_image:new d.Uniform1i(a,b.u_image),u_tex_y_a:new d.Uniform1f(a,b.u_tex_y_a),u_tex_y_b:new d.Uniform1f(a,b.u_tex_y_b),u_mix:new d.Uniform1f(a,b.u_mix)}},fillExtrusion2:function(a,b){return{u_matrix:new d.UniformMatrix4f(a,b.u_matrix),u_lightpos:new d.Uniform3f(a,b.u_lightpos),u_lightintensity:new d.Uniform1f(a,b.u_lightintensity),u_lightcolor:new d.Uniform3f(a,b.u_lightcolor),u_vertical_gradient:new d.Uniform1f(a,
b.u_vertical_gradient),u_opacity:new d.Uniform1f(a,b.u_opacity),u_color:new d.Uniform4f(a,b.u_color),u_height:new d.Uniform1f(a,b.u_height),u_base:new d.Uniform1f(a,b.u_base)}},lineExtrusion:function(a,b){return{u_matrix:new d.UniformMatrix4f(a,b.u_matrix)}},clippingMask:function(a,b){return{u_matrix:new d.UniformMatrix4f(a,b.u_matrix)}},background:function(a,b){return{u_matrix:new d.UniformMatrix4f(a,b.u_matrix),u_opacity:new d.Uniform1f(a,b.u_opacity),u_color:new d.UniformColor(a,b.u_color)}},heatmap:function(a,
b){return{u_extrude_scale:new d.Uniform1f(a,b.u_extrude_scale),u_intensity:new d.Uniform1f(a,b.u_intensity),u_matrix:new d.UniformMatrix4f(a,b.u_matrix)}},heatmapTexture:function(a,b){return{u_matrix:new d.UniformMatrix4f(a,b.u_matrix),u_world:new d.Uniform2f(a,b.u_world),u_image:new d.Uniform1i(a,b.u_image),u_color_ramp:new d.Uniform1i(a,b.u_color_ramp),u_opacity:new d.Uniform1f(a,b.u_opacity)}},raster:function(a,b){return{u_matrix:new d.UniformMatrix4f(a,b.u_matrix),u_tl_parent:new d.Uniform2f(a,
b.u_tl_parent),u_scale_parent:new d.Uniform1f(a,b.u_scale_parent),u_buffer_scale:new d.Uniform1f(a,b.u_buffer_scale),u_fade_t:new d.Uniform1f(a,b.u_fade_t),u_opacity:new d.Uniform1f(a,b.u_opacity),u_image0:new d.Uniform1i(a,b.u_image0),u_image1:new d.Uniform1i(a,b.u_image1),u_brightness_low:new d.Uniform1f(a,b.u_brightness_low),u_brightness_high:new d.Uniform1f(a,b.u_brightness_high),u_saturation_factor:new d.Uniform1f(a,b.u_saturation_factor),u_contrast_factor:new d.Uniform1f(a,b.u_contrast_factor),
u_spin_weights:new d.Uniform3f(a,b.u_spin_weights)}},image:function(a,b){return{u_matrix:new d.UniformMatrix4f(a,b.u_matrix),u_image:new d.Uniform1i(a,b.u_image),u_opacity:new d.Uniform1f(a,b.u_opacity)}},circles:function(a,b){return{u_camera_to_center_distance:new d.Uniform1f(a,b.u_camera_to_center_distance),u_scale_with_map:new d.Uniform1i(a,b.u_scale_with_map),u_pitch_with_map:new d.Uniform1i(a,b.u_pitch_with_map),u_extrude_scale:new d.Uniform2f(a,b.u_extrude_scale),u_device_pixel_ratio:new d.Uniform1f(a,
b.u_device_pixel_ratio),u_matrix:new d.UniformMatrix4f(a,b.u_matrix)}},circle:function(a,b){return{u_camera_to_center_distance:new d.Uniform1f(a,b.u_camera_to_center_distance),u_scale_with_map:new d.Uniform1i(a,b.u_scale_with_map),u_pitch_with_map:new d.Uniform1i(a,b.u_pitch_with_map),u_extrude_scale:new d.Uniform2f(a,b.u_extrude_scale),u_device_pixel_ratio:new d.Uniform1f(a,b.u_device_pixel_ratio),u_matrix:new d.UniformMatrix4f(a,b.u_matrix),radius:new d.Uniform1f(a,b.radius),stroke_width:new d.Uniform1f(a,
b.stroke_width),color:new d.Uniform4f(a,b.color),stroke_color:new d.Uniform4f(a,b.stroke_color),blur:new d.Uniform1f(a,b.blue),opacity:new d.Uniform1f(a,b.opacity),stroke_opacity:new d.Uniform1f(a,b.stroke_opacity)}},basicFill:function(a,b){return{u_matrix:new d.UniformMatrix4f(a,b.u_matrix),u_color:new d.Uniform4f(a,b.u_color),u_opacity:new d.Uniform1f(a,b.u_opacity)}},basicLine:p,basicSymbol:function(a,b){return{u_size:new d.Uniform1f(a,b.u_size),u_camera_to_center_distance:new d.Uniform1f(a,b.u_camera_to_center_distance),
u_pitch:new d.Uniform1f(a,b.u_pitch),u_rotate_symbol:new d.Uniform1i(a,b.u_rotate_symbol),u_aspect_ratio:new d.Uniform1f(a,b.u_aspect_ratio),u_fade_change:new d.Uniform1f(a,b.u_fade_change),u_matrix:new d.UniformMatrix4f(a,b.u_matrix),u_label_plane_matrix:new d.UniformMatrix4f(a,b.u_label_plane_matrix),u_coord_matrix:new d.UniformMatrix4f(a,b.u_coord_matrix),u_is_text:new d.Uniform1f(a,b.u_is_text),u_pitch_with_map:new d.Uniform1i(a,b.u_pitch_with_map),u_texsize:new d.Uniform2f(a,b.u_texsize),u_texture:new d.Uniform1i(a,
b.u_texture),u_gamma_scale:new d.Uniform1f(a,b.u_gamma_scale),u_device_pixel_ratio:new d.Uniform1f(a,b.u_device_pixel_ratio),u_is_halo:new d.Uniform1f(a,b.u_is_halo),u_fill_color:new d.Uniform4f(a,b.u_fill_color),u_halo_color:new d.Uniform4f(a,b.u_halo_color),u_opacity:new d.Uniform1f(a,b.u_opacity),u_halo_width:new d.Uniform1f(a,b.u_halo_width),u_halo_blur:new d.Uniform1f(a,b.u_halo_blur)}},multiPoints:function(a,b){return{u_matrix:new d.UniformMatrix4f(a,b.u_matrix)}},basicLineSDF:function(a,b){return{u_matrix:new d.UniformMatrix4f(a,
b.u_matrix),u_ratio:new d.Uniform1f(a,b.u_ratio),u_units_to_pixels:new d.Uniform2f(a,b.u_units_to_pixels),u_patternscale_a:new d.Uniform2f(a,b.u_patternscale_a),u_patternscale_b:new d.Uniform2f(a,b.u_patternscale_b),u_tex_y_a:new d.Uniform1f(a,b.u_tex_y_a),u_tex_y_b:new d.Uniform1f(a,b.u_tex_y_b),u_color:new d.Uniform4f(a,b.u_color),u_blur:new d.Uniform1f(a,b.u_blur),u_opacity:new d.Uniform1f(a,b.u_opacity),u_gapwidth:new d.Uniform1f(a,b.u_gapwidth),u_offset:new d.Uniform1f(a,b.u_offset),u_width:new d.Uniform1f(a,
b.u_width),u_floorwidth:new d.Uniform1f(a,b.u_floorwidth),u_image:new d.Uniform1i(a,b.u_image),u_sdfgamma:new d.Uniform1f(a,b.u_sdfgamma),u_mix:new d.Uniform1f(a,b.u_mix)}},images:function(a,b){return{u_size:new d.Uniform1f(a,b.u_size),u_camera_to_center_distance:new d.Uniform1f(a,b.u_camera_to_center_distance),u_matrix:new d.UniformMatrix4f(a,b.u_matrix),u_label_plane_matrix:new d.UniformMatrix4f(a,b.u_label_plane_matrix),u_coord_matrix:new d.UniformMatrix4f(a,b.u_coord_matrix),u_pitch_with_map:new d.Uniform1i(a,
b.u_pitch_with_map),u_texsize:new d.Uniform2f(a,b.u_texsize),u_opacity:new d.Uniform1f(a,b.u_opacity),u_texture:new d.Uniform1i(a,b.u_texture),u_rotate_symbol:new d.Uniform1i(a,b.u_rotate_symbol),u_radian:new d.Uniform1f(a,b.u_radian),u_modelMatrix:new d.UniformMatrix4f(a,b.u_modelMatrix)}},text:function(a,b){return{u_size:new d.Uniform1f(a,b.u_size),u_camera_to_center_distance:new d.Uniform1f(a,b.u_camera_to_center_distance),u_matrix:new d.UniformMatrix4f(a,b.u_matrix),u_label_plane_matrix:new d.UniformMatrix4f(a,
b.u_label_plane_matrix),u_coord_matrix:new d.UniformMatrix4f(a,b.u_coord_matrix),u_pitch_with_map:new d.Uniform1i(a,b.u_pitch_with_map),u_texsize:new d.Uniform2f(a,b.u_texsize),u_opacity:new d.Uniform1f(a,b.u_opacity),u_texture:new d.Uniform1i(a,b.u_texture),u_fill_color:new d.Uniform4f(a,b.u_fill_color),u_gamma_scale:new d.Uniform1f(a,b.u_gamma_scale),u_rotate_symbol:new d.Uniform1i(a,b.u_rotate_symbol),u_radian:new d.Uniform1f(a,b.u_radian),u_halo_color:new d.Uniform4f(a,b.u_halo_color),u_halo_width:new d.Uniform1f(a,
b.u_halo_width),u_halo_blur:new d.Uniform1f(a,b.u_halo_blur),u_is_halo:new d.Uniform1i(a,b.u_is_halo)}},ztText:function(a,b){return{u_size:new d.Uniform1f(a,b.u_size),u_camera_to_center_distance:new d.Uniform1f(a,b.u_camera_to_center_distance),u_matrix:new d.UniformMatrix4f(a,b.u_matrix),u_label_plane_matrix:new d.UniformMatrix4f(a,b.u_label_plane_matrix),u_coord_matrix:new d.UniformMatrix4f(a,b.u_coord_matrix),u_pitch_with_map:new d.Uniform1i(a,b.u_pitch_with_map),u_texsize:new d.Uniform2f(a,b.u_texsize),
u_opacity:new d.Uniform1f(a,b.u_opacity),u_texture:new d.Uniform1i(a,b.u_texture),u_fill_color:new d.Uniform4f(a,b.u_fill_color),u_gamma_scale:new d.Uniform1f(a,b.u_gamma_scale),u_rotate_symbol:new d.Uniform1i(a,b.u_rotate_symbol),u_radian:new d.Uniform1f(a,b.u_radian),u_halo_color:new d.Uniform4f(a,b.u_halo_color),u_halo_width:new d.Uniform1f(a,b.u_halo_width),u_halo_blur:new d.Uniform1f(a,b.u_halo_blur),u_is_halo:new d.Uniform1i(a,b.u_is_halo),u_buff:new d.Uniform1f(a,b.u_buff)}},arc:function(a,
b){return{u_matrix:new d.UniformMatrix4f(a,b.u_matrix),height:new d.Uniform1f(a,b.height),tilts:new d.Uniform1f(a,b.tilts),numSegments:new d.Uniform1f(a,b.numSegments),width:new d.Uniform1f(a,b.width),u_units_to_pixels:new d.Uniform2f(a,b.u_units_to_pixels),u_device_pixel_ratio:new d.Uniform1f(a,b.u_device_pixel_ratio),color:new d.Uniform4f(a,b.color),opacity:new d.Uniform1f(a,b.opacity)}},multiCircles:function(a,b){return{u_camera_to_center_distance:new d.Uniform1f(a,b.u_camera_to_center_distance),
u_scale_with_map:new d.Uniform1i(a,b.u_scale_with_map),u_pitch_with_map:new d.Uniform1i(a,b.u_pitch_with_map),u_extrude_scale:new d.Uniform2f(a,b.u_extrude_scale),u_device_pixel_ratio:new d.Uniform1f(a,b.u_device_pixel_ratio),u_matrix:new d.UniformMatrix4f(a,b.u_matrix),radius:new d.Uniform1f(a,b.radius),stroke_width:new d.Uniform1f(a,b.stroke_width),stroke_color:new d.Uniform4f(a,b.stroke_color),blur:new d.Uniform1f(a,b.blue),opacity:new d.Uniform1f(a,b.opacity),stroke_opacity:new d.Uniform1f(a,
b.stroke_opacity)}},multiPolygon:function(a,b){return{u_matrix:new d.UniformMatrix4f(a,b.u_matrix),u_opacity:new d.Uniform1f(a,b.u_opacity)}},fan:function(a,b){return{u_camera_to_center_distance:new d.Uniform1f(a,b.u_camera_to_center_distance),u_scale_with_map:new d.Uniform1i(a,b.u_scale_with_map),u_pitch_with_map:new d.Uniform1i(a,b.u_pitch_with_map),u_extrude_scale:new d.Uniform2f(a,b.u_extrude_scale),u_device_pixel_ratio:new d.Uniform1f(a,b.u_device_pixel_ratio),u_matrix:new d.UniformMatrix4f(a,
b.u_matrix),radius:new d.Uniform1f(a,b.radius),stroke_width:new d.Uniform1f(a,b.stroke_width),stroke_color:new d.Uniform4f(a,b.stroke_color),blur:new d.Uniform1f(a,b.blue),opacity:new d.Uniform1f(a,b.opacity),stroke_opacity:new d.Uniform1f(a,b.stroke_opacity),color:new d.Uniform4f(a,b.color),quadrant:new d.Uniform1i(a,b.quadrant),border:new d.Uniform1i(a,b.border),start:new d.Uniform1f(a,b.start),end:new d.Uniform1f(a,b.end),gap:new d.Uniform1f(a,b.gap)}},arcParticle:function(a,b){return{u_matrix:new d.UniformMatrix4f(a,
b.u_matrix),height:new d.Uniform1f(a,b.height),tilts:new d.Uniform1f(a,b.tilts),color:new d.Uniform4f(a,b.color),offset:new d.Uniform1f(a,b.offset)}},lineParticle:function(a,b){return{u_matrix:new d.UniformMatrix4f(a,b.u_matrix),u_source_position:new d.Uniform3f(a,b.u_source_position),u_target_position:new d.Uniform3f(a,b.u_target_position),color:new d.Uniform4f(a,b.color)}},sprite:function(a,b){return{modelViewMatrix:new d.UniformMatrix4f(a,b.modelViewMatrix),projectionMatrix:new d.UniformMatrix4f(a,
b.projectionMatrix),scale:new d.Uniform2f(a,b.scale),center:new d.Uniform2f(a,b.center),rotation:new d.Uniform1f(a,b.rotation),map:new d.Uniform1i(a,b.map)}},moveLine:function(a,b){return{ratio:new d.Uniform1f(a,b.ratio),u_len:new d.Uniform1f(a,b.u_len),segment:new d.Uniform1f(a,b.segment),u_width:new d.Uniform1f(a,b.u_width),u_matrix:new d.UniformMatrix4f(a,b.u_matrix),u_color:new d.Uniform4f(a,b.u_color)}},moveArc:function(a,b){return{u_matrix:new d.UniformMatrix4f(a,b.u_matrix),height:new d.Uniform1f(a,
b.height),tilts:new d.Uniform1f(a,b.tilts),numSegments:new d.Uniform1f(a,b.numSegments),width:new d.Uniform1f(a,b.width),u_device_pixel_ratio:new d.Uniform1f(a,b.u_device_pixel_ratio),color:new d.Uniform4f(a,b.color),u_ratio:new d.Uniform1f(a,b.u_ratio),u_len:new d.Uniform1f(a,b.u_len)}},blur:function(a,b){return{colorTexture:new d.Uniform1i(a,b.colorTexture),texSize:new d.Uniform2f(a,b.texSize),direction:new d.Uniform2f(a,b.direction),SIGMA:new d.Uniform1f(a,b.SIGMA)}},bloom:function(a,b){return{blurTexture1:new d.Uniform1i(a,
b.blurTexture1),bloomStrength:new d.Uniform1f(a,b.bloomStrength),bloomRadius:new d.Uniform1f(a,b.bloomRadius)}},imageFill:function(a,b){return{u_matrix:new d.UniformMatrix4f(a,b.u_matrix),u_pixel_coord_upper:new d.Uniform2f(a,b.u_pixel_coord_upper),u_pixel_coord_lower:new d.Uniform2f(a,b.u_pixel_coord_lower),u_texsize:new d.Uniform2f(a,b.u_texsize),u_scale:new d.Uniform4f(a,b.u_scale),u_pattern_from:new d.Uniform4f(a,b.u_pattern_from),u_pattern_to:new d.Uniform4f(a,b.u_pattern_to),u_opacity:new d.Uniform1f(a,
b.u_opacity),u_fade:new d.Uniform1f(a,b.u_fade),u_image:new d.Uniform1i(a,b.u_image)}},gaussianBlur:function(a,b){return{uSize:new d.Uniform2f(a,b.uSize),uTexture:new d.Uniform1i(a,b.uTexture),uHorizontal:new d.Uniform1i(a,b.uHorizontal),u_kernel:new d.Uniform1fv(a,b["u_kernel[0]"])}},screen:function(a,b){return{uTexture:new d.Uniform1i(a,b.uTexture)}},basicFillImage:function(a,b){return{u_matrix:new d.UniformMatrix4f(a,b.u_matrix),u_texture:new d.Uniform1i(a,b.u_texture),u_opacity:new d.Uniform1f(a,
b.u_opacity)}},rect:m.rectUniforms,terrain:h.terrainUniforms,heightMap:c.heightMapUniforms,tifTerrain:a.tifTerrainUniforms,water:g.waterUniforms,fillExtrusion:l.fillExtrusionUniforms,bg:e.bgUniforms,mesh:b.meshUniforms,cylinder:k.cylinderUniforms,cone:n.coneUniforms,myline:p,linePattern:t.linePatternUniforms}})},"com/huayun/webgis/geometry/Anchor":function(){define(["../geometry/Point"],function(f){return function(d){function f(f,c,a,g){d.call(this,f,c);this.angle=a;void 0!==g&&(this.segment=g)}d&&
(f.__proto__=d);f.prototype=Object.create(d&&d.prototype);f.prototype.constructor=f;f.prototype.clone=function(){return new f(this.x,this.y,this.angle,this.segment)};return f}(f)})},"com/huayun/webgis/geometry/Circle":function(){define([],function(){function f(d){this.type="circle";d&&(this.center=d.center,this.radius=d.radius||10)}f.prototype.setCenter=function(d){this.center=d};f.prototype.setRadius=function(d){this.radius=d};f.prototype.refresh=function(){};return f})},"com/huayun/webgis/layers/support/Tile":function(){define(["com/huayun/webgis/data/bucket/SymbolBucket",
"com/huayun/webgis/gl/Texture","../../utils/utils","./EvaluationParameters","com/huayun/webgis/data/GeoJSONFeature"],function(f,d,m,h,c){function a(a){var b={};a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(a,e,c,k){a=c||k;b[e]=a?a.toLowerCase():!0;return""});b["max-age"]&&(a=parseInt(b["max-age"],10),isNaN(a)?delete b["max-age"]:b["max-age"]=a);return b}function g(a,e){for(var b=
{},c=0;c<a.length;c+=1){var k=a[c],d=k.layerIds.map(function(a){return e[a]}).filter(Boolean);if(0===d.length)return;k.layers=d;k.stateDependentLayerIds&&(k.stateDependentLayers=k.stateDependentLayerIds.map(function(a){return d.filter(function(b){return b.id===a})[0]}));for(var g=0,l=d;g<l.length;g+=1)b[l[g].id]=k}return b}var l=1,e=function(a,e){this.tileID=a;this.uid=l++;this.uses=0;this.tileSize=256;this.buckets={};this.expirationTime=null;this.queryPadding=0;this.hasSymbolBuckets=!1;this.expiredRequestCount=
0;this.state="loading"};e.prototype.wasRequested=function(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state};e.prototype.setExpiryData=function(b){var e=this.expirationTime;b.cacheControl&&(b=a(b.cacheControl),b["max-age"]&&(this.expirationTime=Date.now()+1E3*b["max-age"]));if(this.expirationTime){b=Date.now();var c=!1;this.expirationTime>b?c=!1:e?this.expirationTime<e?c=!0:(e=this.expirationTime-e)?this.expirationTime=b+Math.max(e,3E4):c=!0:c=!0;c?(this.expiredRequestCount++,
this.state="expired"):this.expiredRequestCount=0}};e.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1E3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)};e.prototype.registerFadeDuration=function(a){a+=this.timeAdded;a<m.now()||this.fadeEndTime&&a<this.fadeEndTime||(this.fadeEndTime=a)};e.prototype.loadVectorData=function(a,e,c){this.hasData()&&this.unloadVectorData();this.state="loaded";
if(a){a.featureIndex&&(this.latestFeatureIndex=a.featureIndex,a.rawTileData?(this.latestRawTileData=a.rawTileData,this.latestFeatureIndex.rawTileData=a.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData));this.collisionBoxArray=a.collisionBoxArray;this.buckets=g(a.buckets,e._layers);this.hasSymbolBuckets=!1;for(var b in this.buckets){var k=this.buckets[b];if(k instanceof f)if(this.hasSymbolBuckets=!0,c)k.justReloaded=!0;else break}this.queryPadding=0;
for(var d in this.buckets)this.queryPadding=Math.max(this.queryPadding,e._layers[d].queryRadius(this.buckets[d]));a.imageAtlas&&(this.imageAtlas=a.imageAtlas);a.glyphAtlasImage&&(this.glyphAtlasImage=a.glyphAtlasImage)}else this.collisionBoxArray=new CollisionBoxArray};e.prototype.unloadVectorData=function(){for(var a in this.buckets)this.buckets[a].destroy();this.buckets={};this.imageAtlasTexture&&this.imageAtlasTexture.destroy();this.imageAtlas&&(this.imageAtlas=null);this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy();
this.latestFeatureIndex=null;this.state="unloaded"};e.prototype.getBucket=function(a){return this.buckets[a.id]};e.prototype.upload=function(a){for(var b in this.buckets){var e=this.buckets[b];e.uploadPending()&&e.upload(a)}b=a.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new d(a,this.imageAtlas.image,b.RGBA),this.imageAtlas.uploaded=!0);this.glyphAtlasImage&&(this.glyphAtlasTexture=new d(a,this.glyphAtlasImage,b.ALPHA),this.glyphAtlasImage=null)};e.prototype.prepare=function(a){this.imageAtlas&&
this.imageAtlas.patchUpdatedImages(a,this.imageAtlasTexture)};e.prototype.queryRenderedFeatures=function(a,e,c,d,g,l,f,h,m){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:c,cameraQueryGeometry:d,scale:g,tileSize:this.tileSize,pixelPosMatrix:m,transform:f,params:l,queryPadding:this.queryPadding*h},a,e):{}};e.prototype.querySourceFeatures=function(a,e){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData){var b=this.latestFeatureIndex.loadVTLayers(),
k=e?e.sourceLayer:"";if(b=b._geojsonTileLayer||b[k]){e=createFilter(e&&e.filter);for(var d=this.tileID.canonical,k=d.z,g=d.x,d=d.y,l={z:k,x:g,y:d},f=0;f<b.length;f++){var m=b.feature(f);e(new h(this.tileID.overscaledZ),m)&&(m=new c(m,k,g,d),m.tile=l,a.push(m))}}}};e.prototype.clearMask=function(){this.segments&&(this.segments.destroy(),delete this.segments);this.maskedBoundsBuffer&&(this.maskedBoundsBuffer.destroy(),delete this.maskedBoundsBuffer);this.maskedIndexBuffer&&(this.maskedIndexBuffer.destroy(),
delete this.maskedIndexBuffer)};e.prototype.setMask=function(a,e){if(!deepEqual(this.mask,a)&&(this.mask=a,this.clearMask(),!deepEqual(a,{0:!0}))){var b=new StructArrayLayout4i8,c=new StructArrayLayout3ui6;this.segments=new SegmentVector;this.segments.prepareSegment(0,b,c);for(var k=Object.keys(a),d=0;d<k.length;d++){var g=a[+k[d]],l=EXTENT>>g.z,g=new pointGeometry(g.x*l,g.y*l),f=new pointGeometry(g.x+l,g.y+l),l=this.segments.prepareSegment(4,b,c);b.emplaceBack(g.x,g.y,g.x,g.y);b.emplaceBack(f.x,
g.y,f.x,g.y);b.emplaceBack(g.x,f.y,g.x,f.y);b.emplaceBack(f.x,f.y,f.x,f.y);g=l.vertexLength;c.emplaceBack(g,g+1,g+2);c.emplaceBack(g+1,g+2,g+3);l.vertexLength+=4;l.primitiveLength+=2}this.maskedBoundsBuffer=e.createVertexBuffer(b,rasterBoundsAttributes.members);this.maskedIndexBuffer=e.createIndexBuffer(c)}};e.prototype.hasData=function(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state};e.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length};
e.prototype.setFeatureState=function(a,e){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&0!==Object.keys(a).length){var b=this.latestFeatureIndex.loadVTLayers(),c;for(c in this.buckets){var k=this.buckets[c],d=k.layers[0].sourceLayer||"_geojsonTileLayer",g=b[d],d=a[d];g&&d&&0!==Object.keys(d).length&&(k.update(d,g,this.imageAtlas&&this.imageAtlas.patternPositions||{}),e&&e.style&&(this.queryPadding=Math.max(this.queryPadding,e.style.getLayer(c).queryRadius(k))))}}};e.prototype.holdingForFade=
function(){return void 0!==this.symbolFadeHoldUntil};e.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<m.now()};e.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0};e.prototype.setHoldDuration=function(a){this.symbolFadeHoldUntil=exported.now()+a};return e})},"com/huayun/webgis/data/captureIntersects":function(){define(["exports","../utils/utils","custom/gl-matrix-min"],function(f,d,m){function h(a,c){for(var d=!1,e=0,b=a.length-1;e<
a.length;b=e++){var k=a[e],b=a[b];k.y>c.y!==b.y>c.y&&c.x<(b.x-k.x)*(c.y-k.y)/(b.y-k.y)+k.x&&(d=!d)}return d}function c(a,c,d){d*=d;if(1===c.length)return a.distSqr(c[0])<d;for(var e=1;e<c.length;e++){var b;b=a;var k=c[e-1],g=c[e],l=k.distSqr(g);0===l?b=b.distSqr(k):(l=((b.x-k.x)*(g.x-k.x)+(b.y-k.y)*(g.y-k.y))/l,b=0>l?b.distSqr(k):1<l?b.distSqr(g):b.distSqr(g.sub(k)._mult(l)._add(k)));if(b<d)return!0}return!1}f.point=function(a,g,l,e,b,k){var n;e=l.uniforms.u_matrix;n=m.mat4.identity([]);m.mat4.translate(n,
n,[1,1,0]);m.mat4.scale(n,n,[.5*k.width,.5*k.height,1]);n=m.mat4.multiply(n,n,e);var f=l.strokeWidth||0;b=l.captureRadius||15;a=(e=l.pitchWithMap)?a:d.projectQueryGeometry(a,n);f=b+f;b=e?g:d.projectPoint(g,n);g=m.vec4.transformMat4([],[g.x,g.y,0,1],n);!l.scaleWithPitch&&e?f*=g[3]/k.cameraToCenterDistance:l.scaleWithPitch&&!e&&(f*=k.cameraToCenterDistance/g[3]);l=f;l=h(a,b)?!0:c(b,a,l)?!0:!1;if(l)return!0};f.line=function(a,g,l,e,b,k,n){g=g.path;b=(l.width+n||4)*e/2;for(l=0;l<g.length;l++){k=g[l];
if(3<=a.length)for(e=0;e<k.length;e++)if(h(a,k[e]))return!0;a:{e=a;n=b;if(1<e.length){var f;b:{f=e;var t=k;if(0!==f.length&&0!==t.length)for(var m=0;m<f.length-1;m++)for(var q=f[m],u=f[m+1],z=0;z<t.length-1;z++){var v=q,y=u,x=t[z],w=t[z+1];if(d.isCounterClockwise(v,x,w)!==d.isCounterClockwise(y,x,w)&&d.isCounterClockwise(v,y,x)!==d.isCounterClockwise(v,y,w)){f=!0;break b}}f=!1}if(f){e=!0;break a}for(f=0;f<k.length;f++)if(c(k[f],e,n)){e=!0;break a}}for(f=0;f<e.length;f++)if(c(e[f],k,n)){e=!0;break a}e=
!1}if(e)return!0}return!1}})},"com/huayun/gl/shaders/terrain":function(){define(["exports","../../webgis/data/uniform"],function(f,d){f.terrainVS="const float m2d \x3d 111194.872221777 / 2.0;\n\nattribute vec4 position3DAndHeight;\nattribute vec3 textureCoordAndEncodedNormals;\n\nuniform mat4 u_matrix;\nuniform vec4 u_tileRectangle;\nuniform float u_resolution;\nvarying vec2 v_texture;\n\nfloat get2DGeographicYPositionFraction(vec2 textureCoordinates){\n    return 1.0 - textureCoordinates.y;\n}\n\nfloat get2DYPositionFraction(vec2 textureCoordinates) {\n    return get2DGeographicYPositionFraction(textureCoordinates);\n}\n\nvec4 getPositionPlanarEarth(vec3 position, float height, vec2 textureCoordinates){\n    float yPositionFraction \x3d get2DYPositionFraction(textureCoordinates);\n    vec4 rtcPosition2D \x3d vec4(mix(u_tileRectangle.st, u_tileRectangle.pq, vec2(textureCoordinates.x, yPositionFraction)), height/  111194.872221777, 1.0);\n    return u_matrix * rtcPosition2D;\n}\n\nvec4 getPositionColumbusViewMode(vec3 position, float height, vec2 textureCoordinates){\n    return getPositionPlanarEarth(position, height, textureCoordinates);\n}\n\nvec4 getPosition(vec3 position, float height, vec2 textureCoordinates) {\n    return getPositionColumbusViewMode(position, height, textureCoordinates);\n}\n\nvoid main() {\n    vec3 position \x3d position3DAndHeight.xyz;\n    float height \x3d position3DAndHeight.w;\n    vec2 textureCoordinates \x3d textureCoordAndEncodedNormals.xy;\n    gl_Position \x3d getPosition(position, height, textureCoordinates);\n    v_texture \x3d textureCoordinates;\n}";
f.terrainFS="precision mediump float;\nuniform vec4 u_color;\nuniform sampler2D u_image;\nvarying vec2 v_texture;\n\nvoid main() {\n    vec2 tex_location \x3d vec2(v_texture.x, 1.0 - v_texture.y);\n    vec4 color0 \x3d texture2D(u_image, tex_location);\n    gl_FragColor \x3d color0;\n}";f.terrainUniforms=function(f,h){return{u_matrix:new d.UniformMatrix4f(f,h.u_matrix),u_color:new d.Uniform4f(f,h.u_color),u_tileRectangle:new d.Uniform4f(f,h.u_tileRectangle),u_image:new d.Uniform1i(f,h.u_image)}}})},
"com/huayun/webgis/data/ArrayType":function(){define(["require","exports","./struct"],function(f,d,m){Object.defineProperty(d,"__esModule",{value:!0});f=function(){function c(){this.isTransferred=!1;this.capacity=-1;this.resize(0)}c.serialize=function(a,c){a._trim();c&&(a.isTransferred=!0,c.push(a.arrayBuffer));return{length:a.length,arrayBuffer:a.arrayBuffer}};c.deserialize=function(a){var c=Object.create(this.prototype);c.arrayBuffer=a.arrayBuffer;c.length=a.length;c.capacity=a.arrayBuffer.byteLength/
c.bytesPerElement;c._refreshViews();return c};c.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())};c.prototype.clear=function(){this.length=0};c.prototype.resize=function(a){this.reserve(a);this.length=a};c.prototype.reserve=function(a){a>this.capacity&&(this.capacity=Math.max(a,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement),
a=this.uint8,this._refreshViews(),a&&this.uint8.set(a))};c.prototype._refreshViews=function(){throw Error("_refreshViews() must be implemented by each concrete StructArray layout");};return c}();d.StructArray=f;var h=function(c){function a(){c.apply(this,arguments)}c&&(a.__proto__=c);a.prototype=Object.create(c&&c.prototype);a.prototype.constructor=a;a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer);this.int16=new Int16Array(this.arrayBuffer)};a.prototype.emplaceBack=
function(a,c){var e=this.length;this.resize(e+1);return this.emplace(e,a,c)};a.prototype.emplace=function(a,c,e){var b=2*a;this.int16[b]=c;this.int16[b+1]=e;return a};return a}(f);h.prototype.bytesPerElement=4;d.StructArrayLayout2i4=h;h=function(c){function a(){c.apply(this,arguments)}c&&(a.__proto__=c);a.prototype=Object.create(c&&c.prototype);a.prototype.constructor=a;a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer);this.uint16=new Uint16Array(this.arrayBuffer)};
a.prototype.emplaceBack=function(a,c){var e=this.length;this.resize(e+1);return this.emplace(e,a,c)};a.prototype.emplace=function(a,c,e){var b=2*a;this.uint16[b]=c;this.uint16[b+1]=e;return a};return a}(f);h.prototype.bytesPerElement=4;d.StructArrayLayout2ui4=h;h=function(c){function a(){c.apply(this,arguments)}c&&(a.__proto__=c);a.prototype=Object.create(c&&c.prototype);a.prototype.constructor=a;a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer);this.int32=new Int32Array(this.arrayBuffer)};
a.prototype.emplaceBack=function(a,c){var e=this.length;this.resize(e+1);return this.emplace(e,a,c)};a.prototype.emplace=function(a,c,e){var b=2*a;this.int32[b]=c;this.int32[b+1]=e;return a};return a}(f);h.prototype.bytesPerElement=8;d.StructArrayLayout2i8=h;h=function(c){function a(){c.apply(this,arguments)}c&&(a.__proto__=c);a.prototype=Object.create(c&&c.prototype);a.prototype.constructor=a;a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer);this.int16=new Int16Array(this.arrayBuffer)};
a.prototype.emplaceBack=function(a,c,e,b,k,d){var g=this.length;this.resize(g+1);return this.emplace(g,a,c,e,b,k,d)};a.prototype.emplace=function(a,c,e,b,k,d,f){var g=4*a,n=8*a;this.int16[g]=c;this.int16[g+1]=e;this.uint8[n+4]=b;this.uint8[n+5]=k;this.uint8[n+6]=d;this.uint8[n+7]=f;return a};return a}(f);h.prototype.bytesPerElement=8;d.StructArrayLayout2i4ub8=h;h=function(c){function a(){c.apply(this,arguments)}c&&(a.__proto__=c);a.prototype=Object.create(c&&c.prototype);a.prototype.constructor=a;
a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer);this.int16=new Int16Array(this.arrayBuffer);this.uint16=new Uint16Array(this.arrayBuffer)};a.prototype.emplaceBack=function(a,c,e,b,k,d,f,h){var g=this.length;this.resize(g+1);return this.emplace(g,a,c,e,b,k,d,f,h)};a.prototype.emplace=function(a,c,e,b,k,d,f,h,m){var g=8*a;this.int16[g+0]=c;this.int16[g+1]=e;this.int16[g+2]=b;this.int16[g+3]=k;this.uint16[g+4]=d;this.uint16[g+5]=f;this.uint16[g+6]=h;this.uint16[g+7]=
m;return a};return a}(f);h.prototype.bytesPerElement=16;d.StructArrayLayout4i4ui16=h;h=function(c){function a(){c.apply(this,arguments)}c&&(a.__proto__=c);a.prototype=Object.create(c&&c.prototype);a.prototype.constructor=a;a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer);this.uint16=new Uint16Array(this.arrayBuffer)};a.prototype.emplaceBack=function(a,c,e){var b=this.length;this.resize(b+1);return this.emplace(b,a,c,e)};a.prototype.emplace=function(a,c,e,b){var k=3*
a;this.uint16[k+0]=c;this.uint16[k+1]=e;this.uint16[k+2]=b;return a};return a}(f);h.prototype.bytesPerElement=6;d.StructArrayLayout3ui6=h;h=function(c){function a(){c.apply(this,arguments)}c&&(a.__proto__=c);a.prototype=Object.create(c&&c.prototype);a.prototype.constructor=a;a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer);this.uint32=new Uint32Array(this.arrayBuffer)};a.prototype.emplaceBack=function(a,c,e){var b=this.length;this.resize(b+1);return this.emplace(b,
a,c,e)};a.prototype.emplace=function(a,c,e,b){var k=3*a;this.uint32[k+0]=c;this.uint32[k+1]=e;this.uint32[k+2]=b;return a};return a}(f);h.prototype.bytesPerElement=12;d.StructArrayLayout3ui12=h;h=function(c){function a(){c.apply(this,arguments)}c&&(a.__proto__=c);a.prototype=Object.create(c&&c.prototype);a.prototype.constructor=a;a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer);this.float32=new Float32Array(this.arrayBuffer)};a.prototype.emplaceBack=function(a,c,e){var b=
this.length;this.resize(b+1);return this.emplace(b,a,c,e)};a.prototype.emplace=function(a,c,e,b){var k=3*a;this.float32[k+0]=c;this.float32[k+1]=e;this.float32[k+2]=b;return a};return a}(f);h.prototype.bytesPerElement=12;d.StructArrayLayout3f12=h;h=function(c){function a(){c.apply(this,arguments)}c&&(a.__proto__=c);a.prototype=Object.create(c&&c.prototype);a.prototype.constructor=a;a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer);this.uint32=new Uint32Array(this.arrayBuffer)};
a.prototype.emplaceBack=function(a){var c=this.length;this.resize(c+1);return this.emplace(c,a)};a.prototype.emplace=function(a,c){this.uint32[1*a+0]=c;return a};return a}(f);h.prototype.bytesPerElement=4;d.StructArrayLayout1ul4=h;h=function(c){function a(){c.apply(this,arguments)}c&&(a.__proto__=c);a.prototype=Object.create(c&&c.prototype);a.prototype.constructor=a;a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer);this.int32=new Float32Array(this.arrayBuffer)};a.prototype.emplaceBack=
function(a,c,e,b,k,d){var g=this.length;this.resize(g+1);return this.emplace(g,a,c,e,b,k,d)};a.prototype.emplace=function(a,c,e,b,k,d,f){var g=3*a,n=12*a;this.int32[g]=c;this.int32[g+1]=e;this.uint8[n+8]=b;this.uint8[n+9]=k;this.uint8[n+10]=d;this.uint8[n+11]=f;return a};return a}(f);h.prototype.bytesPerElement=12;d.StructArrayLayout2i4ub12=h;h=function(c){function a(){c.apply(this,arguments)}c&&(a.__proto__=c);a.prototype=Object.create(c&&c.prototype);a.prototype.constructor=a;a.prototype._refreshViews=
function(){this.uint8=new Uint8Array(this.arrayBuffer);this.int16=new Int16Array(this.arrayBuffer);this.uint16=new Uint16Array(this.arrayBuffer);this.uint32=new Uint32Array(this.arrayBuffer);this.float32=new Float32Array(this.arrayBuffer)};a.prototype.emplaceBack=function(a,c,e,b,k,d,f,h,m,q,u,z,v,y,x){var g=this.length;this.resize(g+1);return this.emplace(g,a,c,e,b,k,d,f,h,m,q,u,z,v,y,x)};a.prototype.emplace=function(a,c,e,b,k,d,f,h,m,q,u,z,v,y,x,w){var g=22*a,n=11*a,l=44*a;this.int16[g+0]=c;this.int16[g+
1]=e;this.uint16[g+2]=b;this.uint16[g+3]=k;this.uint32[n+2]=d;this.uint32[n+3]=f;this.uint32[n+4]=h;this.uint16[g+10]=m;this.uint16[g+11]=q;this.uint16[g+12]=u;this.float32[n+7]=z;this.float32[n+8]=v;this.uint8[l+36]=y;this.uint8[l+37]=x;this.uint32[n+10]=w;return a};return a}(f);h.prototype.bytesPerElement=44;d.StructArrayLayout2i2ui3ul3ui2f2ub1ul44=h;h=function(c){function a(){c.apply(this,arguments)}c&&(a.__proto__=c);a.prototype=Object.create(c&&c.prototype);a.prototype.constructor=a;a.prototype._refreshViews=
function(){this.uint8=new Uint8Array(this.arrayBuffer);this.float32=new Float32Array(this.arrayBuffer)};a.prototype.emplaceBack=function(a,c,e,b){var k=this.length;this.resize(k+1);return this.emplace(k,a,c,e,b)};a.prototype.emplace=function(a,c,e,b,k){var d=12*a,g=3*a;this.uint8[d+0]=c;this.uint8[d+1]=e;this.float32[g+1]=b;this.float32[g+2]=k;return a};return a}(f);h.prototype.bytesPerElement=12;d.StructArrayLayout2ub2f12=h;h=function(c){function a(){c.apply(this,arguments)}c&&(a.__proto__=c);a.prototype=
Object.create(c&&c.prototype);a.prototype.constructor=a;a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer);this.int16=new Int16Array(this.arrayBuffer)};a.prototype.emplaceBack=function(a,c,e,b,k,d){var g=this.length;this.resize(g+1);return this.emplace(g,a,c,e,b,k,d)};a.prototype.emplace=function(a,c,e,b,k,d,f){var g=6*a;this.int16[g+0]=c;this.int16[g+1]=e;this.int16[g+2]=b;this.int16[g+3]=k;this.int16[g+4]=d;this.int16[g+5]=f;return a};return a}(f);h.prototype.bytesPerElement=
12;d.StructArrayLayout2i2i2i12=h;h=function(c){function a(){c.apply(this,arguments)}c&&(a.__proto__=c);a.prototype=Object.create(c&&c.prototype);a.prototype.constructor=a;a.prototype._refreshViews=function(){this.uint8=new Float32Array(this.arrayBuffer);this.float32=new Float32Array(this.arrayBuffer)};a.prototype.emplaceBack=function(a,c,e,b,k,d){var g=this.length;this.resize(g+1);return this.emplace(g,a,c,e,b,k,d)};a.prototype.emplace=function(a,c,e,b,k,d,f){var g=6*a;this.float32[g+0]=c;this.float32[g+
1]=e;this.float32[g+2]=b;this.float32[g+3]=k;this.float32[g+4]=d;this.float32[g+5]=f;return a};return a}(f);h.prototype.bytesPerElement=24;d.StructArrayLayout6fb24=h;h=function(c){function a(){c.apply(this,arguments)}c&&(a.__proto__=c);a.prototype=Object.create(c&&c.prototype);a.prototype.constructor=a;a.prototype._refreshViews=function(){this.uint8=new Float32Array(this.arrayBuffer);this.float32=new Float32Array(this.arrayBuffer);this.int16=new Int16Array(this.arrayBuffer)};a.prototype.emplaceBack=
function(a,c,e,b,k,d,f,h){var g=this.length;this.resize(g+1);return this.emplace(g,a,c,e,b,k,d,f,h)};a.prototype.emplace=function(a,c,e,b,k,d,f,h,m){var g=7*a,n=14*a;this.float32[g+0]=c;this.float32[g+1]=e;this.float32[g+2]=b;this.float32[g+3]=k;this.float32[g+4]=d;this.float32[g+5]=f;this.int16[n+12]=h;this.int16[n+13]=m;return a};return a}(f);h.prototype.bytesPerElement=28;d.StructArrayLayout6f2ib28=h;h=function(c){function a(){c.apply(this,arguments)}c&&(a.__proto__=c);a.prototype=Object.create(c&&
c.prototype);a.prototype.constructor=a;a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer);this.float32=new Float32Array(this.arrayBuffer);this.int16=new Int16Array(this.arrayBuffer)};a.prototype.emplaceBack=function(a,c,e,b,k,d,f,h,m){var g=this.length;this.resize(g+1);return this.emplace(g,a,c,e,b,k,d,f,h,m)};a.prototype.emplace=function(a,c,e,b,k,d,f,h,m,q){var g=8*a,n=16*a;this.float32[g+0]=c;this.float32[g+1]=e;this.float32[g+2]=b;this.float32[g+3]=k;this.float32[g+
4]=d;this.float32[g+5]=f;this.float32[g+6]=h;this.int16[n+14]=m;this.int16[n+15]=q;return a};return a}(f);h.prototype.bytesPerElement=32;d.StructArrayLayout7f2ib32=h;h=function(c){function a(){c.apply(this,arguments)}c&&(a.__proto__=c);a.prototype=Object.create(c&&c.prototype);a.prototype.constructor=a;a.prototype._refreshViews=function(){this.uint8=new Float32Array(this.arrayBuffer);this.float32=new Float32Array(this.arrayBuffer)};a.prototype.emplaceBack=function(a,c,e,b,k,d,f){var g=this.length;
this.resize(g+1);return this.emplace(g,a,c,e,b,k,d,f)};a.prototype.emplace=function(a,c,e,b,k,d,f,h){var g=7*a;this.float32[g+0]=c;this.float32[g+1]=e;this.float32[g+2]=b;this.float32[g+3]=k;this.float32[g+4]=d;this.float32[g+5]=f;this.float32[g+6]=h;return a};return a}(f);h.prototype.bytesPerElement=28;d.StructArrayLayout7fb28=h;h=function(c){function a(){c.apply(this,arguments)}c&&(a.__proto__=c);a.prototype=Object.create(c&&c.prototype);a.prototype.constructor=a;a.prototype._refreshViews=function(){this.uint8=
new Uint8Array(this.arrayBuffer);this.int16=new Int16Array(this.arrayBuffer);this.uint32=new Uint32Array(this.arrayBuffer);this.uint16=new Uint16Array(this.arrayBuffer)};a.prototype.emplaceBack=function(a,c,e,b,k,d,f,h,m,q,u){var g=this.length;this.resize(g+1);return this.emplace(g,a,c,e,b,k,d,f,h,m,q,u)};a.prototype.emplace=function(a,c,e,b,k,d,f,h,m,q,u,z){var g=12*a;this.int16[g+0]=c;this.int16[g+1]=e;this.int16[g+2]=b;this.int16[g+3]=k;this.int16[g+4]=d;this.int16[g+5]=f;this.uint32[6*a+3]=h;
this.uint16[g+8]=m;this.uint16[g+9]=q;this.int16[g+10]=u;this.int16[g+11]=z;return a};return a}(f);h.prototype.bytesPerElement=24;d.StructArrayLayout6i1ul2ui2i24=h;h=function(c){function a(){c.apply(this,arguments)}c&&(a.__proto__=c);a.prototype=Object.create(c&&c.prototype);a.prototype.constructor=a;a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer);this.float32=new Float32Array(this.arrayBuffer)};a.prototype.emplaceBack=function(a){var c=this.length;this.resize(c+1);
return this.emplace(c,a)};a.prototype.emplace=function(a,c){this.float32[1*a+0]=c;return a};return a}(f);h.prototype.bytesPerElement=4;d.StructArrayLayout1f4=h;h=function(c){function a(){c.apply(this,arguments)}c&&(a.__proto__=c);a.prototype=Object.create(c&&c.prototype);a.prototype.constructor=a;a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer);this.int16=new Int16Array(this.arrayBuffer)};a.prototype.emplaceBack=function(a,c,e){var b=this.length;this.resize(b+1);return this.emplace(b,
a,c,e)};a.prototype.emplace=function(a,c,e,b){var k=3*a;this.int16[k+0]=c;this.int16[k+1]=e;this.int16[k+2]=b;return a};return a}(f);h.prototype.bytesPerElement=6;d.StructArrayLayout3i6=h;h=function(c){function a(){c.apply(this,arguments)}c&&(a.__proto__=c);a.prototype=Object.create(c&&c.prototype);a.prototype.constructor=a;a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer);this.int16=new Int16Array(this.arrayBuffer);this.uint16=new Uint16Array(this.arrayBuffer);this.uint32=
new Uint32Array(this.arrayBuffer);this.float32=new Float32Array(this.arrayBuffer)};a.prototype.emplaceBack=function(a,c,e,b,k,d,f,h,m,q,u,z,v,y,x,w,A,B){var g=this.length;this.resize(g+1);return this.emplace(g,a,c,e,b,k,d,f,h,m,q,u,z,v,y,x,w,A,B)};a.prototype.emplace=function(a,c,e,b,k,d,f,h,m,q,u,z,v,y,x,w,A,B,E){var g=22*a,n=11*a;this.int16[g+0]=c;this.int16[g+1]=e;this.int16[g+2]=b;this.int16[g+3]=k;this.int16[g+4]=d;this.int16[g+5]=f;this.uint16[g+6]=h;this.uint16[g+7]=m;this.uint16[g+8]=q;this.uint16[g+
9]=u;this.uint16[g+10]=z;this.uint16[g+11]=v;this.uint16[g+12]=y;this.uint16[g+13]=x;this.uint16[g+14]=w;this.uint32[n+8]=A;this.float32[n+9]=B;this.float32[n+10]=E;return a};return a}(f);h.prototype.bytesPerElement=44;d.StructArrayLayout6i9ui1ul2f44=h;h=function(c){function a(){c.apply(this,arguments)}c&&(a.__proto__=c);a.prototype=Object.create(c&&c.prototype);a.prototype.constructor=a;a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer);this.uint32=new Uint32Array(this.arrayBuffer);
this.uint16=new Uint16Array(this.arrayBuffer)};a.prototype.emplaceBack=function(a,c,e){var b=this.length;this.resize(b+1);return this.emplace(b,a,c,e)};a.prototype.emplace=function(a,c,e,b){var k=4*a;this.uint32[2*a+0]=c;this.uint16[k+2]=e;this.uint16[k+3]=b;return a};return a}(f);h.prototype.bytesPerElement=8;d.StructArrayLayout1ul2ui8=h;h=function(c){function a(){c.apply(this,arguments)}c&&(a.__proto__=c);a.prototype=Object.create(c&&c.prototype);a.prototype.constructor=a;a.prototype._refreshViews=
function(){this.uint8=new Uint8Array(this.arrayBuffer);this.int16=new Int16Array(this.arrayBuffer);this.float32=new Float32Array(this.arrayBuffer)};a.prototype.emplaceBack=function(a,c,e,b,k,d){var g=this.length;this.resize(g+1);return this.emplace(g,a,c,e,b,k,d)};a.prototype.emplace=function(a,c,e,b,k,d,f){var g=4*a,n=8*a;this.float32[g+0]=c;this.float32[g+1]=e;this.int16[n+4]=b;this.int16[n+5]=k;this.int16[n+6]=d;this.int16[n+7]=f;return a};return a}(f);h.prototype.bytesPerElement=16;d.StructArrayLayout2f4ib16=
h;h=function(c){function a(){c.apply(this,arguments)}c&&(a.__proto__=c);a.prototype=Object.create(c&&c.prototype);a.prototype.constructor=a;a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer);this.int16=new Int16Array(this.arrayBuffer);this.float32=new Float32Array(this.arrayBuffer)};a.prototype.emplaceBack=function(a,c,e,b,k,d,f,h,m,q){var g=this.length;this.resize(g+1);return this.emplace(g,a,c,e,b,k,d,f,h,m,q)};a.prototype.emplace=function(a,c,e,b,k,d,f,h,m,q,u){var g=
8*a,n=16*a;this.float32[g+0]=c;this.float32[g+1]=e;this.float32[g+2]=b;this.float32[g+3]=k;this.float32[g+4]=d;this.float32[g+5]=f;this.int16[n+12]=h;this.int16[n+13]=m;this.int16[n+14]=q;this.int16[n+15]=u;return a};return a}(f);h.prototype.bytesPerElement=32;d.StructArrayLayout6f4ib16=h;h=function(c){function a(){c.apply(this,arguments)}c&&(a.__proto__=c);a.prototype=Object.create(c&&c.prototype);a.prototype.constructor=a;a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer);
this.int16=new Int16Array(this.arrayBuffer);this.float32=new Float32Array(this.arrayBuffer)};a.prototype.emplaceBack=function(a,c,e,b){var k=this.length;this.resize(k+1);return this.emplace(k,a,c,e,b)};a.prototype.emplace=function(a,c,e,b,k){var d=3*a,g=6*a;this.float32[d+0]=c;this.float32[d+1]=e;this.int16[g+4]=b;this.int16[g+5]=k;return a};return a}(f);h.prototype.bytesPerElement=12;d.StructArrayLayout2f2ib12=h;h=function(c){function a(){c.apply(this,arguments)}c&&(a.__proto__=c);a.prototype=Object.create(c&&
c.prototype);a.prototype.constructor=a;a.prototype.get=function(a){return new m.CollisionBoxStruct(this,a)};return a}(d.StructArrayLayout6i1ul2ui2i24);d.CollisionBoxArray=h;h=function(c){function a(){c.apply(this,arguments)}c&&(a.__proto__=c);a.prototype=Object.create(c&&c.prototype);a.prototype.constructor=a;a.prototype.getoffsetX=function(a){return this.float32[1*a+0]};a.prototype.get=function(a){return new GlyphOffsetStruct(this,a)};return a}(d.StructArrayLayout1f4);d.GlyphOffsetArray=h;h=function(c){function a(){c.apply(this,
arguments)}c&&(a.__proto__=c);a.prototype=Object.create(c&&c.prototype);a.prototype.constructor=a;a.prototype.getx=function(a){return this.int16[3*a+0]};a.prototype.gety=function(a){return this.int16[3*a+1]};a.prototype.gettileUnitDistanceFromAnchor=function(a){return this.int16[3*a+2]};a.prototype.get=function(a){return new SymbolLineVertexStruct(this,a)};return a}(d.StructArrayLayout3i6);d.SymbolLineVertexArray=h;h=function(c){function a(){c.apply(this,arguments)}c&&(a.__proto__=c);a.prototype=
Object.create(c&&c.prototype);a.prototype.constructor=a;a.prototype.get=function(a){return new m.SymbolInstanceStruct(this,a)};return a}(d.StructArrayLayout6i9ui1ul2f44);d.SymbolInstanceArray=h;h=function(c){function a(){c.apply(this,arguments)}c&&(a.__proto__=c);a.prototype=Object.create(c&&c.prototype);a.prototype.constructor=a;a.prototype.get=function(a){return new m.FeatureIndexStruct(this,a)};return a}(d.StructArrayLayout1ul2ui8);d.FeatureIndexArray=h;h=function(c){function a(){c.apply(this,
arguments)}c&&(a.__proto__=c);a.prototype=Object.create(c&&c.prototype);a.prototype.constructor=a;a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer);this.float32=new Float32Array(this.arrayBuffer)};a.prototype.emplaceBack=function(a,c){var e=this.length;this.resize(e+1);return this.emplace(e,a,c)};a.prototype.emplace=function(a,c,e){var b=2*a;this.float32[b+0]=c;this.float32[b+1]=e;return a};return a}(f);h.prototype.bytesPerElement=8;d.StructArrayLayout2f8=h;h=function(c){function a(){c.apply(this,
arguments)}c&&(a.__proto__=c);a.prototype=Object.create(c&&c.prototype);a.prototype.constructor=a;a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer);this.float32=new Float32Array(this.arrayBuffer)};a.prototype.emplaceBack=function(a,c,e,b,k){var d=this.length;this.resize(d+1);return this.emplace(d,a,c,e,b,k)};a.prototype.emplace=function(a,c,e,b,k,d){var g=5*a;this.float32[g+0]=c;this.float32[g+1]=e;this.float32[g+2]=b;this.float32[g+3]=k;this.float32[g+4]=d;return a};
return a}(f);h.prototype.bytesPerElement=20;d.StructArrayLayout5fb20=h;h=function(c){function a(){c.apply(this,arguments)}c&&(a.__proto__=c);a.prototype=Object.create(c&&c.prototype);a.prototype.constructor=a;a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer);this.float32=new Float32Array(this.arrayBuffer)};a.prototype.emplaceBack=function(a,c,e,b){var d=this.length;this.resize(d+1);return this.emplace(d,a,c,e,b)};a.prototype.emplace=function(a,c,e,b,d){var k=4*a;this.float32[k+
0]=c;this.float32[k+1]=e;this.float32[k+2]=b;this.float32[k+3]=d;return a};return a}(f);h.prototype.bytesPerElement=16;d.StructArrayLayout4f16=h;h=function(c){function a(){c.apply(this,arguments)}c&&(a.__proto__=c);a.prototype=Object.create(c&&c.prototype);a.prototype.constructor=a;a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer);this.uint16=new Uint16Array(this.arrayBuffer)};a.prototype.emplaceBack=function(a,c,e,b,d,n,f,h){var k=this.length;this.resize(k+1);return this.emplace(k,
a,c,e,b,d,n,f,h)};a.prototype.emplace=function(a,c,e,b,d,n,f,h,m){var k=8*a;this.uint16[k+0]=c;this.uint16[k+1]=e;this.uint16[k+2]=b;this.uint16[k+3]=d;this.uint16[k+4]=n;this.uint16[k+5]=f;this.uint16[k+6]=h;this.uint16[k+7]=m;return a};return a}(f);h.prototype.bytesPerElement=16;d.StructArrayLayout8ui16=h;d.PlacedSymbolArray=function(c){function a(){c.apply(this,arguments)}c&&(a.__proto__=c);a.prototype=Object.create(c&&c.prototype);a.prototype.constructor=a;a.prototype.get=function(a){return new m.PlacedSymbolStruct(this,
a)};return a}(d.StructArrayLayout2i2ui3ul3ui2f2ub1ul44);h=function(c){function a(){c.apply(this,arguments)}c&&(a.__proto__=c);a.prototype=Object.create(c&&c.prototype);a.prototype.constructor=a;a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer);this.int16=new Int16Array(this.arrayBuffer)};a.prototype.emplaceBack=function(a,c,e,b,d,n){var k=this.length;this.resize(k+1);return this.emplace(k,a,c,e,b,d,n)};a.prototype.emplace=function(a,c,e,b,d,n,f){var k=6*a;this.int16[k+
0]=c;this.int16[k+1]=e;this.int16[k+2]=b;this.int16[k+3]=d;this.int16[k+4]=n;this.int16[k+5]=f;return a};return a}(f);h.prototype.bytesPerElement=12;d.StructArrayLayout2i4i12=h;h=function(c){function a(){c.apply(this,arguments)}c&&(a.__proto__=c);a.prototype=Object.create(c&&c.prototype);a.prototype.constructor=a;a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer);this.int16=new Int16Array(this.arrayBuffer)};a.prototype.emplaceBack=function(a,c,e,b){var d=this.length;
this.resize(d+1);return this.emplace(d,a,c,e,b)};a.prototype.emplace=function(a,c,e,b,d){var k=4*a;this.int16[k+0]=c;this.int16[k+1]=e;this.int16[k+2]=b;this.int16[k+3]=d;return a};return a}(f);h.prototype.bytesPerElement=8;d.StructArrayLayout4i8=h;h=function(c){function a(){c.apply(this,arguments)}c&&(a.__proto__=c);a.prototype=Object.create(c&&c.prototype);a.prototype.constructor=a;a.prototype._refreshViews=function(){this.uint8=new Float32Array(this.arrayBuffer);this.float32=new Float32Array(this.arrayBuffer);
this.int16=new Int16Array(this.arrayBuffer)};a.prototype.emplaceBack=function(a,c,e,b,d,n,f,h,m,q,u){q=this.length;this.resize(q+1);return this.emplace(q,a,c,e,b,d,n,f,h,m)};a.prototype.emplace=function(a,c,e,b,d,n,f,h,m,q,u,z){var k=10*a,g=20*a;this.float32[k+0]=c;this.float32[k+1]=e;this.float32[k+2]=b;this.float32[k+3]=d;this.float32[k+4]=n;this.float32[k+5]=f;this.float32[k+6]=h;this.float32[k+7]=m;this.float32[k+8]=q;this.int16[g+18]=u;this.int16[g+19]=z;return a};return a}(f);h.prototype.bytesPerElement=
40;d.StructArrayLayout9f2ib40=h})},"com/huayun/webgis/action/measurements/AreaMeasurement":function(){define("dojo/_base/declare dojo/on dojo/topic dojo/dom-class dojo/dom-construct ../../geometry/Polygon ../../Graphic ../../Feature ../../geometry/Point2D ../../symbols/PolygonSymbol ../../symbols/PointSymbol ../../symbols/TextSymbol ../ActiveMapAction".split(" "),function(f,d,m,h,c,a,g,l,e,b,k,n,p){return f("com.huayun.webgis.action.measurements.AreaMeasurement",[p],{constructor:function(a){this.view=
a.view;this.view.selectEnabled=!1;this.isActive=!0;this.drawLayer=this.view.map.findLayerById("drawLayer");this._lastPoint=this._mouseClickMove=this._dblMouseClick=this._mouseClick=null;this._vertexArr=[];this._polygonList=[];this._symbol=new b({color:"#8F8FFF",opacity:.5});this._vertexSymbol=new k({radius:5,color:"#0000FF"});this._currentGraphic=null;this._lineGraphicList=[];this._lineGraphicHash={};var e=this;m.subscribe("measurement-delete",function(a){(a=e._lineGraphicHash[a])&&0<a.length&&a.forEach(function(a){e.drawLayer.removeGraphic(a)})})},
active:function(){this.state||(this.state=!0,this.view.panEnabled=!1,this.view.selectEnabled=!1,this._mouseClick=d(this.view.container,"click",this._onMouseClick.bind(this)),this._dblMouseClick=d(this.view.container,"dblclick",this._onDoubleMouseClick.bind(this)),h.add(this.view.domNode,"draw-cursor-style"))},_onMouseClick:function(a){a.preventDefault();a.stopPropagation();var b=this.view.screenToGeometry(a.x,a.y);this._mouseMove||(this._mouseMove=d(this.view.domNode,"mousemove",this._onMouseMove.bind(this)));
null===this._lastPoint?(this._lineGraphicList=[],this.doAction(b)):a.x!==this._lastPoint.x&&a.y!==this._lastPoint.y&&this.doAction(b);this._lastPoint={x:a.x,y:a.y}},_onMouseMove:function(b){b=this.view.screenToGeometry(b.x,b.y);this.drawLayer.removeGraphic(this._currentGraphic);var c=new a,d=new l({attribute:null,geometry:c}),d=new g({feature:d,symbol:this._symbol});this._preClick?(this._vertexArr.push(new e(b.x,b.y)),this._preClick=!1):this._vertexArr.splice(this._vertexArr.length-1,1,new e(b.x,
b.y));c.setPath([this._vertexArr]);this._currentGraphic=d;this.drawLayer.addGraphic(d);this.drawLayer.layerView.view.threeRender()},_onDoubleMouseClick:function(a){a.preventDefault();a.stopPropagation();this._currentGraphic.rg=this._lineGraphicList;this.showDeleButton(a,this._currentGraphic.id);this.invalid()},showDeleButton:function(a,b){var e=this,k=c.create("div",{className:"graphicClose",style:{width:"8px",height:"8px",position:"absolute",color:"red",border:"2px solid red",display:"block",cursor:"pointer",
textAlign:"center",fontSize:"4px",margin:"0 auto",lineHeight:"5px",backgroundColor:"white"},innerHTML:"\u00d7"},document.body);d(k,"click",function(a){a=e.drawLayer.graphics;for(var d,k=0,g=a.length;k<g&&(d=a[k],d.id!==b);k++);d&&(e.drawLayer.removeGraphic(d),d.rg.forEach(function(a){e.drawLayer.removeGraphic(a)}),c.destroy(this))});k.style.left=a.clientX+5+"px";k.style.top=a.clientY+5+"px";return k},invalid:function(){this.state&&(this._endDrawMethod(),this.state=!1,this.view.panEnabled=!0,this.view.selectEnabled=
!0,null!==this._mouseClick&&(this._mouseClick.remove(),this._mouseClick=null),null!==this._dblMouseClick&&(this._dblMouseClick.remove(),this._dblMouseClick=null),h.remove(this.view.domNode,"draw-cursor-style"))},doAction:function(a){this._drawDotMark(a)},_drawDotMark:function(a){var b=new e(a.x,a.y),c=new l({attribute:null,geometry:b}),c=new g({feature:c,symbol:this._vertexSymbol});this.drawLayer.addGraphic(c);this._lineGraphicList.push(c);c=this._vertexArr.length;this._preClick=!0;3>c?this._vertexArr.push(new e(b.x,
b.y)):this._vertexArr.splice(this._vertexArr.length-1,1,new e(a.x,a.y));this.drawLayer.layerView.view.threeRender()},_addDistanceTip:function(a,b){b=new n({text:b,color:"#000000",size:12});a=new l({attribute:null,geometry:new e(a.x,a.y)});a=new g({feature:a,symbol:b});this.drawLayer.addGraphic(a);this._lineGraphicList.push(a)},_endDrawMethod:function(){var a=this._calculateGravityMethod();this._addDistanceTip(a,this._calculateArea());this.drawLayer.layerView.view.threeRender();this._lineGraphicHash[this._currentGraphic.id]=
this._lineGraphicList;null!==this._mouseClickMove&&(this._mouseClickMove.remove(),this._mouseClickMove=null);this._vertexArr=[];this._lineGraphicList=this._lastPoint=this._currentGraphic=null},_calculateGravityMethod:function(){var a=this._vertexArr,b=this._vertexArr.length;if(3>b)return a[0];for(var e=0,c=0,d=0,k=0,g=0;g<a.length-1;g++)var n=a[g],l=a[g+1],e=n.x*l.y-n.y*l.x,c=c+e,d=d+e*(n.x+l.x),k=k+e*(n.y+l.y);b=a[b-1];a=a[0];e=b.x*a.y-b.y*a.x;d+=e*(b.x+a.x);k+=e*(b.y+a.y);c=(c+e)/2;return{x:d/(6*
c),y:k/(6*c),z:0}},_calculateArea:function(){var a=this._vertexArr.length;if(3>a)return 0;for(var b=this._vertexArr[0].y*(this._vertexArr[a-1].x-this._vertexArr[1].x),e=1;e<a;++e)b+=this._vertexArr[e].y*(this._vertexArr[e-1].x-this._vertexArr[(e+1)%a].x);return Math.abs(b/2E6).toFixed(5)+"km\u00b2"}})})},"com/huayun/webgis/gl/TaggedString":function(){define(["../utils/Constant"],function(f){var d=function(){this.text="";this.sectionIndex=[];this.sections=[]};d.fromFeature=function(f,h){for(var c=
new d,a=0;a<f.sections.length;a++){var g=f.sections[a];c.sections.push({scale:g.scale||1,fontStack:g.fontStack||h});c.text+=g.text;for(var l=0;l<g.text.length;l++)c.sectionIndex.push(a)}return c};d.prototype.length=function(){return this.text.length};d.prototype.getSection=function(d){return this.sections[this.sectionIndex[d]]};d.prototype.getSectionIndex=function(d){return this.sectionIndex[d]};d.prototype.getCharCode=function(d){return this.text.charCodeAt(d)};d.prototype.verticalizePunctuation=
function(){this.text=verticalizePunctuation(this.text)};d.prototype.trim=function(){for(var d=0,h=0;h<this.text.length&&f.whitespace[this.text.charCodeAt(h)];h++)d++;for(var h=this.text.length,c=this.text.length-1;0<=c&&c>=d&&f.whitespace[this.text.charCodeAt(c)];c--)h--;this.text=this.text.substring(d,h);this.sectionIndex=this.sectionIndex.slice(d,h)};d.prototype.substring=function(f,h){var c=new d;c.text=this.text.substring(f,h);c.sectionIndex=this.sectionIndex.slice(f,h);c.sections=this.sections;
return c};d.prototype.toString=function(){return this.text};d.prototype.getMaxScale=function(){var d=this;return this.sectionIndex.reduce(function(f,c){return Math.max(f,d.sections[c].scale)},0)};return d})},"com/huayun/webgis/gl/dataTransfer":function(){define("require exports ../layers/support/OverscaledTileID ../layers/support/CanonicalTileID ../layers/support/expression/Formatted ../utils/Color ../utils/image ./GridIndex ../data/ArrayType ./SegmentVector ../geometry/Anchor ./ImagePosition ./ImageAtlas".split(" "),
function(f,d,m,h,c,a,g,l,e,b,k,n,p){function t(a,b,e){void 0===e&&(e={});Object.defineProperty(b,"_classRegistryKey",{value:a,writeable:!1});u[a]={klass:b,omit:e.omit||[],shallow:e.shallow||[]}}function r(a,b){if(null===a||void 0===a||"boolean"===typeof a||"number"===typeof a||"string"===typeof a||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp)return a;if(a instanceof ArrayBuffer)return b&&b.push(a),a;if(ArrayBuffer.isView(a))return b&&b.push(a.buffer),
a;if(a instanceof ImageData)return b&&b.push(a.data.buffer),a;if(Array.isArray(a)){for(var e=[],c=0;c<a.length;c+=1)e.push(r(a[c],b));return e}if("object"===typeof a){var d=a.constructor,e=d._classRegistryKey;if(!e){debugger;throw Error("can't serialize object of unregistered class");}c=d.serialize?d.serialize(a,b):{};if(!d.serialize){for(var k in a)!a.hasOwnProperty(k)||0<=u[e].omit.indexOf(k)||(d=a[k],c[k]=0<=u[e].shallow.indexOf(k)?d:r(d,b));a instanceof Error&&(c.message=a.message)}if(c.$name)throw Error("$name property is reserved for worker serialization logic.");
"Object"!==e&&(c.$name=e);return c}throw Error("can't serialize object of type "+typeof a);}function q(a){if(null===a||void 0===a||"boolean"===typeof a||"number"===typeof a||"string"===typeof a||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||a instanceof ArrayBuffer||ArrayBuffer.isView(a)||a instanceof ImageData)return a;if(Array.isArray(a))return a.map(q);if("object"===typeof a){var b=a.$name||"Object",e=u[b].klass;if(!e)throw Error("can't deserialize unregistered class "+
b);if(e.deserialize)return e.deserialize(a);for(var e=Object.create(e.prototype),c=0,d=Object.keys(a);c<d.length;c+=1){var k=d[c];if("$name"!==k){var g=a[k];e[k]=0<=u[b].shallow.indexOf(k)?g:q(g)}}return e}throw Error("can't deserialize object of type "+typeof a);}var u={};d.register=t;t("Object",Object);t("StructArrayLayout2i4",e.StructArrayLayout2i4);t("StructArrayLayout3ui6",e.StructArrayLayout3ui6);t("StructArrayLayout2ui4",e.StructArrayLayout2ui4);t("StructArrayLayout2i4ub8",e.StructArrayLayout2i4ub8);
t("StructArrayLayout4i4ui16",e.StructArrayLayout4i4ui16);t("StructArrayLayout3f12",e.StructArrayLayout3f12);t("StructArrayLayout1ul4",e.StructArrayLayout1ul4);t("StructArrayLayout2i2i2i12",e.StructArrayLayout2i2i2i12);t("StructArrayLayout2ub2f12",e.StructArrayLayout2ub2f12);t("GlyphOffsetArray",e.GlyphOffsetArray);t("SymbolInstanceArray",e.SymbolInstanceArray);t("SymbolLineVertexArray",e.SymbolLineVertexArray);t("StructArrayLayout2f8",e.StructArrayLayout2f8);t("PlacedSymbolArray",e.PlacedSymbolArray);
t("StructArrayLayout2i4i12",e.StructArrayLayout2i4i12);t("StructArrayLayout1f4",e.StructArrayLayout1f4);t("StructArrayLayout3i6",e.StructArrayLayout3i6);t("SegmentVector",b);t("CollisionBoxArray",e.CollisionBoxArray);t("Grid",l);t("FeatureIndexArray",e.FeatureIndexArray);t("CanonicalTileID",h);t("OverscaledTileID",m,{omit:["posMatrix"]});t("Anchor",k);t("ImagePosition",n);t("ImageAtlas",p);t("Color",a);t("AlphaImage",g.AlphaImage);t("RGBAImage",g.RGBAImage);t("Error",Error);d.serialize=r;d.deserialize=
q})},"com/huayun/webgis/renderer/TextRenderer":function(){define("custom/gl-matrix-min ./Renderer ../gl/mode ../gl/Texture ../data/bucket/TextBucketSimplify ../geometry/Point ../gl/programCache ../utils/MathUtils".split(" "),function(f,d,m,h,c,a,g,l){function e(){}d&&(e.__proto__=d);e.prototype=Object.create(d&&d.prototype);e.prototype.constructor=e;e.prototype.add=function(b,e,d,g){if("undefined"!==typeof g.text||"undefined"!==typeof g.texts)if(b.ground&&e.base&&!e.base.posMidified)e.needAdd=!0;
else{e.needAdd=!1;var k;switch(d.type){case "point":k=d;break;case "multipoint":k=this.getMultiPointOfCenter(d.points);break;case "line":k=this.getLineCenterPoint(d.path);break;case "polygon":k=l.calculateCoreOfPolygon(d.path[0]);break;case "multipolygon":k=d.getMaxAreaPolygon(),k=l.calculateCoreOfPolygon(k.path[0])}b.ground&&e.base&&e.base.posMidified&&(k.z=e.baseZ?e.baseZ+e.base.z:k.z+e.base.z,e.base=null);d=new c;var n=e.position||b.viewpoint.center||[0,0],f=n[0],n=n[1];d.addFeature([[new a(k.x-
f,k.y-n)]],g.text||g.texts,g.font,g.glyphMap,g.glyphAtlas.positions,g.offset,g.colors);d.upload(b.context,g.colors);e.buckets.push(d);e.position=[f,n,k.z];e.initPosition=[f,n,k.z]}};e.prototype.getMultiPointOfCenter=function(a){return a[1]};e.prototype.getLineCenterPoint=function(a){return l.calculateCenterOfLine(a[0]).center};e.prototype.draw=function(a,e,c,d,l,r){if("undefined"!==typeof d.text||"undefined"!==typeof d.texts){if(e.needAdd||0===e.buckets.length)if(this.add(a,e,c,d),e.needAdd)return;
void 0===r&&(r=0);c=a.context;var b=c.gl;l=l?l.depthModeForSublayer(0,m.DepthMode.ReadWrite):new m.DepthMode(b.LEQUAL,m.DepthMode.ReadWrite,[.9,.9]);var k=m.StencilMode.disabled,n=m.ColorMode.alphaBlended,p=d.colors?g.useProgramSimplify(c,"text",{layoutAttributes:[{name:"a_pos",type:"Float32",components:2,offset:0},{name:"a_color",type:"Float32",components:4,offset:8},{name:"a_data",type:"Int16",components:4,offset:24}],defines:["#define HAS_COLOR"]}):g.useProgramSimplify(c,"text",{layoutAttributes:[{name:"a_pos",
type:"Float32",components:2,offset:0},{name:"a_data",type:"Int16",components:4,offset:8}]});debugger;var t=e.symbol.uniforms,x=e.position,w=d.glyphAtlas.image,A=e.buckets[r],B=[w.width,w.height],x=a.viewpoint.getMatrixForPoint(x[0],x[1],!1,!1,x[2]);t.u_camera_to_center_distance=a.viewpoint.cameraToCenterDistance;t.u_matrix=x;var E=a.viewpoint.labelPlaneMatrix,C=f.mat4.create();f.mat4.multiply(C,E,x);t.u_label_plane_matrix=C;x=a.viewpoint.glCoordMatrix;t.u_coord_matrix=x;t.u_texsize=B;d.markerSize?
(B=this.getRealScale(d.fixed,a.scale,d.minScale)*e.markerScaleFactor,t.u_size=this.calculateSize(d.markerSize*B,d.width,d.height)):e.symbol.size?(e.scaleFactor=e.scaleFactor||1,B=this.getRealScale(d.fixed,a.scale,d.minScale)*e.scaleFactor,t.u_size=this.calculateSize(e.symbol.size*B,d.width,d.height)):t.u_size=d.fontSize*this.getRealScale(d.fixed,a.scale,d.minScale);c.activeTexture.set(b.TEXTURE0);B=d.texture;B||(B=d.texture=new h(c,w,b.ALPHA));B.bind(b.LINEAR,b.CLAMP_TO_EDGE);d.hasHalo&&(t.u_is_halo=
1,p.draw(c,b.TRIANGLES,l,k,n,m.CullFaceMode.disabled,t,e.id+"-text-halo"+r,A.layoutVertexBuffer,A.indexBuffer,A.segments,null,a.viewpoint.level));t.u_is_halo=0;p.draw(c,b.TRIANGLES,l,k,n,m.CullFaceMode.disabled,t,e.id+"-text"+r,A.layoutVertexBuffer,A.indexBuffer,A.segments)}};e.prototype.drawGlow=function(a,e,c,d,g,l){};e.prototype.calculateSize=function(a,e,c){return 96*Math.min(a/e,a/c)};return e})},"com/huayun/gl/shaders/background":function(){define(["exports","../../webgis/data/uniform"],function(f,
d){f.backgroundVS="attribute vec4 a_pos;\n\nvarying float y_screen;\n//varying vec2 v_texture;\n\nvoid main() {\n    gl_Position \x3d vec4(a_pos.xy, 0.0, 1.0);\n//    v_texture \x3d a_pos.zw;\n    y_screen \x3d a_pos.y;\n}";f.backgroundFS="precision mediump float;\n\n/*uniform sampler2D u_image;\nvarying vec2 v_texture;*/\nvarying float y_screen;\n\nvoid main() {\n    //    gl_FragColor \x3d texture2D(u_image, v_texture);\n    float fogFactor \x3d 1.0 - smoothstep(0.3, 0.5, y_screen);\n    gl_FragColor \x3d vec4(0.94, 0.93, 0.91, 1.0) * (1.0-fogFactor) + vec4(0.0, 0.0, 0.0, 0.0) * fogFactor;\n}";
f.bgUniforms=function(d,f){return{}}})},"com/huayun/webgis/gl/draw/drawBackground":function(){define(["../mode","../programCache"],function(f,d){return function(m){var h=m.context,c=h.gl,a=d.useProgramSimplify(h,"bg",{layoutAttributes:[{name:"a_pos",type:"Float32",components:3,offset:0}]}),g=c.LINEAR;h.activeTexture.set(c.TEXTURE0);m._backgroundTexture.bind(g,c.CLAMP_TO_EDGE,c.LINEAR_MIPMAP_NEAREST);var g=f.StencilMode.disabled,l=new f.DepthMode(c.LEQUAL,f.DepthMode.ReadWrite,[0,1]);a.draw(h,c.TRIANGLES,
l,g,f.ColorMode.alphaBlended,f.CullFaceMode.disabled,{},"background",m.viewpoint.rasterBoundsBuffer,m.viewpoint.quadTriangleIndexBuffer,m.viewpoint.rasterBoundsSegments)}})},"com/huayun/webgis/facade/TileFacade":function(){define(["exports","../utils/Resource"],function(f,d){f.getTileInfoData=function(f,h){var c=dojoConfig.token;d.loadJson(f,c?{headers:{"access-key":c}}:void 0,h)};f.loadTile=function(f,h){var c=dojoConfig.token;return d.loadImage(f,c?{headers:{"access-key":c}}:void 0,h)}})},"com/huayun/webgis/geometry/Geometry":function(){define([],
function(){function f(){this.spatialReference=this.extent=null;this.type="";this.hasZ=this.hasM=!1}f.prototype.clone=function(){};f.prototype.update=function(){};return f})},"com/huayun/webgis/symbols/RectSymbol":function(){define(["./Symbol","../utils/Color"],function(f,d){var m=function(c){if(c){f.call(this,c);this.type="rect";this.isFixed=void 0===c.isFixed?!0:c.isFixed;this.fixed={isFixed:this.isFixed,addratio:0};this.width=Number(c.width||1);this.height=Number(c.height||1);var a=d.parse(c.fill||
c.color||"#FFF");this._color=[a.r,a.g,a.b,a.a];this.dx=Number(c.dx||0);this.dy=Number(c.dy||0);a=d.parse(c.stroke||"#000");this.strokeWidth=Number(c["stroke-width"]||0);this._stroke=[a.r,a.g,a.b,a.a];this.rx=Number(c.rx);this.ry=Number(c.ry);this.widthWithStroke=this.width+2*this.strokeWidth;this.heightWithStroke=this.height+2*this.strokeWidth;this.angle=Number(c.angle||0);this.uniforms={u_color:this.color,u_device_pixel_ratio:window.devicePixelRatio,u_is_stroke:1,u_size:1,u_radian:0}}};f&&(m.__proto__=
f);m.prototype=Object.create(f&&f.prototype);m.prototype.constructor=m;m.prototype.setRadian=function(c){this.uniforms.u_rotate_symbol=1;this.uniforms.u_radian=c};m.prototype.clone=function(){var c=new m;c.type="rect";c.markerSize=this.markerSize;c.minScale=this.minScale;c.maxScale=this.maxScale;c.width=this.width;c.height=this.height;c.dx=this.dx;c.dy=this.dy;c.strokeWidth=this.strokeWidth;c.stroke=this.stroke;c.rx=this.rx;c.ry=this.ry;c.widthWithStroke=this.widthWithStroke;c.heightWithStroke=this.heightWithStroke;
c.angle=this.angle;c.uniforms=this.uniforms;c.color=this.color;c.isFixed=this.isFixed;c.fixed={isFixed:c.isFixed,addratio:0};return c};var h={color:{configurable:!0},stroke:{configurable:!0}};h.color.set=function(c){c=d.parse(c);this._color=[c.r,c.g,c.b,c.a];this.uniforms&&(this.uniforms.u_color=this._color)};h.color.get=function(){return this._color};h.stroke.set=function(c){c=d.parse(c);this._stroke=[c.r,c.g,c.b,c.a]};h.stroke.get=function(){return this._stroke};Object.defineProperties(m.prototype,
h);return m})},"dojo/selector/lite":function(){define(["../has","../_base/kernel"],function(f,d){var m=document.createElement("div"),h=m.matches||m.webkitMatchesSelector||m.mozMatchesSelector||m.msMatchesSelector||m.oMatchesSelector,c=m.querySelectorAll,a=/([^\s,](?:"(?:\\.|[^"])+"|'(?:\\.|[^'])+'|[^,])*)/g;f.add("dom-matches-selector",!!h);f.add("dom-qsa",!!c);var g=function(a,n){if(b&&-1<a.indexOf(","))return b(a,n);var k=n?n.ownerDocument||n:d.doc||document,h=(c?/^([\w]*)#([\w\-]+$)|^(\.)([\w\-\*]+$)|^(\w+$)/:
/^([\w]*)#([\w\-]+)(?:\s+(.*))?$|(?:^|(>|.+\s+))([\w\-\*]+)(\S*$)/).exec(a);n=n||k;if(h){var m=8===f("ie")&&f("quirks")?n.nodeType===k.nodeType:null!==n.parentNode&&9!==n.nodeType&&n.parentNode===k;if(h[2]&&m){var q=d.byId?d.byId(h[2],k):k.getElementById(h[2]);if(!q||h[1]&&h[1]!=q.tagName.toLowerCase())return[];if(n!=k)for(a=q;a!=n;)if(a=a.parentNode,!a)return[];return h[3]?g(h[3],q):[q]}if(h[3]&&n.getElementsByClassName)return n.getElementsByClassName(h[4]);if(h[5])if(q=n.getElementsByTagName(h[5]),
h[4]||h[6])a=(h[4]||"")+h[6];else return q}if(c)return 1===n.nodeType&&"object"!==n.nodeName.toLowerCase()?l(n,a,n.querySelectorAll):n.querySelectorAll(a);q||(q=n.getElementsByTagName("*"));h=[];k=0;for(m=q.length;k<m;k++){var u=q[k];1==u.nodeType&&e(u,a,n)&&h.push(u)}return h},l=function(b,e,c){var d=b,k=b.getAttribute("id"),g=k||"__dojo__",n=b.parentNode,l=/^\s*[+~]/.test(e);if(l&&!n)return[];k?g=g.replace(/'/g,"\\$\x26"):b.setAttribute("id",g);l&&n&&(b=b.parentNode);e=e.match(a);for(n=0;n<e.length;n++)e[n]=
"[id\x3d'"+g+"'] "+e[n];e=e.join(",");try{return c.call(b,e)}finally{k||d.removeAttribute("id")}};if(!f("dom-matches-selector"))var e=function(){function a(a,b,e){var c=b.charAt(0);if('"'==c||"'"==c)b=b.slice(1,-1);b=b.replace(/\\/g,"");var d=l[e||""];return function(e){return(e=e.getAttribute(a))&&d(e,b)}}function b(a){return function(b,e){for(;(b=b.parentNode)!=e;)if(a(b,e))return!0}}function e(a){return function(b,e){b=b.parentNode;return a?b!=e&&a(b,e):b==e}}function c(a,b){return a?function(e,
c){return b(e)&&a(e,c)}:b}var d="div"==m.tagName?"toLowerCase":"toUpperCase",g={"":function(a){a=a[d]();return function(b){return b.tagName==a}},".":function(a){var b=" "+a+" ";return function(e){return-1<e.className.indexOf(a)&&-1<(" "+e.className+" ").indexOf(b)}},"#":function(a){return function(b){return b.id==a}}},l={"^\x3d":function(a,b){return 0==a.indexOf(b)},"*\x3d":function(a,b){return-1<a.indexOf(b)},"$\x3d":function(a,b){return a.substring(a.length-b.length,a.length)==b},"~\x3d":function(a,
b){return-1<(" "+a+" ").indexOf(" "+b+" ")},"|\x3d":function(a,b){return 0==(a+"-").indexOf(b+"-")},"\x3d":function(a,b){return a==b},"":function(a,b){return!0}},f={};return function(d,k,n){var l=f[k];if(!l){if(k.replace(/(?:\s*([> ])\s*)|(#|\.)?((?:\\.|[\w-])+)|\[\s*([\w-]+)\s*(.?=)?\s*("(?:\\.|[^"])+"|'(?:\\.|[^'])+'|(?:\\.|[^\]])*)\s*\]/g,function(d,k,n,f,h,p,m){f?l=c(l,g[n||""](f.replace(/\\/g,""))):k?l=(" "==k?b:e)(l):h&&(l=c(l,a(h,m,p)));return""}))throw Error("Syntax error in query");if(!l)return!0;
f[k]=l}return l(d,n)}}();if(!f("dom-qsa"))var b=function(b,e){for(var c=b.match(a),d=[],k=0;k<c.length;k++){b=new String(c[k].replace(/\s*$/,""));b.indexOf=escape;b=g(b,e);for(var n=0,l=b.length;n<l;n++){var f=b[n];d[f.sourceIndex]=f}}e=[];for(k in d)e.push(d[k]);return e};g.match=h?function(a,b,e){return e&&9!=e.nodeType?l(e,b,function(b){return h.call(a,b)}):h.call(a,b)}:e;return g})},"com/huayun/webgis/layers/MapImageLayer":function(){define("dojo/_base/declare dojo/topic dojo/request ../data/GraphicIndex ./Layer ../request ../facade/PowerFacade ../geometry/Point ../geometry/Polyline ../geometry/Multipoint ../geometry/Polygon ../views/3d/layers/MapImageLayerView3D ../utils/Resource".split(" "),
function(f,d,m,h,c,a,g,l,e,b,k,n,p){return f("com.huayun.webgis.layers.MapImageLayer",[c],{type:"Image",name:"\u52a8\u6001\u56fe\u5c42",spatialReference:null,sublayers:null,_powerFacade:null,_results:null,constructor:function(a){f.safeMixin(this,a);this.needQuery=a.needQuery;this.id=a.id?a.id:"power";this.selectEnabled=!0;this.initUrl=this.url=a.url;this._initUrl=this.url.substring(0,this.url.indexOf("?"));this._initUrl=this._initUrl.substring(0,this._initUrl.lastIndexOf("/"));this.token=null===RegExp(/access[\u0000-\u00ff]+(&|$)/g).exec(this.url)?
"":RegExp(/access[\u0000-\u00ff]+(&|$)/g).exec(this.url)[0];this.sublayers=[];this.layerData={};this.tolerance=a.tolerance?a.tolerance:5;this.identifyType="visible";this._powerFacade=new g({url:this.url});this._getMapInfoMethod();this.graphicIndex=new h;this.indexNeedUpdate=!0;this._filterUse=!1;this.maxLevel=a.maxLevel},createLayerView:function(a,b){this.layerView=b=new n({width:a.width,height:a.height,opacity:this.opacity,visible:this.visible,view:a,id:this.id,layer:this});b.transform=a.viewpoint;
return b},_getMapInfoMethod:function(){this._powerFacade.getMapInfoData(function(a){this.sublayers=a.layers}.bind(this),function(a){}.bind(this))},_setVisibleAttr:function(a){this.visible=a;this.layerView.setVisible(a)},fetchImage:function(b,e,c,d){e=this.getImageUrl(b,e,c);b=dojoConfig.token;return a(e,{responseType:"image",headers:b?{headers:{"access-key":b}}:void 0}).then(function(a){return a.data})},getFilterData:function(){this.filter&&m.get(this.filter+"?"+this.token,{handleAs:"json"}).then(function(a){for(var b=
0;b<a.data.length;b++){var e=a.data[b].level,c=a.data[b].layers.join();this.layerData[e]=c}this._filterUse&&this.getMSCdata(this.layerView.view.getExtent())}.bind(this))},getMSCdata:function(a){if(this.needQuery)return m.get(this._initUrl+"/identify?layers\x3dvisible\x26"+this.token+"\x26f\x3djson\x26geometryType\x3desriGeometryEnvelope\x26geometry\x3d"+a.minx+","+a.miny+","+a.maxx+","+a.maxy+"\x26tolerance\x3d"+this.tolerance,{handleAs:"json"}).then(function(a){this.indexNeedUpdate=!0;this._results=
a.results}.bind(this))},getImageUrl:function(a,b,e){var c=this.url.replace(/\{minx\}/,a.minx),c=c.replace(/\{miny\}/,a.miny),c=c.replace(/\{maxx\}/,a.maxx),c=c.replace(/\{maxy\}/,a.maxy),c=c.replace(/\{w\}/,b);return c=c.replace(/\{h\}/,e)},setUrl:function(a){this.url=a;this._initUrl=this.url.substring(0,this.url.indexOf("?"));this._initUrl=this._initUrl.substring(0,this._initUrl.lastIndexOf("/"))},setFilter:function(a){if(a)if(a instanceof Object)for(var b in a)0<this.initUrl.indexOf("?")?this.url=
this.initUrl+"\x26"+b+"\x3d"+a[b]:this.url=this.initUrl+"?"+b+"\x3d"+a[b];else this.url=this.initUrl+a;else this.url=this.initUrl},refresh:function(){this.layerView.refresh()},setVisible:function(a){d.publish("mapImageLayerVisibleChange",a,this.id);this.visible=a;this.layerView.setVisible(a)},setOpacity:function(a){this.layerView.setOpacity(a)},queryFeaturesByGeometry:function(a,b,e){b=b||this.tolerance;var c=this.token?this._initUrl+"/identify?layers\x3d"+this.identifyType+"\x26"+this.token+"\x26f\x3djson":
this._initUrl+"/identify?layers\x3d"+this.identifyType+"\x26f\x3djson";switch(a.type){case "point":c+="\x26geometryType\x3desriGeometryPoint\x26geometry\x3d"+Math.round(a.x)+","+Math.round(a.y);break;default:a=this.getBounds(a),c+="\x26geometryType\x3desriGeometryEnvelope\x26geometry\x3d"+a.minx+","+a.miny+","+a.maxx+","+a.maxy}c+="\x26tolerance\x3d"+Math.round(b*this.layerView.view.resolution);if(e)return p.loadJson(c,e)},getBounds:function(a){return"point"===a.type?{xmin:a.x,ymin:a.y,xmax:a.x,ymax:a.y}:
a.extent},generateUrl:function(a,b){var e="";b.path[0].forEach(function(a){e+="["+Math.round(a.x)+","+Math.round(a.y)+"],"});e=e.substring(0,e.length-1);return a+('\x26geometryType\x3desriGeometryPolygon\x26geometry\x3d{"rings": [['+e+"]]}")}})})},"com/huayun/webgis/gl/potpack":function(){define([],function(){return function(f){for(var d=0,m=0,h=0;h<f.length;h+=1)var c=f[h],d=d+c.w*c.h,m=Math.max(m,c.w);f.sort(function(a,e){return e.h-a.h});for(var m=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(d/.95)),
m),h:Infinity}],a=c=h=0;a<f.length;a+=1)for(var g=f[a],l=m.length-1;0<=l;l--){var e=m[l];if(!(g.w>e.w||g.h>e.h)){g.x=e.x;g.y=e.y;c=Math.max(c,g.y+g.h);h=Math.max(h,g.x+g.w);g.w===e.w&&g.h===e.h?(g=m.pop(),l<m.length&&(m[l]=g)):g.h===e.h?(e.x+=g.w,e.w-=g.w):(g.w!==e.w&&m.push({x:e.x+g.w,y:e.y,w:e.w-g.w,h:g.h}),e.y+=g.h,e.h-=g.h);break}}return{w:h,h:c,fill:d/(h*c)||0}}})},"com/huayun/webgis/action/measurements/AngleMeasurement":function(){define("dojo/_base/declare dojo/on dojo/topic dojo/dom-class dojo/throttle dojo/dom-construct dojo/_base/window ../../geometry/Polyline ../../Graphic ../../Feature ../../symbols/LineSymbol ../../symbols/PointSymbol ../../symbols/TextSymbol ../../geometry/Point2D ../ActiveMapAction".split(" "),
function(f,d,m,h,c,a,g,l,e,b,k,n,p,t,r){return f("com.huayun.webgis.action.measurements.AngleMeasurement",[r],{constructor:function(b){this.view=b.view;this.view.selectEnabled=!1;this.isActive=!0;this.drawLayer=this.view.map.findLayerById("drawLayer");this._lastPoint=this._mouseMove=this._dblMouseClick=this._mouseClick=null;this._vertexArr=[];this._preClick=!0;this._currentGraphic=null;this._lineGraphicList=[];this._lineGraphicHash={};this._symbol=new k({color:"#009688",width:3});this._vertexSymbol=
new n({radius:5,color:"#0000FF",pitchWithMap:!1,scaleWithPitch:!1});var e=this;m.subscribe("measurement-delete",function(a){(a=e._lineGraphicHash[a])&&0<a.length&&a.forEach(function(a){e.drawLayer.removeGraphic(a)})});m.subscribe("clearGraphicPop",function(){for(var b=document.getElementsByClassName("graphicClose"),e=b.length-1;-1<e;e--)a.destroy(b[e]);this.drawLayer.clear()}.bind(this))},active:function(){this.state||(this.state=!0,this.view.panEnabled=!1,this.view.selectEnabled=!1,this._isNew=!0,
this._mouseClick=d(this.view.container,"click",this._onMouseClick.bind(this)),this._dblMouseClick=d(this.view.container,"dblclick",this._onDoubleMouseClick.bind(this)),h.add(this.view.domNode,"draw-cursor-style"))},_onMouseClick:function(a){a.preventDefault();a.stopPropagation();this._mouseMove||(this._mouseMove=d(this.view.domNode,"mousemove",this._onMouseMove.bind(this)));var b=this.view.screenToGeometry(a.x,a.y);null===this._lastPoint?(this._lineGraphicList=[],this.doAction(b)):a.x!==this._lastPoint.x&&
a.y!==this._lastPoint.y&&this.doAction(b);this._lastPoint={x:a.x,y:a.y}},_onMouseMove:function(a){a=this.view.screenToGeometry(a.x,a.y);this.drawLayer.removeGraphic(this._currentGraphic);var c=new l,d=new b({attribute:null,geometry:c}),d=new e({feature:d,symbol:this._symbol});this._preClick?(this._vertexArr.push(new t(a.x,a.y)),this._preClick=!1):this._vertexArr.splice(this._vertexArr.length-1,1,new t(a.x,a.y));c.setPath([this._vertexArr]);this._currentGraphic=d;this.drawLayer.addGraphic(d);this.drawLayer.layerView.view.threeRender()},
doAction:function(a){this._drawVertex(a)},_drawVertex:function(a){var c=new t(a.x,a.y),d=new b({attribute:null,geometry:c}),d=new e({feature:d,symbol:this._vertexSymbol});this.drawLayer.addGraphic(d);this._lineGraphicList.push(d);d=this._vertexArr.length;this._preClick=!0;this._isNew?(this._vertexArr.push(new t(c.x,c.y)),this._addDistanceTip(c,"\u8d77\u70b9"),this._isNew=!1):(this._vertexArr.splice(d-1,1,new t(a.x,a.y)),2<d&&this._addDistanceTip(this._vertexArr[d-2],this._angleToTip(this._calculateAngle())));
this.drawLayer.layerView.view.threeRender()},_addDistanceTip:function(a,c){c=new p({text:c,color:"#009688",size:12,offset:[-6,3]});a=new b({attribute:null,geometry:new t(a.x,a.y)});a=new e({feature:a,symbol:c});this.drawLayer.addGraphic(a);this._lineGraphicList.push(a)},_calculateAngle:function(){var a=this._vertexArr.length;if(3>a)return 0;var b=this._vertexArr[a-3],e=this._vertexArr[a-2],c=this._vertexArr[a-1],a=b.x-e.x,b=b.y-e.y,d=c.x-e.x,e=c.y-e.y,e=(Math.atan2(a*e-b*d,a*d+b*e)/Math.PI*180+360)%
360;return 180>e?e:360-e},_angleToTip:function(a){var b=null;0<a&&180>a&&(b=a.toFixed(2)+"\u5ea6");return b},_onDoubleMouseClick:function(a){a.preventDefault();a.stopPropagation();this._currentGraphic.rg=this._lineGraphicList;this.showDeleButton(a,this._currentGraphic.id);this.invalid()},_endDrawMethod:function(){this._lineGraphicHash[this._currentGraphic.id]=this._lineGraphicList;null!==this._mouseMove&&(this._mouseMove.remove(),this._mouseMove=null);this._vertexArr=[];this._isNew=!this._isNew;this._lineGraphicList=
this._lastPoint=this._currentGraphic=null},invalid:function(){this.state&&(this._endDrawMethod(),this.state=!1,this.view.panEnabled=!0,this.view.selectEnabled=!0,null!==this._mouseClick&&(this._mouseClick.remove(),this._mouseClick=null),null!==this._dblMouseClick&&(this._dblMouseClick.remove(),this._dblMouseClick=null),h.remove(this.view.domNode,"draw-cursor-style"))},showDeleButton:function(b,e){var c=this,k=a.create("div",{className:"graphicClose",style:{width:"8px",height:"8px",position:"absolute",
color:"red",border:"2px solid red",display:"block",cursor:"pointer",fontSize:"4px",margin:"0 auto",lineHeight:"8px",backgroundColor:"white"},innerHTML:"\u00d7"},document.body);d(k,"click",function(b){b=c.drawLayer.graphics;for(var d,k=0,g=b.length;k<g&&(d=b[k],d.id!==e);k++);d&&(c.drawLayer.removeGraphic(d),d.rg.forEach(function(a){c.drawLayer.removeGraphic(a)}),a.destroy(this))});k.style.left=b.clientX+5+"px";k.style.top=b.clientY+5+"px";return k}})})},"com/huayun/webgis/action/ActiveAction":function(){define(["dojo/_base/declare",
"./Action"],function(f,d){return f("com.huayun.webgis.action.ActiveAction",[d],{isActive:!0,state:!1,constructor:function(d){this.isActive=!0},active:function(){},invalid:function(){},doActive:function(d){}})})},"com/huayun/webgis/action/history/NextView":function(){define(["dojo/_base/declare","../MapAction"],function(f,d){return f("com.huayun.webgis.action.zooms.ZoomIn",[d],{constructor:function(d){f.safeMixin(d);this.isActive=!1;this.view=d.view},doAction:function(){this.view.setView(!1)}})})},
"com/huayun/webgis/handler/PanHandler":function(){define(["dojo/_base/declare","dojo/on"],function(f,d){return f("com.huayun.webgis.handler.PanHandler",[],{view:null,_mouseDown:!1,_fromX:0,_fromY:0,_toX:0,_toY:0,mouseMove:null,mouseUp:null,panRaf:null,mapMouseClickTolerance:0,isPanning:!1,isRotating:!1,isSwitching:!1,constructor:function(f){this.view=f;this._mouseDown=!1;this.mapMouseClickTolerance=3;oncontextmenu=function(){return!1};this.panRaf=null;var h=this;d(f.domNode,"mousedown",function(c){0==
c.button&&f.panEnabled?(h._fromX=c.x,h._fromY=c.y,h._mouseDown=!0,h.isPanning||(h._toX=c.x,h._toY=c.y),h.mouseMove=d(document,"mousemove",function(a){h.mouseMoveHandler(a)}),h.mouseUp=d(document,"mouseup",function(a){h.mouseUpHandler(a)})):2==c.button&&f.rotateEnabled&&(h._fromX=c.x,h._fromY=c.y,h._mouseDown=!0,h.isRotating&&h.isSwitching||(h._toX=c.x,h._toY=c.y),h.mouseMove=d(document,"mousemove",function(a){h.rightMoveHandle(a)}),h.mouseUp=d(document,"mouseup",function(a){h.rightUpHandle(a)}))})},
rightMoveHandle:function(d){this._toX=d.x;this._toY=d.y;if(this._mouseDown){var f=this;d=this._toX-this._fromX;var c=this._toY-this._fromY;if(Math.abs(d)>=this.mapMouseClickTolerance||Math.abs(c)>=this.mapMouseClickTolerance)this.isRotating||this.isSwitching||(Math.abs(d)>Math.abs(c)?(this.isRotating=!0,this.isSwitching=!1):(this.isSwitching=!0,this.isRotating=!1)),this._fromX=this._toX,this._fromY=this._toY,this.isRotating&&!this.isSwitching?this.view._mouseRotate(d):this.view._mouseSwitchDip(c),
this.timeout&&(clearTimeout(this.timeout),this.timeout=null),this.timeout=setTimeout(function(){f.timeout=null;f.isSwitching&&f.view._stopSwitch();f.isRotating&&f.view._stopMouseRotate();f.isSwitching=!1;f.isRotating=!1;f._fromX=f._toX;f._fromY=f._toY},50)}},rightUpHandle:function(d){this.timeout&&(clearTimeout(this.timeout),this.timeout=null);this.isRotating&&this.view._stopMouseRotate();this.isSwitching&&this.view._stopSwitch();this._mouseDown=this.isSwitching=this.isRotating=!1;this.mouseMove.remove();
this.mouseUp.remove();this.view.handlePushViewState()},mouseMoveHandler:function(d){this._toX=d.x;this._toY=d.y;this.isPanning=!0;if(this._mouseDown){var f=this;d=this._toX-this._fromX;var c=this._toY-this._fromY;if(Math.abs(d)>=this.mapMouseClickTolerance||Math.abs(c)>=this.mapMouseClickTolerance)this._fromX=this._toX,this._fromY=this._toY,this.view.mapMove(d,c),this.timeout&&(clearTimeout(this.timeout),this.timeout=null),this.timeout=setTimeout(function(){f.timeout=null;f.view.stopMove();f._fromX=
f._toX;f._fromY=f._toY},50)}},mouseUpHandler:function(d){this.timeout&&(clearTimeout(this.timeout),this.timeout=null);this.isPanning&&(this.isPanning=!1,this.view.stopMove());this._mouseDown=!1;this.mouseMove.remove();this.mouseUp.remove();this.view.handlePushViewState()}})})},"com/huayun/webgis/symbols/PolygonSymbol":function(){define(["./Symbol","../utils/Color"],function(f,d){var m=function(c){if(void 0!==c){f.call(this,c);this.type="polygon";var a=d.parse(c.color||"#FF0000");c=void 0===c.opacity?
1:c.opacity;this._color=[a.r,a.g,a.b,a.a];this._opacity=c;this.uniforms={u_color:this.color,u_opacity:this.opacity}}};f&&(m.__proto__=f);m.prototype=Object.create(f&&f.prototype);m.prototype.constructor=m;m.prototype.clone=function(){var c=new m;c.minScale=this.minScale;c.maxScale=this.maxScale;c.uniforms=this.uniforms;c.color=this.color;c.opacity=this.opacity;return c};var h={color:{configurable:!0},opacity:{configurable:!0}};h.color.set=function(c){c=d.parse(c||"#FF0000");this._color=[c.r,c.g,c.b,
c.a];this.uniforms.u_color=this._color};h.opacity.set=function(c){this._opacity=c;this.uniforms.u_opacity=c};h.color.get=function(){return this._color};h.opacity.get=function(){return this._opacity};Object.defineProperties(m.prototype,h);return m})},"dojo/request/default":function(){define(["exports","require","../has"],function(f,d,m){var h=m("config-requestProvider");h||(h="./xhr");f.getPlatformDefaultId=function(){return"./xhr"};f.load=function(c,a,g,f){d(["platform"==c?"./xhr":h],function(a){g(a)})}})},
"com/huayun/webgis/layers/TileLayer":function(){define("./Layer ../geometry/Extent ../views/3d/layers/TileLayerView3D ../geometry/Point ./support/TileSourceCache ./support/LOD ./support/TileInfo ../facade/TileFacade".split(" "),function(f,d,m,h,c,a,g,l){var e=function(a){f.call(this,a);this.id=a.id||"tileLayer";this.type="Tile";this.name=a.name||"\u9759\u6001\u80cc\u666f\u56fe";this.url=a.url;this.visible=void 0===a.visible?!0:a.visible;this.loaded=this.selectEnabled=!1;this.sourceCache=this.layerView=
this.tileInfo=null;this.tileInfo=a.tileInfo;this.maxLevel=a.maxLevel};f&&(e.__proto__=f);e.prototype=Object.create(f&&f.prototype);e.prototype.constructor=e;e.prototype.createLayerView=function(a,e){this.layerView=e=new m({width:a.width,height:a.height,opacity:this.opacity,visible:this.visible,view:a,id:this.id,layer:this});e.transform=a.viewpoint;this._load(a);return e};e.prototype._load=function(a){var b=this.url.indexOf("MapServer"),e=this.url.substring(0,b+9),b=this.url.indexOf("?",b);-1<b?(b=
this.url.substring(b),e=e+b+"\x26f\x3djson"):e+="?f\x3djson";var d=this;this.tileInfo?(this.sourceCache=new c(this.id,{tileSize:this.tileInfo.size,type:"raster",minzoom:this.tileInfo.minzoom,maxzoom:this.tileInfo.maxzoom},a.width,a.height,this.url,this),a.setTileInfo(this.tileInfo)):l.getTileInfoData(e,function(b,e){b?l.getTileInfoData(require.toUrl("com/huayun/webgis/layers/support/tileInfoData2385.json"),function(b,e){if(b)throw Error(b.message);d._resolve(a,e)}):d._resolve(a,e)})};e.prototype._resolve=
function(b,e){var k=e.tileInfo,f=k.origin,f=new h(f.x,f.y),l=[];e.lods.forEach(function(b){l.push(new a({level:b.level,scale:b.scale,resolution:b.resolution}))});var m=e.fullExtent,m=new d(Number(m.xmin),Number(m.ymin),Number(m.xmax),Number(m.ymax));this.tileInfo=new g({lods:l,origin:f,size:k.cols,fullExtent:m,units:e.units});this.sourceCache=new c(this.id,{tileSize:this.tileInfo.size,type:"raster",minzoom:this.tileInfo.lods[0].level,maxzoom:this.tileInfo.lods[l.length-1].level},b.width,b.height,
this.url,this);b.setTileInfo(this.tileInfo)};e.prototype.refresh=function(){this.layerView.view.threeRender()};e.prototype.setVisible=function(a){this.visible=a;this.layerView.setVisible(a)};e.prototype.setUrl=function(a){this.url=a;this.sourceCache.updateTileUrl(a);a=this.sourceCache.getIds();var b=this.sourceCache;b.clearOtherLevel(this.layerView.view.viewpoint.level);for(var e=0;e<a.length;e+=1)b._reAddTile(a[e])};return e})},"com/huayun/webgis/action/history/PreView":function(){define(["dojo/_base/declare",
"../MapAction"],function(f,d){return f("com.huayun.webgis.action.history.PreView",[d],{constructor:function(d){f.safeMixin(d);this.isActive=!1;this.view=d.view},doAction:function(){this.view.setView(!0)}})})},"com/huayun/webgis/gl/LineAtlas":function(){define([],function(){var f=function(d,f){this.width=d;this.height=f;this.nextRow=0;this.bytes=4;this.data=new Uint8Array(this.width*this.height*this.bytes);this.positions={}};f.prototype.getDash=function(d,f){var h=d.join(",")+String(f);this.positions[h]||
(this.positions[h]=this.addDash(d,f));return this.positions[h]};f.prototype.addDash=function(d,f){var h=f?7:0,c=2*h+1;if(this.nextRow+c>this.height)return null;for(var a=0,g=0;g<d.length;g++)a+=d[g];for(var g=this.width/a,l=g/2,e=1===d.length%2,b=-h;b<=h;b++)for(var k=this.width*(this.nextRow+h+b),n=e?-d[d.length-1]:0,p=d[0],m=1,r=0;r<this.width;r++){for(;p<r/g;)n=p,p+=d[m],e&&m===d.length-1&&(p+=d[0]),m++;var q=Math.min(Math.abs(r-n*g),Math.abs(r-p*g)),u=1===m%2,z=void 0;f?(z=h?b/h*(l+1):0,u?(u=
l-Math.abs(z),z=Math.sqrt(q*q+u*u)):z=l-Math.sqrt(q*q+z*z)):z=(u?1:-1)*q;this.data[3+4*(k+r)]=Math.max(0,Math.min(255,z+128))}d={y:(this.nextRow+h+.5)/this.height,height:2*h/this.height,width:a};this.nextRow+=c;this.dirty=!0;return d};f.prototype.bind=function(d){d=d.gl;this.texture?(d.bindTexture(d.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,d.texSubImage2D(d.TEXTURE_2D,0,0,0,this.width,this.height,d.RGBA,d.UNSIGNED_BYTE,this.data))):(this.texture=d.createTexture(),d.bindTexture(d.TEXTURE_2D,
this.texture),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texImage2D(d.TEXTURE_2D,0,d.RGBA,this.width,this.height,0,d.RGBA,d.UNSIGNED_BYTE,this.data))};return f})},"com/huayun/webgis/renderer/FillRenderer":function(){define(["../geometry/Point","../data/bucket/FillBucketSimplify","../gl/mode","../gl/programCache"],
function(f,d,m,h){function c(){}c.prototype.add=function(a,c,d,e){var b=c.position||a.viewpoint.center||[0,0];e=b[0];b=b[1];if("multipolygon"===d.type){for(var k=[],g=0;g<d.polygons.length;g++){var f=this._addOnePathFeature(d.polygons[g],a,e,b);k.push(f)}c.buckets.push(k)}else f=this._addOnePathFeature(d,a,e,b),c.buckets.push(f);c.position=[e,b]};c.prototype._addOnePathFeature=function(a,c,l,e){var b=a.path;a=[];for(var k=0;k<b.length;k++){for(var g=b[k],h=[],m=0;m<g.length;m++){var r=g[m];h.push(new f(r.x-
l,r.y-e,0))}a.push(h)}l=new d;l.addFeature(a);l.upload(c.context);return l};c.prototype.draw=function(a,c,d,e,b,k){void 0===k&&(k=0);var g=m.ColorMode.alphaBlended,f=a.context,l=f.gl,r;r=b?b.depthModeForSublayer(0,m.DepthMode.ReadOnly):new m.DepthMode(l.LEQUAL,m.DepthMode.ReadOnly,[.9,.9]);var q=h.useProgramSimplify(f,"basicFill",{layoutAttributes:[{name:"a_pos",type:"Float32",components:2,offset:0}]}),u=e.uniforms;b=c.position;u.u_matrix=a.viewpoint.getMatrixForPoint(b[0],b[1]);u.u_color=e.color;
a=c.buckets[k];"multipolygon"===d.type?a.forEach(function(a,b){q.draw(f,l.TRIANGLES,r,null,g,m.CullFaceMode.disabled,u,c.id+"-fill"+k+"-"+b,a.layoutVertexBuffer,a.indexBuffer,a.segments)}):q.draw(f,l.TRIANGLES,r,null,g,m.CullFaceMode.disabled,u,c.id+"-fill"+k,a.layoutVertexBuffer,a.indexBuffer,a.segments)};c.prototype.drawGlow=function(a,c,d,e,b,k){var g=c.glow;if(g){void 0===k&&(k=0);d=m.ColorMode.alphaBlended;var f=a.context,l=f.gl;b=b?b.depthModeForSublayer(0,m.DepthMode.ReadOnly):new m.DepthMode(l.LEQUAL,
m.DepthMode.ReadOnly,[.9,.9]);var r=h.useProgramSimplify(f,"basicFill",{layoutAttributes:[{name:"a_pos",type:"Float32",components:2,offset:0}]});e=e.uniforms;var q=c.position;e.u_matrix=a.viewpoint.getMatrixForPoint(q[0],q[1]);e.u_color=g.color;a=c.buckets[k];r.draw(f,l.TRIANGLES,b,null,d,m.CullFaceMode.disabled,e,c.id+"-fill"+k,a.layoutVertexBuffer,a.indexBuffer,a.segments)}};c.prototype.calculateExtent=function(a,c,d,e,b){a=d.extent;b.push({id:c.id,g:c,minX:a.xmin,minY:a.ymin,maxX:a.xmax,maxY:a.ymax,
symbol:e})};return c})},"com/huayun/webgis/layers/support/RasterTileSource":function(){define(["../../facade/TileFacade","../../gl/Texture"],function(f,d){function m(d,c,a,g){this.id=d;this.type="raster";this.minzoom=c.minzoom;this.maxzoom=c.maxzoom;this.roundZoom=!0;this.scheme="xyz";this.tileSize=c.tileSize||256;this.url=a;this.layer=g}m.prototype.hasTile=function(d){};m.prototype.updateTileUrl=function(d){this.url=d};m.prototype.loadTile=function(h,c){var a=this,g=h.tileID.canonical.url([this.url]);
h.request=f.loadTile(g,function(g,e){delete h.request;if(h.aborted)h.state="unloaded",c(null);else if(g)h.state="errored",c(g);else if(e){g=a.layer.layerView.view.context;var b=g.gl;h.texture=a.layer.layerView.getTileTexture(e.width);h.texture?h.texture.update(e,{useMipmap:!0}):(h.texture=new d(g,e,b.RGBA,{useMipmap:!0}),h.texture.bind(b.LINEAR,b.CLAMP_TO_EDGE,b.LINEAR_MIPMAP_NEAREST),g.extTextureFilterAnisotropic&&b.texParameterf(b.TEXTURE_2D,g.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,
g.extTextureFilterAnisotropicMax));h.state="loaded";c(null)}})};m.prototype.abortTile=function(d,c){d.request&&(d.request.cancel(),delete d.request);c()};m.prototype.unloadTile=function(d,c){d.texture&&this.layer.layerView.saveTileTexture(d.texture);c()};m.prototype.hasTransition=function(){return!1};return m})},"com/huayun/webgis/symbols/Symbol":function(){define([],function(){function f(d){d&&(this.minScale=void 0===d.minScale?1:d.minScale,this.maxScale=void 0===d.maxScale?1:d.maxScale,this.dx=
void 0===d.dx?0:d.dx,this.dy=void 0===d.dy?0:d.dy,this.isFixed=!1===d.isFixed?!1:void 0===d.symbol?!0:void 0===d.isFixed,this.renderer=void 0===d.renderer?null:d.renderer,this.fixed={isFixed:this.isFixed,addratio:0})}f.prototype.clone=function(){};return f})},"com/huayun/webgis/gl/VertexArrayObject":function(){define([],function(){function f(){this.boundLayoutVertexBuffer=this.boundProgram=null;this.boundPaintVertexBuffers=[];this.vao=this.boundDynamicVertexBuffer=this.boundVertexOffset=this.boundIndexBuffer=
null}f.prototype.bind=function(d,f,h,c,a,g,l,e){this.context=d;for(var b=this.boundPaintVertexBuffers.length!==c.length,k=0;!b&&k<c.length;k++)this.boundPaintVertexBuffers[k]!==c[k]&&(b=!0);b=!this.vao||this.boundProgram!==f||this.boundLayoutVertexBuffer!==h||b||this.boundIndexBuffer!==a||this.boundVertexOffset!==g||this.boundDynamicVertexBuffer!==l||this.boundDynamicVertexBuffer2!==e;!d.extVertexArrayObject||b?this.freshBind(f,h,c,a,g,l,e):(d.bindVertexArrayOES.set(this.vao),l&&l.bind(),a&&a.dynamicDraw&&
a.bind(),e&&e.bind())};f.prototype.freshBind=function(d,f,h,c,a,g,l){var e,b=d.numAttributes,k=this.context,n=k.gl;if(k.extVertexArrayObject)this.vao&&this.destroy(),this.vao=k.extVertexArrayObject.createVertexArrayOES(),k.bindVertexArrayOES.set(this.vao),e=0,this.boundProgram=d,this.boundLayoutVertexBuffer=f,this.boundPaintVertexBuffers=h,this.boundIndexBuffer=c,this.boundVertexOffset=a,this.boundDynamicVertexBuffer=g,this.boundDynamicVertexBuffer2=l;else{e=k.currentNumAttributes||0;for(var p=b;p<
e;p++)n.disableVertexAttribArray(p)}f.enableAttributes(n,d);for(e=0;e<h.length;e+=1)h[e].enableAttributes(n,d);g&&g.enableAttributes(n,d);l&&l.enableAttributes(n,d);f.bind();f.setVertexAttribPointers(n,d,a);for(f=0;f<h.length;f+=1)e=h[f],e.bind(),e.setVertexAttribPointers(n,d,a);g&&(g.bind(),g.setVertexAttribPointers(n,d,a));c&&c.bind();l&&(l.bind(),l.setVertexAttribPointers(n,d,a));k.currentNumAttributes=b};f.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),
this.vao=null)};return f})},"com/huayun/webgis/utils/image":function(){define(["exports"],function(f){function d(a,c,e,b){var d=c.width;c=c.height;if(!b)b=new Uint8Array(d*c*e);else if(b instanceof Uint8ClampedArray)b=new Uint8Array(b.buffer);else if(b.length!==d*c*e)throw new RangeError("mismatched image size");a.width=d;a.height=c;a.data=b;return a}function m(a,c,e){var b=c.width;c=c.height;if(b!==a.width||c!==a.height){var k=d({},{width:b,height:c},e);h(a,k,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,
b),height:Math.min(a.height,c)},e);a.width=b;a.height=c;a.data=k.data}}function h(a,c,e,b,d,n){if(0===d.width||0===d.height)return c;if(d.width>a.width||d.height>a.height||e.x>a.width-d.width||e.y>a.height-d.height)throw new RangeError("out of range source coordinates for image copy");if(d.width>c.width||d.height>c.height||b.x>c.width-d.width||b.y>c.height-d.height)throw new RangeError("out of range destination coordinates for image copy");for(var k=a.data,g=c.data,f=0;f<d.height;f++)for(var l=((e.y+
f)*a.width+e.x)*n,h=((b.y+f)*c.width+b.x)*n,m=0;m<d.width*n;m++)g[h+m]=k[l+m];return c}var c=function(a,c){d(this,a,1,c)};c.prototype.resize=function(a){m(this,a,1)};c.prototype.clone=function(){return new c({width:this.width,height:this.height},new Uint8Array(this.data))};c.copy=function(a,c,e,b,d){h(a,c,e,b,d,1)};f.AlphaImage=c;var a=function(a,c){d(this,a,4,c)};a.prototype.resize=function(a){m(this,a,4)};a.prototype.replace=function(a,c){c?this.data.set(a):this.data=a instanceof Uint8ClampedArray?
new Uint8Array(a.buffer):a};a.prototype.clone=function(){return new a({width:this.width,height:this.height},new Uint8Array(this.data))};a.copy=function(a,c,e,b,d){h(a,c,e,b,d,4)};f.RGBAImage=a;f.renderColorRamp=function(c,d){for(var e=new Uint8Array(1024),b={},k=0,g=0;256>k;k++,g+=4){b[d]=k/255;var f=c.evaluate(b);e[g+0]=Math.floor(255*f.r/f.a);e[g+1]=Math.floor(255*f.g/f.a);e[g+2]=Math.floor(255*f.b/f.a);e[g+3]=Math.floor(255*f.a)}return new a({width:256,height:1},e)}})},"com/huayun/core/EventEmitter":function(){define([],
function(){function f(a,b){for(var e=Array(b),c=0;c<b;++c)e[c]=a[c];return e}function d(e,b,c,d){var k,g;if("function"!==typeof c)throw Error("listener must be function");k=e._events;void 0===k?(k=e._events=Object.create(null),e._eventsCount=0):(void 0!==k.newListener&&(e.emit("newListener",b,c.listener?c.listener:c),k=e._events),g=k[b]);void 0===g?(g=k[b]=c,++e._eventsCount):("function"===typeof g?g=k[b]=d?[c,g]:[g,c]:d?g.unshift(c):g.push(c),b=void 0===e._maxListeners?a.defaultMaxListeners:e._maxListeners,
0<b&&g.length>b&&!g.warned&&console.warn("Possible EventEmitter memory leak detected."));return e}function m(a,b,c){a={fired:!1,wrapFn:void 0,target:a,type:b,listener:c};b=h.bind(a);b.listener=c;return a.wrapFn=b}function h(){this.fired||(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,this.listener.apply(this.target,Array.prototype.slice.call(arguments,0)))}function c(a,b,c){a=a._events;if(void 0===a)return[];b=a[b];if(void 0===b)return[];if("function"===typeof b)return c?[b.listener||
b]:[b];if(c)for(c=Array(b.length),a=0;a<c.length;++a)c[a]=b[a].listener||b[a];else c=f(b,b.length);return c}function a(){a.init.call(this)}function g(a){var b=this._events;if(void 0!==b){a=b[a];if("function"===typeof a)return 1;if(void 0!==a)return a.length}return 0}var l=10;Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return l},set:function(a){if("number"!==typeof a||0>a||Number.isNaN(a))throw Error("defaultMaxListeners must be a positive number!");l=a}});a.prototype._events=
void 0;a.prototype._eventsCount=0;a.prototype._maxListeners=void 0;a.init=function(){if(void 0===this._events||this._events===Object.getPrototypeOf(this)._events)this._events=Object.create(null),this._eventsCount=0;this._maxListeners=this._maxListeners||void 0};a.prototype.setMaxListeners=function(a){if("number"!==typeof a||0>a||Number.isNaN(a))throw Error("defaultMaxListeners must be a positive number!");this._maxListeners=a;return this};a.prototype.getMaxListeners=function(){return void 0===this._maxListeners?
a.defaultMaxListeners:this._maxListeners};a.prototype.emit=function(a){var b="error"===a,e=this._events;if(void 0!==e)b=b&&void 0===e.error;else if(!b)return!1;if(b){var c;1<arguments.length&&(c=arguments[1]);if(c instanceof Error)throw c;}e=e[a];if(void 0===e)return!1;if("function"===typeof e)e.apply(this,Array.prototype.slice.call(arguments,1));else for(b=e.length,e=f(e,b),c=0;c<b;++c)e[c].apply(this,Array.prototype.slice.call(arguments,1));return!0};a.prototype.addListener=function(a,b){return d(this,
a,b,!1)};a.prototype.on=a.prototype.addListener;a.prototype.prependListener=function(a,b){return d(this,a,b,!0)};a.prototype.once=function(a,b){if("function"!==typeof b)throw Error("listener must be function!");this.on(a,m(this,a,b));return this};a.prototype.prependOnceListener=function(a,b){if("function"!==typeof b)throw Error("listener must be function!");this.prependListener(a,m(this,a,b));return this};a.prototype.removeListener=function(a,b){var e,c,d,g,f;if("function"!==typeof b)throw Error("listener must be function!");
c=this._events;if(void 0===c)return this;e=c[a];if(void 0===e)return this;if(e===b||e.listener===b)0===--this._eventsCount?this._events=Object.create(null):(delete c[a],c.removeListener&&this.emit("removeListener",a,e.listener||b));else if("function"!==typeof e){d=-1;for(g=e.length-1;0<=g;g--)if(e[g]===b||e[g].listener===b){f=e[g].listener;d=g;break}if(0>d)return this;0===d?e.shift():e.splice(d,1);1===e.length&&(c[a]=e[0]);void 0!==c.removeListener&&this.emit("removeListener",a,f||b)}return this};
a.prototype.off=a.prototype.removeListener;a.prototype.removeAllListeners=function(a){var b,e;e=this._events;if(void 0===e)return this;if(void 0===e.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==e[a]&&(0===--this._eventsCount?this._events=Object.create(null):delete e[a]),this;if(0===arguments.length){b=Object.keys(e);var c;for(e=0;e<b.length;++e)c=b[e],"removeListener"!==c&&this.removeAllListeners(c);this.removeAllListeners("removeListener");
this._events=Object.create(null);this._eventsCount=0;return this}b=e[a];if("function"===typeof b)this.removeListener(a,b);else if(void 0!==b)for(e=b.length-1;0<=e;e--)this.removeListener(a,b[e]);return this};a.prototype.listeners=function(a){return c(this,a,!0)};a.prototype.rawListeners=function(a){return c(this,a,!1)};a.listenerCount=function(a,b){return"function"===typeof a.listenerCount?a.listenerCount(b):g.call(a,b)};a.prototype.listenerCount=g;a.prototype.eventNames=function(){return 0<this._eventsCount?
Object.keys(this._events):[]};return a})},"com/huayun/webgis/gl/draw":function(){define("exports ../utils/Color ../utils/Constant ../utils/utils ./mode ../geometry/Point2D ../layers/support/funcUtils ./Texture custom/gl-matrix-min".split(" "),function(f,d,m,h,c,a,g,l,e){function b(a){return"opaque"===a?c.ColorMode.unblended:c.ColorMode.alphaBlended}function k(a,b){for(var e=0;e<a;e++){var c=b.length;b.resize(c+4);b.float32.set(v,3*c)}}function n(b,e){b=[b.x,b.y,0,1];g.xyTransformMat4(b,b,e);e=b[3];
return{point:new a(b[0]/e,b[1]/e),signedDistanceFromCamera:e}}function p(b,e,d,f,l,p,q,r,v,w,A,x,B){for(var C=b.view.context,F=C.gl,E="map"===r,H="map"===v,G=E&&"point"!==d.layout.get("symbol-placement"),I=E&&!H&&!G,Q=b.depthModeForSublayer(0,c.DepthMode.ReadOnly),J,M,D=d.layout.get("text-variable-anchor"),L=[],K=b.view.viewpoint.level,P=b.view.viewpoint.angle,W=0;W<f.length;W+=1){var V=f[W],S=e.getTile(V);if(S){var O=S.getBucket(d);if(O){var Y=l?O.text:O.icon;if(Y&&Y.segments.get().length){var T=
Y.programConfigurations.get(d.id),pa=l||O.sdfIcons,ka=l?O.textSizeData:O.iconSizeData;J||(J=b.view.useProgram(pa?"symbolSDF":"symbolIcon",T),M=g.evaluateSizeForZoom(ka,K));C.activeTexture.set(F.TEXTURE0);var ya=void 0,la=void 0,za=void 0;if(l)la=S.glyphAtlasTexture,za=F.LINEAR,ya=S.glyphAtlasTexture.size;else var wa=1!==d.layout.get("icon-size").constantOr(0)||O.iconsNeedLinear,Ta=H||!1,la=S.imageAtlasTexture,za=pa||wa||Ta?F.LINEAR:F.NEAREST,ya=S.imageAtlasTexture.size;var na=m.layout.EXTENT/S.tileSize*
1,Aa=g.getLabelPlaneMatrix(V.posMatrix,H,E,b.transform,na),Ja=g.getGlCoordMatrix(V.posMatrix,H,E,b.transform,na);if(G){var N=O,oa=V.posMatrix,ma=b,qa=l,ra=Aa,Ua=Ja,eb=H,Va=w,sa=qa?N.textSizeData:N.iconSizeData,Ka=g.evaluateSizeForZoom(sa,K),Ba=ma.view.viewpoint,Ca=[256/Ba.width*2+1,256/Ba.height*2+1],X=qa?N.text.dynamicLayoutVertexArray:N.icon.dynamicLayoutVertexArray;X.clear();for(var Wa=N.lineVertexArray,xa=qa?N.text.placedSymbolArray:N.icon.placedSymbolArray,ga=ma.transform.width/ma.transform.height,
da=!1,ha=0;ha<xa.length;ha++){var R=xa.get(ha);if(R.hidden||R.writingMode===u.vertical&&!da)k(R.numGlyphs,X);else{var da=!1,Z=[R.anchorX,R.anchorY,0,1];g.transformMat4(Z,Z,oa);var ca=Z[0]/Z[3],Da=Z[1]/Z[3];if(ca>=-Ca[0]&&ca<=Ca[0]&&Da>=-Ca[1]&&Da<=Ca[1]){var Ea=.5+Z[3]/ma.transform.cameraToCenterDistance*.5,Xa=g.evaluateSizeForFeature(sa,Ka,R),Ia=eb?Xa*Ea:Xa/Ea,ta=new a(R.anchorX,R.anchorY),Ya=n(ta,ra).point,ua={},ja=g.placeGlyphsAlongLine(R,Ia,!1,Va,oa,ra,Ua,N.glyphOffsetArray,Wa,X,Ya,ta,ua,ga),
da=ja.useVertical;(ja.notEnoughRoom||da||ja.needsFlipping&&g.placeGlyphsAlongLine(R,Ia,!0,Va,oa,ra,Ua,N.glyphOffsetArray,Wa,X,Ya,ta,ua,ga).notEnoughRoom)&&k(R.numGlyphs,X)}else k(R.numGlyphs,X)}}qa?N.text.dynamicLayoutVertexBuffer.updateData(X):N.icon.dynamicLayoutVertexBuffer.updateData(X)}else if(l&&M&&D){var ia=O,La=E,Ma=H,Na=B,Za=__chunk_1.symbolSize,Oa=tr,$a=Aa,ab=V.posMatrix,Fa=Math.pow(2,tr.zoom-S.tileID.overscaledZ),wb=M,kb=ia.text.placedSymbolArray,Pa=ia.text.dynamicLayoutVertexArray;Pa.clear();
for(var cb=0;cb<kb.length;cb++){var ea=kb.get(cb),fa=!ea.hidden&&ea.crossTileID?Na[ea.crossTileID]:null;if(fa){var ob=new __chunk_1.Point(ea.anchorX,ea.anchorY),pb=n(ob,Ma?ab:$a),yb=.5+Oa.cameraToCenterDistance/pb.signedDistanceFromCamera*.5,qb=Za.evaluateSizeForFeature(ia.textSizeData,wb,ea)*yb/__chunk_1.ONE_EM;Ma&&(qb*=ia.tilePixelRatio/Fa);for(var db=calculateVariableRenderShift(fa.anchor,fa.width,fa.height,fa.radialOffset,fa.textBoxScale,qb),zb=Ma?n(ob.add(db),$a).point:pb.point.add(La?db.rotate(-Oa.angle):
db),rb=0;rb<ea.numGlyphs;rb++)__chunk_1.addDynamicAttributes(Pa,zb,0)}else k(ea.numGlyphs,Pa)}ia.text.dynamicLayoutVertexBuffer.updateData(Pa)}var sb=g.translatePosMatrix(V.posMatrix,S,p,q,void 0,P,K),tb=G||l&&D?z:Aa,ub=g.translatePosMatrix(Ja,S,p,q,!0,P,K),Ab=pa&&0!==d.paint.get(l?"text-halo-width":"icon-halo-width").constantOr(1),fb=void 0;if(pa)var vb=H,gb=b,fb=h.extend(y(ka.kind,M,I,vb,gb,sb,tb,ub,l,ya),{u_gamma_scale:vb?Math.cos(gb.view.viewpoint.pitch/180*Math.PI)*gb.view.viewpoint.cameraToCenterDistance:
1,u_device_pixel_ratio:1,u_is_halo:1});else fb=y(ka.kind,M,I,H,b,sb,tb,ub,l,ya);L.push({segments:Y.segments,sortKey:0,state:{program:J,buffers:Y,uniformValues:fb,atlasTexture:la,atlasInterpolation:za,isSDF:pa,hasHalo:Ab}})}}}}for(var hb=0;hb<L.length;hb+=1){var ib=L[hb],aa=ib.state;aa.atlasTexture.bind(aa.atlasInterpolation,F.CLAMP_TO_EDGE);if(aa.isSDF){var jb=aa.uniformValues;aa.hasHalo&&(jb.u_is_halo=1,t(aa.buffers,ib.segments,d,b,aa.program,Q,A,x,jb));jb.u_is_halo=0}t(aa.buffers,ib.segments,d,
b,aa.program,Q,A,x,aa.uniformValues)}}function t(a,b,e,d,k,g,n,f,l){var h=d.view.context;k.draw2(h,h.gl.TRIANGLES,g,n,f,c.CullFaceMode.disabled,l,e.id,a.layoutVertexBuffer,a.indexBuffer,b,e.paint,d.view.viewpoint.level,a.programConfigurations.get(e.id),a.dynamicLayoutVertexBuffer,a.opacityVertexBuffer)}function r(a,b,e,d,k,g,n){var f=a.view.context,l=f.gl;e.paint.get("fill-extrusion-pattern").constantOr(1);e.getCrossfadeParameters();for(var h=e.paint.get("fill-extrusion-opacity"),p=a.view.ground.sourceCache,
m=0;m<d.length;m+=1){var q=d[m],r=b.getTile(q);r.groundTile||(r.groundTile=p.getTile(q));var t=r.getBucket(e);if(t){var v=t.programConfigurations.get(e.id),u=a.view.useProgram("fillExtrusion",v);if(r.groundTile&&r.groundTile.heightTexture){var w=l.LINEAR;f.activeTexture.set(l.TEXTURE0);l.bindTexture(l.TEXTURE_2D,r.groundTile.heightTexture);l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,w);l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,w);l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE);
l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE);var q=q.posMatrix,w=e.paint.get("fill-extrusion-vertical-gradient"),z=h,r=r.groundTile,y=[.12347,-.56158,.9959292143521045],A,x=new Float32Array(9);x[0]=1;x[4]=1;x[8]=1;var x=A=x,B=Math.sin(-0),C=Math.cos(-0);x[0]=C;x[1]=B;x[2]=0;x[3]=-B;x[4]=C;x[5]=0;x[6]=0;x[7]=0;x[8]=1;var x=y,B=y[0],C=y[1],F=y[2];x[0]=B*A[0]+C*A[3]+F*A[6];x[1]=B*A[1]+C*A[4]+F*A[7];x[2]=B*A[2]+C*A[5]+F*A[8];u.draw2(f,f.gl.TRIANGLES,k,g,n,c.CullFaceMode.backCCW,{u_matrix:q,
u_lightpos:y,u_lightintensity:.3,u_lightcolor:[1,1,1],u_vertical_gradient:+w,u_opacity:z,u_height_image:0,u_min_height:r.minimumHeight,u_delta_height:r.maximumHeight-r.minimumHeight},e.id,t.layoutVertexBuffer,t.indexBuffer,t.segments,e.paint,a.transform.level,v)}}}}function q(a,b,e,c){var d=a.gl;d.texImage2D(d.TEXTURE_2D,0,d.RGBA,b.width/4,b.height/4,0,d.RGBA,a.extTextureHalfFloat?a.extTextureHalfFloat.HALF_FLOAT_OES:d.UNSIGNED_BYTE,null);c.colorAttachment.set(e);a.extTextureHalfFloat&&d.checkFramebufferStatus(d.FRAMEBUFFER)!==
d.FRAMEBUFFER_COMPLETE&&(a.extTextureHalfFloat=null,c.colorAttachment.setDirty(),q(a,b,e,c))}f.drawBackground=function(a,e,d,k){e=d.paint.get("background-color");var g=d.paint.get("background-opacity");if(0!==g){var n=a.view.context,f=n.gl,l=a.tileSize,h=d.paint.get("background-pattern"),p=h||1!==e.a||1!==g?"translucent":"opaque";if(a.renderPass===p)for(var m=c.StencilMode.disabled,p=a.depthModeForSublayer(0,"opaque"===p?c.DepthMode.ReadWrite:c.DepthMode.ReadOnly),q=b(a.renderPass),r=a.view.useProgram(h?
"backgroundPattern":"background"),t=d.getCrossfadeParameters(),v=0;v<k.length;v+=1){var u=k[v].posMatrix,u=h?backgroundPatternUniformValues(u,g,a,h,{tileID:tileID,tileSize:l},t):{u_matrix:u,u_opacity:g,u_color:e};r.draw2(n,f.TRIANGLES,p,m,q,c.CullFaceMode.disabled,u,d.id,a.tileExtentBuffer,a.quadTriangleIndexBuffer,a.tileExtentSegments)}}};f.drawFill=function(a,b,e,d){for(var k=c.ColorMode.unblended,g=a.depthModeForSublayer(1,c.DepthMode.ReadWrite),n,f,l,h=a.view.viewpoint.level,p=a.view._gl.TRIANGLES,
m=0;m<d.length;m+=1)if(l=d[m],n=b.getTile(l)){var q=n.getBucket(e);if(q){var r=q.programConfigurations.get(e.id),t=a.view.useProgram("fill",r);n=q.indexBuffer;f=q.segments;l={u_matrix:l.posMatrix};t.draw2(a.view.context,p,g,null,k,c.CullFaceMode.disabled,l,e.id,q.layoutVertexBuffer,n,f,e.paint,h,r)}}};f.drawLine=function(a,b,e,d){var k=e.paint.get("line-opacity").constantOr(1),g=e.paint.get("line-width").constantOr(1);if(0!==k&&0!==g){var k=a.depthModeForSublayer(0,c.DepthMode.ReadOnly),g=c.ColorMode.alphaBlended,
n=e.paint.get("line-dasharray"),f=e.getCrossfadeParameters(),l=a.view.viewpoint.level,h=n?"lineSDF":"line",p=a.view.context,q=p.gl,r=!0;debugger;for(var t=[a.view.viewpoint.width/2,-a.view.viewpoint.height/2],v=0;v<d.length;v+=1){var u=d[v],w=b.getTile(u);if(w){var z=w.getBucket(e);if(z){var y=z.programConfigurations.get(e.id),x=a.view.context.program.get(),A=a.view.useProgram(h,y),r=r||A.program!==x;if(n)var x=t,B=n,C=f,F=a.view.lineAtlas,E=1/(m.layout.EXTENT/w.tileSize*1),G="round"===e.layout.get("line-cap"),
W=F.getDash(B.from,G),B=F.getDash(B.to,G),G=W.width*C.fromScale,V=B.width*C.toScale,w={u_matrix:u.posMatrix,u_ratio:1/(m.layout.EXTENT/w.tileSize*1),u_device_pixel_ratio:1,u_units_to_pixels:x,u_patternscale_a:[E/G,-W.height/2],u_patternscale_b:[E/V,-B.height/2],u_sdfgamma:F.width/(256*Math.min(G,V))/2,u_image:0,u_tex_y_a:W.y,u_tex_y_b:B.y,u_mix:C.t};else w={u_matrix:u.posMatrix,u_ratio:1/(m.layout.EXTENT/w.tileSize*1),u_device_pixel_ratio:1,u_units_to_pixels:t};n&&(r||a.view.lineAtlas.dirty)&&(p.activeTexture.set(q.TEXTURE0),
a.view.lineAtlas.bind(p));A.draw2(p,q.TRIANGLES,k,null,g,c.CullFaceMode.disabled,w,e.id,z.layoutVertexBuffer,z.indexBuffer,z.segments,e.paint,l,y);r=!1}}}}};var u={horizontal:1,vertical:2,horizontalOnly:3},z=e.mat4.create(),v=new Float32Array([-Infinity,-Infinity,0,-Infinity,-Infinity,0,-Infinity,-Infinity,0,-Infinity,-Infinity,0]),y=function(a,b,e,c,d,k,g,n,f,l){return{u_is_size_zoom_constant:+("constant"===a||"source"===a),u_is_size_feature_constant:+("constant"===a||"camera"===a),u_size_t:b?b.uSizeT:
0,u_size:b?b.uSize:0,u_camera_to_center_distance:d.transform.cameraToCenterDistance,u_pitch:d.transform.pitch/180*Math.PI,u_rotate_symbol:+e,u_aspect_ratio:d.view.viewpoint.width/d.view.viewpoint.height,u_fade_change:1,u_matrix:k,u_label_plane_matrix:g,u_coord_matrix:n,u_is_text:+f,u_pitch_with_map:+c,u_texsize:l,u_texture:0}};f.drawSymbols=function(a,e,c,d,k){if("translucent"===a.renderPass){var g=b(a.renderPass);0!==c.paint.get("icon-opacity").constantOr(1)&&p(a,e,c,d,!1,c.paint.get("icon-translate"),
c.paint.get("icon-translate-anchor"),c.layout.get("icon-rotation-alignment"),c.layout.get("icon-pitch-alignment"),c.layout.get("icon-keep-upright"),null,g,k);0!==c.paint.get("text-opacity").constantOr(1)&&p(a,e,c,d,!0,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),c.layout.get("text-keep-upright"),null,g,k)}};f.drawExtrusion=function(a,e,d,k){var g=d.paint.get("fill-extrusion-opacity");if(0!==g&&"translucent"===
a.renderPass){var n=new c.DepthMode(a.view.context.gl.LEQUAL,c.DepthMode.ReadWrite,a.depthRangeFor3D);1!==g||d.paint.get("fill-extrusion-pattern").constantOr(1)?(r(a,e,d,k,n,c.StencilMode.disabled,c.ColorMode.disabled),r(a,e,d,k,n,a.stencilModeFor3D(),b())):(g=b(),r(a,e,d,k,n,c.StencilMode.disabled,g))}};f.drawLineExtrusion=function(a,e,d,k){if(0!==d.paint.get("fill-extrusion-opacity")&&"translucent"===a.renderPass){var g=new c.DepthMode(a.view.context.gl.LEQUAL,c.DepthMode.ReadWrite,a.depthRangeFor3D),
n=b(),f=c.StencilMode.disabled,l=a.view.context;d.paint.get("fill-extrusion-pattern").constantOr(1);for(var h=d.paint.get("fill-extrusion-opacity"),p=0;p<k.length;p+=1){var m=k[p],q=e.getTile(m).getBucket(d);if(q){var r=q.programConfigurations.get(d.id),t=a.view.useProgram("lineExtrusion",r),m=m.posMatrix;d.paint.get("fill-extrusion-vertical-gradient");t.draw(l,l.gl.LINES,g,f,n,c.CullFaceMode.backCCW,{u_matrix:m,u_opacity:h},d.id,q.layoutVertexBuffer,q.indexBuffer,q.segments,d.paint,a.transform.level,
r)}}}};f.drawClipping=function(a,b,e,d,k){var g=a.view.context,n=g.gl,f=new Matrix4;f.ortho(0,a.view.width,a.view.height,0,0,1);f.scale(n.drawingBufferWidth,n.drawingBufferHeight,0);a.view.useProgram("clippingMask").draw(g,n.TRIANGLES,c.DepthMode.disabled,b,c.ColorMode.disabled,c.CullFaceMode.disabled,{u_matrix:f.elements},"$clipping",e,d,k)};var x=function(a,b,e,c){return{u_matrix:a,u_extrude_scale:m.layout.EXTENT/b.tileSize*1,u_intensity:c}},w=function(a,b,c,d){var k=a.view.viewpoint,g=e.mat4.create();
e.mat4.ortho(g,0,k.width,k.height,0,0,1);a=a.view.context.gl;return{u_matrix:g,u_world:[a.drawingBufferWidth,a.drawingBufferHeight],u_image:c,u_color_ramp:d,u_opacity:b.paint.get("heatmap-opacity")}};f.drawHeatmap=function(a,b,e,k){if(0!==e.paint.get("heatmap-opacity"))if("offscreen"===a.renderPass){var g=a.view.context,n=g.gl,f=a.depthModeForSublayer(0,c.DepthMode.ReadOnly),h=c.StencilMode.disabled,p=new c.ColorMode([n.ONE,n.ONE],d.transparent,[!0,!0,!0,!0]),m=g.gl;g.activeTexture.set(m.TEXTURE1);
g.viewport.set([0,0,a.width/4,a.height/4]);var r=e.heatmapFbo;if(r)m.bindTexture(m.TEXTURE_2D,r.colorAttachment.get()),g.bindFramebuffer.set(r.framebuffer);else{var t=m.createTexture();m.bindTexture(m.TEXTURE_2D,t);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,m.CLAMP_TO_EDGE);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,m.CLAMP_TO_EDGE);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,m.LINEAR);m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,m.LINEAR);r=e.heatmapFbo=g.createFramebuffer(a.width/
4,a.height/4);q(g,a,t,r)}g.clear({color:d.transparent});for(m=0;m<k.length;m++)if(r=k[m],!b.hasRenderableParent(r)){var t=b.getTile(r),v=t.getBucket(e);if(v){var u=v.programConfigurations.get(e.id);a.view.useProgram("heatmap",u).draw(g,n.TRIANGLES,f,h,p,c.CullFaceMode.disabled,x(r.posMatrix,t,a.transform.zoom,e.paint.get("heatmap-intensity")),e.id,v.layoutVertexBuffer,v.indexBuffer,v.segments,e.paint,a.transform.level,u)}}g.viewport.set([0,0,a.width,a.height])}else"translucent"===a.renderPass&&(a.view.context.setColorMode(c.ColorMode.alphaBlended),
b=a.view.context,k=b.gl,g=e.heatmapFbo)&&(b.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,g.colorAttachment.get()),b.activeTexture.set(k.TEXTURE1),g=e.colorRampTexture,g||(g=e.colorRampTexture=new l(b,e.colorRamp,k.RGBA)),g.bind(k.LINEAR,k.CLAMP_TO_EDGE),a.view.useProgram("heatmapTexture").draw(b,k.TRIANGLES,c.DepthMode.disabled,c.StencilMode.disabled,c.ColorMode.alphaBlended,c.CullFaceMode.disabled,w(a,e,0,1),e.id,a.viewportBuffer,a.quadTriangleIndexBuffer,a.viewportSegments,e.paint,a.transform.level))};
var A=function(a,b){var e=a.position;return{u_matrix:a.view.viewpoint.getMatrixForPoint(e[0],e[1],null,!0),u_image:b,u_opacity:a.opacity}};f.drawImageLayer=function(a){if(a.texture){a.view.context.setColorMode(c.ColorMode.alphaBlended);var b=a.view.context,e=b.gl,d=a.depthModeForSublayer(0,c.DepthMode.ReadWrite,e.LESS),k=e.LINEAR;b.activeTexture.set(e.TEXTURE0);a.texture.bind(k,e.CLAMP_TO_EDGE,e.LINEAR_MIPMAP_NEAREST);a.view.useProgram("image").draw2(b,e.TRIANGLES,d,c.StencilMode.disabled,c.ColorMode.alphaBlended,
c.CullFaceMode.disabled,A(a,0),"image",a.viewportBuffer,a.quadTriangleIndexBuffer,a.viewportSegments,null,a.transform.level)}};var B=function(a,b,e,c){a=a.transform;var d;"map"===c.paint.get("circle-pitch-alignment")?(d=m.layout.EXTENT/e.tileSize*1,e=!0,d=[d,d]):(e=!1,d=a.pixelsToGLUnits);return{u_camera_to_center_distance:a.cameraToCenterDistance,u_scale_with_map:+("map"===c.paint.get("circle-pitch-scale")),u_matrix:b.posMatrix,u_pitch_with_map:+e,u_device_pixel_ratio:1,u_extrude_scale:d}};f.drawCircles=
function(a,e,d,k){if("translucent"===a.renderPass){var g=d.paint.get("circle-opacity"),n=d.paint.get("circle-stroke-width"),f=d.paint.get("circle-stroke-opacity");if(0!==g.constantOr(1)||0!==n.constantOr(1)&&0!==f.constantOr(1))for(var g=a.view.context,n=g.gl,f=a.depthModeForSublayer(0,c.DepthMode.ReadOnly),l=c.StencilMode.disabled,h=b(a.renderPass),p=0;p<k.length;p++){var m=k[p],q=e.getTile(m),r=q.getBucket(d);if(r){var t=r.programConfigurations.get(d.id);a.view.useProgram("circles",t).draw(g,n.TRIANGLES,
f,l,h,c.CullFaceMode.disabled,B(a,m,q,d),d.id,r.layoutVertexBuffer,r.indexBuffer,r.segments,d.paint,a.transform.level,t)}}}}})},"dojo/_base/array":function(){define(["./kernel","../has","./lang"],function(f,d,m){function h(a){return g[a]=new Function("item","index","array",a)}function c(a){var b=!a;return function(e,c,d){var k=0,n=e&&e.length||0,f;n&&"string"==typeof e&&(e=e.split(""));"string"==typeof c&&(c=g[c]||h(c));if(d)for(;k<n;++k){if(f=!c.call(d,e[k],k,e),a^f)return!f}else for(;k<n;++k)if(f=
!c(e[k],k,e),a^f)return!f;return b}}function a(a){var b=1,c=0,d=0;a||(b=c=d=-1);return function(k,g,n,f){if(f&&0<b)return e.lastIndexOf(k,g,n);f=k&&k.length||0;var h=a?f+d:c;n===l?n=a?c:f+d:0>n?(n=f+n,0>n&&(n=c)):n=n>=f?f+d:n;for(f&&"string"==typeof k&&(k=k.split(""));n!=h;n+=b)if(k[n]==g)return n;return-1}}var g={},l,e={every:c(!1),some:c(!0),indexOf:a(!0),lastIndexOf:a(!1),forEach:function(a,e,c){var b=0,d=a&&a.length||0;d&&"string"==typeof a&&(a=a.split(""));"string"==typeof e&&(e=g[e]||h(e));
if(c)for(;b<d;++b)e.call(c,a[b],b,a);else for(;b<d;++b)e(a[b],b,a)},map:function(a,e,c,d){var b=0,k=a&&a.length||0;d=new (d||Array)(k);k&&"string"==typeof a&&(a=a.split(""));"string"==typeof e&&(e=g[e]||h(e));if(c)for(;b<k;++b)d[b]=e.call(c,a[b],b,a);else for(;b<k;++b)d[b]=e(a[b],b,a);return d},filter:function(a,e,c){var b=0,d=a&&a.length||0,k=[],n;d&&"string"==typeof a&&(a=a.split(""));"string"==typeof e&&(e=g[e]||h(e));if(c)for(;b<d;++b)n=a[b],e.call(c,n,b,a)&&k.push(n);else for(;b<d;++b)n=a[b],
e(n,b,a)&&k.push(n);return k},clearCache:function(){g={}}};m.mixin(f,e);return e})},"dojo/promise/Promise":function(){define(["../_base/lang"],function(f){function d(){throw new TypeError("abstract");}return f.extend(function(){},{then:function(f,h,c){d()},cancel:function(f,h){d()},isResolved:function(){d()},isRejected:function(){d()},isFulfilled:function(){d()},isCanceled:function(){d()},always:function(d){return this.then(d,d)},"catch":function(d){return this.then(null,d)},otherwise:function(d){return this.then(null,
d)},trace:function(){return this},traceRejected:function(){return this},toString:function(){return"[object Promise]"}})})},"com/huayun/webgis/gl/ProgramSimplify":function(){define(["./VertexArrayObject"],function(f){var d=function(d,f,c,a){var g=d.gl;this.program=g.createProgram();var l=c.defines,e;l?(e=l.concat(f.fragmentSource).join("\n"),f=l.concat(f.vertexSource).join("\n")):(e=f.fragmentSource,f=f.vertexSource);l=g.createShader(g.FRAGMENT_SHADER);g.shaderSource(l,e);g.compileShader(l);g.attachShader(this.program,
l);e=g.createShader(g.VERTEX_SHADER);g.shaderSource(e,f);g.compileShader(e);g.attachShader(this.program,e);c=c.layoutAttributes||[];for(e=0;e<c.length;e++)g.bindAttribLocation(this.program,e,c[e].name);g.linkProgram(this.program);this.numAttributes=g.getProgramParameter(this.program,g.ACTIVE_ATTRIBUTES);this.attributes={};c={};for(e=0;e<this.numAttributes;e++)(f=g.getActiveAttrib(this.program,e))&&(this.attributes[f.name]=g.getAttribLocation(this.program,f.name));e=g.getProgramParameter(this.program,
g.ACTIVE_UNIFORMS);for(f=0;f<e;f++)(l=g.getActiveUniform(this.program,f))&&(c[l.name]=g.getUniformLocation(this.program,l.name));this.fixedUniforms=a(d,c)};d.prototype.draw=function(d,h,c,a,g,l,e,b,k,n,p,t,r,q,u,z){var m;a=d.gl;d.program.set(this.program);d.setDepthMode(c);d.setColorMode(g);d.setCullFace(l);for(var y in this.fixedUniforms)this.fixedUniforms[y].set(e[y]);c=(m={},m[a.LINES]=2,m[a.TRIANGLES]=3,m[a.LINE_STRIP]=1,m)[h];m=0;for(p=p.get();m<p.length;m+=1)g=p[m],l=g.vaos||(g.vaos={}),(l[b]||
(l[b]=new f)).bind(d,this,k,[],n,g.vertexOffset,u,z),a.drawElements(h,g.primitiveLength*c,a.UNSIGNED_SHORT,g.primitiveOffset*c*2)};d.prototype.draw2=function(d,f,c,a,g,l,e,b,k,n){a=d.gl;d.program.set(this.program);d.setDepthMode(c);d.setColorMode(g);d.setCullFace(l);for(var h in this.fixedUniforms)this.fixedUniforms[h].set(e[h]);d.bindVertexBuffer.set(k.buffer);a.drawArrays(f,0,n)};d.prototype.drawArray=function(d,h,c,a,g,l,e,b,k,n,p){a=d.gl;d.program.set(this.program);d.setDepthMode(c);d.setColorMode(g);
d.setCullFace(l);for(var m in this.fixedUniforms)this.fixedUniforms[m].set(e[m]);c=0;for(p=p.get();c<p.length;c+=1)g=p[c],l=g.vaos||(g.vaos={}),(l[b]||(l[b]=new f)).bind(d,this,k,[],n,g.vertexOffset,void 0,void 0),a.drawArrays(h,g.primitiveOffset,g.vertexLength)};d.prototype.drawArraysInstancedANGLE=function(d,h,c,a,g,l,e,b,k,n,p,t,r){d.program.set(this.program);d.setDepthMode(c);d.setColorMode(g);d.setCullFace(l);for(var m in this.fixedUniforms)this.fixedUniforms[m].set(e[m]);c=t.attributes;a=d.extInstancedArray;
g=0;for(p=p.get();g<p.length;g+=1){l=p[g];e=l.vaos||(l.vaos={});(e[b]||(e[b]=new f)).bind(d,this,k,[t],n,l.vertexOffset,void 0,void 0);for(e=0;e<c.length;e++)a.vertexAttribDivisorANGLE(this.attributes[c[e].name],1);a.drawArraysInstancedANGLE(h,l.primitiveOffset,l.vertexLength,r)}};d.prototype.drawInstancedANGLE=function(d,h,c,a,g,l,e,b,k,n,p,t,r){a=d.gl;d.program.set(this.program);d.setDepthMode(c);d.setColorMode(g);d.setCullFace(l);for(var m in this.fixedUniforms)this.fixedUniforms[m].set(e[m]);
c=t.attributes;g=d.extInstancedArray;l=0;for(p=p.get();l<p.length;l+=1){e=p[l];m=e.vaos||(e.vaos={});(m[b]||(m[b]=new f)).bind(d,this,k,[t],n,e.vertexOffset,void 0,void 0);for(m=0;m<c.length;m++)g.vertexAttribDivisorANGLE(this.attributes[c[m].name],1);g.drawElementsInstancedANGLE(h,3*e.primitiveLength,a.UNSIGNED_SHORT,6*e.primitiveOffset,r)}};d.prototype.drawMassive=function(d,h,c,a,g,l,e,b,k,n,p,t,r,q,u,z){var m;a=d.gl;d.program.set(this.program);d.setDepthMode(c);d.setColorMode(g);d.setCullFace(l);
for(var y in this.fixedUniforms)this.fixedUniforms[y].set(e[y]);q&&q.setUniforms(d,this.binderUniforms,t,{zoom:r});c=(m={},m[a.LINES]=2,m[a.TRIANGLES]=3,m[a.LINE_STRIP]=1,m)[h];m=0;for(p=p.get();m<p.length;m+=1)g=p[m],l=g.vaos||(g.vaos={}),(l[b]||(l[b]=new f)).bind(d,this,k,q?q.getPaintVertexBuffers():[],n,g.vertexOffset,u,z),a.drawElements(h,g.primitiveLength*c,a.UNSIGNED_INT,g.primitiveOffset*c*2)};return d})},"com/huayun/gl/shaders/heightMap":function(){define(["exports","../../webgis/data/uniform"],
function(f,d){f.heightMapVS="precision highp float;\n\nattribute vec3 a_pos;\n\nuniform float u_min_height;\nuniform float u_delta_height;\nvarying float v_color;\n\nvoid main() {\n    float height \x3d a_pos.z;\n    gl_Position \x3d vec4(a_pos.xy * 2.0 - 1.0, 0.0, 1.0);\n    v_color \x3d (height - u_min_height) / u_delta_height;\n}";f.heightMapFS="precision mediump float;\nvarying float v_color;\n\nvoid main() {\n//    gl_FragColor \x3d vec4(v_color, v_color, v_color, 1.0);\n    gl_FragColor \x3d vec4(v_color, v_color, v_color, 1.0);\n}";
f.heightMapUniforms=function(f,h){return{u_min_height:new d.Uniform1f(f,h.u_min_height),u_delta_height:new d.Uniform1f(f,h.u_delta_height)}}})},"dojo/_base/config":function(){define(["../global","../has","require"],function(f,d,m){f={};m=m.rawConfig;for(var h in m)f[h]=m[h];!f.locale&&"undefined"!=typeof navigator&&(h=navigator.languages&&navigator.languages.length?navigator.languages[0]:navigator.language||navigator.userLanguage)&&(f.locale=h.toLowerCase());return f})},"com/huayun/webgis/core/base":function(){define(["custom/crypto-js.min"],
function(f){function d(a){return 10>a?"0"+a:a}if(dojoConfig&&dojoConfig.app){var m=dojoConfig.app.accessKey,h=dojoConfig.app.secretKey;if(m&&h){var c=f.enc.Utf8.parse("123456yrxo@kc6x3"),a=new Date,g=a.getFullYear()+d(a.getMonth()+1)+d(a.getDate());dojoConfig.token=function(a,e){a=f.enc.Utf8.parse(a+"+"+e+"+"+g);return f.AES.encrypt(a,c,{mode:f.mode.ECB,padding:f.pad.Pkcs7}).toString()}(m,h)}}})},"dojo/_base/kernel":function(){define(["../global","../has","./config","require","module"],function(f,
d,m,h,c){var a,g={},l={},e={config:m,global:f,dijit:g,dojox:l},g={dojo:["dojo",e],dijit:["dijit",g],dojox:["dojox",l]};c=h.map&&h.map[c.id.match(/[^\/]+/)[0]];for(a in c)g[a]?g[a][0]=c[a]:g[a]=[c[a],{}];for(a in g)c=g[a],c[1]._scopeName=c[0],m.noGlobals||(f[c[0]]=c[1]);e.scopeMap=g;e.baseUrl=e.config.baseUrl=h.baseUrl;e.isAsync=h.async;e.locale=m.locale;f="$Rev:$".match(/[0-9a-f]{7,}/);e.version={major:1,minor:15,patch:0,flag:"",revision:f?f[0]:NaN,toString:function(){var a=e.version;return a.major+
"."+a.minor+"."+a.patch+a.flag+" ("+a.revision+")"}};d("csp-restrictions")||Function("d","d.eval \x3d function(){return d.global.eval ? d.global.eval(arguments[0]) : eval(arguments[0]);}")(e);e.exit=function(){};d("host-webworker");d.add("console-as-object",function(){return Function.prototype.bind&&console&&"object"===typeof console.log});"undefined"!=typeof console||(console={});c="assert count debug dir dirxml error group groupEnd info profile profileEnd time timeEnd trace warn log".split(" ");
var b;for(f=0;b=c[f++];)console[b]?d("console-as-object")&&(console[b]=Function.prototype.bind.call(console[b],console)):function(){var a=b+"";console[a]="log"in console?function(){var b=Array.prototype.slice.call(arguments);b.unshift(a+":");console.log(b.join(" "))}:function(){};console[a]._fake=!0}();d.add("dojo-debug-messages",!!m.isDebug);e.deprecated=e.experimental=function(){};d("dojo-debug-messages")&&(e.deprecated=function(a,b,e){a="DEPRECATED: "+a;b&&(a+=" "+b);e&&(a+=" -- will be removed in version: "+
e);console.warn(a)},e.experimental=function(a,b){a="EXPERIMENTAL: "+a+" -- APIs subject to change without notice.";b&&(a+=" "+b);console.warn(a)});if(m.modulePaths){e.deprecated("dojo.modulePaths","use paths configuration");d={};for(a in m.modulePaths)d[a.replace(/\./g,"/")]=m.modulePaths[a];h({paths:d})}e.moduleUrl=function(a,b){e.deprecated("dojo.moduleUrl()","use require.toUrl","2.0");var c=null;a&&(c=h.toUrl(a.replace(/\./g,"/")+(b?"/"+b:"")+"/*.*").replace(/\/\*\.\*/,"")+(b?"":"/"));return c};
e._hasResource={};return e})},"com/huayun/gl/shaders/line":function(){define(["exports","../../webgis/data/uniform"],function(f,d){f.lineVS="precision highp float;\n\n#define scale 0.01587301\n// #define scale 0.007936508\n\nattribute vec3 a_pos;\nattribute vec4 a_data;\nattribute vec2 a_normal;\n\nuniform mat4 u_matrix;\nuniform mediump float u_ratio;\nuniform vec2 u_units_to_pixels;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying float v_gamma_scale;\nvarying highp float v_linesofar;\n\nuniform highp vec4 u_color;\nuniform lowp float u_blur;\nuniform lowp float u_opacity;\nuniform mediump float u_gapwidth;\nuniform lowp float u_offset;\nuniform mediump float u_width;\n\nvoid main() {\n    highp vec4 color \x3d u_color;\n    lowp float blur \x3d u_blur;\n    lowp float opacity \x3d u_opacity;\n    mediump float gapwidth \x3d u_gapwidth;\n    lowp float offset \x3d u_offset;\n    mediump float width \x3d u_width;\n\n    // the distance over which the line edge fades out.\n    // Retina devices need a smaller distance to avoid aliasing.\n    float ANTIALIASING \x3d 0.5;\n\n    vec2 a_extrude \x3d a_data.xy - 128.0;\n    float a_direction \x3d mod(a_data.z, 4.0) - 1.0;\n\n    v_linesofar \x3d (floor(a_data.z / 4.0) + a_data.w * 64.0) * 2.0;\n\n    vec2 pos \x3d a_pos.xy;\n\n    mediump vec2 normal \x3d a_normal;\n    normal.y \x3d normal.y * 2.0 - 1.0;\n    v_normal \x3d normal;\n\n    // these transformations used to be applied in the JS and native code bases.\n    // moved them into the shader for clarity and simplicity.\n    gapwidth \x3d gapwidth / 2.0;\n    float halfwidth \x3d width / 2.0;\n    offset \x3d -1.0 * offset;\n\n    float inset \x3d gapwidth + (gapwidth \x3e 0.0 ? ANTIALIASING : 0.0);\n    float outset \x3d gapwidth + halfwidth * (gapwidth \x3e 0.0 ? 2.0 : 1.0) + (halfwidth \x3d\x3d 0.0 ? 0.0 : ANTIALIASING);\n\n    // Scale the extrusion vector down to a normal and then up by the line width\n    // of this vertex.\n    mediump vec2 dist \x3d outset * a_extrude * scale;\n\n    // Calculate the offset when drawing a line that is to the side of the actual line.\n    // We do this by creating a vector that points towards the extrude, but rotate\n    // it when we're drawing round end points (a_direction \x3d -1 or 1) since their\n    // extrude vector points in another direction.\n    mediump float u \x3d 0.5 * a_direction;\n    mediump float t \x3d 1.0 - abs(u);\n    mediump vec2 offset2 \x3d offset * a_extrude * scale * normal.y * mat2(t, -u, u, t);\n\n    vec4 projected_extrude \x3d u_matrix * vec4(dist / u_ratio, 0.0, 0.0);\n    gl_Position \x3d u_matrix * vec4(pos + offset2 / u_ratio, a_pos.z, 1.0) + projected_extrude;\n\n    // calculate how much the perspective view squishes or stretches the extrude\n    float extrude_length_without_perspective \x3d length(dist);\n    float extrude_length_with_perspective \x3d length(projected_extrude.xy / gl_Position.w * u_units_to_pixels);\n    v_gamma_scale \x3d extrude_length_without_perspective / extrude_length_with_perspective;\n\n    v_width2 \x3d vec2(outset, inset);\n}";
f.lineFS="precision mediump float;\n\nvarying vec2 v_width2;\nvarying vec2 v_normal;\nvarying float v_gamma_scale;\nuniform highp vec4 u_color;\nuniform lowp float u_opacity;\n\nvoid main() {\n\n\n    highp vec4 color \x3d u_color;\n    lowp float blur \x3d 0.0;\n    lowp float opacity \x3d u_opacity;\n    lowp float u_device_pixel_ratio \x3d 1.0;\n\n    float dist \x3d length(v_normal) * v_width2.s;\n\n    float blur2 \x3d (blur + 1.0 / u_device_pixel_ratio) * v_gamma_scale;\n    float alpha \x3d clamp(min(dist - (v_width2.t - blur2), v_width2.s - dist) / blur2, 0.0, 1.0);\n    gl_FragColor \x3d color * (alpha * opacity);\n}"})},
"com/huayun/gl/shaders/cone":function(){define(["exports","../../webgis/data/uniform"],function(f,d){f.coneVS="attribute vec3 a_pos;\nattribute vec4 a_color;\n\nvarying vec4 v_color;\nuniform mat4 u_matrix;\n\nvoid main() {\n    gl_Position \x3d u_matrix * vec4(a_pos, 1.0);\n    v_color \x3d a_color;\n}\n";f.coneFS="precision mediump float;\nvarying vec4 v_color;\n\nvoid main() {\n    gl_FragColor \x3d v_color;\n}";f.coneUniforms=function(f,h){return{u_matrix:new d.UniformMatrix4f(f,h.u_matrix)}}})},
"com/huayun/webgis/gl/ImageAtlas":function(){define(["./potpack","./ImagePosition","../utils/image","../utils/Constant"],function(f,d,m,h){var c=function(a,c){var d={},e={};this.haveRenderCallbacks=[];var b=[];this.addImages(a,d,b);this.addImages(c,e,b);var b=f(b),b=new m.RGBAImage({width:b.w||1,height:b.h||1}),k;for(k in a){var g=a[k],p=d[k].paddedRect;m.RGBAImage.copy(g.data,b,{x:0,y:0},{x:p.x+h.layout.padding,y:p.y+h.layout.padding},g.data)}for(var t in c){a=c[t];g=e[t].paddedRect;k=g.x+h.layout.padding;
var g=g.y+h.layout.padding,p=a.data.width,r=a.data.height;m.RGBAImage.copy(a.data,b,{x:0,y:0},{x:k,y:g},a.data);m.RGBAImage.copy(a.data,b,{x:0,y:r-1},{x:k,y:g-1},{width:p,height:1});m.RGBAImage.copy(a.data,b,{x:0,y:0},{x:k,y:g+r},{width:p,height:1});m.RGBAImage.copy(a.data,b,{x:p-1,y:0},{x:k-1,y:g},{width:1,height:r});m.RGBAImage.copy(a.data,b,{x:0,y:0},{x:k+p,y:g},{width:1,height:r})}this.image=b;this.iconPositions=d;this.patternPositions=e};c.prototype.addImages=function(a,c,f){for(var e in a){var b=
a[e],k={x:0,y:0,w:b.data.width+2*h.layout.padding,h:b.data.height+2*h.layout.padding};f.push(k);c[e]=new d(k,b);b.hasRenderCallback&&this.haveRenderCallbacks.push(e)}};c.prototype.patchUpdatedImages=function(a,c){a.dispatchRenderCallbacks(this.haveRenderCallbacks);for(var d in a.updatedImages)this.patchUpdatedImage(this.iconPositions[d],a.getImage(d),c),this.patchUpdatedImage(this.patternPositions[d],a.getImage(d),c)};c.prototype.patchUpdatedImage=function(a,c,d){a&&c&&a.version!==c.version&&(a.version=
c.version,a=a.tl,d.update(c.data,void 0,{x:a[0],y:a[1]}))};return c})},"com/huayun/webgis/utils/MathUtils":function(){define(["exports"],function(f){function d(d,f,c){return{x:d.x*c-d.y*f,y:d.x*f+d.y*c}}f.radian2Angle=function(d){return 180*d/Math.PI};f.angle2Radian=function(d){return d*Math.PI/180};f.calculateCenterOfLine=function(d){for(var f,c=0,a=[],g=0;g<d.length-1;g++)f=d[g].dist(d[g+1]),a[a.length]=f,c+=f;f=.5*c;for(var l=0,e=0,g=0;g<a.length;g++)if(l+=a[g],l>f){e=g;break}for(g=l=0;g<e;g++)l+=
a[g];var a=[d[e+1].x,d[e+1].y],g=[d[e].x,d[e].y],b=void 0,b=[];b[0]=a[0]-g[0];b[1]=a[1]-g[1];a=b;a=Math.atan2(a[1],a[0]);d=d[e].calculateOtherPoint(f-l,a);return{length:c,center:d,radian:a}};f.sizeAfterRotated=function(f,h){var c=Math.sin(h),a=Math.cos(h);h=d(f[0],c,a);var g=d(f[1],c,a),l=d(f[2],c,a);f=d(f[3],c,a);return{xmin:Math.min(h.x,g.x,l.x,f.x),xmax:Math.max(h.x,g.x,l.x,f.x),ymin:Math.min(h.y,g.y,l.y,f.y),ymax:Math.max(h.y,g.y,l.y,f.y)}};f.calculateCoreOfPolygon=function(d){for(var f,c=0,a=
0,g=0,l=d.length,e=0;e<l-1;e++)f=d[e].x*d[e+1].y-d[e].y*d[e+1].x,c+=f,a+=f*(d[e].x+d[e+1].x),g+=f*(d[e].y+d[e+1].y);f=d[l-1].x*d[0].y-d[l-1].y*d[0].x;a+=f*(d[l-1].x+d[0].x);g+=f*(d[l-1].y+d[0].y);c=(c+f)/2;return{x:a/(6*c),y:g/(6*c)}};f.lerp=function(d,f,c){return(1-c)*d+c*f}})},"com/huayun/webgis/utils/quickselect":function(){define([],function(){function f(d,c){return d<c?-1:d>c?1:0}function d(d,c,a){var g=d[c];d[c]=d[a];d[a]=g}function m(f,c,a,g,l){for(;g>a;){if(600<g-a){var e=g-a+1,b=c-a+1,k=
Math.log(e),n=.5*Math.exp(2*k/3),k=.5*Math.sqrt(k*n*(e-n)/e)*(0>b-e/2?-1:1);m(f,c,Math.max(a,Math.floor(c-b*n/e+k)),Math.min(g,Math.floor(c+(e-b)*n/e+k)),l)}e=f[c];b=a;n=g;d(f,a,c);for(0<l(f[g],e)&&d(f,a,g);b<n;){d(f,b,n);b++;for(n--;0>l(f[b],e);)b++;for(;0<l(f[n],e);)n--}0===l(f[a],e)?d(f,a,n):(n++,d(f,n,g));n<=c&&(a=n+1);c<=n&&(g=n-1)}}return function(d,c,a,g,l){m(d,c,a||0,g||d.length-1,l||f)}})},"com/huayun/webgis/symbols/CircleSymbol":function(){define(["./Symbol","../utils/Color"],function(f,
d){var m=function(h){f.call(this,h);this.type="circle";var c=d.parse(h.color||h.fill||"#FF0000"),a=h.opacity||1,g=d.parse(h.strokeColor||h.stroke||"#FFFFFF"),l=h.strokeOpacity||1;this.radius=Number(h.radius||h.r||5);this.strokeWidth=Number(h.strokeWidth||h["stroke-width"]||0);this.pitchWithMap=!!h.pitchWithMap;this.scaleWithPitch=!!h.scaleWithPitch;this.dx=Number(h.dx||0);this.dy=Number(h.dy||0);this.angle=Number(h.angle||0);this.color=[c.r,c.g,c.b,c.a];this.strokeColor=[g.r,g.g,g.b,g.a];this.uniforms=
{color:this.color,opacity:a,u_device_pixel_ratio:1,u_pitch_with_map:this.pitchWithMap,u_scale_with_map:this.scaleWithPitch,blur:0,stroke_color:this.strokeColor,stroke_width:this.strokeWidth,stroke_opacity:l,radius:this.radius,u_radian:0}};f&&(m.__proto__=f);m.prototype=Object.create(f&&f.prototype);m.prototype.constructor=m;m.prototype.setRadius=function(d){this.radius=d;this.uniforms.radius=d};m.prototype.setStrokeWidth=function(d){this.uniforms.stroke_width=d};return m})},"com/huayun/webgis/symbols/support/CustomGlyphAtlas":function(){define(["../../gl/potpack",
"../../utils/image"],function(f,d){return function(f){var h={},c=0,a=-Infinity,g=0,l;for(l in f){var e=f[l],b=h[l]={},k;for(k in e){var n=e[+k];if(n&&0!==n.bitmap.width&&0!==n.bitmap.height){var p={x:c,y:0,w:n.bitmap.width+2,h:n.bitmap.height+2},c=c+p.w,g=g+n.metrics.advance;p.h>a&&(a=p.h);b[k]={rect:p,metrics:n.metrics}}}}var c=new d.AlphaImage({width:c||1,height:a||1}),m;for(m in f){var a=f[m],r;for(r in a)(l=a[+r])&&0!==l.bitmap.width&&0!==l.bitmap.height&&(e=h[m][r].rect,d.AlphaImage.copy(l.bitmap,
c,{x:0,y:0},{x:e.x+1,y:e.y+1},l.bitmap))}this.image=c;this.positions=h;this.textWidth=g}})},"com/huayun/webgis/gl/programAttributes":function(){define(["exports","../utils/Constant","../utils/utils"],function(f,d,m){f.basicLine=function(f,c){void 0===c&&(c=1);var a=0,g=0;f=f.map(function(e){var b=d.viewTypes[e.type].BYTES_PER_ELEMENT,k=a=m.align(a,Math.max(c,b)),f=e.components||1;g=Math.max(g,b);a+=b*f;return{name:e.name,type:e.type,components:f,offset:k}});var l=m.align(a,Math.max(g,c));return{members:f,
size:l,alignment:c}}([{name:"a_pos",type:"Float32",components:3},{name:"a_data",type:"Float32",components:4},{name:"a_normal",type:"Int16",components:2}],4)})},"dojo/on":function(){define(["./has!dom-addeventlistener?:./aspect","./_base/kernel","./sniff"],function(f,d,m){function h(a,b,c,d,k){if(d=b.match(/(.*):(.*)/))return b=d[2],d=d[1],l.selector(d,b).call(k,a,c);m("touch")&&(e.test(b)&&(c=A(c)),m("event-orientationchange")||"orientationchange"!=b||(b="resize",a=window,c=A(c)));t&&(c=t(c));if(a.addEventListener){var g=
b in n,f=g?n[b]:b;a.addEventListener(f,c,g);return{remove:function(){a.removeEventListener(f,c,g)}}}if(z&&a.attachEvent)return z(a,"on"+b,c);throw Error("Target must be an event emitter");}function c(){this.cancelable=!1;this.defaultPrevented=!0}function a(){this.bubbles=!1}var g=window.ScriptEngineMajorVersion;m.add("jscript",g&&g()+ScriptEngineMinorVersion()/10);m.add("event-orientationchange",m("touch")&&!m("android"));m.add("event-stopimmediatepropagation",window.Event&&!!window.Event.prototype&&
!!window.Event.prototype.stopImmediatePropagation);m.add("event-focusin",function(a,b,e){return"onfocusin"in e});m("touch")&&m.add("touch-can-modify-event-delegate",function(){var a=function(){};a.prototype=document.createEvent("MouseEvents");try{var b=new a;b.target=null;return null===b.target}catch(C){return!1}});var l=function(a,b,e,c){return"function"!=typeof a.on||"function"==typeof b||a.nodeType?l.parse(a,b,e,h,c,this):a.on(b,e)};l.pausable=function(a,b,e,c){var d;a=l(a,b,function(){if(!d)return e.apply(this,
arguments)},c);a.pause=function(){d=!0};a.resume=function(){d=!1};return a};l.once=function(a,b,e,c){var d=l(a,b,function(){d.remove();return e.apply(this,arguments)});return d};l.parse=function(a,b,e,c,d,k){var g;if(b.call)return b.call(k,a,e);b instanceof Array?g=b:-1<b.indexOf(",")&&(g=b.split(/\s*,\s*/));if(g){var f=[];b=0;for(var n;n=g[b++];)f.push(l.parse(a,n,e,c,d,k));f.remove=function(){for(var a=0;a<f.length;a++)f[a].remove()};return f}return c(a,b,e,d,k)};var e=/^touch/;l.matches=function(a,
b,e,c,k){k=k&&"function"==typeof k.matches?k:d.query;c=!1!==c;1!=a.nodeType&&(a=a.parentNode);for(;!k.matches(a,b,e);)if(a==e||!1===c||!(a=a.parentNode)||1!=a.nodeType)return!1;return a};l.selector=function(a,b,e){return function(c,d){function k(b){return l.matches(b,a,c,e,g)}var g="function"==typeof a?{matches:a}:this,f=b.bubble;return f?l(c,f(k),d):l(c,b,function(a){var b=k(a.target);if(b)return a.selectorTarget=b,d.call(b,a)})}};var b=[].slice,k=l.emit=function(e,d,k){var g=b.call(arguments,2),
f="on"+d;if("parentNode"in e){var n=g[0]={},l;for(l in k)n[l]=k[l];n.preventDefault=c;n.stopPropagation=a;n.target=e;n.type=d;k=n}do e[f]&&e[f].apply(e,g);while(k&&k.bubbles&&(e=e.parentNode));return k&&k.cancelable&&k},n=m("event-focusin")?{}:{focusin:"focus",focusout:"blur"};if(!m("event-stopimmediatepropagation"))var p=function(){this.modified=this.immediatelyStopped=!0},t=function(a){return function(b){if(!b.immediatelyStopped)return b.stopImmediatePropagation=p,a.apply(this,arguments)}};if(m("dom-addeventlistener"))l.emit=
function(a,b,e){if(a.dispatchEvent&&document.createEvent){var c=(a.ownerDocument||document).createEvent("HTMLEvents");c.initEvent(b,!!e.bubbles,!!e.cancelable);for(var d in e)d in c||(c[d]=e[d]);return a.dispatchEvent(c)&&c}return k.apply(l,arguments)};else{l._fixEvent=function(a,b){a||(a=(b&&(b.ownerDocument||b.document||b).parentWindow||window).event);if(!a)return a;try{r&&a.type==r.type&&a.srcElement==r.target&&(a=r)}catch(C){}if(!a.target)switch(a.target=a.srcElement,a.currentTarget=b||a.srcElement,
"mouseover"==a.type&&(a.relatedTarget=a.fromElement),"mouseout"==a.type&&(a.relatedTarget=a.toElement),a.stopPropagation||(a.stopPropagation=v,a.preventDefault=y),a.type){case "keypress":b="charCode"in a?a.charCode:a.keyCode,10==b?(b=0,a.keyCode=13):13==b||27==b?b=0:3==b&&(b=99),a.charCode=b,b=a,b.keyChar=b.charCode?String.fromCharCode(b.charCode):"",b.charOrCode=b.keyChar||b.keyCode}return a};var r,q=function(a){this.handle=a};q.prototype.remove=function(){delete _dojoIEListeners_[this.handle]};
var u=function(a){return function(b){b=l._fixEvent(b,this);var e=a.call(this,b);b.modified&&(r||setTimeout(function(){r=null}),r=b);return e}},z=function(a,b,e){e=u(e);if(((a.ownerDocument?a.ownerDocument.parentWindow:a.parentWindow||a.window||window)!=top||5.8>m("jscript"))&&!m("config-_allow_leaks")){"undefined"==typeof _dojoIEListeners_&&(_dojoIEListeners_=[]);var c=a[b];if(!c||!c.listeners){var d=c,c=Function("event","var callee \x3d arguments.callee; for(var i \x3d 0; i\x3ccallee.listeners.length; i++){var listener \x3d _dojoIEListeners_[callee.listeners[i]]; if(listener){listener.call(this,event);}}");
c.listeners=[];a[b]=c;c.global=this;d&&c.listeners.push(_dojoIEListeners_.push(d)-1)}c.listeners.push(a=c.global._dojoIEListeners_.push(e)-1);return new q(a)}return f.after(a,b,e,!0)},v=function(){this.cancelBubble=!0},y=l._preventDefault=function(){this.bubbledKeyCode=this.keyCode;if(this.ctrlKey)try{this.keyCode=0}catch(B){}this.defaultPrevented=!0;this.returnValue=!1;this.modified=!0}}if(m("touch"))var x=function(){},w=window.orientation,A=function(a){return function(b){var e=b.corrected;if(!e){var c=
b.type;try{delete b.type}catch(M){}if(b.type){if(m("touch-can-modify-event-delegate"))x.prototype=b,e=new x;else{var e={},d;for(d in b)e[d]=b[d]}e.preventDefault=function(){b.preventDefault()};e.stopPropagation=function(){b.stopPropagation()}}else e=b,e.type=c;b.corrected=e;if("resize"==c){if(w==window.orientation)return null;w=window.orientation;e.type="orientationchange";return a.call(this,e)}"rotation"in e||(e.rotation=0,e.scale=1);if(window.TouchEvent&&b instanceof TouchEvent){var c=e.changedTouches[0],
k;for(k in c)delete e[k],e[k]=c[k]}}return a.call(this,e)}};return l})},"com/huayun/webgis/utils/classifyRings":function(){define(["./utils","./quickselect"],function(f,d){function m(d,c){return c.area-d.area}return function(h,c){var a=h.length;if(1>=a)return[h];for(var g=[],l,e,b=0;b<a;b++){var k=f.calculateSignedArea(h[b]);0!==k&&(h[b].area=Math.abs(k),void 0===e&&(e=0>k),e===0>k?(l&&g.push(l),l=[h[b]]):l.push(h[b]))}l&&g.push(l);if(1<c)for(h=0;h<g.length;h++)g[h].length<=c||(d(g[h],c,1,g[h].length-
1,m),g[h]=g[h].slice(0,c));return g}})},"com/huayun/webgis/data/queryIntersectsEx":function(){define(["exports"],function(f){function d(a,e){for(var b=!1,c=0,d=a.length-1;c<a.length;d=c++){var g=a[c],d=a[d];g.y>e.y!==d.y>e.y&&e.x<(d.x-g.x)*(e.y-g.y)/(d.y-g.y)+g.x&&(b=!b)}return b}function m(a,e){if(0===a.length||0===e.length)return!1;for(var b=0;b<a.length-1;b++)for(var d=a[b],g=a[b+1],f=0;f<e.length-1;f++){var l=d,h=g,m=e[f],u=e[f+1];if(c(l,m,u)!==c(h,m,u)&&c(l,h,m)!==c(l,h,u))return!0}return!1}
function h(a,e){var b=a.x-e[0];a=a.y-e[1];return b*b+a*a}function c(a,e,b){return(b[1]-a[1])*(e[0]-a[0])>(e[1]-a[1])*(b[0]-a[0])}function a(a,e,b){b*=b;if(1===e.length){var c=e[0];e=c.x-a.x;a=c.y-a.y;return e*e+a*a<b}for(c=1;c<e.length;c++){var d;d=a;var g=e[c-1],f=e[c],l=(g[0]-f[0])*(g[0]-f[0])+(g[1]-f[1])*(g[1]-f[1]);if(0===l)d=h(d,g);else if(l=((d.x-g[0])*(f[0]-g[0])+(d.y-g[1])*(f[1]-g[1]))/l,0>l)d=h(d,g);else if(1<l)d=h(d,f);else{var m=[];m[0]=(f[0]-g[0])*l+g[0];m[1]=(f[1]-g[1])*l+g[1];d=h(d,
m)}if(d<b)return!0}return!1}function g(a,e){for(var b=!1,c,d,g,f=0;f<a.length;f++){c=a[f];var l=0;for(g=c.length-1;l<c.length;g=l++)d=c[l],g=c[g],d[1]>e.y!==g[1]>e.y&&e.x<(g[0]-d[0])*(e.y-d[1])/(g[1]-d[1])+d[0]&&(b=!b)}return b}f.lineex=function(c,e,b,k){c=c[0];b=b.width*k/2;for(k=0;k<e.length;k++){for(var g=e[k],f=0;f<g.length;f++)if(d(c,g[f]))return!0;a:{var f=c,l=b;if(1<f.length){if(m(f,g)){f=!0;break a}for(var h=0;h<g.length;h++)if(a(g[h],f,l)){f=!0;break a}}for(h=0;h<f.length;h++)if(a(f[h],g,
l)){f=!0;break a}f=!1}if(f)return!0}return!1};f.polygonex=function(a,e){e=e.rings;if(1===a.length)return g(e,a[0]);for(var b=0;b<e.length;b++)for(var c=e[b],f=0;f<c.length;f++)if(d(a,c[f]))return!0;for(b=0;b<a.length;b++)if(g(e,a[b]))return!0;for(b=0;b<e.length;b++)if(m(a,e[b]))return!0;return!1};f.pointex=function(c,e,b,k,g,f){c=c[0];e=e[0][0];k*=g;k=d(c,e)?!0:a(e,c,k)?!0:!1;if(k)return!0};f.multipointex=function(a,e,b,c,g){e=e[0];a=a[0];for(b=0;b<e.length;b++)if(d(a,e[b],g))return!0;return!1}})},
"com/huayun/webgis/layers/support/UnitBezier":function(){define([],function(){function f(d,f,h,c){this.cx=3*d;this.bx=3*(h-d)-this.cx;this.ax=1-this.cx-this.bx;this.cy=3*f;this.by=3*(c-f)-this.cy;this.ay=1-this.cy-this.by;this.p1x=d;this.p1y=c;this.p2x=h;this.p2y=c}f.prototype.sampleCurveX=function(d){return((this.ax*d+this.bx)*d+this.cx)*d};f.prototype.sampleCurveY=function(d){return((this.ay*d+this.by)*d+this.cy)*d};f.prototype.sampleCurveDerivativeX=function(d){return(3*this.ax*d+2*this.bx)*d+
this.cx};f.prototype.solveCurveX=function(d,f){"undefined"===typeof f&&(f=1E-6);var h,c,a,g;a=d;for(h=0;8>h;h++){g=this.sampleCurveX(a)-d;if(Math.abs(g)<f)return a;c=this.sampleCurveDerivativeX(a);if(1E-6>Math.abs(c))break;a-=g/c}h=0;c=1;a=d;if(a<h)return h;if(a>c)return c;for(;h<c;){g=this.sampleCurveX(a);if(Math.abs(g-d)<f)break;d>g?h=a:c=a;a=.5*(c-h)+h}return a};f.prototype.solve=function(d,f){return this.sampleCurveY(this.solveCurveX(d,f))};return f})},"com/huayun/webgis/gl/Context":function(){define(["./BaseValue",
"./Buffer","./mode","../utils/utils"],function(f,d,m,h){function c(c){this.id=a++;this.gl=c;this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object");this.clearColor=new f.ClearColor(this);this.colorMask=new f.ColorMask(this);this.clearDepth=new f.ClearDepth(this);this.depthRange=new f.DepthRange(this);this.depthMask=new f.DepthMask(this);this.depthTest=new f.DepthTest(this);this.depthFunc=new f.DepthFunc(this);this.cullFace=new f.CullFace(this);this.cullFaceSide=new f.CullFaceSide(this);
this.blend=new f.Blend(this);this.blendFunc=new f.BlendFunc(this);this.blendColor=new f.BlendColor(this);this.blendEquation=new f.BlendEquation(this);this.clearStencil=new f.ClearStencil(this);this.stencilMask=new f.StencilMask(this);this.stencilFunc=new f.StencilFunc(this);this.stencilOp=new f.StencilOp(this);this.stencilTest=new f.StencilTest(this);this.frontFace=new f.FrontFace(this);this.program=new f.Program(this);this.activeTexture=new f.ActiveTextureUnit(this);this.viewport=new f.Viewport(this);
this.bindFramebuffer=new f.BindFramebuffer(this);this.bindRenderbuffer=new f.BindRenderbuffer(this);this.bindTexture=new f.BindTexture(this);this.bindVertexArrayOES=this.extVertexArrayObject&&new f.BindVertexArrayOES(this);this.bindElementBuffer=new f.BindElementBuffer(this);this.bindVertexBuffer=new f.BindVertexBuffer(this);this.pixelStoreUnpack=new f.PixelStoreUnpack(this);this.pixelStoreUnpackPremultiplyAlpha=new f.PixelStoreUnpackPremultiplyAlpha(this);this.pixelStoreUnpackFlipY=new f.PixelStoreUnpackFlipY(this);
if(this.extTextureFilterAnisotropic=c.getExtension("EXT_texture_filter_anisotropic")||c.getExtension("MOZ_EXT_texture_filter_anisotropic")||c.getExtension("WEBKIT_EXT_texture_filter_anisotropic"))this.extTextureFilterAnisotropicMax=c.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT);(this.extTextureHalfFloat=c.getExtension("OES_texture_half_float"))&&c.getExtension("OES_texture_half_float_linear");this.elementIndexUint=c.getExtension("OES_element_index_uint");this.extInstancedArray=
c.getExtension("ANGLE_instanced_arrays")}var a=0;c.prototype.setDefault=function(){this.unbindVAO();this.clearColor.setDefault();this.clearDepth.setDefault();this.clearStencil.setDefault();this.colorMask.setDefault();this.stencilMask.setDefault();this.stencilFunc.setDefault();this.stencilOp.setDefault();this.stencilTest.setDefault();this.depthMask.setDefault();this.depthRange.setDefault();this.depthTest.setDefault();this.depthFunc.setDefault();this.blend.setDefault();this.blendFunc.setDefault();this.blendColor.setDefault();
this.blendEquation.setDefault();this.cullFace.setDefault();this.cullFaceSide.setDefault();this.frontFace.setDefault();this.program.setDefault();this.activeTexture.setDefault();this.bindFramebuffer.setDefault();this.pixelStoreUnpack.setDefault();this.pixelStoreUnpackPremultiplyAlpha.setDefault();this.pixelStoreUnpackFlipY.setDefault()};c.prototype.setBasic=function(){this.clearColor.setDefault();this.clearDepth.setDefault();this.clearStencil.setDefault();this.colorMask.setDefault();this.stencilMask.setDefault();
this.stencilFunc.setDefault();this.stencilOp.setDefault();this.stencilTest.setDefault();this.depthMask.setDefault();this.depthRange.setDefault();this.depthTest.setDefault();this.depthFunc.setDefault();this.blend.setDefault();this.blendFunc.setDefault();this.blendColor.setDefault();this.blendEquation.setDefault();this.cullFace.setDefault();this.cullFaceSide.setDefault();this.frontFace.setDefault();this.program.setDefault();this.activeTexture.setDefault();this.bindFramebuffer.setDefault();this.pixelStoreUnpack.setDefault();
this.pixelStoreUnpackPremultiplyAlpha.setDefault();this.pixelStoreUnpackFlipY.setDefault()};c.prototype.setDirty=function(){this.clearColor.dirty=!0;this.clearDepth.dirty=!0;this.clearStencil.dirty=!0;this.colorMask.dirty=!0;this.depthMask.dirty=!0;this.stencilMask.dirty=!0;this.stencilFunc.dirty=!0;this.stencilOp.dirty=!0;this.stencilTest.dirty=!0;this.depthRange.dirty=!0;this.depthTest.dirty=!0;this.depthFunc.dirty=!0;this.blend.dirty=!0;this.blendFunc.dirty=!0;this.blendColor.dirty=!0;this.blendEquation.dirty=
!0;this.cullFace.dirty=!0;this.cullFaceSide.dirty=!0;this.frontFace.dirty=!0;this.program.dirty=!0;this.activeTexture.dirty=!0;this.viewport.dirty=!0;this.bindFramebuffer.dirty=!0;this.bindRenderbuffer.dirty=!0;this.bindTexture.dirty=!0;this.bindVertexBuffer.dirty=!0;this.bindElementBuffer.dirty=!0;this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0);this.pixelStoreUnpack.dirty=!0;this.pixelStoreUnpackPremultiplyAlpha.dirty=!0;this.pixelStoreUnpackFlipY.dirty=!0};c.prototype.createIndexBuffer=
function(a,c){return new d.IndexBuffer(this,a,c)};c.prototype.createVertexBuffer=function(a,c,e){return new d.VertexBuffer(this,a,c,e)};c.prototype.createRenderbuffer=function(a,c,e){var b=this.gl,d=b.createRenderbuffer();this.bindRenderbuffer.set(d);b.renderbufferStorage(b.RENDERBUFFER,a,c,e);this.bindRenderbuffer.set(null);return d};c.prototype.createFramebuffer=function(a,c){return new d.Framebuffer(this,a,c)};c.prototype.clear=function(a){var c=a.color;a=a.depth;var e=this.gl,b=0;c&&(b|=e.COLOR_BUFFER_BIT,
this.clearColor.set(c),this.colorMask.set([!0,!0,!0,!0]));"undefined"!==typeof a&&(b|=e.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0));e.clear(b)};c.prototype.setCullFace=function(a){!1===a.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(a.mode),this.frontFace.set(a.frontFace))};c.prototype.setDepthMode=function(a){a.func!==this.gl.ALWAYS||a.mask?(this.depthTest.set(!0),this.depthFunc.set(a.func),this.depthMask.set(a.mask),this.depthRange.set(a.range)):
this.depthTest.set(!1)};c.prototype.setStencilMode=function(a){a.test.func!==this.gl.ALWAYS||a.mask?(this.stencilTest.set(!0),this.stencilMask.set(a.mask),this.stencilOp.set([a.fail,a.depthFail,a.pass]),this.stencilFunc.set({func:a.test.func,ref:a.ref,mask:a.test.mask})):this.stencilTest.set(!1)};c.prototype.setColorMode=function(a){h.deepEqual(a.blendFunction,m.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(a.blendFunction),this.blendColor.set(a.blendColor));this.colorMask.set(a.mask)};
c.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};return c})},"com/huayun/webgis/renderer/Renderer":function(){define([],function(){function f(){}f.prototype.getRealScale=function(d,f,h){if(d.isFixed||0===h)return 1;if(0===d.addratio)return f/h;if(0<d.addratio)return 1+f/h*d.addratio};f.prototype.calculateExtent=function(){};return f})},"dojo/promise/tracer":function(){define(["../_base/lang","./Promise","../Evented"],function(f,d,m){function h(d){setTimeout(function(){a.apply(c,
d)},0)}var c=new m,a=c.emit;c.emit=null;d.prototype.trace=function(){var a=f._toArray(arguments);this.then(function(c){h(["resolved",c].concat(a))},function(c){h(["rejected",c].concat(a))},function(c){h(["progress",c].concat(a))});return this};d.prototype.traceRejected=function(){var a=f._toArray(arguments);this.otherwise(function(c){h(["rejected",c].concat(a))});return this};return c})},"dojo/dom-style":function(){define(["./sniff","./dom","./_base/window"],function(f,d,m){function h(a,b,e){b=b.toLowerCase();
if("auto"==e){if("height"==b)return a.offsetHeight;if("width"==b)return a.offsetWidth}if("fontweight"==b)switch(e){case 700:return"bold";default:return"normal"}b in k||(k[b]=n.test(b));return k[b]?g(a,e):e}var c,a={};c=f("webkit")?function(a){var b;if(1==a.nodeType){var e=a.ownerDocument.defaultView;b=e.getComputedStyle(a,null);!b&&a.style&&(a.style.display="",b=e.getComputedStyle(a,null))}return b||{}}:f("ie")&&(9>f("ie")||f("quirks"))?function(a){return 1==a.nodeType&&a.currentStyle?a.currentStyle:
{}}:function(a){if(1===a.nodeType){var b=a.ownerDocument.defaultView;return(b.opener?b:m.global.window).getComputedStyle(a,null)}return{}};a.getComputedStyle=c;var g;g=f("ie")?function(a,b){if(!b)return 0;if("medium"==b)return 4;if(b.slice&&"px"==b.slice(-2))return parseFloat(b);var e=a.style,c=a.runtimeStyle,d=e.left,k=c.left;c.left=a.currentStyle.left;try{e.left=b,b=e.pixelLeft}catch(y){b=0}e.left=d;c.left=k;return b}:function(a,b){return parseFloat(b)||0};a.toPixelValue=g;var l=function(a,b){try{return a.filters.item("DXImageTransform.Microsoft.Alpha")}catch(q){return b?
{}:null}},e=9>f("ie")||10>f("ie")&&f("quirks")?function(a){try{return l(a).Opacity/100}catch(r){return 1}}:function(a){return c(a).opacity},b=9>f("ie")||10>f("ie")&&f("quirks")?function(a,e){""===e&&(e=1);var c=100*e;1===e?(a.style.zoom="",l(a)&&(a.style.filter=a.style.filter.replace(/\s*progid:DXImageTransform.Microsoft.Alpha\([^\)]+?\)/i,""))):(a.style.zoom=1,l(a)?l(a,1).Opacity=c:a.style.filter+=" progid:DXImageTransform.Microsoft.Alpha(Opacity\x3d"+c+")",l(a,1).Enabled=!0);if("tr"==a.tagName.toLowerCase())for(a=
a.firstChild;a;a=a.nextSibling)"td"==a.tagName.toLowerCase()&&b(a,e);return e}:function(a,b){return a.style.opacity=b},k={left:!0,top:!0},n=/margin|padding|width|height|max|min|offset/,p={cssFloat:1,styleFloat:1,"float":1};a.get=function(b,c){var k=d.byId(b),g=arguments.length;if(2==g&&"opacity"==c)return e(k);c=p[c]?"cssFloat"in k.style?"cssFloat":"styleFloat":c;var f=a.getComputedStyle(k);return 1==g?f:h(k,c,f[c]||k.style[c])};a.set=function(e,c,k){var g=d.byId(e),f=arguments.length,n="opacity"==
c;c=p[c]?"cssFloat"in g.style?"cssFloat":"styleFloat":c;if(3==f)return n?b(g,k):g.style[c]=k;for(var l in c)a.set(e,l,c[l]);return a.getComputedStyle(g)};return a})},"dojo/dom-construct":function(){define("exports ./_base/kernel ./sniff ./_base/window ./dom ./dom-attr".split(" "),function(f,d,m,h,c,a){function g(a,b){var e=b.parentNode;e&&e.insertBefore(a,b)}function l(a){if("innerHTML"in a)try{a.innerHTML="";return}catch(y){}for(var b;b=a.lastChild;)a.removeChild(b)}var e={option:["select"],tbody:["table"],
thead:["table"],tfoot:["table"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","thead","tr"],legend:["fieldset"],caption:["table"],colgroup:["table"],col:["table","colgroup"],li:["ul"]},b=/<\s*([\w\:]+)/,k={},n=0,p="__"+d._scopeName+"ToDomId",t;for(t in e)e.hasOwnProperty(t)&&(d=e[t],d.pre="option"==t?'\x3cselect multiple\x3d"multiple"\x3e':"\x3c"+d.join("\x3e\x3c")+"\x3e",d.post="\x3c/"+d.reverse().join("\x3e\x3c/")+"\x3e");var r;8>=m("ie")&&(r=function(a){a.__dojo_html5_tested="yes";
var b=q("div",{innerHTML:"\x3cnav\x3ea\x3c/nav\x3e",style:{visibility:"hidden"}},a.body);1!==b.childNodes.length&&"abbr article aside audio canvas details figcaption figure footer header hgroup mark meter nav output progress section summary time video".replace(/\b\w+\b/g,function(b){a.createElement(b)});u(b)});f.toDom=function(a,c){c=c||h.doc;var d=c[p];d||(c[p]=d=++n+"",k[d]=c.createElement("div"));8>=m("ie")&&!c.__dojo_html5_tested&&c.body&&r(c);a+="";var g=a.match(b),f=g?g[1].toLowerCase():"",
d=k[d];if(g&&e[f])for(g=e[f],d.innerHTML=g.pre+a+g.post,a=g.length;a;--a)d=d.firstChild;else d.innerHTML=a;if(1==d.childNodes.length)return d.removeChild(d.firstChild);for(a=c.createDocumentFragment();c=d.firstChild;)a.appendChild(c);return a};f.place=function(a,b,e){b=c.byId(b);"string"==typeof a&&(a=/^\s*</.test(a)?f.toDom(a,b.ownerDocument):c.byId(a));if("number"==typeof e){var d=b.childNodes;!d.length||d.length<=e?b.appendChild(a):g(a,d[0>e?0:e])}else switch(e){case "before":g(a,b);break;case "after":e=
a;(d=b.parentNode)&&(d.lastChild==b?d.appendChild(e):d.insertBefore(e,b.nextSibling));break;case "replace":b.parentNode.replaceChild(a,b);break;case "only":f.empty(b);b.appendChild(a);break;case "first":if(b.firstChild){g(a,b.firstChild);break}default:b.appendChild(a)}return a};var q=f.create=function(b,e,d,k){var g=h.doc;d&&(d=c.byId(d),g=d.ownerDocument);"string"==typeof b&&(b=g.createElement(b));e&&a.set(b,e);d&&f.place(b,d,k);return b};f.empty=function(a){l(c.byId(a))};var u=f.destroy=function(a){if(a=
c.byId(a)){var b=a;a=a.parentNode;b.firstChild&&l(b);a&&(m("ie")&&a.canHaveChildren&&"removeNode"in b?b.removeNode(!1):a.removeChild(b))}}})},"com/huayun/webgis/data/bucket/TextBucketSimplify":function(){define(["../ArrayType","../../gl/SegmentVector","../../geometry/Anchor","../../geometry/Point2D","../../gl/TaggedString"],function(f,d,m,h,c){function a(a,b,e,c,d,g,f,l){l?a.emplaceBack(b,e,l[0],l[1],l[2],l[3],Math.round(32*c),Math.round(32*d),g,f):a.emplaceBack(b,e,Math.round(32*c),Math.round(32*
d),g,f)}function g(a,b,e,c,d,g){for(var k=0,f=-17,n=b=0,l=0,h=0;h<c.length;h+=1){var p=c[h],m=p.color?{positionedGlyphs:[],lineOffset:0,color:p.color}:{positionedGlyphs:[],lineOffset:0};a.positionedLines[l]=m;var q=m.positionedGlyphs;if(p.length()){for(var r=0;r<p.length();r++){var t=p.getSection(r),F=p.getSectionIndex(r),G=p.getCharCode(r),I=0,M=null,D=null;(I=(I=e[t.fontStack])&&I[G])&&I.rect&&(D=I.rect,M=I.metrics);I=96*(1-t.scale);q.push({glyph:G,imageName:null,x:k,y:f+I,vertical:!1,scale:t.scale,
fontStack:t.fontStack,sectionIndex:F,metrics:M,rect:D});k+=M.advance*t.scale+g}if(0!==q.length)for(b=Math.max(k-g,b),k=q,q=q.length-1,p=k[q],p=.5*(k[q].x+p.metrics.advance*p.scale),r=0;r<=q;r++)k[r].x-=p,k[r].y+=0;k=0;q=1*d+0;m.lineOffset=Math.max(0,0);f+=q;n=Math.max(q,n)}else f+=d;++l}e=f- -17;g=0*b;f=0;f=n!==d?.5*-e- -17:(-.5*c.length+.5)*d;c=0;for(d=a.positionedLines;c<d.length;c+=1)for(n=0,l=d[c].positionedGlyphs;n<l.length;n+=1)h=l[n],h.x+=g,h.y+=f;a.top+=-.5*e;a.bottom=a.top+e;a.left+=-.5*
b;a.right=a.left+b}function l(a,b,e,d,f,l,h,m,v){if(v){var k=[];a.forEach(function(a,e){a=a.split(/[(\r\n)\r\n]+/);for(var d=0,g=a.length;d<g;d++){var f=c.fromFeature({sections:[{fontStack:b,scale:null,text:a[d]}]},b);f.color=v[e];k[k.length]=f}})}else for(var k=[],n=a.split(/[(\r\n)\r\n]+/),p=0,q=n.length;p<q;p++)k[k.length]=c.fromFeature({sections:[{fontStack:b,scale:null,text:n[p]}]},b);a={positionedLines:[],text:a,top:m[1],bottom:m[1],left:m[0],right:m[0],writingMode:h,iconsInText:!1,verticalizable:!1,
lineCount:k.length};g(a,e,d,k,f,l);return a}function e(a,b,e){a=[];var c=0;for(b=b.positionedLines;c<b.length;c+=1)for(var d=b[c],k=0,g=d.positionedGlyphs;k<g.length;k+=1){var f=g[k];if(f.rect){var n=f.rect||{},l=f.metrics.advance*f.scale/2,p=[f.x+l+e[0],f.y+e[1]],l=(f.metrics.left-1)*f.scale-l+p[0],m=(-f.metrics.top-1)*f.scale+p[1],p=l+n.w*f.scale/1,A=m+n.h*f.scale/1,f=new h(l,m),m=new h(p,m),l=new h(l,A),p=new h(p,A);a.push({tl:f,tr:m,bl:l,br:p,tex:n,isSDF:!0,color:d.color})}}return a}var b=function(){this.indexArray=
new f.StructArrayLayout3ui6;this.segments=new d};b.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy())};b.prototype.addFeature=function(a,b,c,d,g,f,h){var k={};f=f.map(function(a){return 96*a});(b=l(b,c,d,g,24,.24,1,f,h))&&(k.center=b);for(b=0;b<a.length;b++)for(c=a[b],d=0;d<c.length;d++){g=c[b];g=new m(g.x,g.y,0);var n=e(g,k.center,f);this.addSymbols(n,g,h)}};b.prototype.addSymbols=function(b,e,c){var d=this.indexArray;
this.layoutVertexArray||(this.layoutVertexArray=c?new f.StructArrayLayout6f4ib16:new f.StructArrayLayout2f4ib16);var k=this.layoutVertexArray,g=this.segments.prepareSegment(4*b.length,this.layoutVertexArray,this.indexArray);if(c)for(c=0;c<b.length;c+=1){var n=b[c],l=n.color,h=n.tl,p=n.tr,m=n.bl,w=n.br,n=n.tex,A=g.vertexLength;a(k,e.x,e.y,h.x,h.y,n.x,n.y,l);a(k,e.x,e.y,p.x,p.y,n.x+n.w,n.y,l);a(k,e.x,e.y,m.x,m.y,n.x,n.y+n.h,l);a(k,e.x,e.y,w.x,w.y,n.x+n.w,n.y+n.h,l);d.emplaceBack(A,A+1,A+2);d.emplaceBack(A+
1,A+2,A+3);g.vertexLength+=4;g.primitiveLength+=2}else for(c=0;c<b.length;c+=1)n=b[c],h=n.tl,p=n.tr,m=n.bl,w=n.br,n=n.tex,A=g.vertexLength,a(k,e.x,e.y,h.x,h.y,n.x,n.y),a(k,e.x,e.y,p.x,p.y,n.x+n.w,n.y),a(k,e.x,e.y,m.x,m.y,n.x,n.y+n.h),a(k,e.x,e.y,w.x,w.y,n.x+n.w,n.y+n.h),d.emplaceBack(A,A+1,A+2),d.emplaceBack(A+1,A+2,A+3),g.vertexLength+=4,g.primitiveLength+=2};b.prototype.upload=function(a,b){this.layoutVertexBuffer=b?a.createVertexBuffer(this.layoutVertexArray,[{name:"a_pos",type:"Float32",components:2,
offset:0},{name:"a_color",type:"Float32",components:4,offset:8},{name:"a_data",type:"Int16",components:4,offset:24}]):a.createVertexBuffer(this.layoutVertexArray,[{name:"a_pos",type:"Float32",components:2,offset:0},{name:"a_data",type:"Int16",components:4,offset:8}]);this.indexBuffer=a.createIndexBuffer(this.indexArray)};return b})},"dojo/when":function(){define(["./Deferred","./promise/Promise"],function(f,d){return function(m,h,c,a){var g=m&&"function"===typeof m.then,l=g&&m instanceof d;if(!g)return 1<
arguments.length?h?h(m):m:(new f).resolve(m);l||(g=new f(m.cancel),m.then(g.resolve,g.reject,g.progress),m=g.promise);return h||c||a?m.then(h,c,a):m}})},"com/huayun/webgis/utils/Color":function(){define([],function(){function f(a){a=Math.round(a);return 0>a?0:255<a?255:a}function d(a){return 0>a?0:1<a?1:a}function m(a){return"%"===a[a.length-1]?f(parseFloat(a)/100*255):f(parseInt(a))}function h(a){return"%"===a[a.length-1]?d(parseFloat(a)/100):d(parseFloat(a))}function c(a,b,c){0>c?c+=1:1<c&&--c;
return 1>6*c?a+(b-a)*c*6:1>2*c?b:2>3*c?a+(b-a)*(2/3-c)*6:a}function a(a){a=a.replace(/ /g,"").toLowerCase();if(a in g)return g[a].slice();if("#"===a[0])return 4===a.length?(a=parseInt(a.substr(1),16),0<=a&&4095>=a?[(a&3840)>>4|(a&3840)>>8,a&240|(a&240)>>4,a&15|(a&15)<<4,1]:null):7===a.length?(a=parseInt(a.substr(1),16),0<=a&&16777215>=a?[(a&16711680)>>16,(a&65280)>>8,a&255,1]:null):null;if("0x"===a.substr(0,2))return 5===a.length?(a=parseInt(a.substr(2),16),0<=a&&4095>=a?[(a&3840)>>4|(a&3840)>>8,
a&240|(a&240)>>4,a&15|(a&15)<<4,1]:null):8===a.length?(a=parseInt(a.substr(2),16),0<=a&&16777215>=a?[(a&16711680)>>16,(a&65280)>>8,a&255,1]:null):null;var b=a.indexOf("("),e=a.indexOf(")");if(-1!==b&&e+1===a.length){var d=a.substr(0,b),b=a.substr(b+1,e-(b+1)).split(",");a=1;switch(d){case "rgba":if(4!==b.length)return null;a=h(b.pop());case "rgb":return 3!==b.length?null:[m(b[0]),m(b[1]),m(b[2]),a];case "hsla":if(4!==b.length)return null;a=h(b.pop());case "hsl":if(3!==b.length)return null;d=(parseFloat(b[0])%
360+360)%360/360;e=h(b[1]);b=h(b[2]);e=.5>=b?b*(e+1):b+e-b*e;b=2*b-e;return[f(255*c(b,e,d+1/3)),f(255*c(b,e,d)),f(255*c(b,e,d-1/3)),a];default:return null}}a=a.split(",");return 3===a.length?[m(a[0]),m(a[1]),m(a[2]),1]:4===a.length?[m(a[0]),m(a[1]),m(a[2]),h(a[3])]:null}var g={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,
235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,
107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,
220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,
250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,
85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,
170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,
192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]},l=function(a,b,c,d){void 0===d&&(d=1);this.r=a;this.g=b;this.b=c;
this.a=d};l.parse=function(e){if(e){if(e instanceof l)return e;if(e instanceof Array)return new l(e[0],e[1],e[2],e[3]);if("string"===typeof e&&(e=a(e)))return new l(e[0]/255*e[3],e[1]/255*e[3],e[2]/255*e[3],e[3])}};l.prototype.toString=function(){var a=this.toArray();return"rgba("+Math.round(a[0])+","+Math.round(a[1])+","+Math.round(a[2])+","+a[3]+")"};l.prototype.toArray=function(){var a=this.r,b=this.g,c=this.b,d=this.a;return 0===d?[0,0,0,0]:[255*a/d,255*b/d,255*c/d,d]};l.black=new l(0,0,0,1);
l.white=new l(1,1,1,1);l.transparent=new l(0,0,0,0);l.red=new l(1,0,0,1);return l})},"com/huayun/webgis/renderer/CircleRenderer":function(){define(["./Renderer","../gl/mode","../data/bucket/CircleBucketSimplify","../geometry/Point","../gl/programCache"],function(f,d,m,h,c){function a(){}f&&(a.__proto__=f);a.prototype=Object.create(f&&f.prototype);a.prototype.constructor=a;a.prototype.add=function(a,c,e,b){b=new m;var d=c.position||a.viewpoint.center||[0,0],g=d[0],d=d[1];if("multipoint"===e.type){for(var f=
[],l=0;l<e.points.length;l++)f.push(new h(e.points[l].x-g,e.points[l].y-d,0));b.addFeature([f])}else"point"===e.type?b.addFeature([[new h(e.x-g,e.y-d,0)]]):"circle"===e.type&&(e=e.center,b.addFeature([[new h(e.x-g,e.y-d,0)]]));b.upload(a.context);c.buckets.push(b);c.position=[g,d]};a.prototype.draw=function(a,f,e,b,k,n,h){void 0===n&&(n=0);var g=a.context,l=g.gl;k=k?k.depthModeForSublayer(0,d.DepthMode.ReadOnly):new d.DepthMode(l.LEQUAL,d.DepthMode.ReadOnly,[.9,.9]);var p=d.StencilMode.disabled,m=
d.ColorMode.alphaBlended,z=c.useProgramSimplify(g,"circle",{layoutAttributes:[{name:"a_pos",type:"Float32",components:2,offset:0},{name:"a_data",type:"Int16",components:2,offset:8}]}),v=b.uniforms,y=f.position,x=this.getRealScale(b.fixed,a.scale,b.minScale),w=void 0,A=a.resolution;b.markerSize?(x*=f.markerScaleFactor||1,w=b.markerSize/b.radius,x*=w):f.symbol.size&&void 0===f.symbol.tempW?(f.scaleFactor=f.scaleFactor||1,x*=f.scaleFactor,w=f.symbol.size/b.radius,f.symbol.tempW=w,x*=w):f.symbol.size&&
void 0!==f.symbol.tempW?x*=f.symbol.tempW:(f.scaleFactor=f.scaleFactor||1,x*=f.scaleFactor);h||(v.radius=b.radius*x);v.u_radian=f.rotation?b.angle+f.rotation:b.angle;v.u_radian||(v.u_radian=0);var w=b.dx*x*A,B=b.dy*x*A,E=Math.sin(v.u_radian),C=Math.cos(v.u_radian);h=w*C-B*E;w=B*C+w*E;v.u_matrix=a.viewpoint.getMatrixForPoint(y[0]+h,y[1]+w);y=b.strokeWidth*x;v.stroke_width=1>y?1:y;v.u_camera_to_center_distance=a.viewpoint.cameraToCenterDistance;v.u_extrude_scale=a.viewpoint.pixelsToGLUnits;f["_circleOffset"+
n]={dx:h,dy:w,size:b.uniforms.radius+b.uniforms.stroke_width};v.color=b.color;v.stroke_color=b.strokeColor;"circle"===e.type&&(v.radius=e.radius/A);if(a=f.buckets[n]){debugger;z.draw(g,l.TRIANGLES,k,p,m,d.CullFaceMode.disabled,v,f.id+"-circle"+n,a.layoutVertexBuffer,a.indexBuffer,a.segments,null)}};a.prototype.drawGlow=function(a,f,e,b,k,n,h){var g=f.glow;if(g){void 0===n&&(n=0);e=a.context;var l=e.gl;k=k?k.depthModeForSublayer(0,d.DepthMode.ReadOnly):new d.DepthMode(l.LEQUAL,d.DepthMode.ReadOnly,
[.9,.9]);var p=d.StencilMode.disabled,m=d.ColorMode.alphaBlended,z=c.useProgramSimplify(e,"circle",{layoutAttributes:[{name:"a_pos",type:"Float32",components:2,offset:0},{name:"a_data",type:"Int16",components:2,offset:8}]}),v=b.uniforms,y=f.position,x=this.getRealScale(b.fixed,a.scale,b.minScale),w=1,A=a.resolution;b.markerSize?(x*=f.markerScaleFactor,w=b.markerSize/b.radius,x*=w):f.symbol.size?(f.scaleFactor=f.scaleFactor||1,x*=f.scaleFactor,w=f.symbol.size/b.radius,x*=w):(f.scaleFactor=f.scaleFactor||
1,x*=f.scaleFactor);h||(v.radius=b.radius*x);v.u_radian=f.rotation?b.angle+f.rotation:b.angle;h=b.dx*x*A;var A=b.dy*x*A,w=Math.sin(v.u_radian),B=Math.cos(v.u_radian);v.u_matrix=a.viewpoint.getMatrixForPoint(y[0]+(h*B-A*w),y[1]+(A*B+h*w));b=b.strokeWidth*x;v.stroke_width=1>b?1:b;v.u_camera_to_center_distance=a.viewpoint.cameraToCenterDistance;v.u_extrude_scale=a.viewpoint.pixelsToGLUnits;a=g.color;v.color=a;v.stroke_color=a;a=f.buckets[n];z.draw(e,l.TRIANGLES,k,p,m,d.CullFaceMode.disabled,v,f.id+"-circle"+
n,a.layoutVertexBuffer,a.indexBuffer,a.segments,null)}};a.prototype.calculateExtent=function(a,c,e,b,d,f){f||(f=0);a=a.resolution;f=c["_circleOffset"+f];b=f.size;var g=e.x;e=e.y;var k=f.dy,g=g+f.dx;e+=k;d.push({id:c.id,g:c,minX:g-b*a,minY:e-b*a,maxX:g+b*a,maxY:e+b*a})};return a})},"com/huayun/webgis/gl/constantBinder":function(){define(["exports","./uniform","./dataTransfer","../layers/support/EvaluationParameters","../utils/utils"],function(f,d,m,h,c){var a=function(a,b,e){this.value=a;this.names=
b;this.uniformNames=this.names.map(function(a){return"u_"+a});this.type=e;this.maxValue=-Infinity};a.prototype.defines=function(){return this.names.map(function(a){return"#define HAS_UNIFORM_u_"+a})};a.prototype.setConstantPatternPositions=function(){};a.prototype.populatePaintArray=function(){};a.prototype.updatePaintArray=function(){};a.prototype.upload=function(){};a.prototype.destroy=function(){};a.prototype.setUniforms=function(a,b,e,c){b.set(c.constantOr(this.value))};a.prototype.setUniform=
function(a,b,e){b.set(e)};a.prototype.getBinding=function(a,b){return"color"===this.type?new d.UniformColor(a,b):new d.Uniform1f(a,b)};a.serialize=function(a){var b=a.names,e=a.type;return{value:m.serialize(a.value),names:b,type:e}};a.deserialize=function(b){var e=b.names,c=b.type;return new a(m.deserialize(b.value),e,c)};var g=function(a,b,e){this.value=a;this.names=b;this.uniformNames=this.names.map(function(a){return"u_"+a});this.type=e;this.maxValue=-Infinity;this.patternPositions={patternTo:null,
patternFrom:null}};g.prototype.defines=function(){return this.names.map(function(a){return"#define HAS_UNIFORM_u_"+a})};g.prototype.populatePaintArray=function(){};g.prototype.updatePaintArray=function(){};g.prototype.upload=function(){};g.prototype.destroy=function(){};g.prototype.setConstantPatternPositions=function(a,b){this.patternPositions.patternTo=a.tlbr;this.patternPositions.patternFrom=b.tlbr};g.prototype.setUniforms=function(a,b,e,c,d){a=this.patternPositions;"u_pattern_to"===d&&a.patternTo&&
b.set(a.patternTo);"u_pattern_from"===d&&a.patternFrom&&b.set(a.patternFrom)};g.prototype.getBinding=function(a,b){return new d.Uniform4f(a,b)};var l=function(a,b,e,c){this.expression=a;this.names=b;this.type=e;this.uniformNames=this.names.map(function(a){return"a_"+a});this.maxValue=-Infinity;this.paintVertexAttributes=b.map(function(a){return{name:"a_"+a,type:"Float32",components:"color"===e?2:1,offset:0}});this.paintVertexArray=new c};l.prototype.defines=function(){return[]};l.prototype.setConstantPatternPositions=
function(){};l.prototype.populatePaintArray=function(a,b){var e=this.paintVertexArray,d=e.length;e.reserve(a);b=this.expression.evaluate(new h(0),b,{});if("color"===this.type)for(b=c.packColor(b);d<a;d++)e.emplaceBack(b[0],b[1]);else{for(;d<a;d++)e.emplaceBack(b);this.maxValue=Math.max(this.maxValue,b)}};l.prototype.updatePaintArray=function(a,b,e,d){var g=this.paintVertexArray;e=this.expression.evaluate({zoom:0},e,d);if("color"===this.type)for(e=c.packColor(e);a<b;a++)g.emplace(a,e[0],e[1]);else{for(;a<
b;a++)g.emplace(a,e);this.maxValue=Math.max(this.maxValue,e)}};l.prototype.upload=function(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))};l.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};l.prototype.setUniforms=
function(a,b){b.set(0)};l.prototype.getBinding=function(a,b){return new d.Uniform1f(a,b)};var e=function(a,b,e,c,d,g){this.expression=a;this.names=b;this.uniformNames=this.names.map(function(a){return"u_"+a+"_t"});this.type=e;this.useIntegerZoom=c;this.zoom=d;this.maxValue=-Infinity;this.paintVertexAttributes=b.map(function(a){return{name:"a_"+a,type:"Float32",components:"color"===e?4:2,offset:0}});this.paintVertexArray=new g};e.prototype.defines=function(){return[]};e.prototype.setConstantPatternPositions=
function(){};e.prototype.populatePaintArray=function(a,b){var e=this.paintVertexArray,d=e.length;e.reserve(a);var g=this.expression.evaluate(new h(this.zoom),b,{});b=this.expression.evaluate(new h(this.zoom+1),b,{});if("color"===this.type)for(g=c.packColor(g),b=c.packColor(b);d<a;d++)e.emplaceBack(g[0],g[1],b[0],b[1]);else{for(;d<a;d++)e.emplaceBack(g,b);this.maxValue=Math.max(this.maxValue,g,b)}};e.prototype.updatePaintArray=function(a,b,e,d){var g=this.paintVertexArray,k=this.expression.evaluate({zoom:this.zoom},
e,d);e=this.expression.evaluate({zoom:this.zoom+1},e,d);if("color"===this.type)for(k=c.packColor(k),e=c.packColor(e);a<b;a++)g.emplace(a,k[0],k[1],e[0],e[1]);else{for(;a<b;a++)g.emplace(a,k,e);this.maxValue=Math.max(this.maxValue,k,e)}};e.prototype.upload=function(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,
this.paintVertexAttributes,this.expression.isStateDependent))};e.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};e.prototype.interpolationFactor=function(a){return this.useIntegerZoom?this.expression.interpolationFactor(Math.floor(a),this.zoom,this.zoom+1):this.expression.interpolationFactor(a,this.zoom,this.zoom+1)};e.prototype.setUniforms=function(a,b,e){b.set(this.interpolationFactor(e.zoom))};e.prototype.getBinding=function(a,b){return new d.Uniform1f(a,
b)};var b=function(a,b,e,c,d,g,f){this.expression=a;this.names=b;this.type=e;this.uniformNames=this.names.map(function(a){return"u_"+a+"_t"});this.useIntegerZoom=c;this.zoom=d;this.maxValue=-Infinity;this.layerId=f;this.paintVertexAttributes=b.map(function(a){return{name:"a_"+a,type:"Uint16",components:4,offset:0}});this.zoomInPaintVertexArray=new g;this.zoomOutPaintVertexArray=new g};b.prototype.defines=function(){return[]};b.prototype.setConstantPatternPositions=function(){};b.prototype.populatePaintArray=
function(a,b,e){var c=this.zoomInPaintVertexArray,d=this.zoomOutPaintVertexArray,g=this.layerId,k=c.length;c.reserve(a);d.reserve(a);if(e&&b.patterns&&b.patterns[g]){var f=b.patterns[g];b=e[f.min];g=e[f.mid];e=e[f.max];if(b&&g&&e)for(;k<a;k++)c.emplaceBack(g.tl[0],g.tl[1],g.br[0],g.br[1],b.tl[0],b.tl[1],b.br[0],b.br[1]),d.emplaceBack(g.tl[0],g.tl[1],g.br[0],g.br[1],e.tl[0],e.tl[1],e.br[0],e.br[1])}};b.prototype.updatePaintArray=function(a,b,e,c,d){c=this.zoomInPaintVertexArray;var g=this.zoomOutPaintVertexArray,
k=this.layerId;if(d&&e.patterns&&e.patterns[k]){var f=e.patterns[k];e=d[f.min];k=d[f.mid];d=d[f.max];if(e&&k&&d)for(;a<b;a++)c.emplace(a,k.tl[0],k.tl[1],k.br[0],k.br[1],e.tl[0],e.tl[1],e.br[0],e.br[1]),g.emplace(a,k.tl[0],k.tl[1],k.br[0],k.br[1],d.tl[0],d.tl[1],d.br[0],d.br[1])}};b.prototype.upload=function(a){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=a.createVertexBuffer(this.zoomInPaintVertexArray,
this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=a.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))};b.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy();this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};b.prototype.setUniforms=function(a,b){b.set(0)};b.prototype.getBinding=function(a,b){return new d.Uniform1f(a,b)};m.register("ConstantBinder",
a);m.register("CrossFadedConstantBinder",g);m.register("SourceExpressionBinder",l);m.register("CrossFadedCompositeBinder",b);m.register("CompositeExpressionBinder",e);f.ConstantBinder=a;f.CrossFadedConstantBinder=g;f.SourceExpressionBinder=l;f.CrossFadedCompositeBinder=b;f.CompositeExpressionBinder=e})},"com/huayun/webgis/utils/Constant":function(){define(["exports"],function(f){f.ONE_EM=24;f.MAX_GLYPHS=65535;f.glConstant={ALWAYS:519,LEQUAL:515,BACK:1029,CCW:2305,ZERO:0,ONE:1,ONE_MINUS_SRC_ALPHA:771,
SRC_ALPHA:770,KEEP:7680};f.viewTypes={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};f.AttributeType={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};f.types={string:{kind:"string"},number:{kind:"number"},boolean:{kind:"boolean"},object:{kind:"object"}};f.geometryTypes=["Unknown","Point","LineString","Polygon"];f.layout={EXTENT:8192,border:3,EXTRUDE_SCALE:63,
LINE_DISTANCE_BUFFER_BITS:15,LINE_DISTANCE_SCALE:.5,MAX_LINE_DISTANCE:Math.pow(2,14)/.5,SHARP_CORNER_OFFSET:15,COS_HALF_SHARP_CORNER:Math.cos(Math.PI/180*37.5),EARCUT_MAX_RINGS:500,padding:1};f.collisionBoxLayout=[{name:"a_pos",components:2,type:"Int16",offset:0},{name:"a_anchor_pos",components:2,type:"Int16",offset:4},{name:"a_extrude",components:2,type:"Int16",offset:8}];f.collisionCircleLayout=[{name:"a_pos",components:2,type:"Int16",offset:0},{name:"a_anchor_pos",components:2,type:"Int16",offset:4},
{name:"a_extrude",components:2,type:"Int16",offset:8}];f.whitespace={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0};f.verticalizedCharacterMap={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","\x26":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","\x3c":"\ufe3f","\x3d":"\uff1d","\x3e":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015",
"}":"\ufe38","~":"\uff5e","\u00a2":"\uffe0","\u00a3":"\uffe1","\u00a5":"\uffe5","\u00a6":"\uffe4","\u00ac":"\uffe2","\u00af":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c",
"\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};f.unicodeBlockLookup={"Latin-1 Supplement":function(d){return 128<=
d&&255>=d},Arabic:function(d){return 1536<=d&&1791>=d},"Arabic Supplement":function(d){return 1872<=d&&1919>=d},"Arabic Extended-A":function(d){return 2208<=d&&2303>=d},"Hangul Jamo":function(d){return 4352<=d&&4607>=d},"Unified Canadian Aboriginal Syllabics":function(d){return 5120<=d&&5759>=d},Khmer:function(d){return 6016<=d&&6143>=d},"Unified Canadian Aboriginal Syllabics Extended":function(d){return 6320<=d&&6399>=d},"General Punctuation":function(d){return 8192<=d&&8303>=d},"Letterlike Symbols":function(d){return 8448<=
d&&8527>=d},"Number Forms":function(d){return 8528<=d&&8591>=d},"Miscellaneous Technical":function(d){return 8960<=d&&9215>=d},"Control Pictures":function(d){return 9216<=d&&9279>=d},"Optical Character Recognition":function(d){return 9280<=d&&9311>=d},"Enclosed Alphanumerics":function(d){return 9312<=d&&9471>=d},"Geometric Shapes":function(d){return 9632<=d&&9727>=d},"Miscellaneous Symbols":function(d){return 9728<=d&&9983>=d},"Miscellaneous Symbols and Arrows":function(d){return 11008<=d&&11263>=
d},"CJK Radicals Supplement":function(d){return 11904<=d&&12031>=d},"Kangxi Radicals":function(d){return 12032<=d&&12255>=d},"Ideographic Description Characters":function(d){return 12272<=d&&12287>=d},"CJK Symbols and Punctuation":function(d){return 12288<=d&&12351>=d},Hiragana:function(d){return 12352<=d&&12447>=d},Katakana:function(d){return 12448<=d&&12543>=d},Bopomofo:function(d){return 12544<=d&&12591>=d},"Hangul Compatibility Jamo":function(d){return 12592<=d&&12687>=d},Kanbun:function(d){return 12688<=
d&&12703>=d},"Bopomofo Extended":function(d){return 12704<=d&&12735>=d},"CJK Strokes":function(d){return 12736<=d&&12783>=d},"Katakana Phonetic Extensions":function(d){return 12784<=d&&12799>=d},"Enclosed CJK Letters and Months":function(d){return 12800<=d&&13055>=d},"CJK Compatibility":function(d){return 13056<=d&&13311>=d},"CJK Unified Ideographs Extension A":function(d){return 13312<=d&&19903>=d},"Yijing Hexagram Symbols":function(d){return 19904<=d&&19967>=d},"CJK Unified Ideographs":function(d){return 19968<=
d&&40959>=d},"Yi Syllables":function(d){return 40960<=d&&42127>=d},"Yi Radicals":function(d){return 42128<=d&&42191>=d},"Hangul Jamo Extended-A":function(d){return 43360<=d&&43391>=d},"Hangul Syllables":function(d){return 44032<=d&&55215>=d},"Hangul Jamo Extended-B":function(d){return 55216<=d&&55295>=d},"Private Use Area":function(d){return 57344<=d&&63743>=d},"CJK Compatibility Ideographs":function(d){return 63744<=d&&64255>=d},"Arabic Presentation Forms-A":function(d){return 64336<=d&&65023>=d},
"Vertical Forms":function(d){return 65040<=d&&65055>=d},"CJK Compatibility Forms":function(d){return 65072<=d&&65103>=d},"Small Form Variants":function(d){return 65104<=d&&65135>=d},"Arabic Presentation Forms-B":function(d){return 65136<=d&&65279>=d},"Halfwidth and Fullwidth Forms":function(d){return 65280<=d&&65519>=d}}})},"com/huayun/webgis/renderer/PointRenderer":function(){define(["./Renderer","../gl/mode","../data/bucket/CircleBucketSimplify","../geometry/Point","../gl/programCache"],function(f,
d,m,h,c){function a(){}f&&(a.__proto__=f);a.prototype=Object.create(f&&f.prototype);a.prototype.constructor=a;a.prototype.add=function(a,c,e,b){b=new m;var d=c.position||a.viewpoint.center||[0,0],g=d[0],d=d[1];if("multipoint"===e.type){for(var f=[],l=0;l<e.points.length;l++)f.push(new h(e.points[l].x-g,e.points[l].y-d,0));b.addFeature([f])}else"point"===e.type&&b.addFeature([[new h(e.x-g,e.y-d,0)]]);b.upload(a.context);c.buckets.push(b);c.position=[g,d]};a.prototype.draw=function(a,f,e,b,k,n,h){void 0===
n&&(n=0);e=a.context;var g=e.gl;k=k?k.depthModeForSublayer(0,d.DepthMode.ReadWrite):new d.DepthMode(g.LEQUAL,d.DepthMode.ReadWrite,[.9,.9]);var l=d.StencilMode.disabled,m=d.ColorMode.alphaBlended,p=c.useProgramSimplify(e,"circle",{layoutAttributes:[{name:"a_pos",type:"Float32",components:2,offset:0},{name:"a_data",type:"Int16",components:2,offset:8}]}),z=b.uniforms,v=f.position,y=this.getRealScale(b.fixed,a.scale,b.minScale),x=void 0,w=a.resolution;b.markerSize?(y*=f.markerScaleFactor||1,x=b.markerSize/
b.radius,y*=x):f.symbol.size&&void 0===f.symbol.tempW?(f.scaleFactor=f.scaleFactor||1,y*=f.scaleFactor,x=f.symbol.size/b.radius,f.symbol.tempW=x,y*=x):f.symbol.size&&void 0!==f.symbol.tempW?y*=f.symbol.tempW:(f.scaleFactor=f.scaleFactor||1,y*=f.scaleFactor);h||(z.radius=b.radius*y);z.u_radian=f.rotation?b.angle+f.rotation:b.angle;void 0===z.u_radian&&(z.u_radian=0);var x=b.dx*y*w,w=b.dy*y*w,A=Math.sin(z.u_radian),B=Math.cos(z.u_radian);h=x*B-w*A;x=w*B+x*A;z.u_matrix=a.viewpoint.getMatrixForPoint(v[0]+
h,v[1]+x);v=b.strokeWidth*y;z.stroke_width=1>v?1:v;z.u_camera_to_center_distance=a.viewpoint.cameraToCenterDistance;z.u_extrude_scale=a.viewpoint.pixelsToGLUnits;f["_circleOffset"+n]={dx:h,dy:x,size:b.uniforms.radius+b.uniforms.stroke_width};z.color=b.color;z.stroke_color=b.strokeColor;a=f.buckets[n];p.draw(e,g.TRIANGLES,k,l,m,d.CullFaceMode.disabled,z,f.id+"-circle"+n,a.layoutVertexBuffer,a.indexBuffer,a.segments,null)};a.prototype.drawGlow=function(a,f,e,b,k,n,h){var g=f.glow;if(g){void 0===n&&
(n=0);e=a.context;var l=e.gl;k=k?k.depthModeForSublayer(0,d.DepthMode.ReadOnly):new d.DepthMode(l.LEQUAL,d.DepthMode.ReadOnly,[.9,.9]);var m=d.StencilMode.disabled,p=d.ColorMode.alphaBlended,z=c.useProgramSimplify(e,"circle",{layoutAttributes:[{name:"a_pos",type:"Float32",components:2,offset:0},{name:"a_data",type:"Int16",components:2,offset:8}]}),v=b.uniforms,y=f.position,x=this.getRealScale(b.fixed,a.scale,b.minScale),w=1,A=a.resolution;b.markerSize?(x*=f.markerScaleFactor,w=b.markerSize/b.radius,
x*=w):f.symbol.size?(f.scaleFactor=f.scaleFactor||1,x*=f.scaleFactor,w=f.symbol.size/b.radius,x*=w):(f.scaleFactor=f.scaleFactor||1,x*=f.scaleFactor);h||(v.radius=b.radius*x);v.u_radian=f.rotation?b.angle+f.rotation:b.angle;h=b.dx*x*A;var A=b.dy*x*A,w=Math.sin(v.u_radian),B=Math.cos(v.u_radian);v.u_matrix=a.viewpoint.getMatrixForPoint(y[0]+(h*B-A*w),y[1]+(A*B+h*w));b=b.strokeWidth*x;v.stroke_width=1>b?1:b;v.u_camera_to_center_distance=a.viewpoint.cameraToCenterDistance;v.u_extrude_scale=a.viewpoint.pixelsToGLUnits;
a=g.color;v.color=a;v.stroke_color=a;a=f.buckets[n];z.draw(e,l.TRIANGLES,k,m,p,d.CullFaceMode.disabled,v,f.id+"-circle"+n,a.layoutVertexBuffer,a.indexBuffer,a.segments,null)}};a.prototype.calculateExtent=function(a,c,e,b,d,f){f||(f=0);a=a.resolution;f=c["_circleOffset"+f];b=f.size;var g=e.x;e=e.y;var k=f.dy,g=g+f.dx;e+=k;d.push({id:c.id,g:c,minX:g-b*a,minY:e-b*a,maxX:g+b*a,maxY:e+b*a})};return a})},"com/huayun/webgis/layers/support/expression/Var":function(){define([],function(){var f=function(d,
f){this.type=f.type;this.name=d;this.boundExpression=f};f.parse=function(d,m){if(2!==d.length||"string"!==typeof d[1])return m.error("'var' expression requires exactly one string literal argument.");d=d[1];return m.scope.has(d)?new f(d,m.scope.get(d)):m.error('Unknown variable "'+d+'". Make sure "'+d+'" has been bound in an enclosing "let" expression before using it.',1)};f.prototype.evaluate=function(d){return this.boundExpression.evaluate(d)};f.prototype.eachChild=function(){};f.prototype.possibleOutputs=
function(){return[void 0]};f.prototype.serialize=function(){return["var",this.name]};return f})},"dojo/Deferred":function(){define(["./has","./_base/lang","./errors/CancelError","./promise/Promise","./promise/instrumentation"],function(f,d,m,h,c){var a=Object.freeze||function(){},g=function(a,b,e,c,d){2===b&&k.instrumentRejected&&0===a.length&&k.instrumentRejected(e,!1,c,d);for(d=0;d<a.length;d++)l(a[d],b,e,c)},l=function(a,c,d,g){var f=a[c],n=a.deferred;if(f)try{var l=f(d);if(0===c)"undefined"!==
typeof l&&b(n,c,l);else{if(l&&"function"===typeof l.then){a.cancel=l.cancel;l.then(e(n,1),e(n,2),e(n,0));return}b(n,1,l)}}catch(v){b(n,2,v)}else b(n,c,d);2===c&&k.instrumentRejected&&k.instrumentRejected(d,!!f,g,n.promise)},e=function(a,e){return function(c){b(a,e,c)}},b=function(a,b,e){if(!a.isCanceled())switch(b){case 0:a.progress(e);break;case 1:a.resolve(e);break;case 2:a.reject(e)}},k=function(b){var e=this.promise=new h,c=this,d,f,n,z=!1,v=[];Error.captureStackTrace&&(Error.captureStackTrace(c,
k),Error.captureStackTrace(e,k));this.isResolved=e.isResolved=function(){return 1===d};this.isRejected=e.isRejected=function(){return 2===d};this.isFulfilled=e.isFulfilled=function(){return!!d};this.isCanceled=e.isCanceled=function(){return z};this.progress=function(a,b){if(d){if(!0===b)throw Error("This deferred has already been fulfilled.");return e}g(v,0,a,null,c);return e};this.resolve=function(a,b){if(d){if(!0===b)throw Error("This deferred has already been fulfilled.");return e}g(v,d=1,f=a,
null,c);v=null;return e};var y=this.reject=function(a,b){if(d){if(!0===b)throw Error("This deferred has already been fulfilled.");return e}Error.captureStackTrace&&Error.captureStackTrace(n={},y);g(v,d=2,f=a,n,c);v=null;return e};this.then=e.then=function(a,b,c){var g=[c,a,b];g.cancel=e.cancel;g.deferred=new k(function(a){return g.cancel&&g.cancel(a)});d&&!v?l(g,d,f,n):v.push(g);return g.deferred.promise};this.cancel=e.cancel=function(a,e){if(!d){b&&(e=b(a),a="undefined"===typeof e?a:e);z=!0;if(!d)return"undefined"===
typeof a&&(a=new m),y(a),a;if(2===d&&f===a)return a}else if(!0===e)throw Error("This deferred has already been fulfilled.");};a(e)};k.prototype.toString=function(){return"[object Deferred]"};c&&c(k);return k})},"com/huayun/webgis/geometry/Polyline":function(){define(["./Geometry","./Extent"],function(f,d){var m=function(c,a){f.call(this);this.type="line";this.path=c;this.spatialReference=a;this._extent=null};f&&(m.__proto__=f);m.prototype=Object.create(f&&f.prototype);m.prototype.constructor=m;var h=
{length:{configurable:!1},extent:{configurable:!1}};h.length.get=function(){return this.path.length};h.extent.get=function(){if(!this._extent){var c=this.path,a,g,f,e;a=f=c[0][0].x;g=e=c[0][0].y;for(var b=c.length,k=0;k<b;k++)for(var n=c[k],h=n.length,m=0;m<h;m++){var r=n[m];a=Math.min(a,r.x);g=Math.min(g,r.y);f=Math.max(f,r.x);e=Math.max(e,r.y)}this._extent=new d(a,g,f,e)}return this._extent};m.prototype={setPath:function(c){this.path=c;this._extent=null},addPath:function(c){this.path.push(c);this._extent=
null},update:function(c,a){this.path.forEach(function(d){d.forEach(function(d){d.update(c,a)})});this._extent=null}};Object.defineProperties(m.prototype,h);return m})},"dojo/_base/connect":function(){define("./kernel ../on ../topic ../aspect ./event ../mouse ./sniff ./lang ../keys".split(" "),function(f,d,m,h,c,a,g,l){function e(b,e,c,g,k){g=l.hitch(c,g);if(!b||!b.addEventListener&&!b.attachEvent)return h.after(b||f.global,e,g,!0);"string"==typeof e&&"on"==e.substring(0,2)&&(e=e.substring(2));b||
(b=f.global);if(!k)switch(e){case "keypress":e=t;break;case "mouseenter":e=a.enter;break;case "mouseleave":e=a.leave}return d(b,e,g,k)}function b(a){a.keyChar=a.charCode?String.fromCharCode(a.charCode):"";a.charOrCode=a.keyChar||a.keyCode}g.add("events-keypress-typed",function(){var a={charCode:0};try{a=document.createEvent("KeyboardEvent"),(a.initKeyboardEvent||a.initKeyEvent).call(a,"keypress",!0,!0,null,!1,!1,!1,!1,9,3)}catch(u){}return 0==a.charCode&&!g("opera")});var k={106:42,111:47,186:59,
187:43,188:44,189:45,190:46,191:47,192:96,219:91,220:92,221:93,222:39,229:113},n=g("mac")?"metaKey":"ctrlKey",p=function(a,e){e=l.mixin({},a,e);b(e);e.preventDefault=function(){a.preventDefault()};e.stopPropagation=function(){a.stopPropagation()};return e},t;t=g("events-keypress-typed")?function(a,b){var e=d(a,"keydown",function(a){var e=a.keyCode,c=13!=e&&32!=e&&(27!=e||!g("ie"))&&(48>e||90<e)&&(96>e||111<e)&&(186>e||192<e)&&(219>e||222<e)&&229!=e;if(c||a.ctrlKey){c=c?0:e;if(a.ctrlKey){if(3==e||
13==e)return b.call(a.currentTarget,a);c=95<c&&106>c?c-48:!a.shiftKey&&65<=c&&90>=c?c+32:k[c]||c}e=p(a,{type:"keypress",faux:!0,charCode:c});b.call(a.currentTarget,e);if(g("ie"))try{a.keyCode=e.keyCode}catch(A){}}}),c=d(a,"keypress",function(a){var e=a.charCode;a=p(a,{charCode:32<=e?e:0,faux:!0});return b.call(this,a)});return{remove:function(){e.remove();c.remove()}}}:g("opera")?function(a,b){return d(a,"keypress",function(a){var e=a.which;3==e&&(e=99);e=32>e&&!a.shiftKey?0:e;a.ctrlKey&&!a.shiftKey&&
65<=e&&90>=e&&(e+=32);return b.call(this,p(a,{charCode:e}))})}:function(a,e){return d(a,"keypress",function(a){b(a);return e.call(this,a)})};var r={_keypress:t,connect:function(a,b,c,d,g){var k=arguments,f=[],n=0;f.push("string"==typeof k[0]?null:k[n++],k[n++]);var l=k[n+1];f.push("string"==typeof l||"function"==typeof l?k[n++]:null,k[n++]);for(l=k.length;n<l;n++)f.push(k[n]);return e.apply(this,f)},disconnect:function(a){a&&a.remove()},subscribe:function(a,b,e){return m.subscribe(a,l.hitch(b,e))},
publish:function(a,b){return m.publish.apply(m,[a].concat(b))},connectPublisher:function(a,b,e){var c=function(){r.publish(a,arguments)};return e?r.connect(b,e,c):r.connect(b,c)},isCopyKey:function(a){return a[n]}};r.unsubscribe=r.disconnect;l.mixin(f,r);return r})},"com/huayun/webgis/utils/colorSpaces":function(){define(["./utils","./Color"],function(f,d){function m(a){return a>n?Math.pow(a,1/3):a/k+e}function h(a){return a>b?a*a*a:k*(a-e)}function c(a){return 255*(.0031308>=a?12.92*a:1.055*Math.pow(a,
1/2.4)-.055)}function a(a){a/=255;return.04045>=a?a/12.92:Math.pow((a+.055)/1.055,2.4)}function g(b){var e=a(b.r),c=a(b.g),d=a(b.b),g=m((.4124564*e+.3575761*c+.1804375*d)/.95047),k=m((.2126729*e+.7151522*c+.072175*d)/1),e=m((.0193339*e+.119192*c+.9503041*d)/1.08883);return{l:116*k-16,a:500*(g-k),b:200*(k-e),alpha:b.a}}function l(a){var b=(a.l+16)/116,e=isNaN(a.a)?b:b+a.a/500,g=isNaN(a.b)?b:b-a.b/200,b=1*h(b),e=.95047*h(e),g=1.08883*h(g);return new d(c(3.2404542*e-1.5371385*b-.4985314*g),c(-.969266*
e+1.8760108*b+.041556*g),c(.0556434*e-.2040259*b+1.0572252*g),a.alpha)}var e=4/29,b=6/29,k=3*b*b,n=b*b*b,p=Math.PI/180,t=180/Math.PI;return Object.freeze({lab:{forward:g,reverse:l,interpolate:function(a,b,e){return{l:f.number(a.l,b.l,e),a:f.number(a.a,b.a,e),b:f.number(a.b,b.b,e),alpha:f.number(a.alpha,b.alpha,e)}}},hcl:{forward:function(a){var b=g(a),e=b.a,c=b.b,d=Math.atan2(c,e)*t;return{h:0>d?d+360:d,c:Math.sqrt(e*e+c*c),l:b.l,alpha:a.a}},reverse:function(a){var b=a.h*p,e=a.c;return l({l:a.l,a:Math.cos(b)*
e,b:Math.sin(b)*e,alpha:a.alpha})},interpolate:function(a,b,e){var c=a.h,d=b.h-c;return{h:c+e*(180<d||-180>d?d-360*Math.round(d/360):d),c:f.number(a.c,b.c,e),l:f.number(a.l,b.l,e),alpha:f.number(a.alpha,b.alpha,e)}}}})})},"com/huayun/gl/shaders/mesh":function(){define(["exports","../../webgis/data/uniform"],function(f,d){f.meshVS="precision highp float;\nattribute vec3 position;\nuniform mat4 u_matrix;\nuniform mat4 u_model;\nvoid main() {\n    gl_Position \x3d u_matrix * u_model * vec4(position, 1.0);\n}";
f.meshFS="precision mediump float;\nuniform vec3 u_color;\nvoid main() {\n    gl_FragColor \x3d vec4(1.0, 1.0, 1.0, 1.0);\n}";f.meshUniforms=function(f,h){return{u_matrix:new d.UniformMatrix4f(f,h.u_matrix),u_model:new d.UniformMatrix4f(f,h.u_model),u_color:new d.Uniform3f(f,h.u_color)}}})},"dojo/dom-attr":function(){define("exports ./sniff ./_base/lang ./dom ./dom-style ./dom-prop".split(" "),function(f,d,m,h,c,a){function g(a,e){a=a.getAttributeNode&&a.getAttributeNode(e);return!!a&&a.specified}
var l={innerHTML:1,textContent:1,className:1,htmlFor:d("ie")?1:0,value:1},e={classname:"class",htmlfor:"for",tabindex:"tabIndex",readonly:"readOnly"};f.has=function(b,c){var d=c.toLowerCase();return!!l[a.names[d]||c]||g(h.byId(b),e[d]||c)};f.get=function(b,c){b=h.byId(b);var d=c.toLowerCase(),k=a.names[d]||c,f=b[k];if(l[k]&&"undefined"!=typeof f)return f;if("textContent"==k)return a.get(b,k);if("href"!=k&&("boolean"==typeof f||m.isFunction(f)))return f;c=e[d]||c;return g(b,c)?b.getAttribute(c):null};
f.set=function(b,d,g){b=h.byId(b);if(2==arguments.length){for(var k in d)f.set(b,k,d[k]);return b}k=d.toLowerCase();var n=a.names[k]||d,r=l[n];if("style"==n&&"string"!=typeof g)return c.set(b,g),b;if(r||"boolean"==typeof g||m.isFunction(g))return a.set(b,d,g);b.setAttribute(e[k]||d,g);return b};f.remove=function(a,c){h.byId(a).removeAttribute(e[c.toLowerCase()]||c)};f.getNodeProp=function(b,c){b=h.byId(b);var d=c.toLowerCase(),k=a.names[d]||c;if(k in b&&"href"!=k)return b[k];c=e[d]||c;return g(b,
c)?b.getAttribute(c):null}})},"dojo/io-query":function(){define(["./_base/lang"],function(f){var d={};return{objectToQuery:function(m){var h=encodeURIComponent,c=[],a;for(a in m){var g=m[a];if(g!=d[a]){var l=h(a)+"\x3d";if(f.isArray(g))for(var e=0,b=g.length;e<b;++e)c.push(l+h(g[e]));else c.push(l+h(g))}}return c.join("\x26")},queryToObject:function(d){var h=decodeURIComponent;d=d.split("\x26");for(var c={},a,g,l=0,e=d.length;l<e;++l)if(g=d[l],g.length){var b=g.indexOf("\x3d");0>b?(a=h(g),g=""):(a=
h(g.slice(0,b)),g=h(g.slice(b+1)));"string"==typeof c[a]&&(c[a]=[c[a]]);f.isArray(c[a])?c[a].push(g):c[a]=g}return c}}})},"com/huayun/webgis/layers/support/tileCover":function(){define(["./OverscaledTileID"],function(f){function d(c,a){if(c.y>a.y){var d=c;c=a;a=d}return{x0:c.x,y0:c.y,x1:a.x,y1:a.y,dx:a.x-c.x,dy:a.y-c.y}}function m(c,a,d,f,e){d=Math.max(d,Math.floor(a.y0));f=Math.min(f,Math.ceil(a.y1));if(c.x0===a.x0&&c.y0===a.y0?c.x0+a.dy/c.dy*c.dx<a.x1:c.x1-a.dy/c.dy*c.dx<a.x0){var b=c;c=a;a=b}for(var b=
c.dx/c.dy,g=a.dx/a.dy,n=0<c.dx,l=0>a.dx;d<f;d++)e(Math.floor(g*Math.max(0,Math.min(a.dy,d+l-a.y0))+a.x0),Math.ceil(b*Math.max(0,Math.min(c.dy,d+n-c.y0))+c.x0),d)}function h(c,a,g,f,e,b){var k=d(c,a);a=d(a,g);c=d(g,c);k.dy>a.dy&&(g=k,k=a,a=g);k.dy>c.dy&&(g=k,k=c,c=g);a.dy>c.dy&&(g=a,a=c,c=g);k.dy&&m(c,k,f,e,b);a.dy&&m(c,a,f,e,b)}return function(c,a,d){function g(a,d,g){for(var b,k;a<d;a++)b=Math.floor(a),k=new f(c,0,c,b,g),e[c+"/"+b+"/"+g]=k}var e={};h(a[0],a[1],a[2],0,Infinity,g);h(a[2],a[3],a[0],
0,Infinity,g);return Object.keys(e).map(function(a){return e[a]})}})},"com/huayun/webgis/layers/support/TileCache":function(){define([],function(){var f=function(d,f){this.max=d;this.onRemove=f;this.reset()};f.prototype.reset=function(){for(var d in this.data)for(var f=0,h=this.data[d];f<h.length;f+=1){var c=h[f];c.timeout&&clearTimeout(c.timeout);this.onRemove(c.value)}this.data={};this.order=[];return this};f.prototype.add=function(d,f,h){var c=this,a=d.wrapped().key;void 0===this.data[a]&&(this.data[a]=
[]);var g={value:f,timeout:void 0};void 0!==h&&(g.timeout=setTimeout(function(){c.remove(d,g)},h));this.data[a].push(g);this.order.push(a);if(this.order.length>this.max&&(f=this._getAndRemoveByKey(this.order[0])))this.onRemove(f);return this};f.prototype.has=function(d){return d.wrapped().key in this.data};f.prototype.getAndRemove=function(d){return this.has(d)?this._getAndRemoveByKey(d.wrapped().key):null};f.prototype._getAndRemoveByKey=function(d){var f=this.data[d].shift();f.timeout&&clearTimeout(f.timeout);
0===this.data[d].length&&delete this.data[d];this.order.splice(this.order.indexOf(d),1);return f.value};f.prototype.get=function(d){return this.has(d)?this.data[d.wrapped().key][0].value:null};f.prototype.remove=function(d,f){if(!this.has(d))return this;d=d.wrapped().key;f=void 0===f?0:this.data[d].indexOf(f);var h=this.data[d][f];this.data[d].splice(f,1);h.timeout&&clearTimeout(h.timeout);0===this.data[d].length&&delete this.data[d];this.onRemove(h.value);this.order.splice(this.order.indexOf(d),
1);return this};f.prototype.setMaxSize=function(d){for(this.max=d;this.order.length>this.max;)if(d=this._getAndRemoveByKey(this.order[0]))this.onRemove(d);return this};return f})},"com/huayun/webgis/symbols/PointSymbol":function(){define(["./Symbol","../utils/Color"],function(f,d){var m=function(h){f.call(this,h);this.type="point";var c=d.parse(h.color||"#FF0000"),a=void 0===h.opacity?1:h.opacity,g=h.radius||5,l=d.parse(h.strokeColor||"#FFFFFF"),e=h.strokeWidth||0,b=h.strokeOpacity||1;this.color=
[c.r,c.g,c.b,c.a];this.strokeColor=[l.r,l.g,l.b,l.a];this.opacity=a;this.radius=g;this.strokeWidth=e;this.radian=0;this.pitchWithMap=!!h.pitchWithMap;this.scaleWithPitch=!!h.scaleWithPitch;this.uniforms={color:this.color,opacity:a,u_device_pixel_ratio:1,u_pitch_with_map:this.pitchWithMap,u_scale_with_map:this.scaleWithPitch,blur:0,radius:g,stroke_color:this.strokeColor,stroke_width:e,stroke_opacity:b,u_radian:0}};f&&(m.__proto__=f);m.prototype=Object.create(f&&f.prototype);return m.prototype.constructor=
m})},"com/huayun/webgis/layers/support/TileSourceCache":function(){define("./RasterTileSource ./tileCover ./Tile ./funcUtils ./TileCache ./SourceFeatureState com/huayun/webgis/geometry/Point2D ../../utils/utils".split(" "),function(f,d,m,h,c,a,g,l){function e(a,e,d,g,f,l,h){this.id=a;this._source=new b[e.type](a,e,f,l,h);this._tiles={};this._cache=new c(0,this._unloadTile.bind(this));this._timers={};this._cacheTimers={};this._maxTileCacheSize=null;this._coveredTiles={};this.layer=l;this.view=l.layerView.view;
this.updateCacheSize(d,g)}var b={raster:f};e.prototype.updateTileSize=function(a){this._source.setSize(a)};e.prototype.onRemove=function(a){if(this._source&&this._source.onRemove)this._source.onRemove(a)};e.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;for(var a in this._tiles){var b=this._tiles[a];if("loaded"!==b.state&&"errored"!==b.state)return!1}return!0};e.prototype.getSource=function(){return this._source};e.prototype.pause=function(){this._paused=
!0};e.prototype.resume=function(){if(this._paused){var a=this._shouldReloadOnResume;this._shouldReloadOnResume=this._paused=!1;a&&this.reload();this.transform&&this.update(this.transform)}};e.prototype._loadTile=function(a,b){return this._source.loadTile(a,b)};e.prototype._unloadTile=function(a){if(this._source.unloadTile)return this._source.unloadTile(a,function(){})};e.prototype._abortTile=function(a){if(this._source.abortTile)return this._source.abortTile(a,function(){})};e.prototype.serialize=
function(){return this._source.serialize()};e.prototype.getIds=function(){var a=[],b;for(b in this._tiles)a.push(this._tiles[b].tileID);return a};e.prototype.getRenderableIds=function(){var a=[],b;for(b in this._tiles)this._isIdRenderable(b)&&a.push(b);return a.sort(l.compareKeyZoom)};e.prototype.hasRenderableParent=function(a){return(a=this.findLoadedParent(a,0))?this._isIdRenderable(a.tileID.key):!1};e.prototype._isIdRenderable=function(a){return this._tiles[a]&&this._tiles[a].hasData()&&!this._coveredTiles[a]&&
!this._tiles[a].holdingForFade()};e.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(var a in this._tiles)"errored"!==this._tiles[a].state&&this._reloadTile(a,"reloading")}};e.prototype._reloadTile=function(a,b){var e=this._tiles[a];e&&("loading"!==e.state&&(e.state=b),this._loadTile(e,this._tileLoaded.bind(this,e,a,b)))};e.prototype.updateTileUrl=function(a){this._source.updateTileUrl(a)};e.prototype._tileLoaded=function(a,b,e,c){c?(a.state="errored",
404===c.status&&this.update(this.transform)):(a.timeAdded=l.now(),this._setTileReloadTimer(b,a),this.layer.layerView._sourcesDirty=!0,this.view.threeRender())};e.prototype.getTile=function(a){return this.getTileByID(a.key)};e.prototype.getTileByID=function(a){return this._tiles[a]};e.prototype.getZoom=function(a){return a.level+a.scaleZoom(a.tileSize/this._source.tileSize)};e.prototype._retainLoadedChildren=function(a,b,e,c){for(var d in this._tiles){var g=this._tiles[d];if(!(c[d]||!g.hasData()||
g.tileID.overscaledZ<=b||g.tileID.overscaledZ>e)){for(var k=g.tileID;g&&g.tileID.overscaledZ>b+1;){var f=g.tileID.scaledTo(g.tileID.overscaledZ-1);(g=this._tiles[f.key])&&g.hasData()&&(k=f)}for(g=k;g.overscaledZ>b;)if(g=g.scaledTo(g.overscaledZ-1),a[g.key]){c[k.key]=k;break}}}};e.prototype.findLoadedParent=function(a,b){for(var e=a.overscaledZ-1;e>=b;e--){var c=a.scaledTo(e);if(!c)break;var d=this._tiles[String(c.key)];if(d&&d.hasData())return d;if(this._cache.has(c))return this._cache.get(c)}};e.prototype.updateCacheSize=
function(a,b){a=Math.floor((Math.ceil(a/this._source.tileSize)+1)*(Math.ceil(b/this._source.tileSize)+1)*3);this._cache.setMaxSize("number"===typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,a):a)};e.prototype.update=function(a,b,e,c,g){this._coveredTiles={};b=d(a,b,e);b=b.sort(function(a,b){a=a.canonical;b=b.canonical;return Math.sqrt((c-a.x)*(c-a.x)+(g-a.y)*(g-a.y))-Math.sqrt((c-b.x)*(c-b.x)+(g-b.y)*(g-b.y))});a=this._updateRetainedTiles(b,a);for(var f in a)this._tiles[f].clearFadeHold();
f=0;for(a=l.keysDifference(this._tiles,a);f<a.length;f+=1)this._removeTile(a[f])};e.prototype.updateTile=function(a,b,e,c,g){this._coveredTiles={};b=d(a,b,e);b=b.sort(function(a,b){a=a.canonical;b=b.canonical;return Math.sqrt((c-a.x)*(c-a.x)+(g-a.y)*(g-a.y))-Math.sqrt((c-b.x)*(c-b.x)+(g-b.y)*(g-b.y))});this._updateRetainedTiles(b,a);return b};e.prototype.releaseSymbolFadeTiles=function(){for(var a in this._tiles)this._tiles[a].holdingForFade()&&this._removeTile(a)};e.prototype._updateRetainedTiles=
function(a,b){for(var c={},d={},g=Math.max(b-e.maxOverzooming,this._source.minzoom),f=Math.max(b+e.maxUnderzooming,this._source.minzoom),k={},n=0;n<a.length;n+=1){var l=a[n],h=this._addTile(l);c[l.key]=l;h.hasData()||b<this._source.maxzoom&&(k[l.key]=l)}this._retainLoadedChildren(k,b,f,c);for(f=0;f<a.length;f+=1)if(k=a[f],n=this._tiles[k.key],!n.hasData()){if(b+1>this._source.maxzoom){if(l=k.children(this._source.maxzoom)[0],(h=this.getTile(l))&&h.hasData()){c[l.key]=l;continue}}else if(l=k.children(this._source.maxzoom),
c[l[0].key]&&c[l[1].key]&&c[l[2].key]&&c[l[3].key])continue;l=n.wasRequested();for(h=k.overscaledZ-1;h>=g;--h){var m=k.scaledTo(h);if(d[m.key])break;d[m.key]=!0;n=this.getTile(m);!n&&l&&(n=this._addTile(m));if(n&&(c[m.key]=m,l=n.wasRequested(),n.hasData()))break}}return c};e.prototype._reAddTile=function(a){var b=new m(a,this._source.tileSize*a.overscaleFactor());this._loadTile(b,this._tileReAddLoaded.bind(this,b,a.key,b.state))};e.prototype._tileReAddLoaded=function(a,b,e,c){this._removeTile(b);
this._tiles[a.tileID.key]=a;c?(a.state="errored",404===c.status&&this.update(this.transform)):(a.timeAdded=l.now(),this._setTileReloadTimer(b,a),this.layer.layerView._sourcesDirty=!0,this.view.threeRender())};e.prototype._addTile=function(a){var b=this._tiles[a.key];if(b)return b;if(b=this._cache.getAndRemove(a))this._setTileReloadTimer(a.key,b),b.tileID=a,this._cacheTimers[a.key]&&(clearTimeout(this._cacheTimers[a.key]),delete this._cacheTimers[a.key],this._setTileReloadTimer(a.key,b));b||(b=new m(a,
this._source.tileSize*a.overscaleFactor()),this._loadTile(b,this._tileLoaded.bind(this,b,a.key,b.state)));if(!b)return null;b.uses++;return this._tiles[a.key]=b};e.prototype._setTileReloadTimer=function(a,b){var e=this;a in this._timers&&(clearTimeout(this._timers[a]),delete this._timers[a]);(b=b.getExpiryTimeout())&&(this._timers[a]=setTimeout(function(){e._reloadTile(a,"expired");delete e._timers[a]},b))};e.prototype._removeTile=function(a){var b=this._tiles[a];b&&(b.uses--,delete this._tiles[a],
this._timers[a]&&(clearTimeout(this._timers[a]),delete this._timers[a]),0<b.uses||b.hasData()||(b.aborted=!0,this._abortTile(b),this._unloadTile(b)))};e.prototype.clearTiles=function(){this._paused=this._shouldReloadOnResume=!1;for(var a in this._tiles)this._removeTile(a);this._cache.reset()};e.prototype.clearOtherLevel=function(a){this._paused=this._shouldReloadOnResume=!1;for(var b in this._tiles)this._tiles[b].tileID.canonical.z!==a&&this._removeTile(b)};e.prototype.tilesIn=function(a,b,e){var c=
this,d=[],g=this.transform;if(!g)return d;e=e?g.getCameraQueryGeometry(a):a;var f=a.map(function(a){return g.pointCoordinate(a)}),k=e.map(function(a){return g.pointCoordinate(a)}),l=this.getIds(),n=Infinity,h=Infinity,m=-Infinity,p=-Infinity;for(a=0;a<k.length;a+=1)e=k[a],n=Math.min(n,e.x),h=Math.min(h,e.y),m=Math.max(m,e.x),p=Math.max(p,e.y);a=function(a){a=c._tiles[l[a]];if(!a.holdingForFade()){var e=a.tileID,q=Math.pow(2,g.level-a.tileID.overscaledZ),r=b*a.queryPadding*__chunk_1.EXTENT/a.tileSize/
q,t=[e.getTilePoint(new __chunk_1.MercatorCoordinate(n,h)),e.getTilePoint(new __chunk_1.MercatorCoordinate(m,p))];t[0].x-r<__chunk_1.EXTENT&&t[0].y-r<__chunk_1.EXTENT&&0<=t[1].x+r&&0<=t[1].y+r&&(r=f.map(function(a){return e.getTilePoint(a)}),t=k.map(function(a){return e.getTilePoint(a)}),d.push({tile:a,tileID:e,queryGeometry:r,cameraQueryGeometry:t,scale:q}))}};for(e=0;e<l.length;e++)a(e);return d};e.prototype.getVisibleCoordinates=function(a,b){var e=this;a=this.getRenderableIds().map(function(a){return e._tiles[a].tileID});
this.currentCoords=[];for(var c=0;c<a.length;c+=1){var d=a[c],g=d.toUnwrapped();d.geometry||(d.geometry=this.layer.tileInfo.getGeometry(g));d.posMatrix=b.calculatePosMatrix(g,d.geometry,!0);this.currentCoords.push(d)}return a};e.prototype.updateTileMatrix=function(a,b){a=this.currentCoords;for(var e=0;e<a.length;e+=1){var c=a[e];c.posMatrix=b.updatePosMatrix(c.toUnwrapped(),c.geometry,!0)}return a};e.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;for(var a in this._tiles){var b=
this._tiles[a];if(void 0!==b.fadeEndTime&&b.fadeEndTime>=l.now())return!0}return!1};e.maxOverzooming=10;e.maxUnderzooming=3;return e})},"com/huayun/webgis/gl/draw/drawRaster":function(){define("exports ../mode ../../geometry/Point ../Texture ../../utils/utils custom/gl-matrix-min".split(" "),function(f,d,m,h,c,a){return function(a,f,e,b){e=a.view.context;var g=e.gl;f.getSource();for(var l=a.view.useProgram("raster"),h=d.StencilMode.disabled,m=d.ColorMode.alphaBlended,r=b.length&&b[0].overscaledZ,
q=0;q<b.length;q+=1){var u=b[q],z=a.depthModeForSublayer(u.overscaledZ-r,d.DepthMode.ReadWrite,g.LESS),v=f.getTile(u),y=u.posMatrix;v.registerFadeDuration(300);var u=f.findLoadedParent(u,0),x;var w=v;x=u;var A=f,B=a.transform,E=c.now(),C=(E-w.timeAdded)/300,E=x?(E-x.timeAdded)/300:-1,A=A.getSource(),B=B.coveringZoomLevel({tileSize:A.tileSize,roundZoom:A.roundZoom}),w=(B=!x||Math.abs(x.tileID.overscaledZ-B)>Math.abs(w.tileID.overscaledZ-B))&&w.refreshedUponExpiration?1:c.clamp(B?C:1-E,0,1);x=x?{opacity:1,
mix:1-w}:{opacity:w,mix:0};1>x.opacity&&(a._fadeDirty=!0);C=w=void 0;E=g.LINEAR;e.activeTexture.set(g.TEXTURE0);v.texture.bind(E,g.CLAMP_TO_EDGE,g.LINEAR_MIPMAP_NEAREST);e.activeTexture.set(g.TEXTURE1);u?(u.texture.bind(E,g.CLAMP_TO_EDGE,g.LINEAR_MIPMAP_NEAREST),w=Math.pow(2,u.tileID.overscaledZ-v.tileID.overscaledZ),C=[v.tileID.canonical.x*w%1,v.tileID.canonical.y*w%1]):v.texture.bind(E,g.CLAMP_TO_EDGE,g.LINEAR_MIPMAP_NEAREST);l.draw2(e,g.TRIANGLES,z,h,m,d.CullFaceMode.disabled,{u_matrix:y,u_tl_parent:C||
[0,0],u_scale_parent:w||1,u_buffer_scale:1,u_fade_t:x.mix,u_opacity:x.opacity,u_image0:0,u_image1:1,u_brightness_low:0,u_brightness_high:1,u_saturation_factor:-0,u_contrast_factor:1,u_spin_weights:[1,0,0]},"tile",a.rasterBoundsBuffer,a.quadTriangleIndexBuffer,a.rasterBoundsSegments)}}})},"com/huayun/webgis/renderer/SimpleRenderer":function(){define("./FillRenderer ./LineRenderer ./CircleRenderer ./ImageRenderer ./PointRenderer ./RectRenderer ./TextRenderer".split(" "),function(f,d,m,h,c,a,g){function l(){this.lineRenderer=
new d;this.fillRenderer=new f;this.circleRenderer=new m;this.imageRenderer=new h;this.pointRenderer=new c;this.rectRenderer=new a;this.textRenderer=new g}l.prototype.add=function(a,b,c,d){switch(d.type){case "line":this.lineRenderer.add(a,b,c,d);break;case "polygon":this.fillRenderer.add(a,b,c,d);break;case "circle":this.circleRenderer.add(a,b,c,d);break;case "point":this.pointRenderer.add(a,b,c,d);break;case "rect":this.rectRenderer.add(a,b,c,d);break;case "text":this.textRenderer.add(a,b,c,d);break;
case "image":this.imageRenderer.add(a,b,c,d)}};l.prototype.draw=function(a,b,c,d,g,f){switch(d.type){case "line":this.lineRenderer.draw(a,b,c,d,g,f);break;case "polygon":this.fillRenderer.draw(a,b,c,d,g,f);break;case "circle":this.circleRenderer.draw(a,b,c,d,g,f);break;case "point":this.pointRenderer.draw(a,b,c,d,g,f);break;case "rect":this.rectRenderer.draw(a,b,c,d,g,f);break;case "text":this.textRenderer.draw(a,b,c,d,g,f);break;case "image":this.imageRenderer.draw(a,b,c,d,g,f)}};l.prototype.drawGlow=
function(a,b,c,d,g,f){switch(d.type){case "line":this.lineRenderer.drawGlow(a,b,c,d,g,f);break;case "polygon":this.fillRenderer.drawGlow(a,b,c,d,g,f);break;case "circle":this.circleRenderer.drawGlow(a,b,c,d,g,f);break;case "point":this.pointRenderer.drawGlow(a,b,c,d,g,f);break;case "rect":this.rectRenderer.drawGlow(a,b,c,d,g,f);break;case "text":this.textRenderer.drawGlow(a,b,c,d,g,f);break;case "image":this.imageRenderer.drawGlow(a,b,c,d,g,f)}};l.prototype.calculateExtent=function(a,b,c,d,g){switch(d.type){case "line":this.lineRenderer.calculateExtent(a,
b,c,d,g);break;case "polygon":this.fillRenderer.calculateExtent(a,b,c,d,g);break;case "circle":this.circleRenderer.calculateExtent(a,b,c,d,g);break;case "point":this.pointRenderer.calculateExtent(a,b,c,d,g);break;case "rect":this.rectRenderer.calculateExtent(a,b,c,d,g);break;case "text":this.textRenderer.calculateExtent(a,b,c,d,g);break;case "image":this.imageRenderer.calculateExtent(a,b,c,d,g)}};return l})},"com/huayun/webgis/utils/TaskQueue":function(){define([],function(){var f=function(){this._queue=
[];this._id=0;this._currentlyRunning=this._cleared=!1};f.prototype.add=function(d){var f=++this._id;this._queue.push({callback:d,id:f,cancelled:!1});return f};f.prototype.remove=function(d){for(var f=this._currentlyRunning,f=f?this._queue.concat(f):this._queue,h=0,c=f.length;h<c;h+=1){var a=f[h];if(a.id===d){a.cancelled=!0;break}}};f.prototype.run=function(d){var f=this._currentlyRunning=this._queue;this._queue=[];for(var h=0,c=f.length;h<c;h+=1){var a=f[h];if(!a.cancelled&&(a.callback(d),this._cleared))break}this._currentlyRunning=
this._cleared=!1};f.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0);this._queue=[]};return f})},"com/huayun/webgis/Map":function(){define(["./core/base","../core/EventEmitter","./utils/extendClazz","./layers/Layer"],function(f,d,m,h){function c(a){this.id=a&&a.id?a.id:"map";this.allLayers=[]}m(c,d);c.prototype.addLayer=function(a){if(!(a instanceof h))throw Error("\u6dfb\u52a0\u7684\u5fc5\u987b\u662f\u56fe\u5c42\u7c7b\u578b");for(var c=0,d=this.allLayers.length;c<d;c++)if(this.allLayers[c].id===
a.id)throw Error("\u56fe\u5c42id\u5fc5\u987b\u552f\u4e00.");this.allLayers.push(a);this.emit("addLayers",[a])};c.prototype.addLayers=function(a){for(var c=0,d=a.length;c<d;c++){var e=a[c];if(!(e instanceof h))throw Error("\u6dfb\u52a0\u7684\u5fc5\u987b\u662f\u56fe\u5c42\u7c7b\u578b");for(var b=0,f=this.allLayers.length;b<f;b++)if(this.allLayers[b].id===e.id)throw Error("\u56fe\u5c42id\u5fc5\u987b\u552f\u4e00.");this.allLayers.push(e)}this.emit("addLayers",a)};c.prototype.addLayerBefore=function(a,
c){if(!(a instanceof h))throw Error("\u6dfb\u52a0\u7684\u5fc5\u987b\u662f\u56fe\u5c42\u7c7b\u578b");for(var d=-1,e=this.allLayers.length-1;-1<e;e--){if(this.allLayers[e].id===a.id)throw Error("\u56fe\u5c42id\u5fc5\u987b\u552f\u4e00.");if(this.allLayers[e].id===c){d=e;break}}if(-1<d)this.allLayers.splice(d,0,a),this.emit("addLayers",[a],c,d);else throw Error("\u76ee\u6807layer\u4e0d\u5b58\u5728, \u65e0\u6cd5\u653e\u7f6e\u5230\u5b83\u4e4b\u524d!");};c.prototype.removeLayerById=function(a){for(var c=
this.allLayers.length-1;-1<c;c--)if(this.allLayers[c].id===a)return this.allLayers.splice(c,1),this.emit("removeLayers",[a]),!0;return!1};c.prototype.findAllLayers=function(){return this.allLayers};c.prototype.findLayerById=function(a){for(var c=this.allLayers.length-1;-1<c;c--)if(this.allLayers[c].id===a)return this.allLayers[c];return null};c.prototype.refresh=function(){};c.prototype.clear=function(){this.allLayers.forEach(function(a){a.clear()});this.allLayers=[]};return c})},"com/huayun/webgis/data/bucket/CircleBucketSimplify":function(){define(["../ArrayType",
"../../gl/SegmentVector"],function(f,d){var m=function(h){this.layoutVertexArray=new f.StructArrayLayout2f2ib12;this.indexArray=new f.StructArrayLayout3ui6;this.segments=new d};m.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy())};m.prototype.addFeature=function(d){for(var c=0;c<d.length;c+=1)for(var a=0,g=d[c];a<g.length;a+=1){var f=g[a],e=f.x,f=f.y,b=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),
k=b.vertexLength;this.layoutVertexArray.emplaceBack(e,f,-1,-1);this.layoutVertexArray.emplaceBack(e,f,1,-1);this.layoutVertexArray.emplaceBack(e,f,1,1);this.layoutVertexArray.emplaceBack(e,f,-1,1);this.indexArray.emplaceBack(k,k+1,k+2);this.indexArray.emplaceBack(k,k+3,k+2);b.vertexLength+=4;b.primitiveLength+=2}};m.prototype.upload=function(d){this.layoutVertexBuffer=d.createVertexBuffer(this.layoutVertexArray,[{name:"a_pos",type:"Float32",components:2,offset:0},{name:"a_data",type:"Int16",components:2,
offset:8}]);this.indexBuffer=d.createIndexBuffer(this.indexArray)};return m})},"com/huayun/webgis/layers/support/expression/Formatted":function(){define(["./FormattedSection"],function(f){var d=function(d){this.sections=d};d.fromString=function(m){return new d([new f(m,null,null)])};d.prototype.toString=function(){return this.sections.map(function(d){return d.text}).join("")};d.prototype.serialize=function(){for(var d=["format"],f=0,c=this.sections;f<c.length;f+=1){var a=c[f];d.push(a.text);var g=
{};a.fontStack&&(g["text-font"]=["literal",a.fontStack.split(",")]);a.scale&&(g["font-scale"]=a.scale);d.push(g)}return d};return d})},"com/huayun/webgis/views/layers/LayerView":function(){define([],function(){function f(d){this.id=d&&d.id?d.id:"layerView";this.layer=d.layer;this.view=d.view}f.prototype.refresh=function(){};return f})},"com/huayun/gl/shaders/cylinder":function(){define(["exports","../../webgis/data/uniform"],function(f,d){f.cylinderVS="attribute vec3 a_pos;\n\n#ifdef HAS_PATTERN\nattribute vec2 a_uv;\nvarying vec2 v_uv;\n#endif\n\nuniform mat4 u_matrix;\nuniform float u_size;\n\nvoid main() {\n    gl_Position \x3d u_matrix * vec4(u_size * a_pos.xy, a_pos.z, 1.0);\n    #ifdef HAS_PATTERN\n    v_uv \x3d a_uv;\n    #endif\n}";
f.cylinderFS="precision mediump float;\nuniform float u_opacity;\n\n#ifdef HAS_PATTERN\nvarying vec2 v_uv;\nuniform sampler2D u_texture;\n#else\nuniform vec4 u_color;\n#endif\n\nvoid main() {\n    #ifdef HAS_PATTERN\n    gl_FragColor \x3d texture2D(u_texture, v_uv) * u_opacity;\n    #else\n    gl_FragColor \x3d u_color * u_opacity;\n    #endif\n}";f.cylinderUniforms=function(f,h){return{u_matrix:new d.UniformMatrix4f(f,h.u_matrix),u_texture:new d.Uniform1i(f,h.u_texture),u_size:new d.Uniform1f(f,
h.u_size),u_opacity:new d.Uniform1f(f,h.u_opacity),u_color:new d.Uniform4f(f,h.u_color)}}})},"com/huayun/webgis/action/zooms/ZoomIn":function(){define(["dojo/_base/declare","../MapAction"],function(f,d){return f("com.huayun.webgis.action.zooms.ZoomIn",[d],{constructor:function(d){f.safeMixin(d);this.isActive=!1;this.view=d.view},doAction:function(){this.view.zoomIn()}})})},"com/huayun/webgis/layers/support/TileInfo":function(){define(["dojo/_base/declare","../../geometry/MapPoint","./LOD","../../geometry/Extent"],
function(f,d,m,h){return f("com.huayun.webgis.layers.support.TileInfo",[],{size:256,dpi:96,format:"PNG8",origin:null,lods:[],fullExtent:null,units:null,constructor:function(c){this.lods=c.lods;this.origin=c.origin;this.size=c.size?c.size:256;this.dpi=c.dpi?c.dpi:96;this.fullExtent=c.fullExtent;this.units=c.units;this.lods.forEach(function(a){0===a.level&&(this.baseResolution=a.resolution)}.bind(this))},toString:function(){return"size: "+this.size+" dpi: "+this.dpi},getResolution:function(c){return this.baseResolution/
Math.pow(2,c)},getLevel:function(c){return Math.log2(this.baseResolution/c)},findNestZoom:function(c){for(var a=this.lods,d=a.length,f=0,e=d-1;-1<e;e--)if(f=a[e].resolution/c,1.9>f&&.95<f)return{resolution:a[e].resolution,level:e};return{level:d-1,resolution:a[d-1].resolution}},getColForX:function(c,a){return(c-this.origin.x)/(a*this.size)},getRowForY:function(c,a){return(this.origin.y-c)/(a*this.size)},getColRange:function(c){return[Math.floor((this.origin.y-this.fullExtent.maxy)/(c*this.size)),
Math.ceil((this.origin.y-this.fullExtent.miny)/(c*this.size))]},getXForCol:function(c,a){return a*this.size*c+this.origin.x},getYForRow:function(c,a){return this.origin.y-a*this.size*c},getColForSceneX:function(c,a){return(c-this.origin.x/a)/this.size},getRowForSceneY:function(c,a){return(this.origin.y/a-c)/this.size},getSceneXForCol:function(c,a){return this.size*c+this.origin.x/a},getSceneYForRow:function(c,a){return this.origin.y/a-this.size*c},getSceneXForCol2:function(c,a,d){return(this.size*
a*c+this.origin.x)/d},getSceneYForRow2:function(c,a,d){return(this.origin.y-this.size*a*c)/d},getGeometry:function(c,a){c=c.canonical;var d=this.getResolution(a||c.z);a=this.getXForCol(c.x,d);c=this.getYForRow(c.y,d);return[a,c]},getSceneXForX:function(c,a){return c/this.getResolution(a)},getSceneYForY:function(c,a){return c/this.getResolution(a)},tileXYToRectangle:function(c,a,d){var g=this.getResolution(d);d=this.getXForCol(c,g);c=this.getXForCol(c+1,g);var e=this.getYForRow(a,g);a=this.getYForRow(a+
1,g);return{west:d,east:c,north:e,south:a}}})})},"com/huayun/webgis/data/bucket/ImageBucketSimplify":function(){define(["../ArrayType","../../gl/SegmentVector","../../geometry/Anchor","../../geometry/Point2D"],function(f,d,m,h){var c=function(){this.layoutVertexArray=new f.StructArrayLayout2f4ib16;this.indexArray=new f.StructArrayLayout3ui6;this.segments=new d};c.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy())};
c.prototype.addFeature=function(a,c,d,e){var b,g=e[0]-.5*c,f=e[1]-.5*d;e=f+d;b=g+c;for(var l=0;l<a.length;l+=1)for(var t=0,r=a[l];t<r.length;t+=1){var q=r[t],q=new m(q.x,q.y),u=c,z=d,v=f,y=g,x=e,w=b,A=void 0,B=void 0,E=void 0,C=void 0,A=new h(y,v),B=new h(w,v),E=new h(w,x),C=new h(y,x);this.addSymbols([{tl:A,tr:B,bl:C,br:E,tex:{x:0,y:0,w:u,h:z}}],q)}};c.prototype.addSymbols=function(a,c){for(var d=this.indexArray,e=this.layoutVertexArray,b=this.segments.prepareSegment(4*a.length,this.layoutVertexArray,
this.indexArray),g=0;g<a.length;g+=1){var f=a[g],h=f.tl,m=f.tr,r=f.bl,q=f.br,f=f.tex,u=b.vertexLength;e.emplaceBack(c.x,c.y,Math.round(32*h.x),Math.round(32*h.y),f.x,f.y);e.emplaceBack(c.x,c.y,Math.round(32*m.x),Math.round(32*m.y),f.x+f.w,f.y);e.emplaceBack(c.x,c.y,Math.round(32*r.x),Math.round(32*r.y),f.x,f.y+f.h);e.emplaceBack(c.x,c.y,Math.round(32*q.x),Math.round(32*q.y),f.x+f.w,f.y+f.h);d.emplaceBack(u,u+1,u+2);d.emplaceBack(u+1,u+2,u+3);b.vertexLength+=4;b.primitiveLength+=2}};c.prototype.upload=
function(a){this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,[{name:"a_pos",type:"Float32",components:2,offset:0},{name:"a_data",type:"Int16",components:4,offset:8}]);this.indexBuffer=a.createIndexBuffer(this.indexArray)};return c})},"com/huayun/webgis/data/bucket/LineBucketSimplify":function(){define(["../ArrayType","../../gl/SegmentVector"],function(f,d){function m(a,c,e,b,d,f,h){a.emplaceBack(c.x,c.y,c.z||0,Math.round(63*e.x)+128,Math.round(63*e.y)+128,(0===f?0:0>f?-1:1)+1|(.5*
h&63)<<2,.5*h>>6,b?1:0,d?1:0)}var h=Math.pow(2,14)/.5,c=Math.cos(Math.PI/180*37.5),a=function(a){this.layoutVertexArray=new f.StructArrayLayout7f2ib32;this.indexArray=new f.StructArrayLayout3ui6;this.segments=new d};a.prototype.addFeature=function(a,c,e,b,d){for(var g=0;g<a.length;g+=1)this.addLine(a[g],c,e,b,d)};a.prototype.upload=function(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,[{name:"a_pos",type:"Float32",components:3,offset:0},{name:"a_data",type:"Float32",
components:4,offset:12},{name:"a_normal",type:"Int16",components:2,offset:28}]),this.indexBuffer=a.createIndexBuffer(this.indexArray));this.uploaded=!0};a.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy())};a.prototype.addLine=function(a,d,e,b,f){for(var g=a.length;2<=g&&a[g-1].equals(a[g-2]);)a.splice(g-1),g--;for(var k=0;k<g-1&&a[k].equals(a[k+1]);)k++;"bevel"===d&&(b=1.05);var l=this.segments.prepareSegment(10*
g,this.layoutVertexArray,this.indexArray);this.distance=0;var h=!0,m,u=void 0,z=void 0,v=void 0,y=void 0,x,w;this.e1=this.e2=this.e3=-1;for(var A=k;A<g;A++){z=a[A+1];y&&(v=y);m&&(u=m);m=a[A];y=z?z.sub(m)._unit()._perp():v;v=v||y;if(!v)break;var B=v.add(y);0===B.x&&0===B.y||B._unit();var E=B.x*y.x+B.y*y.y;x=0!==E?1/E:Infinity;var C=E<c&&u&&z;if(C&&A>k){var F=m.dist(u);480<F&&(F=m.sub(m.sub(u)._mult(240/F)._round()),this.distance+=F.dist(u),this.addCurrentVertex(F,this.distance,v.mult(1),0,0,!1,l,null),
u=F)}var G=(F=u&&z)?d:e;F&&"round"===G&&(x<f?G="miter":2>=x&&(G="fakeround"));"miter"===G&&x>b&&(G="bevel");"bevel"===G&&(2<x&&(G="flipbevel"),x<b&&(G="miter"));u&&(this.distance+=m.dist(u));if("miter"===G)B._mult(x),this.addCurrentVertex(m,this.distance,B,0,0,!1,l,null);else if("flipbevel"===G)100<x?B=y.clone().mult(-1):(F=0<v.x*y.y-v.y*y.x?-1:1,h=x*v.add(y).mag()/v.sub(y).mag(),B._perp()._mult(h*F)),this.addCurrentVertex(m,this.distance,B,0,0,!1,l,null),this.addCurrentVertex(m,this.distance,B.mult(-1),
0,0,!1,l,null);else if("bevel"===G||"fakeround"===G){var F=0<v.x*y.y-v.y*y.x,I=-Math.sqrt(x*x-1);F?(w=0,x=I):(x=0,w=I);h||this.addCurrentVertex(m,this.distance,v,x,w,!1,l,null);if("fakeround"===G){h=Math.floor(8*(.5-(E-.5)));E=void 0;for(G=0;G<h;G++)E=y.mult((G+1)/(h+1))._add(v)._unit(),this.addPieSliceVertex(m,this.distance,E,F,l,null);this.addPieSliceVertex(m,this.distance,B,F,l,null);for(B=h-1;0<=B;B--)E=v.mult((B+1)/(h+1))._add(y)._unit(),this.addPieSliceVertex(m,this.distance,E,F,l,null)}z&&
this.addCurrentVertex(m,this.distance,y,-x,-w,!1,l,null)}else"butt"===G?(h||this.addCurrentVertex(m,this.distance,v,0,0,!1,l,null),z&&this.addCurrentVertex(m,this.distance,y,0,0,!1,l,null)):"square"===G?(h||(this.addCurrentVertex(m,this.distance,v,1,1,!1,l,null),this.e1=this.e2=-1),z&&this.addCurrentVertex(m,this.distance,y,-1,-1,!1,l,null)):"round"===G&&(h||(this.addCurrentVertex(m,this.distance,v,0,0,!1,l,null),this.addCurrentVertex(m,this.distance,v,1,1,!0,l,null),this.e1=this.e2=-1),z&&(this.addCurrentVertex(m,
this.distance,y,-1,-1,!0,l,null),this.addCurrentVertex(m,this.distance,y,0,0,!1,l,null)));C&&A<g-1&&(C=m.dist(z),480<C&&(z=m.add(z.sub(m)._mult(240/C)._round()),this.distance+=z.dist(m),this.addCurrentVertex(z,this.distance,y.mult(1),0,0,!1,l,null),m=z));h=!1}};a.prototype.addCurrentVertex=function(a,c,e,b,d,f,p,t){var g,k=this.layoutVertexArray,l=this.indexArray;g=e.clone();b&&g._sub(e.perp()._mult(b));m(k,a,g,f,!1,b,c);this.e3=p.vertexLength++;0<=this.e1&&0<=this.e2&&(l.emplaceBack(this.e1,this.e2,
this.e3),p.primitiveLength++);this.e1=this.e2;this.e2=this.e3;g=e.mult(-1);d&&g._sub(e.perp()._mult(d));m(k,a,g,f,!0,-d,c);this.e3=p.vertexLength++;0<=this.e1&&0<=this.e2&&(l.emplaceBack(this.e1,this.e2,this.e3),p.primitiveLength++);this.e1=this.e2;this.e2=this.e3;c>h/2&&!t&&(this.distance=0,this.addCurrentVertex(a,this.distance,e,b,d,f,p))};a.prototype.addPieSliceVertex=function(a,c,e,b,d){e=e.mult(b?-1:1);var g=this.indexArray;m(this.layoutVertexArray,a,e,!1,b,0,c);this.e3=d.vertexLength++;0<=this.e1&&
0<=this.e2&&(g.emplaceBack(this.e1,this.e2,this.e3),d.primitiveLength++);b?this.e2=this.e3:this.e1=this.e3};return a})},"dojo/topic":function(){define(["./Evented"],function(f){var d=new f;return{publish:function(f,h){return d.emit.apply(d,arguments)},subscribe:function(f,h){return d.on.apply(d,arguments)}}})},"com/huayun/webgis/gl/programCache":function(){define(["exports","./ProgramSimplify","./VertexFragShader"],function(f,d,m){var h={};f.useProgramSimplify=function(c,a,g){var f=a+"-"+c.id,e=g.defines;
e&&(f+="-"+e.join("-"));h[f]||(h[f]=new d(c,m[a],g,m.programUniforms[a]));return h[f]}})},"com/huayun/webgis/renderer/ImageRenderer":function(){define("custom/gl-matrix-min ./Renderer ../data/bucket/ImageBucketSimplify ../geometry/Point ../gl/mode ../gl/Texture ../gl/programCache".split(" "),function(f,d,m,h,c,a,g){function l(){}d&&(l.__proto__=d);l.prototype=Object.create(d&&d.prototype);l.prototype.constructor=l;l.prototype.add=function(a,b,c,d){var e=new m,g=b.position||a.viewpoint.center||[0,
0],f=g[0],g=g[1];if("multipoint"===c.type){for(var k=[],l=0;l<c.points.length;l++)k.push(new h(c.points[l].x-f,c.points[l].y-g,0));e.addFeature([k],d.width,d.height,d.offset)}else"point"===c.type&&e.addFeature([[new h(c.x-f,c.y-g,0)]],d.width,d.height,d.offset);e.upload(a.context);b.buckets.push(e);b.position=[f,g]};l.prototype.draw=function(e,b,d,l,h,m){if(l.loaded){void 0===m&&(m=0);d=e.context;var k=d.gl;h=h?h.depthModeForSublayer(0,c.DepthMode.ReadOnly):new c.DepthMode(k.LEQUAL,c.DepthMode.ReadOnly,
[.9,.9]);var n=c.StencilMode.disabled,p=c.ColorMode.alphaBlended,t=g.useProgramSimplify(d,"images",{layoutAttributes:[{name:"a_pos",type:"Float32",components:2,offset:0},{name:"a_data",type:"Int16",components:4,offset:8}]}),v=l.uniforms,y=b.position,x=this.getRealScale(l.fixed,e.scale,l.minScale),w=void 0,A=e.resolution;l.markerSize?(x*=b.markerScaleFactor||1,w=l.markerSize/l.radius,x*=w):b.symbol.size&&void 0===b.symbol.tempW?(b.scaleFactor=b.scaleFactor||1,x*=b.scaleFactor,w=b.symbol.size/l.radius,
b.symbol.tempW=w,x*=w):b.symbol.size&&void 0!==b.symbol.tempW?x*=b.symbol.tempW:(b.scaleFactor=b.scaleFactor||1,x*=b.scaleFactor);v.u_radian=b.rotation?l.angle+b.rotation:l.angle;var w=l.dx*x*A,A=l.dy*x*A,B=Math.sin(v.u_radian),E=Math.cos(v.u_radian),x=w*E-A*B,w=A*E+w*B;v.u_matrix=e.viewpoint.getMatrixForPoint(y[0]+x,y[1]+w);y=[l.width,l.height];v.u_camera_to_center_distance=e.viewpoint.cameraToCenterDistance;A=v.u_matrix;B=e.viewpoint.labelPlaneMatrix;E=f.mat4.create();f.mat4.multiply(E,B,A);v.u_label_plane_matrix=
E;e=e.viewpoint.glCoordMatrix;v.u_coord_matrix=e;v.u_texsize=y;d.activeTexture.set(k.TEXTURE0);e=l.texture;e||(e=l.texture=new a(d,l.image,k.RGBA,{useMipmap:!0}));e.bind(k.LINEAR,k.CLAMP_TO_EDGE);b["_imageOffset"+m]={dx:x,dy:w,size:y};l=b.buckets[m];t.draw(d,k.TRIANGLES,h,n,p,c.CullFaceMode.disabled,v,b.id+"-image"+m,l.layoutVertexBuffer,l.indexBuffer,l.segments,null)}else l.used=!0};l.prototype.drawGlow=function(a,b,c,d,g,f,l){this.draw(a,b,c,d,g,f,l)};l.prototype.calculateExtent=function(a,b,c,
d,g,f){f||(f=0);if(d.loaded){a=a.resolution;f=b["_imageOffset"+f];d=f.size;var e=c.x;c=c.y;var k=f.dy,e=e+f.dx;c+=k;g.push({id:b.id,g:b,minX:e-d[0]*a/2,minY:c-d[1]*a/2,maxX:e+d[0]*a/2,maxY:c+d[1]*a/2})}};return l})},"com/huayun/webgis/views/3d/layers/TileLayerView3D":function(){define("./LayerView3D ../../../utils/utils ../../../utils/extendClazz ../../../gl/draw/drawRaster ../../../gl/mode ../../../data/ArrayType ../../../utils/Constant ../../../gl/members ../../../gl/SegmentVector".split(" "),function(f,
d,m,h,c,a,g,l,e){function b(b){f.call(this,b);this.visible=b.visible;this.id=b.id;this.layer=b.layer;this.view=b.view;this._tileTextures={};this._fadeDirty=this._sourcesDirty=!0;b=new a.StructArrayLayout3ui6;b.emplaceBack(0,1,2);b.emplaceBack(2,1,3);this.quadTriangleIndexBuffer=this.view.context.createIndexBuffer(b);b=g.layout.EXTENT;var c=new a.StructArrayLayout4i8;c.emplaceBack(0,0,0,0);c.emplaceBack(b,0,b,0);c.emplaceBack(0,b,0,b);c.emplaceBack(b,b,b,b);this.rasterBoundsBuffer=this.view.context.createVertexBuffer(c,
l.rasterBoundsAttributes.members);this.rasterBoundsSegments=e.simpleSegment(0,0,4,2)}m(b,f);b.prototype.refresh=function(){this._readyData();this.view.threeRender()};b.prototype._readyData=function(){if(this.visible){var a=this.view.viewpoint.tileInfo,b=Math.round(this.layer.maxLevel?Math.min(this.view.viewpoint.targetZoom||this.view.viewpoint.level,this.layer.maxLevel):this.view.viewpoint.targetZoom||this.view.viewpoint.level),e=this.view.viewpoint.center,c=a.getResolution(b),d=this.view._bound.map(function(b){return{x:a.getColForX(b.x,
c),y:a.getRowForY(b.y,c)}}),g=a.getColRange(c),f=a.getColForX(e[0],c),e=a.getRowForY(e[1],c);this.layer.sourceCache&&(this.layer.sourceCache.updateTile(b,d,g,f,e),this._sourcesDirty=!0,this.zoomedBounds=d,this.range=g,this.cx=f,this.cy=e)}};b.prototype._render=function(){if(this.visible&&this.zoomedBounds){this.view.currentLayer++;var a=this.layer.maxLevel?Math.min(this.view.viewpoint.targetZoom||this.view.viewpoint.level,this.layer.maxLevel):this.view.viewpoint.targetZoom||this.view.viewpoint.level;
this.layer.sourceCache&&(this._sourcesDirty&&(this.layer.sourceCache.update(a,this.zoomedBounds,this.range,this.cx,this.cy),this._fadeDirty=this._sourcesDirty=!1),this.renderPass="translucent",a=this.layer.sourceCache.getVisibleCoordinates(!1,this.transform).slice().reverse(),this.renderLayer(this,this.layer.sourceCache,null,a))}};b.prototype.renderLayer=function(a,b,e,c,d){c.length&&h(a,b,e,c)};b.prototype.setVisible=function(a){(this.visible=a)?this.refresh():this.view.threeRender()};b.prototype.zoom=
function(){if(this.visible&&(this.transform=this.view.viewpoint,this.view.currentLayer++,this.renderPass="translucent",this.layer.sourceCache)){var a=this.layer.sourceCache.updateTileMatrix(!1,this.transform).slice().reverse();this.renderLayer(this,this.layer.sourceCache,null,a)}};b.prototype.depthModeForSublayer=function(a,b,e){a=1-((1+this.view.currentLayer)*this.view.numSublayers+a)*this.view.depthEpsilon;return new c.DepthMode(e||this.view.context.gl.LEQUAL,b,[a,a])};b.prototype.getTileTexture=
function(a){return(a=this._tileTextures[a])&&0<a.length?a.pop():null};b.prototype.saveTileTexture=function(a){var b=this._tileTextures[a.size[0]];b?b.push(a):this._tileTextures[a.size[0]]=[a]};return b})},"com/huayun/webgis/layers/support/LOD":function(){define([],function(){function f(d){this.level=d.level;this.scale=d.scale;this.resolution=d.resolution}f.prototype.toString=function(){return"level: "+this.level+" scale: "+this.scale+" resolution: "+this.resolution};return f})},"dojo/_base/declare":function(){define(["./kernel",
"../has","./lang"],function(f,d,m){function h(a,b){throw Error("declare"+(b?" "+b:"")+": "+a);}function c(a,b){for(var e=[],c=[{cls:0,refs:[]}],d={},g=1,f=a.length,k=0,l,n,m,p,q;k<f;++k){(l=a[k])?"[object Function]"!=w.call(l)&&h("mixin #"+k+" is not a callable constructor.",b):h("mixin #"+k+" is unknown. Did you use dojo.require to pull it in?",b);n=l._meta?l._meta.bases:[l];m=0;for(l=n.length-1;0<=l;--l)p=n[l].prototype,p.hasOwnProperty("declaredClass")||(p.declaredClass="uniqName_"+B++),p=p.declaredClass,
d.hasOwnProperty(p)||(d[p]={count:0,refs:[],cls:n[l]},++g),p=d[p],m&&m!==p&&(p.refs.push(m),++m.count),m=p;++m.count;c[0].refs.push(m)}for(;c.length;){m=c.pop();e.push(m.cls);for(--g;q=m.refs,1==q.length;){m=q[0];if(!m||--m.count){m=0;break}e.push(m.cls);--g}if(m)for(k=0,f=q.length;k<f;++k)m=q[k],--m.count||c.push(m)}g&&h("can't build consistent linearization",b);l=a[0];e[0]=l?l._meta&&l===e[e.length-l._meta.bases.length]?l._meta.bases.length:1:0;return e}function a(a,b,e,c){var d,g,f,k,l,n,m=this._inherited=
this._inherited||{};"string"===typeof a&&(d=a,a=b,b=e,e=c);if("function"===typeof a)f=a,a=b,b=e;else try{f=a.callee}catch(P){if(P instanceof TypeError)h("strict mode inherited() requires the caller function to be passed before arguments",this.declaredClass);else throw P;}(d=d||f.nom)||h("can't deduce a name to call inherited()",this.declaredClass);e=c=0;k=this.constructor._meta;c=k.bases;n=m.p;if("constructor"!=d){if(m.c!==f&&(n=0,l=c[0],k=l._meta,k.hidden[d]!==f)){(g=k.chains)&&"string"==typeof g[d]&&
h("calling chained method with inherited: "+d,this.declaredClass);do if(k=l._meta,g=l.prototype,k&&(g[d]===f&&g.hasOwnProperty(d)||k.hidden[d]===f))break;while(l=c[++n]);n=l?n:-1}if(l=c[++n])if(g=l.prototype,l._meta&&g.hasOwnProperty(d))e=g[d];else{f=x[d];do if(g=l.prototype,(e=g[d])&&(l._meta?g.hasOwnProperty(d):e!==f))break;while(l=c[++n])}e=l&&e||x[d]}else{if(m.c!==f&&(n=0,(k=c[0]._meta)&&k.ctor!==f)){for((g=k.chains)&&"manual"===g.constructor||h("calling chained constructor with inherited",this.declaredClass);(l=
c[++n])&&(!(k=l._meta)||k.ctor!==f););n=l?n:-1}for(;(l=c[++n])&&!(e=(k=l._meta)?k.ctor:l););e=l&&e}m.c=e;m.p=n;if(e)return!0===b?e:e.apply(this,b||a)}function g(a,b,e){return"string"===typeof a?"function"===typeof b?this.__inherited(a,b,e,!0):this.__inherited(a,b,!0):"function"===typeof a?this.__inherited(a,b,!0):this.__inherited(a,!0)}function l(a,b,e,c){var d=this.getInherited(a,b,e);if(d)return d.apply(this,c||e||b||a)}function e(a){for(var b=this.constructor._meta.bases,e=0,c=b.length;e<c;++e)if(b[e]===
a)return!0;return this instanceof a}function b(a,b){for(var e in b)"constructor"!=e&&b.hasOwnProperty(e)&&(a[e]=b[e]);if(d("bug-for-in-skips-shadowed"))for(var c=m._extraNames,g=c.length;g;)e=c[--g],"constructor"!=e&&b.hasOwnProperty(e)&&(a[e]=b[e])}function k(a){v.safeMixin(this.prototype,a);return this}function n(a,b){a instanceof Array||"function"===typeof a||(b=a,a=void 0);b=b||{};a=a||[];return v([this].concat(a),b)}function p(a,b){return function(){var e=arguments,c=e,d=e[0],g,f;f=a.length;
var k;if(!(this instanceof e.callee))return z(e);if(b&&(d&&d.preamble||this.preamble))for(k=Array(a.length),k[0]=e,g=0;;){(d=e[0])&&(d=d.preamble)&&(e=d.apply(this,e)||e);d=a[g].prototype;(d=d.hasOwnProperty("preamble")&&d.preamble)&&(e=d.apply(this,e)||e);if(++g==f)break;k[g]=e}for(g=f-1;0<=g;--g)d=a[g],(d=(f=d._meta)?f.ctor:d)&&d.apply(this,k?k[g]:e);(d=this.postscript)&&d.apply(this,c)}}function t(a,b){return function(){var e=arguments,c=e,d=e[0];if(!(this instanceof e.callee))return z(e);b&&(d&&
(d=d.preamble)&&(c=d.apply(this,c)||c),(d=this.preamble)&&d.apply(this,c));a&&a.apply(this,e);(d=this.postscript)&&d.apply(this,e)}}function r(a){return function(){var b=arguments,e=0,c,d;if(!(this instanceof b.callee))return z(b);for(;c=a[e];++e)if(c=(d=c._meta)?d.ctor:c){c.apply(this,b);break}(c=this.postscript)&&c.apply(this,b)}}function q(a,b,e){return function(){var c,d,g=0,f=1;e&&(g=b.length-1,f=-1);for(;c=b[g];g+=f)d=c._meta,(c=(d?d.hidden:c.prototype)[a])&&c.apply(this,arguments)}}function u(a){A.prototype=
a.prototype;a=new A;A.prototype=null;return a}function z(a){var b=a.callee,e=u(b);b.apply(e,a);return e}function v(f,l,z){"string"!=typeof f&&(z=l,l=f,f="");z=z||{};var A,B,C,H,F,G,L,K=1,P=l;"[object Array]"==w.call(l)?(G=c(l,f),C=G[0],K=G.length-C,l=G[K]):(G=[0],l?"[object Function]"==w.call(l)?(C=l._meta,G=G.concat(C?C.bases:l)):h("base class is not a callable constructor.",f):null!==l&&h("unknown base class. Did you use dojo.require to pull it in?",f));if(l)for(B=K-1;;--B){A=u(l);if(!B)break;C=
G[B];(C._meta?b:y)(A,C.prototype);H=d("csp-restrictions")?function(){}:new Function;H.superclass=l;H.prototype=A;l=A.constructor=H}else A={};v.safeMixin(A,z);C=z.constructor;C!==x.constructor&&(C.nom="constructor",A.constructor=C);for(B=K-1;B;--B)(C=G[B]._meta)&&C.chains&&(L=y(L||{},C.chains));A["-chains-"]&&(L=y(L||{},A["-chains-"]));l&&l.prototype&&l.prototype["-chains-"]&&(L=y(L||{},l.prototype["-chains-"]));C=!L||!L.hasOwnProperty("constructor");G[0]=H=L&&"manual"===L.constructor?r(G):1==G.length?
t(z.constructor,C):p(G,C);H._meta={bases:G,hidden:z,chains:L,parents:P,ctor:z.constructor};H.superclass=l&&l.prototype;H.extend=k;H.createSubclass=n;H.prototype=A;A.constructor=H;A.getInherited=g;A.isInstanceOf=e;A.inherited=E;A.__inherited=a;f&&(A.declaredClass=f,m.setObject(f,H));if(L)for(F in L)A[F]&&"string"==typeof L[F]&&"constructor"!=F&&(C=A[F]=q(F,G,"after"===L[F]),C.nom=F);return H}var y=m.mixin,x=Object.prototype,w=x.toString,A,B=0;A=d("csp-restrictions")?function(){}:new Function;var E=
f.config.isDebug?l:a;f.safeMixin=v.safeMixin=function(a,b){var e,c;for(e in b)c=b[e],c===x[e]&&e in x||"constructor"==e||("[object Function]"==w.call(c)&&(c.nom=e),a[e]=c);if(d("bug-for-in-skips-shadowed")&&b)for(var g=m._extraNames,f=g.length;f;)e=g[--f],c=b[e],c===x[e]&&e in x||"constructor"==e||("[object Function]"==w.call(c)&&(c.nom=e),a[e]=c);return a};return f.declare=v})},"com/huayun/webgis/layers/support/expression/Interpolate":function(){define(["../style/styleUtils","../../../utils/colorSpaces",
"../UnitBezier"],function(f,d,m){function h(a,c,d,e){e-=d;a-=d;return 0===e?0:1===c?a/e:(Math.pow(c,a)-1)/(Math.pow(c,e)-1)}var c=function(a,c,d,e,b){this.type=a;this.operator=c;this.interpolation=d;this.input=e;this.labels=[];this.outputs=[];for(a=0;a<b.length;a+=1)c=b[a],d=c[1],this.labels.push(c[0]),this.outputs.push(d)};c.interpolationFactor=function(a,c,d,e){var b=0;"exponential"===a.name?b=h(c,a.base,d,e):"linear"===a.name?b=h(c,1,d,e):"cubic-bezier"===a.name&&(a=a.controlPoints,b=(new m(a[0],
a[1],a[2],a[3])).solve(h(c,1,d,e)));return b};c.parse=function(a,d){var g=a[0],e=a[1],b=a[2],k=a.slice(3);if(!Array.isArray(e)||0===e.length)return d.error("Expected an interpolation type expression.",1);if("linear"===e[0])e={name:"linear"};else if("exponential"===e[0]){e=e[1];if("number"!==typeof e)return d.error("Exponential interpolation requires a numeric base.",1,1);e={name:"exponential",base:e}}else if("cubic-bezier"===e[0]){e=e.slice(1);if(4!==e.length||e.some(function(a){return"number"!==
typeof a||0>a||1<a}))return d.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);e={name:"cubic-bezier",controlPoints:e}}else return d.error("Unknown interpolation type "+String(e[0]),1,0);if(4>a.length-1)return d.error("Expected at least 4 arguments, but found only "+(a.length-1)+".");if(0!==(a.length-1)%2)return d.error("Expected an even number of arguments.");b=d.parse(b,2,{kind:"number"});if(!b)return null;a=[];var h=null;"interpolate-hcl"===g||
"interpolate-lab"===g?h={kind:"color"}:d.expectedType&&"value"!==d.expectedType.kind&&(h=d.expectedType);for(var m=0;m<k.length;m+=2){var t=k[m],r=k[m+1],q=m+3,u=m+4;if("number"!==typeof t)return d.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',q);if(a.length&&a[a.length-1][0]>=t)return d.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',
q);r=d.parse(r,u,h);if(!r)return null;h=h||r.type;a.push([t,r])}return"number"===h.kind||"color"===h.kind||"array"===h.kind&&"number"===h.itemType.kind&&"number"===typeof h.N?new c(h,g,e,b,a):d.error("Type "+f.toString(h)+" is not interpolatable.")};c.prototype.evaluate=function(a){var g=this.labels,l=this.outputs;if(1===g.length)return l[0].evaluate(a);var e=this.input.evaluate(a);if(e<=g[0])return l[0].evaluate(a);var b=g.length;if(e>=g[b-1])return l[b-1].evaluate(a);b=f.findStopLessThanOrEqualTo(g,
e);g=c.interpolationFactor(this.interpolation,e,g[b],g[b+1]);e=l[b].evaluate(a);a=l[b+1].evaluate(a);if("interpolate"===this.operator)return f.interpolate[this.type.kind.toLowerCase()](e,a,g);if("interpolate-hcl"===this.operator)return l=d.hcl,l.reverse(l.interpolate(l.forward(e),l.forward(a),g));l=d.lab;return l.reverse(l.interpolate(l.forward(e),l.forward(a),g))};c.prototype.eachChild=function(a){a(this.input);for(var c=0,d=this.outputs;c<d.length;c+=1)a(d[c])};c.prototype.possibleOutputs=function(){var a;
return(a=[]).concat.apply(a,this.outputs.map(function(a){return a.possibleOutputs()}))};c.prototype.serialize=function(){var a;a="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);a=[this.operator,a,this.input.serialize()];for(var c=0;c<this.labels.length;c++)a.push(this.labels[c],this.outputs[c].serialize());return a};return c})},
"com/huayun/webgis/data/queryIntersects":function(){define(["exports","../utils/utils","custom/gl-matrix-min"],function(f,d,m){function h(a,b){for(var e=!1,c=0,d=a.length-1;c<a.length;d=c++){var g=a[c],d=a[d];g.y>b.y!==d.y>b.y&&b.x<(d.x-g.x)*(b.y-g.y)/(d.y-g.y)+g.x&&(e=!e)}return e}function c(a,b){if(0===a.length||0===b.length)return!1;for(var e=0;e<a.length-1;e++)for(var c=a[e],g=a[e+1],f=0;f<b.length-1;f++){var k=c,l=g,h=b[f],n=b[f+1];if(d.isCounterClockwise(k,h,n)!==d.isCounterClockwise(l,h,n)&&
d.isCounterClockwise(k,l,h)!==d.isCounterClockwise(k,l,n))return!0}return!1}function a(a,b,e){e*=e;if(1===b.length)return a.distSqr(b[0])<e;for(var c=1;c<b.length;c++){var d;d=a;var g=b[c-1],f=b[c],k=g.distSqr(f);0===k?d=d.distSqr(g):(k=((d.x-g.x)*(f.x-g.x)+(d.y-g.y)*(f.y-g.y))/k,d=0>k?d.distSqr(g):1<k?d.distSqr(f):d.distSqr(f.sub(g)._mult(k)._add(g)));if(d<e)return!0}return!1}function g(a,b){for(var e=!1,c,d,g,f=0;f<a.length;f++){c=a[f];var k=0;for(g=c.length-1;k<c.length;g=k++)d=c[k],g=c[g],d.y>
b.y!==g.y>b.y&&b.x<(g.x-d.x)*(b.y-d.y)/(g.y-d.y)+d.x&&(e=!e)}return e}function l(a,b){b=b.path;if(1===a.length)return g(b,a[0]);for(var e=0;e<b.length;e++)for(var d=b[e],f=0;f<d.length;f++)if(h(a,d[f]))return!0;for(e=0;e<a.length;e++)if(g(b,a[e]))return!0;for(e=0;e<b.length;e++)if(c(a,b[e]))return!0;return!1}function e(a,b){var e=m.mat4.identity([]);m.mat4.translate(e,e,[1,1,0]);m.mat4.scale(e,e,[.5*a.width,.5*a.height,1]);return m.mat4.multiply(e,e,b)}function b(a,b,c,g,f,h){g=e(h,c.uniforms.u_matrix);
a=d.projectQueryGeometry(a,g);b=d.projectPoint(b,g);g=c.width/2;c=c.height/2;if(l(a,{path:[[{x:b.x-g,y:b.y-c},{x:b.x+g,y:b.y-c},{x:b.x+g,y:b.y+c},{x:b.x-g,y:b.y+c}]]}))return!0}f.line=function(b,e,d,g){e=e.path;d=((d.uniforms.u_width||1)+4)*g/2;for(g=0;g<e.length;g++){var f=e[g];if(3<=b.length)for(var k=0;k<f.length;k++)if(h(b,f[k]))return!0;a:{var k=b,l=d;if(1<k.length){if(c(k,f)){k=!0;break a}for(var n=0;n<f.length;n++)if(a(f[n],k,l)){k=!0;break a}}for(n=0;n<k.length;n++)if(a(k[n],f,l)){k=!0;break a}k=
!1}if(k)return!0}return!1};f.polygon=l;f.imageFill=l;f.circle=function(b,c,g,f,l,q){c=c.center;var k=e(q,g.uniforms.u_matrix),n=g.strokeWidth,p=g.pitchWithMap;b=p?b:d.projectQueryGeometry(b,k);f=l+n*f;l=c;c=p?l:d.projectPoint(l,k);k=m.vec4.transformMat4([],[l.x,l.y,0,1],k);!g.scaleWithPitch&&p?f*=k[3]/q.cameraToCenterDistance:g.scaleWithPitch&&!p&&(f*=q.cameraToCenterDistance/k[3]);g=f;if(h(b,c)||a(c,b,g))return!0};f.point=function(b,c,g,f,l,q){if(!g.uniforms.u_matrix)return!1;var k=e(q,g.uniforms.u_matrix),
n=g.strokeWidth||0;l=g.uniforms.radius;b=(f=g.pitchWithMap)?b:d.projectQueryGeometry(b,k);n=l+n;l=f?c:d.projectPoint(c,k);c=m.vec4.transformMat4([],[c.x,c.y,0,1],k);!g.scaleWithPitch&&f?n*=c[3]/q.cameraToCenterDistance:g.scaleWithPitch&&!f&&(n*=q.cameraToCenterDistance/c[3]);g=n;if(h(b,l)||a(l,b,g))return!0};f.image=b;f.canvas=b;f.text=function(){return!1}})},"com/huayun/gl/shaders/fillExtrusion":function(){define(["exports","../../webgis/data/uniform"],function(f,d){f.fillExtrusionVS="#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif\n\nuniform mat4 u_matrix;\nuniform vec3 u_lightcolor;\nuniform lowp vec3 u_lightpos;\nuniform lowp float u_lightintensity;\nuniform float u_vertical_gradient;\nuniform lowp float u_opacity;\n\nattribute vec2 a_pos;\nattribute vec4 a_normal_ed;\n\nvarying vec4 v_color;\n\n// \u6761\u4ef6\u7f16\u8bd1\n// \u989c\u8272\n#ifndef HAS_UNIFORM_u_color\nuniform lowp float u_color_t;\nattribute highp vec4 a_color;\n#else\nuniform highp vec4 u_color;\n#endif\n\n// \u9ad8\u5ea6\n#ifndef HAS_UNIFORM_u_height\nuniform lowp float u_height_t;\nattribute highp vec2 a_height;\n#else\nuniform highp float u_height;\n#endif\n\n// \u5730\u5f62\n#ifdef HAS_TERRAIN\nuniform sampler2D u_height_image;\nuniform highp float u_min_height;\nuniform highp float u_delta_height;\n#else\n// \u5e95\u90e8\u9ad8\u5ea6\n#ifndef HAS_UNIFORM_u_base\nuniform lowp float u_base_t;\nattribute highp vec2 a_base;\n#else\nuniform highp float u_base;\n#endif\n#endif\n\n// \u5904\u7406\u51fd\u6570\nvec2 unpack_float(const float packedValue) {\n    int packedIntValue \x3d int(packedValue);\n    int v0 \x3d packedIntValue/256;\n    return vec2(v0, packedIntValue - v0 * 256);\n}\n\nfloat unpack_mix_vec2(const vec2 packedValue, const float t) {\n    return mix(packedValue[0], packedValue[1], t);\n}\n\nvec4 decode_color(const vec2 encodedColor) {\n    return vec4(\n    unpack_float(encodedColor[0]) / 255.0,\n    unpack_float(encodedColor[1]) / 255.0\n    );\n}\n\nvec4 unpack_mix_color(const vec4 packedColors, const float t) {\n    vec4 minColor \x3d decode_color(vec2(packedColors[0], packedColors[1]));\n    vec4 maxColor \x3d decode_color(vec2(packedColors[2], packedColors[3]));\n    return mix(minColor, maxColor, t);\n}\n\nvoid main() {\n\n    #ifndef HAS_UNIFORM_u_height\n    highp float height \x3d unpack_mix_vec2(a_height, u_height_t);\n    #else\n    highp float height \x3d u_height;\n    #endif\n\n    #ifndef HAS_UNIFORM_u_color\n    highp vec4 color \x3d unpack_mix_color(a_color, u_color_t);\n    #else\n    highp vec4 color \x3d u_color;\n    #endif\n\n    #ifdef HAS_TERRAIN\n    vec3 rgb \x3d texture2D(u_height_image, a_pos/8192.0).rgb;\n    highp float base \x3d rgb.r * u_delta_height + u_min_height;\n    #else\n    #ifndef HAS_UNIFORM_u_base\n    highp float base \x3d unpack_mix_vec2(a_base, u_base_t);\n    #else\n    highp float base \x3d u_base;\n    #endif\n    #endif\n\n    vec3 normal \x3d a_normal_ed.xyz;\n    float t \x3d mod(normal.x, 2.0);\n    gl_Position \x3d u_matrix * vec4(a_pos, t \x3e 0.0 ? height + base : base, 1);\n    float colorvalue \x3d color.r * 0.2126 + color.g * 0.7152 + color.b * 0.0722;\n    v_color \x3d vec4(0.0, 0.0, 0.0, 1.0);\n    vec4 ambientlight \x3d vec4(0.03, 0.03, 0.03, 1.0);\n    color +\x3d ambientlight;\n    float directional \x3d clamp(dot(normal / 16384.0, u_lightpos), 0.0, 1.0);\n    directional \x3d mix((1.0 - u_lightintensity), max((1.0 - colorvalue + u_lightintensity), 1.0), directional);\n    if (normal.y !\x3d 0.0) {\n        directional *\x3d (\n        (1.0 - u_vertical_gradient) +\n        (u_vertical_gradient * clamp((t + base) * pow(height / 150.0, 0.5), mix(0.7, 0.98, 1.0 - u_lightintensity), 1.0)));\n    }\n    v_color.r +\x3d clamp(color.r * directional * u_lightcolor.r, mix(0.0, 0.3, 1.0 - u_lightcolor.r), 1.0);\n    v_color.g +\x3d clamp(color.g * directional * u_lightcolor.g, mix(0.0, 0.3, 1.0 - u_lightcolor.g), 1.0);\n    v_color.b +\x3d clamp(color.b * directional * u_lightcolor.b, mix(0.0, 0.3, 1.0 - u_lightcolor.b), 1.0);\n    v_color *\x3d u_opacity;\n}\n";
f.fillExtrusionFS="precision mediump float;\nvarying vec4 v_color;\n\nvoid main() {\n    gl_FragColor \x3d v_color;\n}\n";f.fillExtrusionUniforms=function(f,h){return{u_matrix:new d.UniformMatrix4f(f,h.u_matrix),u_lightpos:new d.Uniform3f(f,h.u_lightpos),u_lightintensity:new d.Uniform1f(f,h.u_lightintensity),u_lightcolor:new d.Uniform3f(f,h.u_lightcolor),u_vertical_gradient:new d.Uniform1f(f,h.u_vertical_gradient),u_opacity:new d.Uniform1f(f,h.u_opacity),u_height_image:new d.Uniform1i(f,h.u_height_image),
u_min_height:new d.Uniform1f(f,h.u_min_height),u_delta_height:new d.Uniform1f(f,h.u_delta_height)}}})},"com/huayun/webgis/views/3d/layers/MapImageLayerView3D":function(){define("dojo/_base/declare ./LayerView3D ../../../gl/Texture ../../../gl/draw com/huayun/webgis/gl/mode com/huayun/webgis/data/ArrayType com/huayun/webgis/utils/Constant com/huayun/webgis/gl/members com/huayun/webgis/gl/SegmentVector".split(" "),function(f,d,m,h,c,a,g,l,e){return f("com.huayun.webgis.views.3d.layers.MapImageLayerView3D",
[d],{_promise:null,view:null,constructor:function(b){f.safeMixin(this,b);b=new a.StructArrayLayout3ui6;b.emplaceBack(0,1,2);b.emplaceBack(2,1,3);this.quadTriangleIndexBuffer=this.view.context.createIndexBuffer(b);this.viewportSegments=e.simpleSegment(0,0,4,2);this._matrixDirty=!0;this._promiseHandled=!1},setVisible:function(a){this.visible=a;this.view.threeRender()},resize:function(){},refresh:function(){this._readyData();this.view.threeRender()},_readyData:function(){var a=this.view.viewpoint.targetZoom||
this.view.viewpoint.level,e=this.visible;this.layer.maxLevel&&a>=this.layer.maxLevel&&(e=!1);e&&(e=this.view.getExtent())&&(a=this.view.viewpoint.tileInfo.getResolution(a),this._promise&&!this._promise.isResolved()&&this._promise.cancel(),this._promise=this.layer.fetchImage(e,Math.round(e.getWidth()/a),Math.round(e.getHeight()/a)),this._promiseHandled=!1)},_render:function(){var a=this.view.viewpoint.targetZoom||this.view.viewpoint.level,e=this.visible;this.layer.maxLevel&&a>=this.layer.maxLevel&&
(e=!1);if(e){var c=this.view.getExtent();!this._promiseHandled&&this._promise&&c&&(this._promiseHandled=!0,this._promise.then(function(b){this._promise=null;this._promiseHandled=!1;if(b){this.position=this.view.viewpoint.center;this.extent=c;this._matrixDirty=!0;var e=this.view.context,d=e.gl;this.texture?this.texture.update(b,{useMipmap:!0}):(this.texture=new m(e,b,d.RGBA,{useMipmap:!0}),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE,d.LINEAR_MIPMAP_NEAREST),e.extTextureFilterAnisotropic&&d.texParameterf(d.TEXTURE_2D,
e.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,e.extTextureFilterAnisotropicMax));this.texture.zoom=a}this.view.threeRender()}.bind(this)));this._drawLayer()}},_drawLayer:function(){if(this.extent){this.view.currentLayer++;if(this._matrixDirty){var b=this.extent,e=this.position,c=g.layout.EXTENT,d=new a.StructArrayLayout4f16;d.emplaceBack(b.minx-e[0],e[1]-b.maxy,0,0);d.emplaceBack(b.maxx-e[0],e[1]-b.maxy,c,0);d.emplaceBack(b.minx-e[0],e[1]-b.miny,0,c);d.emplaceBack(b.maxx-e[0],e[1]-b.miny,
c,c);this.viewportBuffer=this.view.context.createVertexBuffer(d,[{name:"a_pos",type:"Float32",components:2,offset:0},{name:"a_texture_pos",type:"Float32",components:2,offset:8}]);this._matrixDirty=!1}this.depthRangeFor3D=[0,1-(1+this.view.currentLayer)*this.view.numSublayers*this.view.depthEpsilon];h.drawImageLayer(this)}},zoom:function(){var a=this.view.viewpoint.targetZoom||this.view.viewpoint.level,e=this.visible;this.layer.maxLevel&&a>=this.layer.maxLevel&&(e=!1);e&&(this.view.currentLayer++,
h.drawImageLayer(this))},depthModeForSublayer:function(a,e,d){a=1-((1+this.view.currentLayer)*this.view.numSublayers+a)*this.view.depthEpsilon;return new c.DepthMode(d||this.view.context.gl.LEQUAL,e,[a,a])}})})},"dojo/query":function(){define("./_base/kernel ./has ./dom ./on ./_base/array ./_base/lang ./selector/_loader ./selector/_loader!default".split(" "),function(f,d,m,h,c,a,g,l){function e(a,b){var e=function(e,c){if("string"==typeof c&&(c=m.byId(c),!c))return new b([]);e="string"==typeof e?
a(e,c):e?e.end&&e.on?e:[e]:[];return e.end&&e.on?e:new b(e)};e.matches=a.match||function(a,b,c){return 0<e.filter([a],b,c).length};e.filter=a.filter||function(a,b,d){return e(b,d).filter(function(b){return-1<c.indexOf(a,b)})};if("function"!=typeof a){var d=a.search;a=function(a,b){return d(b||document,a)}}return e}d.add("array-extensible",function(){return 1==a.delegate([],{length:1}).length&&!d("bug-for-in-skips-shadowed")});var b=Array.prototype,k=b.slice,n=b.concat,p=c.forEach,t=function(a,b,e){b=
[0].concat(k.call(b,0));e=e||f.global;return function(c){b[0]=c;return a.apply(e,b)}},r=function(b){var e=this instanceof q&&d("array-extensible");"number"==typeof b&&(b=Array(b));var c=b&&"length"in b?b:arguments;if(e||!c.sort){for(var g=e?this:[],f=g.length=c.length,k=0;k<f;k++)g[k]=c[k];if(e)return g;c=g}a._mixin(c,u);c._NodeListCtor=function(a){return q(a)};return c},q=r,u=q.prototype=d("array-extensible")?[]:{};q._wrap=u._wrap=function(a,b,e){a=new (e||this._NodeListCtor||q)(a);return b?a._stash(b):
a};q._adaptAsMap=function(a,b){return function(){return this.map(t(a,arguments,b))}};q._adaptAsForEach=function(a,b){return function(){this.forEach(t(a,arguments,b));return this}};q._adaptAsFilter=function(a,b){return function(){return this.filter(t(a,arguments,b))}};q._adaptWithCondition=function(a,b,e){return function(){var c=arguments,d=t(a,c,e);if(b.call(e||f.global,c))return this.map(d);this.forEach(d);return this}};p(["slice","splice"],function(a){var e=b[a];u[a]=function(){return this._wrap(e.apply(this,
arguments),"slice"==a?this:null)}});p(["indexOf","lastIndexOf","every","some"],function(a){var b=c[a];u[a]=function(){return b.apply(f,[this].concat(k.call(arguments,0)))}});a.extend(r,{constructor:q,_NodeListCtor:q,toString:function(){return this.join(",")},_stash:function(a){this._parent=a;return this},on:function(a,b){var e=this.map(function(e){return h(e,a,b)});e.remove=function(){for(var a=0;a<e.length;a++)e[a].remove()};return e},end:function(){return this._parent?this._parent:new this._NodeListCtor(0)},
concat:function(a){var b=k.call(this,0),e=c.map(arguments,function(a){return k.call(a,0)});return this._wrap(n.apply(b,e),this)},map:function(a,b){return this._wrap(c.map(this,a,b),this)},forEach:function(a,b){p(this,a,b);return this},filter:function(a){var b=arguments,e=this,d=0;if("string"==typeof a){e=z._filterResult(this,b[0]);if(1==b.length)return e._stash(this);d=1}return this._wrap(c.filter(e,b[d],b[d+1]),this)},instantiate:function(b,e){var c=a.isFunction(b)?b:a.getObject(b);e=e||{};return this.forEach(function(a){new c(e,
a)})},at:function(){var a=new this._NodeListCtor(0);p(arguments,function(b){0>b&&(b=this.length+b);this[b]&&a.push(this[b])},this);return a._stash(this)}});var z=e(l,r);f.query=e(l,function(a){return r(a)});z.load=function(a,b,c){g.load(a,b,function(a){c(e(a,r))})};f._filterQueryResult=z._filterResult=function(a,b,e){return new r(z.filter(a,b,e))};f.NodeList=z.NodeList=r;return z})},"com/huayun/webgis/layers/GraphicLayer":function(){define("dojo/_base/declare ./Layer ../views/3d/layers/GraphicLayerView3D ../data/GraphicIndex com/huayun/webgis/symbols/PointSymbol com/huayun/webgis/symbols/CircleSymbol com/huayun/webgis/symbols/PolygonSymbol com/huayun/webgis/symbols/LineSymbol ../renderer/SimpleRenderer".split(" "),
function(f,d,m,h,c,a,g,l,e){return f("com.huayun.webgis.layers.GraphicLayer",[d],{constructor:function(a){a=a||{};this.type="GraphicLayer";this.graphics=[];this.id="graphic";this.uid=0;this.maxLevel=a.maxLevel;this.minLevel=a.minLevel;this.opacity=1;f.safeMixin(this,a);this.graphicIndex=new h;this.queryPadding=20;this.selectEnabled=this.indexNeedUpdate=!0;this.highlightGraphics=[];this.renderer=a&&a.renderer||new e;a&&(this.glowRatio=void 0===a.glowRatio?8:a.glowRatio,a.graphics&&a.graphics.forEach(function(a){this.addGraphic(a)}.bind(this)))},
setRenderer:function(a){this.renderer=a;this.layerView&&(this.layerView.renderer=a)},createLayerView:function(a,e){this.layerView=e=new m({opacity:this.opacity,visible:this.visible,view:a,id:this.id,layer:this,glow:this.glow,renderer:this.renderer});e.transform=a.viewpoint;this.graphics.forEach(function(a){this.layerView.addGraphic(a)}.bind(this));return e},addGraphic:function(a,e){if(e)switch(e){case "first":this.graphics.splice(0,0,a);break;case "end":this.graphics.push(a)}else this.graphics.push(a);
a.layer=this;a.id=this.id+"-"+this.uid++;this.layerView&&this.layerView.addGraphic(a);this.indexNeedUpdate=!0},updateGraphic:function(a){this.layerView.addGraphic(a)},addGraphicBefore:function(a,e){a.layer=this;for(var b=this.graphics.length,c=!1,d=0;d<b;d++)if(e===this.graphics[d].id){this.graphics.splice(d,0,a);c=!0;break}c||this.graphics.push(a);this.layerView&&this.layerView.addGraphic(a);this.indexNeedUpdate=!0},removeGraphic:function(a){if(a){for(var b=this.graphics.length,e=0;e<b;e++)if(a.id===
this.graphics[e].id){a.buckets.forEach(function(a){a.destroy()});a.buckets=[];this.graphics.splice(e,1);break}this.layerView.view.threeRender()}},addMultiPoint:function(a){this.graphics.push(a);this.layerView.addMultiPoint(a)},removeGraphics:function(a){for(var b=0;b<a.length;b++)this.removeGraphic(a[b])},setVisible:function(a){this.visible=a;this.layerView.setVisible(a)},refresh:function(){this.layerView.view.threeRender()},clear:function(a){this.graphics.forEach(function(a){a.buckets&&(a.buckets.forEach(function(a){a.destroy()}),
a.buckets=[])});this.graphics=[];a||this.layerView.view.threeRender()},queryFeaturesByGeometry:function(a,e){this.indexNeedUpdate&&(this.graphicIndex.clear(),this.graphics.forEach(function(a){if(a.selectEnabled){var b;switch(a.feature.geometry.type){case "point":b=[[a.feature.geometry]];break;case "circle":b=[[a.feature.geometry.center]];break;case "multipoint":b=[a.feature.geometry.points];break;case "line":case "polygon":b=a.feature.geometry.path;break;default:b=[[]]}this.graphicIndex.insert(b,
a.id)}}.bind(this)),this.indexNeedUpdate=!1);e=e||this.queryPadding;switch(a.type){case "point":a=[[a]];break;case "polygon":a=a.path,e=0}return this.graphicIndex.query(a,e,this.graphics,this.layerView.view.resolution,this.layerView.view.viewpoint)},captureFeaturesByGeometry:function(a,e){this.indexNeedUpdate&&(this.graphicIndex.clear(),this.graphics.forEach(function(a){if(a.selectEnabled){var b;switch(a.symbol.type){case "point":b=[[a.feature.geometry]];break;case "circle":b=[[a.feature.geometry.center]];
break;case "text":return;case "image":b=[[a.feature.geometry]];break;default:b=a.feature.geometry.path}this.graphicIndex.insert(b,a.id)}}.bind(this)),this.indexNeedUpdate=!1);e=e||this.queryPadding;switch(a.type){case "point":a=[a]}return this.graphicIndex.captureQuery(a,e,this.graphics,this.layerView.view.resolution,this.layerView.view.viewpoint)},queryRenderFeaturesByGeometry:function(a,e){this.indexNeedUpdate&&(this.graphicIndex.clear(),this.graphics.forEach(function(a){if(a.selectEnabled){var b;
switch(a.symbol.type){case "point":b=[[a.feature.geometry]];break;case "circle":b=[[a.feature.geometry.center]];break;case "text":return;case "image":b=[[a.feature.geometry]];break;default:b=a.feature.geometry.path}this.graphicIndex.insert(b,a.id)}}.bind(this)),this.indexNeedUpdate=!1);e=e||this.queryPadding;switch(a.type){case "point":a=[a]}return this.graphicIndex.queryRender(a,e,this.graphics,this.layerView.view.resolution,this.layerView.view.viewpoint)},highlightGraphic:function(a){this.highlightSymbol||
(this.highlightSymbol={point:new c({color:"#FFFF00",radius:16}),line:new l({color:"#BF2BFF",width:4,join:"round",cap:"round"}),polygon:new g({color:"#FF4B37"})});var b=!1;this.highlightGraphics.forEach(function(a){delete a.highLightSymbol;b=!0}.bind(this));this.highlightGraphics=[];a.forEach(function(a){a.highLightSymbol=this.highlightSymbol[a.symbol.type];b=!0}.bind(this));this.highlightGraphics=a;b&&this.layerView.view.threeRender()}})})},"com/huayun/webgis/views/SceneView":function(){define("dojo/topic dojo/on dojo/DeferredList dojo/promise/Promise dojo/dom-construct ./View ../Viewpoint ../geometry/Extent ../geometry/Point ../geometry/Polygon ../geometry/MapPoint ../layers/GraphicLayer ../handler/PanHandler ../handler/TouchHandler com/huayun/webgis/gl/Context com/huayun/webgis/layers/support/ZoomHistory com/huayun/webgis/gl/VertexFragShader com/huayun/webgis/gl/programConfig com/huayun/webgis/gl/Program com/huayun/webgis/gl/ProgramSimplify ../utils/utils ../utils/Color ../utils/TaskQueue com/huayun/webgis/gl/LineAtlas ../data/GraphicsIndex ../data/queryIntersects ../gl/draw/drawBackground ../utils/Resource ../gl/Texture ../utils/animation".split(" "),
function(f,d,m,h,c,a,g,l,e,b,k,n,p,t,r,q,u,z,v,y,x,w,A,B,E,C,F,G,I,M){var D=function(b){a.call(this,b);this._offsetLeft=this.container.getBoundingClientRect().left;this._offsetTop=this.container.getBoundingClientRect().top;this._clearBit=17664;this._extentDirty=this._nochanging=!0;this.backgroundColor=w.parse(b.backgroundColor||"#FFFFFF");this.numSublayers=D.maxUnderzooming+D.maxOverzooming+1;this.depthEpsilon=1/Math.pow(2,16);this.currentLayer=0;this.viewStates=[];this.backViewStates=[];this.viewStatesLength=
10;this._initState=null;this.antialias=!!b.antialias;this.zooming=!1;var e=b.pitch?b.pitch:b.is3DVision?50:0,c=b.angle?b.angle:0,d=this.container.clientWidth,f=this.container.clientHeight,k=b.maxPitch||50;this._setupContainer(d,f);this._setupContext();this.viewpoint=new g(d,f,e,c,b.maxLevel,b.minLevel,k,this);this._tileTextures={};this.zoomHistory=new q;this.zoomEnabled=this.panEnabled=!0;this.rotateEnabled=void 0===b.rotateEnabled?!0:b.rotateEnabled;this.resizeEnabled=this.selectEnabled=!0;this.emptyProgramConfiguration=
new z.ProgramConfiguration;this.lineAtlas=new B(256,512);this._offsetLeft=this.container.getBoundingClientRect().left;this._offsetTop=this.container.getBoundingClientRect().top;this.graphicsIndex=new E;new p(this);new t(this);this._handleEvent();if(b.center)if(b.level)this.setCenter(b.center,b.level);else if(b.resolution)this.setCenter(b.center,null,b.resolution);else throw Error("\u901a\u8fc7\u4e2d\u5fc3\u70b9\u8bbe\u7f6e\u521d\u59cb\u72b6\u6001\u5fc5\u987b\u5305\u542b\u5c42\u7ea7\u6216\u5206\u8fa8\u7387");
else b.extent&&this.setExtent(b.extent);this.numSublayers=14;this.depthEpsilon=1/Math.pow(2,16);var l=this;b.backgroundImage&&G.loadImage(b.backgroundImage,function(a,b){if(b){a=l.context;var e=a.gl;l._backgroundTexture=new I(a,b,e.RGBA,{useMipmap:!0});l._backgroundTexture.bind(e.LINEAR,e.CLAMP_TO_EDGE,e.LINEAR_MIPMAP_NEAREST);a.extTextureFilterAnisotropic&&e.texParameterf(e.TEXTURE_2D,a.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,a.extTextureFilterAnisotropicMax);l.threeRender()}});this.zoomEnd=
[];this._renderTaskQueue=new A;this._handleAddedLayer()};a&&(D.__proto__=a);D.prototype=Object.create(a&&a.prototype);D.prototype.constructor=D;b={width:{configurable:!0},height:{configurable:!0},resolution:{configurable:!0},level:{configurable:!0},center:{configurable:!0},is3DVision:{configurable:!0},extent:{configurable:!0},nearestResolution:{configurable:!0},scale:{configurable:!0}};b.width.get=function(){return this.viewpoint.width};b.height.get=function(){return this.viewpoint.height};b.resolution.get=
function(){return this.viewpoint.resolution};b.scale.get=function(){return.0254000508001016/(96*this.resolution)};b.level.get=function(){return this.viewpoint.level};b.center.get=function(){var a=this.viewpoint.center;return new e(a[0],a[1],0)};b.is3DVision.get=function(){return 0!==this.viewpoint.pitch};b.extent.get=function(){if(this._extentDirty){var a=this._bound;return this._bound?(this._extent=new l(Math.min(a[0].x,a[1].x,a[2].x,a[3].x),Math.min(a[0].y,a[1].y,a[2].y,a[3].y),Math.max(a[0].x,
a[1].x,a[2].x,a[3].x),Math.max(a[0].y,a[1].y,a[2].y,a[3].y)),this._extentDirty=!1,this._extent):null}return this._extent};D.prototype._setupContainer=function(a,b){this.domNode=document.createElement("div");this.domNode.classList.add("webgis-root");var e=document.createElement("canvas");e.width=a;e.height=b;this._canvas=e;this._canvas.setAttribute("tabindex","0");this._canvas.setAttribute("aria-label","Map");this.domNode.appendChild(e);this.container.appendChild(this.domNode)};D.prototype._setupContext=
function(){var a={alpha:!0,antialias:this.antialias,depth:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,stencil:!0};this._gl=this._canvas.getContext("webgl",a)||this._canvas.getContext("experimental-webgl",a);this.context=new r(this._gl)};D.prototype._handleAddedLayer=function(){if(0<this.map.allLayers.length){var a=this.map.allLayers[0].type;if(!a||0>a.indexOf("Tile"))this._load=!0;else if(a=this.map.allLayers[0].tileInfo)this.viewpoint.setTileInfo(a),this._load=!0;this.map.allLayers.forEach(function(a){this.allLayerViews.push(a.createLayerView(this))}.bind(this))}};
D.prototype.setTileInfo=function(){var a=this,b=this.map.allLayers[0].tileInfo;b&&(this.viewpoint.tileInfo?setTimeout(function(){a.setCenter(a.center)},0):(this.viewpoint.setTileInfo(b),this._load=!0,(this.viewpoint.level||this.viewpoint.resolution)&&this.setCenter(this.viewpoint.center,this.viewpoint.level,this.viewpoint.resolution),f.publish("mapLoadComplete")))};D.prototype._handleEvent=function(){this.map.on("addLayers",function(a,b,e){var c=this.map.allLayers[0].type;if(!c||0>c.indexOf("Tile"))this._load=
!0;else if(c=this.map.allLayers[0].tileInfo)this.viewpoint.setTileInfo(c),this._load=!0;for(c=0;c<a.length;c++)b?this.allLayerViews.splice(e,0,a[c].createLayerView(this)):this.allLayerViews.push(a[c].createLayerView(this))}.bind(this));this.map.on("removeLayers",function(a){for(var b=0;b<a.length;b++)for(var e=a[b],c=this.allLayerViews.length-1;-1<c;c--)if(this.allLayerViews[c].id===e){debugger;this.allLayerViews[c].beforeRemove(this);this.allLayerViews.splice(c,1);break}}.bind(this));d(this.domNode,
"mousewheel",this._zoomMap.bind(this));d(window,"resize",this._onResize.bind(this))};D.prototype._onResize=function(){if(this.resizeEnabled){var a=this.container.clientWidth,b=this.container.clientHeight;a&&b&&(this.resizeEnabled=!1,setTimeout(function(){this.resizeEnabled=!0}.bind(this),100),this._canvas.width=a,this._canvas.height=b,this._canvas.style.width=a+"px",this._canvas.style.height=b+"px",this.context.viewport.set([0,0,this._canvas.width,this._canvas.height]),this.viewpoint.resize(a,b),
this._offsetLeft=this.container.getBoundingClientRect().left,this._offsetTop=this.container.getBoundingClientRect().top,this.allLayerViews.forEach(function(a){a.resize()}),this.refresh())}};D.prototype.expand=function(a){var b=this.width/2*a*this.resolution;a=this.height/2*a*this.resolution;b=new l(this.center.x-b,this.center.y-a,this.center.x+b,this.center.y+a);this.setExtent(b)};D.prototype.setCenter=function(a,b,e){if(b){var c=this.viewpoint.level;this.viewpoint.setLevel(b);this.viewpoint.setCenter(a);
a=this.viewpoint.level;c!==a&&f.publish("changeLevel",{level:this.viewpoint.level})}else e?(c=this.viewpoint.level,this.viewpoint.setResolution(e,this._load),this.viewpoint.setCenter(a),a=this.viewpoint.level,c!==a&&f.publish("changeLevel",{level:this.viewpoint.level})):this.viewpoint.setCenter(a);this.refresh()};D.prototype.setExtent=function(a,b){if(a instanceof l){var e=a.getCenter(),c=a.getWidth();a=a.getHeight();var d=this.viewpoint.width,g=this.viewpoint.height,k=this.viewpoint.level;this.viewpoint.setCenter([e.x,
e.y]);this.viewpoint.setResolution(Math.max(c/d,a/g),!0);this._extentDirty=!0;k!==this.viewpoint.level&&f.publish("changeLevel",{level:this.viewpoint.level});this.refresh(!1,b)}};D.prototype.getExtent=function(){if(this._extentDirty){var a=this._bound;return this._bound?(this._extent=new l(Math.min(a[0].x,a[1].x,a[2].x,a[3].x),Math.min(a[0].y,a[1].y,a[2].y,a[3].y),Math.max(a[0].x,a[1].x,a[2].x,a[3].x),Math.max(a[0].y,a[1].y,a[2].y,a[3].y)),this._extentDirty=!1,this._extent):null}return this._extent};
D.prototype.setView=function(a){a instanceof Object?(a.level!==this.level&&f.publish("changeLevel",{level:a.level}),this.viewpoint.setView(a),this.refresh(!0)):a&&1<this.viewStates.length?(this.backViewStates.push(this.viewStates.pop()),a=this.viewStates[this.viewStates.length-1],this.viewpoint.setView(a),this.refresh(!0)):!a&&0<this.backViewStates.length&&(this.viewStates.push(this.backViewStates.pop()),a=this.viewStates[this.viewStates.length-1],this.viewpoint.setView(a),this.refresh(!0))};D.prototype.refresh=
function(a,b){if(this._load){if(this.viewpoint.matrixDirty){var e=this.container.clientWidth,c=this.container.clientHeight;if(0===e||0===c)return;this.viewpoint.resize(e,c);this.viewpoint.matrixDirty=!1}this.zoomHistory.update(this.viewpoint.level,x.now());this.viewpoint.calcMatrix(!0);this._bound=this.viewpoint.calcBounds();this._extentDirty=!0;f.publish("extentChangeEvent",this);this._initState||(this._initState={level:this.viewpoint.level,center:[this.viewpoint.center[0],this.viewpoint.center[1]],
pitch:this.viewpoint.pitch,angle:this.viewpoint.angle});a||this.handlePushViewState();this.allLayerViews.forEach(function(a){a.refresh(b)});this.threeRender()}};D.prototype.handlePushViewState=function(){this.viewStates.length<this.viewStatesLength||this.viewStates.shift();this.viewStates.push({pitch:this.viewpoint.pitch,angle:this.viewpoint.angle,level:this.viewpoint.targetZoom||this.viewpoint.level,center:this.viewpoint.center});this.backViewStates=[]};D.prototype.centerAt=function(a,b,e){e&&e!==
this.viewpoint.level&&this.viewpoint.setLevel(e);this.viewpoint.setCenter([a,b]);this.refresh()};D.prototype.setLevel=function(a){this.viewpoint.setLevel(a);this.viewpoint.calcMatrix(!0);this.refresh()};D.prototype.findLayerViewById=function(a){for(var b=this.allLayerViews.length-1;-1<b;b--)if(this.allLayerViews[b].id===a)return this.allLayerViews[b]};D.prototype.screenToGeometry=function(a,b){a-=this._offsetLeft;b-=this._offsetTop;a=this.viewpoint.screenToGeometry(a,b);return new e(a.x,a.y,0)};D.prototype.geometryToScreen=
function(a,b){var c=0;if(this.ground&&this.ground.visible){var d=Math.min(this.viewpoint.targetZoom||this.viewpoint.level,this.ground.maxLevel),g=this.viewpoint.tileInfo.getResolution(d),f=this.viewpoint.tileInfo.getColForX(a,g),k=this.viewpoint.tileInfo.getRowForY(b,g),l=f-Math.floor(f),g=k-Math.floor(k);(d=this.ground.sourceCache.getTileByID(d+"/"+Math.floor(f)+"/"+Math.floor(k)))&&d.fbo&&(c=this.context.gl,this.context.bindFramebuffer.set(d.fbo.framebuffer),f=new Float32Array(4),l=Math.round(256*
l),g=Math.round(256*g),c.readPixels(0===l?l:l-1,0===g?g:g-1,1,1,c.RGBA,c.FLOAT,f),c=f[0]*(d.maximumHeight-d.minimumHeight)+d.minimumHeight)}b=this.viewpoint.geometryToScreen(a,b,c);a=b.x+this._offsetLeft;b=b.y+this._offsetTop;return new e(a,b)};D.prototype.getTileTexture=function(a){return(a=this._tileTextures[a])&&0<a.length?a.pop():null};D.prototype.saveTileTexture=function(a){var b=this._tileTextures[a.size[0]];b?b.push(a):this._tileTextures[a.size[0]]=[a]};D.prototype.useProgram=function(a,b,
e){void 0===b&&(b=this.emptyProgramConfiguration);this.cache=this.cache||{};var c=""+a+(b.cacheKey||"");this.cache[c]||(this.cache[c]=new v(this.context,u[a],b,u.programUniforms[a],e));return this.cache[c]};D.prototype.useProgramSimplify=function(a,b){this.simplifyCache=this.simplifyCache||{};this.simplifyCache[a]||(this.simplifyCache[a]=new y(this.context,u[a],b,u.programUniforms[a]));return this.simplifyCache[a]};D.prototype._drawBackgroundImage=function(){this._backgroundTexture&&this.viewpoint.rasterBoundsBuffer&&
F(this)};Object.defineProperties(D.prototype,b);D.prototype._zoomMap=function(a){0<a.wheelDelta?this.zoomInWheel(a.clientX,a.clientY):0>a.wheelDelta&&this.zoomOutWheel(a.clientX,a.clientY)};D.prototype.zoomInWheel=function(a,b){this.zoomEnabled&&!this.zooming&&(null!==this.viewpoint.level&&this.viewpoint.level<this.viewpoint.maxLevel?(this.zoomEnabled=!1,setTimeout(function(){this.zoomEnabled=!0}.bind(this),400),this.viewpoint.startZoom=this.viewpoint.level,this.viewpoint.targetZoom=this.viewpoint.level+
1,this.viewpoint.level=this.viewpoint.targetZoom,a=this.screenToGeometry(a,b),b=this.viewpoint.center,this.deltaX=a.x-b[0],this.deltaY=a.y-b[1],this.viewpoint.readyMatrix(b[0]+this.deltaX/2,b[1]+this.deltaY/2,this.viewpoint.targetZoom),this._bound=this.viewpoint.calcBounds(),this._extentDirty=!0,f.publish("changeLevel",{level:this.viewpoint.targetZoom}),f.publish("extentChangeEvent",this),this._handleZoomWheel(!0)):null===this.viewpoint.level&&(this.zoomEnabled=!1,this.graphicsIndex.clear(),setTimeout(function(){this.zoomEnabled=
!0}.bind(this),400),this.viewpoint.targetResolution=this.viewpoint.resolution,a=this.screenToGeometry(a,b),b=this.viewpoint.center,this.deltaX=a.x-b[0],this.deltaY=a.y-b[1],this.viewpoint.readyMatrix(b[0]+this.deltaX/2,b[1]+this.deltaY/2,null,null,this.viewpoint.resolution/2),this._bound=this.viewpoint.calcBounds(),this._extentDirty=!0,f.publish("extentChangeEvent",this),this._handleZoomWheel(!0)))};D.prototype.zoomOutWheel=function(a,b){this.zoomEnabled&&!this.zooming&&(null!==this.viewpoint.level&&
this.viewpoint.level>this.viewpoint.minLevel?(this.zoomEnabled=!1,setTimeout(function(){this.zoomEnabled=!0}.bind(this),400),this.viewpoint.startZoom=this.viewpoint.level,this.viewpoint.targetZoom=this.viewpoint.level-1,this.viewpoint.level=this.viewpoint.targetZoom,a=this.screenToGeometry(a,b),b=this.viewpoint.center,this.deltaX=a.x-b[0],this.deltaY=a.y-b[1],this.viewpoint.readyMatrix(b[0]-this.deltaX,b[1]-this.deltaY,this.viewpoint.targetZoom),this._bound=this.viewpoint.calcBounds(),this._extentDirty=
!0,f.publish("changeLevel",{level:this.viewpoint.targetZoom}),f.publish("extentChangeEvent",this),this._handleZoomWheel(!1)):null===this.viewpoint.level&&(this.zoomEnabled=!1,this.graphicsIndex.clear(),setTimeout(function(){this.zoomEnabled=!0}.bind(this),400),this.viewpoint.targetResolution=this.viewpoint.resolution,a=this.screenToGeometry(a,b),b=this.viewpoint.center,this.deltaX=a.x-b[0],this.deltaY=a.y-b[1],this.viewpoint.readyMatrix(b[0]+this.deltaX/2,b[1]+this.deltaY/2,null,null,2*this.viewpoint.resolution),
this._bound=this.viewpoint.calcBounds(),this._extentDirty=!0,f.publish("extentChangeEvent",this),this._handleZoomWheel(!1)))};D.prototype.zoomIn=function(){if(this.zoomEnabled&&!this.zooming&&this.viewpoint.level<this.viewpoint.maxLevel){this.zoomEnabled=!1;setTimeout(function(){this.zoomEnabled=!0}.bind(this),300);this.viewpoint.startZoom=this.viewpoint.level;this.viewpoint.targetZoom=this.viewpoint.level+1;this.viewpoint.level=this.viewpoint.targetZoom;var a=this.viewpoint.center;this.viewpoint.readyMatrix(a[0],
a[1],this.viewpoint.targetZoom);this._bound=this.viewpoint.calcBounds();this._extentDirty=!0;f.publish("extentChangeEvent",this);f.publish("changeLevel",{level:this.viewpoint.targetZoom});this._handleZoom(!0)}};D.prototype.zoomOut=function(){if(this.zoomEnabled&&!this.zooming&&this.viewpoint.level>this.viewpoint.minLevel){this.zoomEnabled=!1;setTimeout(function(){this.zoomEnabled=!0}.bind(this),300);this.viewpoint.startZoom=this.viewpoint.level;this.viewpoint.targetZoom=this.viewpoint.level-1;this.viewpoint.level=
this.viewpoint.targetZoom;var a=this.viewpoint.center;this.viewpoint.readyMatrix(a[0],a[1],this.viewpoint.targetZoom);this._bound=this.viewpoint.calcBounds();this._extentDirty=!0;f.publish("changeLevel",{level:this.viewpoint.targetZoom});f.publish("extentChangeEvent",this);this._handleZoom(!1)}};D.prototype._handleZoom=function(a){this.allLayerViews.forEach(function(a){a._readyData()});this._nochanging=!1;this.zooming=!0;a?this._zoomAnimateIn(null,1):this._zoomAnimateOut(null,1)};D.prototype._handleZoomWheel=
function(a){this.allLayerViews.forEach(function(a){a._readyData()});this._nochanging=!1;this.zooming=!0;a?this._zoomWheelAnimateIn(null,null!==this.viewpoint.level):this._zoomWheelAnimateOut(null,null!==this.viewpoint.level)};D.prototype._zoomWheelAnimateOut=function(a,b){a||(a=performance.now());var e=performance.now()-a,c=this.viewpoint.center;if(300<=e)window.cancelAnimationFrame(this._animateRaf),this._nochanging=!0,this.zooming=!1,this.viewpoint.setCenter([c[0]-this.deltaX,c[1]-this.deltaY]),
b?(this.viewpoint.setLevel(this.viewpoint.targetZoom),this.viewpoint.targetZoom=null):(this.viewpoint.resolution=2*this.viewpoint.targetResolution,this.viewpoint.targetResolution=null),this.viewpoint.calcMatrix(!0),this.handlePushViewState(),this._renderRaf=null,this.callHooks("zoomEnd"),this.threeRender();else{var e=e/300,d;b?(d=1/Math.pow(2,-e)-1,this.viewpoint.updateMatrix(c[0]-this.deltaX*d,c[1]-this.deltaY*d,this.viewpoint.startZoom-e)):(d=e,this.viewpoint.resolution=this.viewpoint.targetResolution*
(1+e),this.viewpoint.updateMatrix(c[0]-this.deltaX*d,c[1]-this.deltaY*d,null,this.viewpoint.resolution));this.animate();this._animateRaf=window.requestAnimationFrame(this._zoomWheelAnimateOut.bind(this,a,b))}};D.prototype._zoomAnimateOut=function(a){a||(a=performance.now());var b=performance.now()-a,e=this.viewpoint.center;300<=b?(window.cancelAnimationFrame(this._animateRaf),this._nochanging=!0,this.zooming=!1,this.viewpoint.setCenter([e[0],e[1]]),this.viewpoint.setLevel(this.viewpoint.targetZoom),
this.viewpoint.calcMatrix(!0),this.viewpoint.targetZoom=null,this.handlePushViewState(),this._renderRaf=null,this.callHooks("zoomEnd"),this.threeRender()):(this.viewpoint.updateMatrix(e[0],e[1],this.viewpoint.startZoom-b/300),this.animate(),this._animateRaf=window.requestAnimationFrame(this._zoomAnimateOut.bind(this,a)))};D.prototype._zoomWheelAnimateIn=function(a,b){a||(a=performance.now());var e=performance.now()-a,c=this.viewpoint.center;if(300<=e)window.cancelAnimationFrame(this._animateRaf),
this._nochanging=!0,this.zooming=!1,this.viewpoint.setCenter([c[0]+this.deltaX/2,c[1]+this.deltaY/2]),b?(this.viewpoint.setLevel(this.viewpoint.targetZoom),this.viewpoint.targetZoom=null):(this.viewpoint.resolution=this.viewpoint.targetResolution/2,this.viewpoint.targetResolution=null),this.viewpoint.calcMatrix(!0),this._renderRaf=null,this.callHooks("zoomEnd"),this.handlePushViewState(),this.threeRender();else{var e=e/300,d;b?(d=1-1/Math.pow(2,e),this.viewpoint.updateMatrix(c[0]+this.deltaX*d,c[1]+
this.deltaY*d,this.viewpoint.startZoom+e)):(d=1-1/(1+e),this.viewpoint.resolution=this.viewpoint.targetResolution/(1+e),this.viewpoint.updateMatrix(c[0]+this.deltaX*d,c[1]+this.deltaY*d,null,this.viewpoint.resolution));this.animate();this._animateRaf=window.requestAnimationFrame(this._zoomWheelAnimateIn.bind(this,a,b))}};D.prototype._zoomAnimateIn=function(a){a||(a=performance.now());var b=performance.now()-a,e=this.viewpoint.center;300<=b?(window.cancelAnimationFrame(this._animateRaf),this._nochanging=
!0,this.zooming=!1,this.viewpoint.setCenter([e[0],e[1]]),this.viewpoint.setLevel(this.viewpoint.targetZoom),this.viewpoint.calcMatrix(!0),this._renderRaf=null,this.viewpoint.targetZoom=null,this.handlePushViewState(),this.callHooks("zoomEnd"),this.threeRender()):(this.viewpoint.updateMatrix(e[0],e[1],this.viewpoint.startZoom+b/300),this.animate(),this._animateRaf=window.requestAnimationFrame(this._zoomAnimateIn.bind(this,a)))};D.prototype.zoomInAnimate=function(a,b,e){this.viewpoint.startZoom=this.viewpoint.level;
this.viewpoint.targetZoom=a;this.viewpoint.level=this.viewpoint.targetZoom;this.domNode.style.pointerEvents="none";a=this.viewpoint.center;this.viewpoint.readyMatrix(a[0],a[1],this.viewpoint.targetZoom);this._bound=this.viewpoint.calcBounds();this._extentDirty=!0;f.publish("extentChangeEvent",this);f.publish("changeLevel",{level:this.viewpoint.targetZoom});this._handleZoomAnimate(!0,this.viewpoint.targetZoom-this.viewpoint.startZoom,b,e)};D.prototype.zoomOutAnimate=function(a,b,e){this.viewpoint.startZoom=
this.viewpoint.level;this.viewpoint.targetZoom=a;this.viewpoint.level=this.viewpoint.targetZoom;this.domNode.style.pointerEvents="none";a=this.viewpoint.center;this.viewpoint.readyMatrix(a[0],a[1],this.viewpoint.targetZoom);this._bound=this.viewpoint.calcBounds();this._extentDirty=!0;f.publish("extentChangeEvent",this);f.publish("changeLevel",{level:this.viewpoint.targetZoom});this._handleZoomAnimate(!1,this.viewpoint.targetZoom-this.viewpoint.startZoom,b,e)};D.prototype._handleZoomAnimate=function(a,
b,e,c){this.allLayerViews.forEach(function(a){a._readyData()});this._nochanging=!1;a?this._handleZoomAnimateIn(null,b,e,c):this._handleZoomAnimateOut(null,b,e,c)};D.prototype._handleZoomAnimateIn=function(a,b,e,c){a||(a=performance.now());var d=performance.now()-a,g=this.viewpoint.center;d>=e?(window.cancelAnimationFrame(this._animateRaf),this.domNode.style.pointerEvents="all",this._nochanging=!0,this.viewpoint.setCenter([g[0],g[1]]),this.viewpoint.setLevel(this.viewpoint.targetZoom),this.viewpoint.calcMatrix(!0),
this.viewpoint.targetZoom=null,this.handlePushViewState(),this._renderRaf=null,this.callHooks("zoomEnd"),this.threeRender(),c()):(d/=e,this.viewpoint.updateMatrix(g[0],g[1],this.viewpoint.startZoom+b*d*d*d),this.animate(),this._animateRaf=window.requestAnimationFrame(this._handleZoomAnimateIn.bind(this,a,b,e,c)))};D.prototype._handleZoomAnimateOut=function(a,b,e,c){a||(a=performance.now());var d=performance.now()-a,g=this.viewpoint.center;d>=e?(window.cancelAnimationFrame(this._animateRaf),this.domNode.style.pointerEvents=
"all",this._nochanging=!0,this.viewpoint.setCenter([g[0],g[1]]),this.viewpoint.setLevel(this.viewpoint.targetZoom),this.viewpoint.calcMatrix(!0),this.viewpoint.targetZoom=null,this.handlePushViewState(),this._renderRaf=null,this.callHooks("zoomEnd"),this.threeRender(),c()):(d/=e,this.viewpoint.updateMatrix(g[0],g[1],this.viewpoint.startZoom+d*d*d*b),this.animate(),this._animateRaf=window.requestAnimationFrame(this._handleZoomAnimateOut.bind(this,a,b,e,c)))};D.prototype.mapMove=function(a,b){if(this.panEnabled&&
!this.zooming){var e=-this.viewpoint.angle/180*Math.PI,c=Math.sin(e),e=Math.cos(e),d=this.viewpoint.resolution,g=this.viewpoint.center;this.viewpoint.setCenter([g[0]-d*(a*e-b*c),g[1]+d*(a*c+b*e)]);this.viewpoint.calcMatrix(!0);this.threeRender()}};D.prototype.stopMove=function(){this.panEnabled&&!this.zooming&&this.refresh(!0)};D.prototype.pan=function(a,b){if(!(0===a&&0===b||this.zooming)){var e=this.viewpoint.center;this.viewpoint.setCenter([e[0]+a,e[1]+b]);this.viewpoint.calcMatrix(!0);this.zoomHistory.update(this.viewpoint.level,
x.now());this.viewpoint.calcMatrix(!0);this._bound=this.viewpoint.calcBounds();this._extentDirty=!0;this.allLayerViews.forEach(function(a){a.refresh()});this.threeRender()}};D.prototype._mouseRotate=function(a){this.rotateEnabled&&!this.zooming&&(this.viewpoint.angle=(this.viewpoint.angle-a/1080*180)%360,this.viewpoint.updateBaseMatrix(),this.threeRender(),f.publish("mapRotateAngle",this.viewpoint.angle))};D.prototype._stopMouseRotate=function(){this.rotateEnabled&&!this.zooming&&this.refresh(!0)};
D.prototype.rotateMap=function(a){this.rotateEnabled&&!this.zooming&&(this.viewpoint.oldAngle=this.viewpoint.angle,this.viewpoint.angle=(this.viewpoint.angle+a)%360,this.viewpoint.deltaAngle=a,f.publish("mapRotateAngle",this.viewpoint.angle),this.viewpoint.updateBaseMatrix(),this._bound=this.viewpoint.calcBounds(),this._extentDirty=!0,this._handleRotate())};D.prototype._handleRotate=function(){this.allLayerViews.forEach(function(a){a._readyData()});this._nochanging=!1;this._rotateAnimation(null,this.viewpoint.deltaAngle,
0)};D.prototype._rotateAnimation=function(a,b,e){a||(a=performance.now());e=performance.now()-a;300<=e?(this._rotateRaf&&window.cancelAnimationFrame(this._rotateRaf),this._nochanging=!0,this.viewpoint.angle=this.viewpoint.oldAngle+b,this.viewpoint.updateBaseMatrix(),this.handlePushViewState(),this.threeRender()):(this.viewpoint.angle=this.viewpoint.oldAngle+b*e/300,this.viewpoint.updateBaseMatrix(),this.animate(),this._rotateRaf=window.requestAnimationFrame(this._rotateAnimation.bind(this,a,b,e)))};
D.prototype._mouseSwitchDip=function(a){this.rotateEnabled&&!this.zooming&&(this.viewpoint.updatePitch(-a/20),this.threeRender())};D.prototype._stopSwitch=function(){this.rotateEnabled&&!this.zooming&&this.refresh(!0)};D.prototype.setDimensions=function(a){2===a&&0!==this.viewpoint.pitch?(this.viewpoint.oldPitch=this.viewpoint.pitch,this.viewpoint.pitch=0,this.viewpoint.deltaPitch=this.viewpoint.pitch-this.viewpoint.oldPitch,f.publish("mapSwitchDimension",2),this.viewpoint.updateBaseMatrix(),this._bound=
this.viewpoint.calcBounds(),this._extentDirty=!0,this._handleSwitch2D()):3===a&&50!==this.viewpoint.pitch&&(this.viewpoint.oldPitch=this.viewpoint.pitch,this.viewpoint.pitch=50,this.viewpoint.deltaPitch=this.viewpoint.pitch-this.viewpoint.oldPitch,f.publish("mapSwitchDimension",3),this.viewpoint.updateBaseMatrix(),this._bound=this.viewpoint.calcBounds(),this._extentDirty=!0,this._handleSwitch3D())};D.prototype._handleSwitch2D=function(){this.allLayerViews.forEach(function(a){a._readyData()});this._nochanging=
!1;this._switchAnimation(null,this.viewpoint.deltaPitch)};D.prototype._handleSwitch3D=function(){this.allLayerViews.forEach(function(a){a._readyData()});this._nochanging=!1;this._switchAnimation(null,this.viewpoint.deltaPitch)};D.prototype._switchAnimation=function(a,b){a||(a=performance.now());var e=performance.now()-a;500<=e?(window.cancelAnimationFrame(this._animateRaf),this._nochanging=!0,this.viewpoint.pitch=this.viewpoint.oldPitch+b,this.viewpoint.updateBaseMatrix(),this.handlePushViewState(),
this.threeRender()):(this.viewpoint.pitch=this.viewpoint.oldPitch+b*e/500,this.viewpoint.updateBaseMatrix(),this.animate(),this._animateRaf=window.requestAnimationFrame(this._switchAnimation.bind(this,a,b)))};D.prototype.animate=function(){this._renderRaf||(this._renderRaf=requestAnimationFrame(function(){this._renderRaf=null;this._gl.clearColor(this.backgroundColor.r,this.backgroundColor.g,this.backgroundColor.b,this.backgroundColor.a);this._gl.clear(this._clearBit);this.currentLayer=0;this.context.setDefault();
this._drawBackgroundImage();this.allLayerViews.forEach(function(a){a.zoom()})}.bind(this)))};D.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO();this.context.cullFace.setDefault();this.context.activeTexture.setDefault();this.context.pixelStoreUnpack.setDefault();this.context.pixelStoreUnpackPremultiplyAlpha.setDefault();this.context.pixelStoreUnpackFlipY.setDefault()};D.prototype.setBaseState=function(){var a=this.context.gl;this.context.cullFace.set(!1);this.context.viewport.set([0,
0,this.width,this.height]);this.context.blendEquation.set(a.FUNC_ADD)};D.prototype.queryFeaturesByGeometry=function(a,b,e){var c=[],d={},g=[];this.map.allLayers.forEach(function(e){if(e.selectEnabled){var f=e.queryFeaturesByGeometry(a,b);f instanceof h?(c.push(f),g.push(e.id)):d[e.id]=f}});0<c.length?(new m(c)).then(function(a){a.forEach(function(a,b){a[0]&&(d[g[b]]=a[1].results)});e&&e(d)}):e&&e(d)};D.prototype.queryRenderFeaturesByGeometry=function(a,b,e){var c=[],d={},g=[];this.map.allLayers.forEach(function(e){if(e.selectEnabled){var f=
e.queryRenderFeaturesByGeometry(a,b);f instanceof h?(c.push(f),g.push(e.id)):d[e.id]=f}});0<c.length?(new m(c)).then(function(a){a.forEach(function(a,b){a[0]&&(d[g[b]]=a[1].results)});e&&e(d)}):e&&e(d)};D.prototype.addTask=function(a){this._renderRaf=requestAnimationFrame(function(){this._renderRaf=null;this._gl.clear(this._clearBit);this.currentLayer=0;this.depthRangeFor3D=[0,1-3*this.numSublayers*this.depthEpsilon];this.context.setDefault();this.allLayerViews.forEach(function(a){a._render()});this.allLayerViews[0]._fadeDirty?
(this.allLayerViews[0]._fadeDirty=!1,this.threeRender()):a()}.bind(this))};D.prototype.resetExtent=function(){this._initState&&(this.viewpoint.setView(this._initState),this.refresh(!0))};D.prototype.calcBounds=function(a,b,e,c){return this.viewpoint.calcBound(a,b,e,c)};D.prototype.callHooks=function(a){this[a].forEach(function(a){a()})};D.prototype.loadItem=function(a){this.graphicsIndex.load(a)};D.prototype.insertItems=function(a){for(var b=0,e=a.length;b<e;b++)this.graphicsIndex.insert(a[b])};D.prototype.switchPitch=
function(a){this.viewpoint.oldPitch=this.viewpoint.pitch;this.viewpoint.pitch=a;this.viewpoint.deltaPitch=this.viewpoint.pitch-this.viewpoint.oldPitch;0<a?f.publish("mapSwitchDimension",3):f.publish("mapSwitchDimension",2);this.viewpoint.updateBaseMatrix();this._bound=this.viewpoint.calcBounds();this._extentDirty=!0;this._handleSwitch3D()};D.prototype.queryGraphicsByGeometry=function(a,b){switch(a.type){case "point":a=[a]}var e={};b=this.graphicsIndex.query(a,b||0,this.resolution);for(var c=[],d=
0,g=b.length;d<g;d++){var f=b[d];if(f.g.selectEnabled)if(f.hasOwnProperty("symbol")){var k=f.g,l=k.feature.geometry;if("multipolygon"===l.type)for(var l=l.polygons,h=0;h<l.length;h++){if(C[f.symbol.type](a,l[h],f.symbol,this.resolution,k.feature.geometry.radius,this.viewpoint)){e.hasOwnProperty(f.id)||(c.push(f.g),e[f.id]=!0);break}}else C[f.symbol.type](a,f.g.feature.geometry,f.symbol,this.resolution,k.feature.geometry.radius,this.viewpoint)&&!e.hasOwnProperty(f.id)&&(c.push(f.g),e[f.id]=!0)}else e.hasOwnProperty(f.id)||
(c.push(f.g),e[f.id]=!0)}return c};D.prototype.queryGraphicByDevId=function(a){for(var b,e=0,c=this.allLayerViews;e<c.length;e++)if(0<c[e].layer.graphics.length&&"labelLayer"!==c[e].graphicsLayerView.id)for(var d=0,g=c[e].layer.graphics;d<g.length;d++)g[d].feature.attributes.forEach(function(e){"dev_id"===e.name&&e.value===a&&(b=g[d])});return void 0!==b?b:null};D.prototype.queryGraphicSizeByPoint=function(a,b){a=this.graphicsIndex.query([a],0,this.resolution);var e=Infinity,c=Infinity,d=-Infinity,
g=-Infinity;b=!b;for(var f=0,k=a.length;f<k;f++){var l=a[f];l.symbol&&b||(l.minX<e&&(e=l.minX),l.minY<c&&(c=l.minY),l.maxX>d&&(d=l.maxX),l.maxY>g&&(g=l.maxY))}return{xmin:e,ymin:c,xmax:d,ymax:g,width:Math.abs(d-e),height:Math.abs(g-c)}};D.prototype.checkExtentState=function(a,b,c,d,g){void 0===g&&(g=!0);var f=this.graphicsIndex.checkExtentState(a,b,c,d);a=[new e(a,d),new e(c,d),new e(c,b),new e(a,b)];b=0;for(c=f.length;b<c;b++)if(d=f[b],d.hasOwnProperty("symbol")){var k=d.g;if(g&&C.line(a,k.feature.geometry,
d.symbol,this.resolution,k.feature.geometry.radius,this.viewpoint))return!0}else return!0;return!1};D.prototype.clear=function(){this.graphicsIndex.clear();this.map.clear();this.allLayerViews=[];this.threeRender()};D.prototype.setBackgroundColor=function(a){this.backgroundColor=w.parse(a);this.threeRender()};D.prototype.destroy=function(){this.graphicsIndex.clear();this.map.clear();this.allLayerViews=[];c.destroy(this.domNode)};D.prototype.requestRenderFrame=function(a){return this._renderTaskQueue.add(a)};
D.prototype.cancelRenderFrame=function(a){this._renderTaskQueue.remove(a)};D.prototype.setMaxPitch=function(a,b){this.viewpoint.maxPitch=a;b&&this.refresh()};D.prototype.threeRender=function(){this._renderRaf||!this._nochanging||this.viewpoint.matrixDirty||(this._renderRaf=requestAnimationFrame(function(){this._renderRaf=null;this._nochanging&&(this._renderTaskQueue.run(this),this._gl.clearColor(this.backgroundColor.r,this.backgroundColor.g,this.backgroundColor.b,this.backgroundColor.a),this._gl.clear(this._clearBit),
this.context.setDefault(),this._drawBackgroundImage(),this.currentLayer=0,this.depthRangeFor3D=[0,1-3*this.numSublayers*this.depthEpsilon],this.allLayerViews.forEach(function(a){a._render()}),0<this.allLayerViews.length&&this.allLayerViews[0]._fadeDirty&&(this.allLayerViews[0]._fadeDirty=!1,this.threeRender()))}.bind(this)))};D.prototype.destroy=function(){this.map=null;this.container.removeChild(this.domNode);this.allLayerViews=[]};D.prototype.flyTo=function(a,b){if(!this.zooming){this.viewpoint.readyMatrix(a.x,
a.y,this.viewpoint.level);this._bound=this.viewpoint.calcBounds();this._extentDirty=!0;this.viewpoint.targetZoom=this.viewpoint.level;this.viewpoint.startZoom=this.viewpoint.level;this.allLayerViews.forEach(function(a){a._readyData()});this.domNode.style.pointerEvents="none";this._nochanging=!1;var e=this.viewpoint.center;this._flyToAnimation(null,{duration:b,dx:(a.x-e[0])/2,dy:(a.y-e[1])/2})}};D.prototype._flyToAnimation=function(a,b){a||(a=performance.now());var e=performance.now()-a,c=this.viewpoint.center;
e>b.duration?(window.cancelAnimationFrame(this._animateRaf),this._nochanging=!0,this.viewpoint.setCenter([c[0]+b.dx,c[1]+b.dy]),this.viewpoint.setLevel(this.viewpoint.targetZoom-3),this.viewpoint.calcMatrix(!0),this.viewpoint.startZoom-=3,this._renderRaf=null,this.threeRender(),setTimeout(function(){this._ToAnimation(null,b)}.bind(this),0)):(e/=b.duration,e=M.polyIn(e),this.viewpoint.updateMatrix(c[0]+b.dx*e,c[1]+b.dy*e,this.viewpoint.startZoom-3*e),this.animate(),this._animateRaf=window.requestAnimationFrame(this._flyToAnimation.bind(this,
a,b)))};D.prototype._ToAnimation=function(a,b){a||(a=performance.now());var e=performance.now()-a,c=this.viewpoint.center;e>b.duration?(this.viewpoint.setCenter([c[0]+b.dx,c[1]+b.dy]),this.viewpoint.setLevel(this.viewpoint.targetZoom),this.viewpoint.targetZoom=null,this.viewpoint.calcMatrix(!0),this._renderRaf=null,this.domNode.style.pointerEvents="all",this.threeRender()):(e/=b.duration,e=M.polyOut(e),this.viewpoint.updateMatrix(c[0]+b.dx*e,c[1]+b.dy*e,this.viewpoint.startZoom+3*e),this.animate(),
this._animateRaf=window.requestAnimationFrame(this._ToAnimation.bind(this,a,b)))};D.maxOverzooming=10;D.maxUnderzooming=3;return D})},"com/huayun/webgis/symbols/ImageSymbol":function(){define(["dojo/topic","custom/gl-matrix-min","./BaseSymbol"],function(f,d,m){var h=function(c){m.call(this,c);this.type="image";var a=c.opacity||1,g=c.size||1,l=void 0===c.isRotate?!1:c.isRotate,e=void 0===c.rotateRadian?0:c.rotateRadian;this.used=this.loaded=!1;this.width=c.width;this.height=c.height;this.angle=c.angle||
0;this.dx=c.dx||0;this.dy=c.dy||0;this.offset=void 0===c.offset?[0,0]:c.offset;var b=d.mat4.create();this.uniforms={u_size:g,u_pitch_with_map:0,u_opacity:a,u_texture:0,u_rotate_symbol:l,u_radian:e,u_modelMatrix:b};var k=new Image;k.setAttribute("crossorigin","anonymous");k.onload=function(a){this.loaded=!0;this.image=k;this.uniforms.u_texsize=[this.width,this.height];this.used&&f.publish("threeRender")}.bind(this);k.src=c.url};m&&(h.__proto__=m);h.prototype=Object.create(m&&m.prototype);return h.prototype.constructor=
h})},"com/huayun/webgis/geometry/Extent":function(){define(["./Geometry"],function(f){var d=function(d,c,a,g,l){f.call(this);this.spatialReference=l;this.xmin=d;this.ymin=c;this.xmax=a;this.ymax=g};f&&(d.__proto__=f);d.prototype=Object.create(f&&f.prototype);d.prototype.constructor=d;var m={minx:{configurable:!0},miny:{configurable:!0},maxx:{configurable:!0},maxy:{configurable:!0},width:{configurable:!1},height:{configurable:!1},center:{configurable:!1}};m.minx.get=function(){return this.xmin};m.minx.set=
function(d){this.xmin=d};m.miny.get=function(){return this.ymin};m.miny.set=function(d){this.ymin=d};m.maxx.get=function(){return this.xmax};m.maxx.set=function(d){this.xmax=d};m.maxy.get=function(){return this.ymax};m.maxy.set=function(d){this.ymax=d};m.width.get=function(){return Math.abs(this.xmax-this.xmin)};m.height.get=function(){return Math.abs(this.ymax-this.ymin)};m.center.get=function(){return{x:.5*(this.xmin+this.xmax),y:.5*(this.ymin+this.ymax),z:0,type:"point"}};d.prototype={getCenter:function(){return{x:.5*
(this.xmin+this.xmax),y:.5*(this.ymin+this.ymax),z:0,type:"point"}},getWidth:function(){return Math.abs(this.xmax-this.xmin)},getHeight:function(){return Math.abs(this.ymax-this.ymin)},equals:function(d){return d?this.xmin===d.xmin&&this.ymin===d.ymin&&this.xmax===d.xmax&&this.ymax===d.ymax:!1}};Object.defineProperties(d.prototype,m);return d})},"com/huayun/webgis/facade/MapConfigFacade":function(){define(["dojo/_base/declare","dojo/request"],function(f,d){return f("com.huayun.webgis.facade.MapConfigFacade",
null,{url:"",constructor:function(d){this._url=d.url},getMapConfigData:function(f,h){d.get(this._url,{handleAs:"json"}).then(function(c){f(c)},function(c){h(c)})}})})},"com/huayun/webgis/data/ieee754":function(){define([],function(){return{read:function(f,d,m,h,c){var a;a=8*c-h-1;var g=(1<<a)-1,l=g>>1,e=-7;c=m?c-1:0;var b=m?-1:1,k=f[d+c];c+=b;m=k&(1<<-e)-1;k>>=-e;for(e+=a;0<e;m=256*m+f[d+c],c+=b,e-=8);a=m&(1<<-e)-1;m>>=-e;for(e+=h;0<e;a=256*a+f[d+c],c+=b,e-=8);if(0===m)m=1-l;else{if(m===g)return a?
NaN:Infinity*(k?-1:1);a+=Math.pow(2,h);m-=l}return(k?-1:1)*a*Math.pow(2,m-h)},write:function(f,d,m,h,c,a){var g,l=8*a-c-1,e=(1<<l)-1,b=e>>1,k=23===c?Math.pow(2,-24)-Math.pow(2,-77):0;a=h?0:a-1;var n=h?1:-1,p=0>d||0===d&&0>1/d?1:0;d=Math.abs(d);isNaN(d)||Infinity===d?(d=isNaN(d)?1:0,h=e):(h=Math.floor(Math.log(d)/Math.LN2),1>d*(g=Math.pow(2,-h))&&(h--,g*=2),d=1<=h+b?d+k/g:d+k*Math.pow(2,1-b),2<=d*g&&(h++,g/=2),h+b>=e?(d=0,h=e):1<=h+b?(d=(d*g-1)*Math.pow(2,c),h+=b):(d=d*Math.pow(2,b-1)*Math.pow(2,c),
h=0));for(;8<=c;f[m+a]=d&255,a+=n,d/=256,c-=8);h=h<<c|d;for(l+=c;0<l;f[m+a]=h&255,a+=n,h/=256,l-=8);f[m+a-n]|=128*p}}})},"com/huayun/webgis/action/zooms/ZoomOut":function(){define(["dojo/_base/declare","../MapAction"],function(f,d){return f("com.huayun.webgis.action.zooms.ZoomOut",[d],{constructor:function(d){f.safeMixin(d);this.isActive=!1;this.view=d.view},doAction:function(){this.view.zoomOut()}})})},"com/huayun/webgis/data/GraphicIndex":function(){define(["custom/rbush","./queryIntersects","./queryIntersectsEx",
"./captureIntersects"],function(f,d,m,h){function c(a){for(var c=Infinity,e=Infinity,b=-Infinity,d=-Infinity,g=0;g<a.length;g+=1)for(var f=a[g],h=0,m=f.length;h<m;h++)var q=f[h],c=Math.min(c,q.x),e=Math.min(e,q.y),b=Math.max(b,q.x),d=Math.max(d,q.y);return{minx:c,miny:e,maxx:b,maxy:d}}var a=function(){this.tree=new f};a.prototype.insert=function(a,c){for(var e=[],b=0;b<a.length;b++){for(var d=a[b],g=[Infinity,Infinity,-Infinity,-Infinity],f=0;f<d.length;f++){var l=d[f];g[0]=Math.min(g[0],l.x);g[1]=
Math.min(g[1],l.y);g[2]=Math.max(g[2],l.x);g[3]=Math.max(g[3],l.y)}e.push({minX:g[0],minY:g[1],maxX:g[2],maxY:g[3],id:c})}this.tree.load(e)};a.prototype.insertMsc=function(a,c){for(var e=[],b=0;b<a.length;b++){for(var d=a[b],g=[Infinity,Infinity,-Infinity,-Infinity],f=0;f<d.length;f++){var l=d[f];g[0]=Math.min(g[0],l.x);g[1]=Math.min(g[1],l.y);g[2]=Math.max(g[2],l.x);g[3]=Math.max(g[3],l.y)}e.push({minX:g[0],minY:g[1],maxX:g[2],maxY:g[3],id:c})}this.tree.load(e)};a.prototype.query=function(a,f,e,
b,k){var g=c(a);f=this.tree.search({minX:g.minx-f*b,minY:g.miny-f*b,maxX:g.maxx+f*b,maxY:g.maxy+f*b});for(var l=[],h=0;h<f.length;h++)for(var m=0;m<e.length;m++)if(f[h].id===e[m].id)if(g=e[m],"multipoint"===g.feature.geometry.type)for(var q=0,u=g.feature.geometry.points.length;q<u;q++){if(d[g.symbol.type](a,g.feature.geometry.points[q],g.symbol,b,g.feature.geometry.radius,k)){l.push(g);break}}else d[g.symbol.type](a[0],g.feature.geometry,g.symbol,b,g.feature.geometry.radius,k)&&l.push(g);return l};
a.prototype.roughQuery=function(a,d,e,b,f){a=c(a);d=this.tree.search({minX:a.minx-d*b,minY:a.miny-d*b,maxX:a.maxx+d*b,maxY:a.maxy+d*b});a=[];for(f=0;f<d.length;f++)for(var g=0;g<e.length;g++)d[f].id===e[g].id&&(b=e[g],a.push(b));return a};a.prototype.captureQuery=function(a,d,e,b,f){for(var g=c(a),g=this.tree.search({minX:g.minx-d*b,minY:g.miny-d*b,maxX:g.maxx+d*b,maxY:g.maxy+d*b}),k,l=[],m=0;m<g.length;m++)for(var q=0;q<e.length;q++)g[m].id===e[q].id&&(k=e[q],h[k.symbol.type](a,k.feature.geometry,
k.symbol,b,k.feature.geometry.radius,f,d)&&l.push(k));return l};a.prototype.queryMsc=function(a,d,e,b){var g=c(a);d=this.tree.search({minX:g.minx-d*e,minY:g.miny-d*e,maxX:g.maxx+d*e,maxY:g.maxy+d*e});for(var f=[],l={width:5},h,r=0;r<d.length;r++)g=d[r],h=g.id.feature.type+"ex",-1===f.indexOf(g.id)&&m[h](a,g.id.geometry,l,e,5,b)&&f.push(g.id);return f};a.prototype.queryRender=function(a,f,e,b,k){var g=c(a);f=this.tree.search({minX:g.minx-f*b,minY:g.miny-f*b,maxX:g.maxx+f*b,maxY:g.maxy+f*b});for(var l=
[],h=0;h<f.length;h++)for(var m=0;m<e.length;m++)f[h].id===e[m].id&&(g=e[m],g.visible&&d[g.symbol.type](a,g.feature.geometry,g.symbol,b,g.feature.geometry.radius,k)&&l.push(g));return l};a.prototype.clear=function(){this.tree.clear()};return a})},"com/huayun/webgis/Viewpoint":function(){define("dojo/topic ./utils/utils ./utils/Constant custom/gl-matrix-min ./data/ArrayType ./gl/SegmentVector".split(" "),function(f,d,m,h,c,a){var g=function(e,b,d,g,f,l,m,q){this.width=e;this.height=b;this.angle=g;
this.pitch=d;this.center=[0,0];this.level=null;this.maxLevel=f||15;this.minLevel=l||1;this.resolution=0;this.tileInfo=null;this.scale=1;this._fov=.6435011087932844;this._posMatrixCache={};this.pixelsToGLUnits=[2/e,-2/b];this._tilePixelRatio=.0625;this.view=q;this.oldAngle=g;this.maxPitch=m;if(0===e||0===b)this.matrixDirty=!0;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*b;d=Math.PI/180;this._projectionMatrix=h.mat4.perspective(new Float64Array(16),this._fov,e/b,1,1E4);g=h.mat4.create();h.mat4.translate(g,
g,[0,0,-this.cameraToCenterDistance]);h.mat4.rotateX(g,g,-this.pitch*d);h.mat4.rotateZ(g,g,-this.angle*d);this._baseMatrix=g;g=h.mat4.create();h.mat4.scale(g,g,[e/2,-b/2,1]);h.mat4.translate(g,g,[1,-1,0]);this.labelPlaneMatrix=g;g=h.mat4.create();h.mat4.scale(g,g,[1,-1,1]);h.mat4.translate(g,g,[-1,-1,0]);h.mat4.scale(g,g,[2/e,2/b,1]);this.glCoordMatrix=g;this.frogHeight=0;e=new c.StructArrayLayout3ui6;e.emplaceBack(0,1,2);e.emplaceBack(2,1,3);this.quadTriangleIndexBuffer=q.context.createIndexBuffer(e);
this.rasterBoundsSegments=a.simpleSegment(0,0,4,2)},l={zoom:{configurable:!0}};l.zoom.get=function(){return this.level};l.zoom.set=function(a){return this.level=a};g.prototype.resize=function(a,b){this.width=a;this.height=b;this.pixelsToGLUnits=[2/a,-2/b];this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*b;var e=Math.PI/180;this._projectionMatrix=h.mat4.perspective(new Float64Array(16),this._fov,a/b,1,1E4);var c=h.mat4.create();h.mat4.translate(c,c,[0,0,-this.cameraToCenterDistance]);h.mat4.rotateX(c,
c,-this.pitch*e);h.mat4.rotateZ(c,c,-this.angle*e);this._baseMatrix=c;c=h.mat4.create();h.mat4.scale(c,c,[a/2,-b/2,1]);h.mat4.translate(c,c,[1,-1,0]);this.labelPlaneMatrix=c;c=h.mat4.create();h.mat4.scale(c,c,[1,-1,1]);h.mat4.translate(c,c,[-1,-1,0]);h.mat4.scale(c,c,[2/a,2/b,1]);this.glCoordMatrix=c};g.prototype.setTileInfo=function(a){this.tileInfo=a;this._tilePixelRatio=a.size/m.layout.EXTENT;this.zoomPixelRatio=(a.size+1)/m.layout.EXTENT};g.prototype.readyMatrix=function(a,b,c,d,g){g||(g=this.tileInfo.getResolution(c));
c=h.mat4.scale(new Float64Array(16),this._baseMatrix,[1/g,1/g,1/g]);c=h.mat4.translate(c,c,[-a,-b,0]);this._viewMatrix=h.mat4.clone(c);this.matrix=h.mat4.multiply(c,this._projectionMatrix,c);this.pixelMatrix=h.mat4.multiply(new Float64Array(16),this.labelPlaneMatrix,this.matrix);this.pixelMatrixInverse=h.mat4.invert(new Float64Array(16),this.pixelMatrix);a/=g;b/=g;c=this.width%2/2;var e=this.height%2/2,f=Math.cos(this.angle),k=Math.sin(this.angle);a=a-Math.round(a)+f*c+k*e;b=b-Math.round(b)+f*e+k*
c;c=new Float64Array(this.matrix);h.mat4.translate(c,c,[(.5<a?a-1:a)*g,(.5<b?b-1:b)*g,0]);this.alignedProjMatrix=c;d&&(this._posMatrixCache={},this._alignedPosMatrixCache={})};g.prototype.calcMatrix=function(a){var b=this.center[0],e=this.center[1],c=this.resolution;c||(c=this.resolution=this.tileInfo.getResolution(this.level));var d=h.mat4.scale(new Float64Array(16),this._baseMatrix,[1/c,1/c,1/c]),d=h.mat4.translate(d,d,[-b,-e,0]);this._viewMatrix=h.mat4.clone(d);this.matrix=h.mat4.multiply(d,this._projectionMatrix,
d);this.pixelMatrix=h.mat4.multiply(new Float64Array(16),this.labelPlaneMatrix,this.matrix);this.pixelMatrixInverse=h.mat4.invert(new Float64Array(16),this.pixelMatrix);d=h.mat4.set(new Float32Array(16),1,0,0,0,0,1,0,0,0,0,1,0,b,e,0,1);h.mat4.multiply(d,this.matrix,d);this.centerMatrix=d;var b=b/c,e=e/c,d=this.width%2/2,g=this.height%2/2,l=Math.cos(this.angle),m=Math.sin(this.angle),b=b-Math.round(b)+l*d+m*g,e=e-Math.round(e)+l*g+m*d,d=new Float64Array(this.matrix);h.mat4.translate(d,d,[(.5<b?b-1:
b)*c,(.5<e?e-1:e)*c,0]);this.alignedProjMatrix=d;a&&(this._posMatrixCache={},this._alignedPosMatrixCache={});f.publish("frameUpdate")};g.prototype.setView=function(a){this.pitch=a.pitch;this.angle=a.angle;this.setLevel(a.level);this.setCenter([a.center[0],a.center[1]]);a=h.mat4.create();h.mat4.translate(a,a,[0,0,-this.cameraToCenterDistance]);h.mat4.rotateX(a,a,-this.pitch/180*Math.PI);h.mat4.rotateZ(a,a,-this.angle/180*Math.PI);this._baseMatrix=a};g.prototype.updateBaseMatrix=function(){var a=h.mat4.create();
h.mat4.translate(a,a,[0,0,-this.cameraToCenterDistance]);h.mat4.rotateX(a,a,-this.pitch/180*Math.PI);h.mat4.rotateZ(a,a,-this.angle/180*Math.PI);this._baseMatrix=a;this.calcMatrix(!0)};g.prototype.updateMatrix=function(a,b,c,d){c&&(this.setLevel(c),d=this.resolution);c=h.mat4.scale(new Float64Array(16),this._baseMatrix,[1/d,1/d,1/d]);c=h.mat4.translate(c,c,[-a,-b,0]);this._viewMatrix=h.mat4.clone(c);this.matrix=h.mat4.multiply(c,this._projectionMatrix,c);this.pixelMatrix=h.mat4.multiply(new Float64Array(16),
this.labelPlaneMatrix,this.matrix);this.pixelMatrixInverse=h.mat4.invert(new Float64Array(16),this.pixelMatrix);a/=d;b/=d;c=this.width%2/2;var e=this.height%2/2,g=Math.cos(this.angle),k=Math.sin(this.angle);a=a-Math.round(a)+g*c+k*e;b=b-Math.round(b)+g*e+k*c;c=new Float64Array(this.matrix);h.mat4.translate(c,c,[(.5<a?a-1:a)*d,(.5<b?b-1:b)*d,0]);this.alignedProjMatrix=c;this._posMatrixCache={};this._alignedPosMatrixCache={};f.publish("frameUpdate")};g.prototype.updatePitch=function(a){var b=this.pitch;
this.pitch+=a;this.pitch=0>this.pitch?0:this.pitch>this.maxPitch?this.maxPitch:this.pitch;0===b&&0<this.pitch&&f.publish("mapSwitchDimension",3);0<b&&0===this.pitch&&f.publish("mapSwitchDimension",2);a=h.mat4.create();h.mat4.translate(a,a,[0,0,-this.cameraToCenterDistance]);h.mat4.rotateX(a,a,-this.pitch/180*Math.PI);h.mat4.rotateZ(a,a,-this.angle/180*Math.PI);this._baseMatrix=a;this.calcMatrix(!0)};g.prototype.screenToGeometry=function(a,b){var e=[a,b,0,1];a=[a,b,1,1];h.vec4.transformMat4(e,e,this.pixelMatrixInverse);
h.vec4.transformMat4(a,a,this.pixelMatrixInverse);b=e[3];var c=a[3],g=e[1]/b,f=a[1]/c,l=e[2]/b,m=a[2]/c,l=l===m?0:(0-l)/(m-l);return{x:d.number(e[0]/b,a[0]/c,l),y:d.number(g,f,l),z:0}};g.prototype.geometryToScreen=function(a,b,c){a=[a,b,c,1];h.vec4.transformMat4(a,a,this.pixelMatrix);b=a[3];return{x:Math.round(a[0]/b),y:Math.round(a[1]/b)}};g.prototype.calcBounds=function(){if(52>this.pitch)return this.rasterBoundsBuffer=null,[this.screenToGeometry(0,0),this.screenToGeometry(this.width,0),this.screenToGeometry(this.width,
this.height),this.screenToGeometry(0,this.height)];var a=52/this.pitch,b=(1-a)*this.height,a=a-.2,d=new c.StructArrayLayout4f16;d.emplaceBack(-1,2*a-1,0,1);d.emplaceBack(1,2*a-1,1,1);d.emplaceBack(-1,1,0,a/2);d.emplaceBack(1,1,1,a/2);this.rasterBoundsBuffer=this.view.context.createVertexBuffer(d,[{name:"a_pos",type:"Float32",components:4,offset:0}]);return[this.screenToGeometry(0,b),this.screenToGeometry(this.width,b),this.screenToGeometry(this.width,this.height),this.screenToGeometry(0,this.height)]};
g.prototype.calcBound=function(a,b,c,d){return[this.screenToGeometry(a,c),this.screenToGeometry(b,c),this.screenToGeometry(b,d),this.screenToGeometry(a,d)]};g.prototype.calculatePosMatrix=function(a,b,c){var e=a.key,d=c?this._alignedPosMatrixCache:this._posMatrixCache;if(d[e])return d[e];a=Math.pow(2,this.level-a.canonical.z);var g=this.tileInfo.getResolution(this.level),f=b[0];b=b[1];c&&(f=Math.round(f/g),b=Math.round(b/g),f*=g,b*=g);b=h.mat4.set(new Float64Array(16),this._tilePixelRatio*g,0,0,0,
0,-this._tilePixelRatio*g,0,0,0,0,1,0,f,b,0,1);h.mat4.multiply(b,c?this.alignedProjMatrix:this.matrix,b);h.mat4.scale(b,b,[a,a,1]);d[e]=new Float32Array(b);return d[e]};g.prototype.getMatrixForPoint=function(a,b,c,d,g){g=g?g:0;var e=this.resolution;d=d?-1:1;c&&(a=Math.round(a/e),b=Math.round(b/e),a*=e,b*=e);a=h.mat4.set(new Float64Array(16),1,0,0,0,0,d,0,0,0,0,1,0,a,b,g,1);h.mat4.multiply(a,c?this.alignedProjMatrix:this.matrix,a);return a=new Float32Array(a)};g.prototype.getModelViewMatrix=function(a,
b){};g.prototype.getMatrixForModel=function(a,b,c,d){var e=this.resolution;d=d?-1:1;c&&(a=Math.round(a/e),b=Math.round(b/e),a*=e,b*=e);a=h.mat4.set(new Float32Array(16),e,0,0,0,0,d*e,0,0,0,0,e,0,a,b,0,1);h.mat4.multiply(a,c?this.alignedProjMatrix:this.matrix,a);return a};g.prototype.updatePosMatrix=function(a,b,c){var e=a.key,d=c?this._alignedPosMatrixCache:this._posMatrixCache;if(d[e])return d[e];a=Math.pow(2,this.level-a.canonical.z);var g=this.tileInfo.getResolution(this.level),f=b[0];b=b[1];c&&
(f=Math.round(f/g),b=Math.round(b/g),f*=g,b*=g);b=h.mat4.set(new Float64Array(16),this.zoomPixelRatio*g,0,0,0,0,-this.zoomPixelRatio*g,0,0,0,0,1,0,f,b,0,1);h.mat4.multiply(b,c?this.alignedProjMatrix:this.matrix,b);h.mat4.scale(b,b,[a,a,1]);d[e]=new Float32Array(b);return d[e]};g.prototype.setLevel=function(a){a<this.minLevel&&(a=this.minLevel);a>this.maxLevel&&(a=this.maxLevel);this.level=a;this.tileInfo&&(this.resolution=this.tileInfo.getResolution(a))};g.prototype.setResolution=function(a,b){this.tileInfo?
b?(a=this.tileInfo.findNestZoom(a),this.resolution=a.resolution,this.level=a.level):(this.resolution=a,this.level=this.tileInfo.getLevel(a)):this.resolution=a};g.prototype.getResolution=function(a){return this.tileInfo.getResolution(a)};g.prototype.setCenter=function(a){a instanceof Array?this.center=a:a.x&&a.y&&(this.center=[a.x,a.y])};g.prototype.coveringZoomLevel=function(a){return(a.roundZoom?Math.round:Math.floor)(this.level)};g.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;
var a=this.screenToGeometry(0,0),a=[a.x,a.y,0,1];return h.vec4.transformMat4(a,a,this.pixelMatrix)[3]/this.cameraToCenterDistance};Object.defineProperties(g.prototype,l);return g})},"com/huayun/webgis/gl/BaseValue":function(){define(["require","exports","../utils/Color"],function(f,d,m){Object.defineProperty(d,"__esModule",{value:!0});f=function(){function a(a){this.gl=a.gl;this.current=this.default=this.getDefault();this.dirty=!1}a.prototype.get=function(){return this.current};a.prototype.set=function(a){};
a.prototype.getDefault=function(){return this.default};a.prototype.setDefault=function(){this.set(this.default)};return a}();d.BaseValue=f;var h=function(a){function c(c){a.call(this,c);this.vao=c.extVertexArrayObject}a&&(c.__proto__=a);c.prototype=Object.create(a&&a.prototype);c.prototype.constructor=c;c.prototype.getDefault=function(){return null};c.prototype.set=function(a){this.vao&&(a!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(a),this.current=a,this.dirty=!1)};return c}(f);d.BindVertexArrayOES=
h;h=function(a){function c(){a.apply(this,arguments)}a&&(c.__proto__=a);c.prototype=Object.create(a&&a.prototype);c.prototype.constructor=c;c.prototype.getDefault=function(){return null};c.prototype.set=function(a){var e=this.gl;e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,a);this.current=a;this.dirty=!1};return c}(f);d.BindElementBuffer=h;h=function(a){function c(){a.apply(this,arguments)}a&&(c.__proto__=a);c.prototype=Object.create(a&&a.prototype);c.prototype.constructor=c;c.prototype.getDefault=function(){return null};
c.prototype.set=function(a){if(a!==this.current||this.dirty){var e=this.gl;e.bindBuffer(e.ARRAY_BUFFER,a);this.current=a;this.dirty=!1}};return c}(f);d.BindVertexBuffer=h;h=function(a){function c(){a.apply(this,arguments)}a&&(c.__proto__=a);c.prototype=Object.create(a&&a.prototype);c.prototype.constructor=c;c.prototype.getDefault=function(){return null};c.prototype.set=function(a){if(a!==this.current||this.dirty){var e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,a);this.current=a;this.dirty=!1}};return c}(f);
d.BindFramebuffer=h;h=function(a){function c(){a.apply(this,arguments)}a&&(c.__proto__=a);c.prototype=Object.create(a&&a.prototype);c.prototype.constructor=c;c.prototype.getDefault=function(){return null};c.prototype.set=function(a){if(a!==this.current||this.dirty){var e=this.gl;e.bindRenderbuffer(e.RENDERBUFFER,a);this.current=a;this.dirty=!1}};return c}(f);d.BindRenderbuffer=h;h=function(a){function c(){a.apply(this,arguments)}a&&(c.__proto__=a);c.prototype=Object.create(a&&a.prototype);c.prototype.constructor=
c;c.prototype.getDefault=function(){return null};c.prototype.set=function(a){if(a!==this.current||this.dirty){var e=this.gl;e.bindTexture(e.TEXTURE_2D,a);this.current=a;this.dirty=!1}};return c}(f);d.BindTexture=h;h=function(a){function c(){a.apply(this,arguments)}a&&(c.__proto__=a);c.prototype=Object.create(a&&a.prototype);c.prototype.constructor=c;c.prototype.getDefault=function(){return m.transparent};c.prototype.set=function(a){var e=this.current;if(a.r!==e.r||a.g!==e.g||a.b!==e.b||a.a!==e.a||
this.dirty)this.gl.clearColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1};return c}(f);d.ClearColor=h;h=function(a){function c(){a.apply(this,arguments)}a&&(c.__proto__=a);c.prototype=Object.create(a&&a.prototype);c.prototype.constructor=c;c.prototype.getDefault=function(){return 1};c.prototype.set=function(a){if(a!==this.current||this.dirty)this.gl.clearDepth(a),this.current=a,this.dirty=!1};return c}(f);d.ClearDepth=h;h=function(a){function c(){a.apply(this,arguments)}a&&(c.__proto__=a);c.prototype=
Object.create(a&&a.prototype);c.prototype.constructor=c;c.prototype.getDefault=function(){return[!0,!0,!0,!0]};c.prototype.set=function(a){var c=this.current;if(a[0]!==c[0]||a[1]!==c[1]||a[2]!==c[2]||a[3]!==c[3]||this.dirty)this.gl.colorMask(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1};return c}(f);d.ColorMask=h;h=function(a){function c(){a.apply(this,arguments)}a&&(c.__proto__=a);c.prototype=Object.create(a&&a.prototype);c.prototype.constructor=c;c.prototype.getDefault=function(){return!0};
c.prototype.set=function(a){if(a!==this.current||this.dirty)this.gl.depthMask(a),this.current=a,this.dirty=!1};return c}(f);d.DepthMask=h;h=function(a){function c(){a.apply(this,arguments)}a&&(c.__proto__=a);c.prototype=Object.create(a&&a.prototype);c.prototype.constructor=c;c.prototype.getDefault=function(){return[0,1]};c.prototype.set=function(a){var c=this.current;if(a[0]!==c[0]||a[1]!==c[1]||this.dirty)this.gl.depthRange(a[0],a[1]),this.current=a,this.dirty=!1};return c}(f);d.DepthRange=h;h=function(a){function c(){a.apply(this,
arguments)}a&&(c.__proto__=a);c.prototype=Object.create(a&&a.prototype);c.prototype.constructor=c;c.prototype.getDefault=function(){return!1};c.prototype.set=function(a){if(a!==this.current||this.dirty){var c=this.gl;a?c.enable(c.DEPTH_TEST):c.disable(c.DEPTH_TEST);this.current=a;this.dirty=!1}};return c}(f);d.DepthTest=h;h=function(a){function c(){a.apply(this,arguments)}a&&(c.__proto__=a);c.prototype=Object.create(a&&a.prototype);c.prototype.constructor=c;c.prototype.getDefault=function(){return this.gl.LESS};
c.prototype.set=function(a){if(a!==this.current||this.dirty)this.gl.depthFunc(a),this.current=a,this.dirty=!1};return c}(f);d.DepthFunc=h;h=function(a){function c(){a.apply(this,arguments)}a&&(c.__proto__=a);c.prototype=Object.create(a&&a.prototype);c.prototype.constructor=c;c.prototype.getDefault=function(){return!1};c.prototype.set=function(a){if(a!==this.current||this.dirty){var c=this.gl;a?c.enable(c.CULL_FACE):c.disable(c.CULL_FACE);this.current=a;this.dirty=!1}};return c}(f);d.CullFace=h;h=
function(a){function c(){a.apply(this,arguments)}a&&(c.__proto__=a);c.prototype=Object.create(a&&a.prototype);c.prototype.constructor=c;c.prototype.getDefault=function(){return this.gl.BACK};c.prototype.set=function(a){if(a!==this.current||this.dirty)this.gl.cullFace(a),this.current=a,this.dirty=!1};return c}(f);d.CullFaceSide=h;h=function(a){function c(){a.apply(this,arguments)}a&&(c.__proto__=a);c.prototype=Object.create(a&&a.prototype);c.prototype.constructor=c;c.prototype.getDefault=function(){return!1};
c.prototype.set=function(a){if(a!==this.current||this.dirty){var c=this.gl;a?c.enable(c.BLEND):c.disable(c.BLEND);this.current=a;this.dirty=!1}};return c}(f);d.Blend=h;h=function(a){function c(){a.apply(this,arguments)}a&&(c.__proto__=a);c.prototype=Object.create(a&&a.prototype);c.prototype.constructor=c;c.prototype.getDefault=function(){var a=this.gl;return[a.ONE,a.ZERO]};c.prototype.set=function(a){var c=this.current;if(a[0]!==c[0]||a[1]!==c[1]||this.dirty)this.gl.blendFunc(a[0],a[1]),this.current=
a,this.dirty=!1};return c}(f);d.BlendFunc=h;h=function(a){function c(){a.apply(this,arguments)}a&&(c.__proto__=a);c.prototype=Object.create(a&&a.prototype);c.prototype.constructor=c;c.prototype.getDefault=function(){return m.transparent};c.prototype.set=function(a){var c=this.current;if(a.r!==c.r||a.g!==c.g||a.b!==c.b||a.a!==c.a||this.dirty)this.gl.blendColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1};return c}(f);d.BlendColor=h;h=function(a){function c(){a.apply(this,arguments)}a&&(c.__proto__=
a);c.prototype=Object.create(a&&a.prototype);c.prototype.constructor=c;c.prototype.getDefault=function(){return this.gl.FUNC_ADD};c.prototype.set=function(a){if(a!==this.current||this.dirty)this.gl.blendEquation(a),this.current=a,this.dirty=!1};return c}(f);d.BlendEquation=h;h=function(a){function c(){a.apply(this,arguments)}a&&(c.__proto__=a);c.prototype=Object.create(a&&a.prototype);c.prototype.constructor=c;c.prototype.getDefault=function(){return this.gl.TEXTURE0};c.prototype.set=function(a){if(a!==
this.current||this.dirty)this.gl.activeTexture(a),this.current=a,this.dirty=!1};return c}(f);d.ActiveTextureUnit=h;h=function(a){function c(){a.apply(this,arguments)}a&&(c.__proto__=a);c.prototype=Object.create(a&&a.prototype);c.prototype.constructor=c;c.prototype.getDefault=function(){return 4};c.prototype.set=function(a){if(a!==this.current||this.dirty){var c=this.gl;c.pixelStorei(c.UNPACK_ALIGNMENT,a);this.current=a;this.dirty=!1}};return c}(f);d.PixelStoreUnpack=h;h=function(a){function c(){a.apply(this,
arguments)}a&&(c.__proto__=a);c.prototype=Object.create(a&&a.prototype);c.prototype.constructor=c;c.prototype.getDefault=function(){return!1};c.prototype.set=function(a){if(a!==this.current||this.dirty){var c=this.gl;c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a);this.current=a;this.dirty=!1}};return c}(f);d.PixelStoreUnpackPremultiplyAlpha=h;h=function(a){function c(){a.apply(this,arguments)}a&&(c.__proto__=a);c.prototype=Object.create(a&&a.prototype);c.prototype.constructor=c;c.prototype.getDefault=
function(){return!1};c.prototype.set=function(a){if(a!==this.current||this.dirty){var c=this.gl;c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,a);this.current=a;this.dirty=!1}};return c}(f);d.PixelStoreUnpackFlipY=h;h=function(a){function c(){a.apply(this,arguments)}a&&(c.__proto__=a);c.prototype=Object.create(a&&a.prototype);c.prototype.constructor=c;c.prototype.getDefault=function(){return this.gl.CCW};c.prototype.set=function(a){if(a!==this.current||this.dirty)this.gl.frontFace(a),this.current=a,this.dirty=
!1};return c}(f);d.FrontFace=h;h=function(a){function c(){a.apply(this,arguments)}a&&(c.__proto__=a);c.prototype=Object.create(a&&a.prototype);c.prototype.constructor=c;c.prototype.getDefault=function(){return 0};c.prototype.set=function(a){if(a!==this.current||this.dirty)this.gl.clearStencil(a),this.current=a,this.dirty=!1};return c}(f);d.ClearStencil=h;h=function(a){function c(){a.apply(this,arguments)}a&&(c.__proto__=a);c.prototype=Object.create(a&&a.prototype);c.prototype.constructor=c;c.prototype.getDefault=
function(){return 255};c.prototype.set=function(a){if(a!==this.current||this.dirty)this.gl.stencilMask(a),this.current=a,this.dirty=!1};return c}(f);d.StencilMask=h;h=function(a){function c(){a.apply(this,arguments)}a&&(c.__proto__=a);c.prototype=Object.create(a&&a.prototype);c.prototype.constructor=c;c.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}};c.prototype.set=function(a){var c=this.current;if(a.func!==c.func||a.ref!==c.ref||a.mask!==c.mask||this.dirty)this.gl.stencilFunc(a.func,
a.ref,a.mask),this.current=a,this.dirty=!1};return c}(f);d.StencilFunc=h;h=function(a){function c(){a.apply(this,arguments)}a&&(c.__proto__=a);c.prototype=Object.create(a&&a.prototype);c.prototype.constructor=c;c.prototype.getDefault=function(){var a=this.gl;return[a.KEEP,a.KEEP,a.KEEP]};c.prototype.set=function(a){var c=this.current;if(a[0]!==c[0]||a[1]!==c[1]||a[2]!==c[2]||this.dirty)this.gl.stencilOp(a[0],a[1],a[2]),this.current=a,this.dirty=!1};return c}(f);d.StencilOp=h;h=function(a){function c(){a.apply(this,
arguments)}a&&(c.__proto__=a);c.prototype=Object.create(a&&a.prototype);c.prototype.constructor=c;c.prototype.getDefault=function(){return!1};c.prototype.set=function(a){if(a!==this.current||this.dirty){var c=this.gl;a?c.enable(c.STENCIL_TEST):c.disable(c.STENCIL_TEST);this.current=a;this.dirty=!1}};return c}(f);d.StencilTest=h;h=function(a){function c(){a.apply(this,arguments)}a&&(c.__proto__=a);c.prototype=Object.create(a&&a.prototype);c.prototype.constructor=c;c.prototype.getDefault=function(){var a=
this.gl;return[0,0,a.drawingBufferWidth,a.drawingBufferHeight]};c.prototype.set=function(a){var c=this.current;if(a[0]!==c[0]||a[1]!==c[1]||a[2]!==c[2]||a[3]!==c[3]||this.dirty)this.gl.viewport(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1};return c}(f);d.Viewport=h;var c=function(a){function c(c,e){a.call(this,c);this.context=c;this.parent=e}a&&(c.__proto__=a);c.prototype=Object.create(a&&a.prototype);c.prototype.constructor=c;c.prototype.getDefault=function(){return null};return c}(f);d.FramebufferAttachment=
c;h=function(a){function c(){a.apply(this,arguments)}a&&(c.__proto__=a);c.prototype=Object.create(a&&a.prototype);c.prototype.constructor=c;c.prototype.setDirty=function(){this.dirty=!0};c.prototype.set=function(a){if(a!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,a,0);this.current=a;this.dirty=!1}};return c}(c);d.ColorAttachment=h;h=function(a){function c(){a.apply(this,arguments)}a&&
(c.__proto__=a);c.prototype=Object.create(a&&a.prototype);c.prototype.constructor=c;c.prototype.set=function(a){if(a!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var c=this.gl;c.framebufferRenderbuffer(c.FRAMEBUFFER,c.DEPTH_ATTACHMENT,c.RENDERBUFFER,a);this.current=a;this.dirty=!1}};return c}(c);d.DepthAttachment=h;d.Program=function(a){function c(){a.apply(this,arguments)}a&&(c.__proto__=a);c.prototype=Object.create(a&&a.prototype);c.prototype.constructor=c;c.prototype.getDefault=
function(){return null};c.prototype.set=function(a){if(a!==this.current||this.dirty)this.gl.useProgram(a),this.current=a,this.dirty=!1};return c}(f)})},"com/huayun/webgis/data/bucket/SymbolBucket":function(){define("../ArrayType ../../gl/SegmentVector ../../gl/programConfig ../../gl/dataTransfer ../../gl/members ../../geometry/Point2D ../../layers/support/EvaluationParameters ../../layers/support/expression/Formatted ../../utils/utils ../../utils/Constant".split(" "),function(f,d,m,h,c,a,g,l,e,b){function k(a,
b,c){a.sections.forEach(function(a){var e=b.layout.get("text-transform").evaluate(c,{});"uppercase"===e?a.text=a.text.toLocaleUpperCase():"lowercase"===e&&(a.text=a.text.toLocaleLowerCase())});return a}function n(a,b){var c=b.expression;if("constant"===c.kind)return{kind:"constant",layoutSize:c.evaluate(new g(a+1))};if("source"===c.kind)return{kind:"source"};var e=c.zoomStops;b=c.interpolationType;for(var d=0;d<e.length&&e[d]<=a;)d++;for(var f=d=Math.max(0,d-1);f<e.length&&e[f]<a+1;)f++;f=Math.min(e.length-
1,f);a=e[d];e=e[f];if("composite"===c.kind)return{kind:"composite",minZoom:a,maxZoom:e,interpolationType:b};f=c.evaluate(new g(a));c=c.evaluate(new g(e));return{kind:"camera",minZoom:a,maxZoom:e,minSize:f,maxSize:c,interpolationType:b}}function p(a,b,c,e,d,f,g,k){a.emplaceBack(b,c,Math.round(32*e),Math.round(32*d),f,g,k?k[0]:0,k?k[1]:0)}function t(a,b,c){a.emplaceBack(b.x,b.y,c);a.emplaceBack(b.x,b.y,c);a.emplaceBack(b.x,b.y,c);a.emplaceBack(b.x,b.y,c)}function r(a){function b(a,b,c){var e=f[a];delete f[a];
f[b]=e;g[e].geometry[0].pop();g[e].geometry[0]=g[e].geometry[0].concat(c[0]);return e}function c(a,b,c){var e=d[b];delete d[b];d[a]=e;g[e].geometry[0].shift();g[e].geometry[0]=c[0].concat(g[e].geometry[0]);return e}function e(a,b,c){b=c?b[0][b[0].length-1]:b[0][0];return a+":"+b.x+":"+b.y}for(var d={},f={},g=[],k=0,h=0;h<a.length;h++){var l=a[h],n=l.geometry;if(l=l.text?l.text.toString():null){var m=e(l,n),p=e(l,n,!0);if(m in f&&p in d&&f[m]!==d[p]){var n=c(m,p,n),q=b(m,p,g[n].geometry);delete d[m];
delete f[p];f[e(l,g[q].geometry,!0)]=q;g[n].geometry=null}else m in f?b(m,p,n):p in d?c(m,p,n):(g.push(a[h]),k++,d[m]=k-1,f[p]=k-1)}else g.push(a[h]),k++}return g.filter(function(a){return a.geometry})}var q=function(a){this.layoutVertexArray=new f.StructArrayLayout4i4ui16;this.indexArray=new f.StructArrayLayout3ui6;this.programConfigurations=a;this.segments=new d;this.dynamicLayoutVertexArray=new f.StructArrayLayout3f12;this.opacityVertexArray=new f.StructArrayLayout1ul4;this.placedSymbolArray=new f.PlacedSymbolArray};
q.prototype.upload=function(a,b,e,d){e&&(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,c.symbolLayoutAttributes.members),this.indexBuffer=a.createIndexBuffer(this.indexArray,b),this.dynamicLayoutVertexBuffer=a.createVertexBuffer(this.dynamicLayoutVertexArray,c.dynamicLayoutAttributes.members,!0),this.opacityVertexBuffer=a.createVertexBuffer(this.opacityVertexArray,c.shaderOpacityAttributes,!0),this.opacityVertexBuffer.itemSize=1);(e||d)&&this.programConfigurations.upload(a)};
q.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())};var u=function(a,b,c){this.layoutVertexArray=new a;this.layoutAttributes=b;this.indexArray=new c;this.segments=new d;this.collisionVertexArray=new f.StructArrayLayout2ub2f12};u.prototype.upload=function(a){this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,
this.layoutAttributes);this.indexBuffer=a.createIndexBuffer(this.indexArray);this.collisionVertexBuffer=a.createVertexBuffer(this.collisionVertexArray,[{name:"a_placed",components:2,type:"Uint8",offset:0},{name:"a_shift",components:2,type:"Float32",offset:4}],!0)};u.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())};h.register("SymbolBuffers",q);h.register("CollisionBuffers",
u);a=function(a){this.collisionBoxArray=a.collisionBoxArray;this.zoom=a.zoom;this.overscaling=a.overscaling;this.layers=a.layers;this.layerIds=this.layers.map(function(a){return a.id});this.index=a.index;this.pixelRatio=a.pixelRatio;this.sourceLayerIndex=a.sourceLayerIndex;this.hasPattern=!1;var b=this.layers[0]._unevaluatedLayout._values;this.textSizeData=n(this.zoom,b["text-size"]);this.iconSizeData=n(this.zoom,b["icon-size"]);var b=this.layers[0].layout,c=b.get("symbol-sort-key"),e=b.get("symbol-z-order");
this.sortFeaturesByKey="viewport-y"!==e&&void 0!==c.constantOr(1);this.sortFeaturesByY=("viewport-y"===e||"auto"===e&&!this.sortFeaturesByKey)&&(b.get("text-allow-overlap")||b.get("icon-allow-overlap")||b.get("text-ignore-placement")||b.get("icon-ignore-placement"));this.stateDependentLayerIds=this.layers.filter(function(a){return a.isStateDependent()}).map(function(a){return a.id});this.sourceID=a.sourceID};a.prototype.createArrays=function(){this.text=new q(new m.ProgramConfigurationSet(c.symbolLayoutAttributes.members,
this.layers,this.zoom,function(a){return/^text/.test(a)}));this.icon=new q(new m.ProgramConfigurationSet(c.symbolLayoutAttributes.members,this.layers,this.zoom,function(a){return/^icon/.test(a)}));this.collisionBox=new u(f.StructArrayLayout2i2i2i12,b.collisionBoxLayout,f.StructArrayLayout2ui4);this.collisionCircle=new u(f.StructArrayLayout2i2i2i12,b.collisionCircleLayout,f.StructArrayLayout3ui6);this.glyphOffsetArray=new f.GlyphOffsetArray;this.lineVertexArray=new f.SymbolLineVertexArray;this.symbolInstances=
new f.SymbolInstanceArray};a.prototype.calculateGlyphDependencies=function(a,c,e,d){for(var f=0;f<a.length;f++)if(c[a.charCodeAt(f)]=!0,e&&d){var g=b.verticalizedCharacterMap[a.charAt(f)];g&&(c[g.charCodeAt(0)]=!0)}};a.prototype.populate=function(a,c){var d=this.layers[0],f=d.layout,h=f.get("text-font"),n=f.get("text-field"),m=f.get("icon-image"),n=("constant"!==n.value.kind||0<n.value.value.toString().length)&&("constant"!==h.value.kind||0<h.value.value.length),m="constant"!==m.value.kind||m.value.value&&
0<m.value.value.length,p=f.get("symbol-sort-key");this.features=[];if(n||m){var q=c.iconDependencies;c=c.glyphDependencies;for(var v=new g(this.zoom),t=0;t<a.length;t+=1){var u=a[t],z=u.feature,D=u.index,H=u.sourceLayerIndex;if(d._featureFilter(v,z)){u=void 0;n&&(u=d.getValueAndResolveTokens("text-field",z),u=k(u instanceof l?u:l.fromString(u),d,z));var J=void 0;m&&(J=d.getValueAndResolveTokens("icon-image",z));if(u||J){var Q=this.sortFeaturesByKey?p.evaluate(z,{}):void 0,D={text:u,icon:J,index:D,
sourceLayerIndex:H,geometry:e.loadGeometry(z),properties:z.properties,type:b.geometryTypes[z.type],sortKey:Q};"undefined"!==typeof z.id&&(D.id=z.id);this.features.push(D);J&&(q[J]=!0);if(u)for(z=h.evaluate(z,{}).join(","),D="map"===f.get("text-rotation-alignment")&&"point"!==f.get("symbol-placement"),H=0,J=u.sections;H<J.length;H+=1){var Q=J[H],L=e.allowsVerticalWritingMode(u.toString()),K=Q.fontStack||z,K=c[K]=c[K]||{};this.calculateGlyphDependencies(Q.text,K,D,L)}}}}"line"===f.get("symbol-placement")&&
(this.features=r(this.features));this.sortFeaturesByKey&&this.features.sort(function(a,b){return a.sortKey-b.sortKey})}};a.prototype.update=function(a,b,c){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(a,b,this.layers,c),this.icon.programConfigurations.updatePaintArrays(a,b,this.layers,c))};a.prototype.isEmpty=function(){return 0===this.symbolInstances.length};a.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||
this.icon.programConfigurations.needsUpload};a.prototype.upload=function(a){this.uploaded||(this.collisionBox.upload(a),this.collisionCircle.upload(a));this.text.upload(a,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload);this.icon.upload(a,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload);this.uploaded=!0};a.prototype.destroy=function(){this.text.destroy();this.icon.destroy();this.collisionBox.destroy();this.collisionCircle.destroy()};
a.prototype.addToLineVertexArray=function(a,b){var c=this.lineVertexArray.length;if(void 0!==a.segment){for(var e=a.dist(b[a.segment+1]),d=a.dist(b[a.segment]),f={},g=a.segment+1;g<b.length;g++)f[g]={x:b[g].x,y:b[g].y,tileUnitDistanceFromAnchor:e},g<b.length-1&&(e+=b[g+1].dist(b[g]));for(a=a.segment||0;0<=a;a--)f[a]={x:b[a].x,y:b[a].y,tileUnitDistanceFromAnchor:d},0<a&&(d+=b[a-1].dist(b[a]));for(d=0;d<b.length;d++)a=f[d],this.lineVertexArray.emplaceBack(a.x,a.y,a.tileUnitDistanceFromAnchor)}return{lineStartIndex:c,
lineLength:this.lineVertexArray.length-c}};a.prototype.addSymbols=function(a,b,c,e,d,f,g,k,h,l){d=a.indexArray;for(var n=a.layoutVertexArray,m=a.dynamicLayoutVertexArray,q=a.segments.prepareSegment(4*b.length,a.layoutVertexArray,a.indexArray,f.sortKey),r=this.glyphOffsetArray.length,w=q.vertexLength,v=0;v<b.length;v+=1){var u=b[v],A=u.tl,y=u.tr,z=u.bl,x=u.br,B=u.tex,C=q.vertexLength,F=u.glyphOffset[1];p(n,k.x,k.y,A.x,F+A.y,B.x,B.y,c);p(n,k.x,k.y,y.x,F+y.y,B.x+B.w,B.y,c);p(n,k.x,k.y,z.x,F+z.y,B.x,
B.y+B.h,c);p(n,k.x,k.y,x.x,F+x.y,B.x+B.w,B.y+B.h,c);t(m,k,0);d.emplaceBack(C,C+1,C+2);d.emplaceBack(C+1,C+2,C+3);q.vertexLength+=4;q.primitiveLength+=2;this.glyphOffsetArray.emplaceBack(u.glyphOffset[0])}a.placedSymbolArray.emplaceBack(k.x,k.y,r,this.glyphOffsetArray.length-r,w,h,l,k.segment,c?c[0]:0,c?c[1]:0,e[0],e[1],g,!1,0);a.programConfigurations.populatePaintArrays(a.layoutVertexArray.length,f,f.index,{})};a.prototype._addCollisionDebugVertex=function(a,b,c,e,d,f){b.emplaceBack(0,0);return a.emplaceBack(c.x,
c.y,e,d,Math.round(f.x),Math.round(f.y))};a.prototype.addCollisionDebugVertices=function(a,b,c,e,d,f,g,k){var h=d.segments.prepareSegment(4,d.layoutVertexArray,d.indexArray),l=h.vertexLength,n=d.layoutVertexArray,m=d.collisionVertexArray,p=g.anchorX;g=g.anchorY;this._addCollisionDebugVertex(n,m,f,p,g,new pointGeometry(a,b));this._addCollisionDebugVertex(n,m,f,p,g,new pointGeometry(c,b));this._addCollisionDebugVertex(n,m,f,p,g,new pointGeometry(c,e));this._addCollisionDebugVertex(n,m,f,p,g,new pointGeometry(a,
e));h.vertexLength+=4;k?(a=d.indexArray,a.emplaceBack(l,l+1,l+2),a.emplaceBack(l,l+2,l+3),h.primitiveLength+=2):(a=d.indexArray,a.emplaceBack(l,l+1),a.emplaceBack(l+1,l+2),a.emplaceBack(l+2,l+3),a.emplaceBack(l+3,l),h.primitiveLength+=4)};a.prototype.addDebugCollisionBoxes=function(a,b,c){for(;a<b;a++){var e=this.collisionBoxArray.get(a),d=0<e.radius;this.addCollisionDebugVertices(e.x1,e.y1,e.x2,e.y2,d?this.collisionCircle:this.collisionBox,e.anchorPoint,c,d)}};a.prototype.generateCollisionDebugBuffers=
function(){for(var a=0;a<this.symbolInstances.length;a++){var b=this.symbolInstances.get(a);this.addDebugCollisionBoxes(b.textBoxStartIndex,b.textBoxEndIndex,b);this.addDebugCollisionBoxes(b.iconBoxStartIndex,b.iconBoxEndIndex,b)}};a.prototype._deserializeCollisionBoxesForSymbol=function(a,b,c,e,d){var f={};debugger;for(;b<c;b++){var g=a.get(b);if(0===g.radius){f.textBox={x1:g.x1,y1:g.y1,x2:g.x2,y2:g.y2,anchorPointX:g.anchorPointX,anchorPointY:g.anchorPointY};f.textFeatureIndex=g.featureIndex;break}else f.textCircles||
(f.textCircles=[],f.textFeatureIndex=g.featureIndex),f.textCircles.push(g.anchorPointX,g.anchorPointY,g.radius,g.signedDistanceFromAnchor,1)}for(c=e;c<d;c++)if(e=a.get(c),0===e.radius){f.iconBox={x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,anchorPointX:e.anchorPointX,anchorPointY:e.anchorPointY};f.iconFeatureIndex=e.featureIndex;break}return f};a.prototype.deserializeCollisionBoxes=function(a){debugger;this.collisionArrays=[];for(var b=0;b<this.symbolInstances.length;b++){var c=this.symbolInstances.get(b);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(a,
c.textBoxStartIndex,c.textBoxEndIndex,c.iconBoxStartIndex,c.iconBoxEndIndex))}};a.prototype.hasTextData=function(){return 0<this.text.segments.get().length};a.prototype.hasIconData=function(){return 0<this.icon.segments.get().length};a.prototype.hasCollisionBoxData=function(){return 0<this.collisionBox.segments.get().length};a.prototype.hasCollisionCircleData=function(){return 0<this.collisionCircle.segments.get().length};a.prototype.addIndicesForPlacedTextSymbol=function(a){var b=this.text.placedSymbolArray.get(a);
a=b.vertexStartIndex+4*b.numGlyphs;for(b=b.vertexStartIndex;b<a;b+=4)this.text.indexArray.emplaceBack(b,b+1,b+2),this.text.indexArray.emplaceBack(b+1,b+2,b+3)};a.prototype.getSortedSymbolIndexes=function(a){if(this.sortedAngle===a&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;var b=Math.sin(a);a=Math.cos(a);for(var c=[],e=[],d=[],f=0;f<this.symbolInstances.length;++f){d.push(f);var g=this.symbolInstances.get(f);c.push(Math.round(b*g.anchorX+a*g.anchorY)|0);e.push(g.featureIndex)}d.sort(function(a,
b){return c[a]-c[b]||e[b]-e[a]});return d};a.prototype.sortFeatures=function(a){var b=this;if(this.sortFeaturesByY&&this.sortedAngle!==a&&!(1<this.text.segments.get().length||1<this.icon.segments.get().length)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(a);this.sortedAngle=a;this.text.indexArray.clear();this.icon.indexArray.clear();this.featureSortOrder=[];a=0;for(var c=this.symbolInstanceIndexes;a<c.length;a+=1){var e=c[a],d=this.symbolInstances.get(e);this.featureSortOrder.push(d.featureIndex);
[d.rightJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.leftJustifiedTextSymbolIndex].forEach(function(a,c,e){0<=a&&e.indexOf(a)===c&&b.addIndicesForPlacedTextSymbol(a)});0<=d.verticalPlacedTextSymbolIndex&&this.addIndicesForPlacedTextSymbol(d.verticalPlacedTextSymbolIndex);e=this.icon.placedSymbolArray.get(e);e.numGlyphs&&(e=e.vertexStartIndex,this.icon.indexArray.emplaceBack(e,e+1,e+2),this.icon.indexArray.emplaceBack(e+1,e+2,e+3))}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray);
this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}};a.MAX_GLYPHS=65535;a.addDynamicAttributes=t;h.register("SymbolBucket",a,{omit:["layers","collisionBoxArray","features","compareText"]});return a})},"com/huayun/webgis/utils/utils":function(){define("exports custom/gl-matrix-min ./Constant ./Color ../layers/support/expression/Formatted ../data/ArrayType ../layers/support/UnitBezier ../geometry/Point".split(" "),function(f,d,m,h,c,a,g,l){function e(a){return Array.isArray(a)?
a.map(e):"object"===typeof a&&a?k(a,e):a}function b(a,b,c,e){var d=new g(a,b,c,e);return function(a){return d.solve(a)}}function k(a,b,c){var e={},d;for(d in a)e[d]=b.call(c||this,a[d],d,a);return e}function n(a,b){a=d.vec4.transformMat4([],[a.x,a.y,0,1],b);return new l(a[0]/a[3],a[1]/a[3])}function p(a,b){for(var c=!1,e=0,d=a.length-1;e<a.length;d=e++){var f=a[e],d=a[d];f.y>b.y!==d.y>b.y&&b.x<(d.x-f.x)*(b.y-f.y)/(d.y-f.y)+f.x&&(c=!c)}return c}function t(a,b,c,e){if(!(c>=e)){for(var d=a[c+e>>1],f=
c-1,g=e+1;;){do f++;while(a[f]<d);do g--;while(a[g]>d);if(f>=g)break;r(a,f,g);r(b,3*f,3*g);r(b,3*f+1,3*g+1);r(b,3*f+2,3*g+2)}t(a,b,c,g);t(a,b,g+1,e)}}function r(a,b,c){var e=a[b];a[b]=a[c];a[c]=e}function q(a,b){if(Array.isArray(a)){if(!Array.isArray(b)||a.length!==b.length)return!1;for(var c=0;c<a.length;c++)if(!q(a[c],b[c]))return!1;return!0}if("object"===typeof a&&null!==a&&null!==b){if("object"!==typeof b||Object.keys(a).length!==Object.keys(b).length)return!1;for(c in a)if(!q(a[c],b[c]))return!1;
return!0}return a===b}function u(b){return{"line-pattern":{source:a.StructArrayLayout8ui16,composite:a.StructArrayLayout8ui16},"fill-pattern":{source:a.StructArrayLayout8ui16,composite:a.StructArrayLayout8ui16},"fill-extrusion-pattern":{source:a.StructArrayLayout8ui16,composite:a.StructArrayLayout8ui16}}[b]}function z(a,b,c){return Math.min(c,Math.max(b,a))}function v(a,b){a=z(Math.floor(a),0,255);b=z(Math.floor(b),0,255);return 256*a+b}function y(a){return 746===a||747===a?!0:4352>a?!1:m.unicodeBlockLookup["Bopomofo Extended"](a)||
m.unicodeBlockLookup.Bopomofo(a)||m.unicodeBlockLookup["CJK Compatibility Forms"](a)&&!(65097<=a&&65103>=a)||m.unicodeBlockLookup["CJK Compatibility Ideographs"](a)||m.unicodeBlockLookup["CJK Compatibility"](a)||m.unicodeBlockLookup["CJK Radicals Supplement"](a)||m.unicodeBlockLookup["CJK Strokes"](a)||m.unicodeBlockLookup["CJK Symbols and Punctuation"](a)&&!(12296<=a&&12305>=a||12308<=a&&12319>=a)&&12336!==a||m.unicodeBlockLookup["CJK Unified Ideographs Extension A"](a)||m.unicodeBlockLookup["CJK Unified Ideographs"](a)||
m.unicodeBlockLookup["Enclosed CJK Letters and Months"](a)||m.unicodeBlockLookup["Hangul Compatibility Jamo"](a)||m.unicodeBlockLookup["Hangul Jamo Extended-A"](a)||m.unicodeBlockLookup["Hangul Jamo Extended-B"](a)||m.unicodeBlockLookup["Hangul Jamo"](a)||m.unicodeBlockLookup["Hangul Syllables"](a)||m.unicodeBlockLookup.Hiragana(a)||m.unicodeBlockLookup["Ideographic Description Characters"](a)||m.unicodeBlockLookup.Kanbun(a)||m.unicodeBlockLookup["Kangxi Radicals"](a)||m.unicodeBlockLookup["Katakana Phonetic Extensions"](a)||
m.unicodeBlockLookup.Katakana(a)&&12540!==a||m.unicodeBlockLookup["Halfwidth and Fullwidth Forms"](a)&&!(65288===a||65289===a||65293===a||65306<=a&&65310>=a||65339===a||65341===a||65343===a||65371<=a&&65503>=a||65507===a||65512<=a&&65519>=a)||m.unicodeBlockLookup["Small Form Variants"](a)&&!(65112<=a&&65118>=a||65123<=a&&65126>=a)||m.unicodeBlockLookup["Unified Canadian Aboriginal Syllabics"](a)||m.unicodeBlockLookup["Unified Canadian Aboriginal Syllabics Extended"](a)||m.unicodeBlockLookup["Vertical Forms"](a)||
m.unicodeBlockLookup["Yijing Hexagram Symbols"](a)||m.unicodeBlockLookup["Yi Syllables"](a)?!0:!!m.unicodeBlockLookup["Yi Radicals"](a)}var x=m.layout.EXTENT;f.now=self.performance&&self.performance.now?self.performance.now.bind(self.performance):Date.now.bind(Date);f.extend=Object.assign?Object.assign:function(a){for(var b=[],c=arguments.length-1;0<c--;)b[c]=arguments[c+1];for(c=0;c<b.length;c+=1){var e=b[c],d;for(d in e)a[d]=e[d]}return a};f.isFunction=function(a){return"object"===typeof a&&null!==
a&&!Array.isArray(a)};f.clone=e;f.asyncAll=function(a,b,c){if(!a.length)return c(null,[]);var e=a.length,d=Array(a.length),f=null;a.forEach(function(a,g){b(a,function(a,b){a&&(f=a);d[g]=b;0===--e&&c(f,d)})})};f.values=function(a){var b=[],c;for(c in a)b.push(a[c]);return b};f.isCounterClockwise=function(a,b,c){return(c.y-a.y)*(b.x-a.x)>(b.y-a.y)*(c.x-a.x)};f.number=function(a,b,c){return a*(1-c)+b*c};f.getType=function(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof
Boolean?"boolean":Array.isArray(a)?"array":null===a?"null":typeof a};f.coalesce=function(){for(var a=0;a<arguments.length;a++)if(void 0!==arguments[a])return arguments[a]};f.easeCubicInOut=function(a){if(0>=a)return 0;if(1<=a)return 1;var b=a*a,c=b*a;return 4*(.5>a?c:3*(a-b)+c-.75)};f.endsWith=function(a,b){return-1!==a.indexOf(b,a.length-b.length)};f.validateRGBA=function(a,b,c,e){return"number"===typeof a&&0<=a&&255>=a&&"number"===typeof b&&0<=b&&255>=b&&"number"===typeof c&&0<=c&&255>=c?"undefined"===
typeof e||"number"===typeof e&&0<=e&&1>=e?null:"Invalid rgba value ["+[a,b,c,e].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+("number"===typeof e?[a,b,c,e]:[a,b,c]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."};f.bezier=b;f.topDownFeatureComparator=function(a,b){return b-a};f.loadGeometry=function(a){var b=x/a.extent;a=a.loadGeometry();for(var c=0;c<a.length;c++)for(var e=a[c],d=0;d<e.length;d++){var f=e[d];f.x=Math.round(f.x*b);f.y=Math.round(f.y*b)}return a};
f.arraysIntersect=function(a,b){for(var c=0;c<a.length;c++)if(0<=b.indexOf(a[c]))return!0;return!1};f.mapObject=k;f.calculateSignedArea=function(a){for(var b=0,c=0,e=a.length,d=e-1,f=void 0,g=void 0;c<e;d=c++)f=a[c],g=a[d],b+=(g.x-f.x)*(f.y+g.y);return b};f.keysDifference=function(a,b){var c=[],e;for(e in a)e in b||c.push(e);return c};f.projectPoint=n;f.projectQueryGeometry=function(a,b){return a.map(function(a){return n(a,b)})};f.bindAll=function(a,b){a.forEach(function(a){b[a]&&(b[a]=b[a].bind(b))})};
f.getPixelPosMatrix=function(a,b){var c=d.mat4.identity([]);d.mat4.translate(c,c,[1,1,0]);d.mat4.scale(c,c,[.5*a.width,.5*a.height,1]);return d.mat4.multiply(c,c,a.calculatePosMatrix(b.toUnwrapped()))};f.polygonIntersectsBufferedPoint=function(a,b,c){if(p(a,b))return!0;a:if(c*=c,1===a.length)a=b.distSqr(a[0])<c;else{for(var e=1;e<a.length;e++){var d;d=b;var f=a[e-1],g=a[e],k=f.distSqr(g);0===k?d=d.distSqr(f):(k=((d.x-f.x)*(g.x-f.x)+(d.y-f.y)*(g.y-f.y))/k,d=0>k?d.distSqr(f):1<k?d.distSqr(g):d.distSqr(g.sub(f)._mult(k)._add(f)));
if(d<c){a=!0;break a}}a=!1}return a?!0:!1};f.polygonContainsPoint=p;f.sortTilesIn=function(a,b){a=a.tileID;b=b.tileID;return a.overscaledZ-b.overscaledZ||a.canonical.y-b.canonical.y||a.wrap-b.wrap||a.canonical.x-b.canonical.x};f.ease=b(.25,.1,.25,1);f.isEntirelyOutside=function(a){return a.every(function(a){return 0>a.x})||a.every(function(a){return a.x>x})||a.every(function(a){return 0>a.y})||a.every(function(a){return a.y>x})};f.isBoundaryEdge=function(a,b){return a.x===b.x&&(0>a.x||a.x>x)||a.y===
b.y&&(0>a.y||a.y>x)};f.pick=function(a,b){for(var c={},e=0;e<b.length;e++){var d=b[e];d in a&&(c[d]=a[d])}return c};f.align=function(a,b){return Math.ceil(a/b)*b};f.sort=t;f.swap=r;f.deepEqual=q;f.supportsPropertyExpression=function(a){return"data-driven"===a["property-type"]||"cross-faded-data-driven"===a["property-type"]};f.supportsZoomExpression=function(a){return!!a.expression&&-1<a.expression.parameters.indexOf("zoom")};f.supportsInterpolation=function(a){return!!a.expression&&a.expression.interpolated};
f.findStopLessThanOrEqualTo=function(a,b){for(var c=a.length-1,e=0,d=c,f=0,g,k;e<=d;)if(f=Math.floor((e+d)/2),g=a[f],k=a[f+1],g<=b){if(f===c||b<k)return f;e=f+1}else if(g>b)d=f-1;else throw Error("Input is not a number.");return 0};f.pixelsToTileUnits=function(a,b,c){return m.layout.EXTENT/(a.tileSize*Math.pow(2,c-a.tileID.overscaledZ))*b};f.paintAttributeNames=function(a,b){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],
"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from"],"fill-pattern":["pattern_to","pattern_from"],"fill-extrusion-pattern":["pattern_to","pattern_from"]}[a]||[a.replace(b+"-","").replace(/-/g,"_")]};f.getLayoutException=u;f.layoutType=function(b,c,e){var d={color:{source:a.StructArrayLayout2f8,composite:a.StructArrayLayout4f16},
number:{source:a.StructArrayLayout1f4,composite:a.StructArrayLayout2f8}};return(b=u(b))&&b[e]||d[c][e]};f.clamp=z;f.packUint8ToFloat=v;f.packColor=function(a){return[v(255*a.r,255*a.g),v(255*a.b,255*a.a)]};f.charHasUprightVerticalOrientation=y;f.allowsVerticalWritingMode=function(a){for(var b=0;b<a.length;b+=1)if(y(a[b].charCodeAt(0)))return!0;return!1};f.compareKeyZoom=function(a,b){return a%32-b%32||b-a}})},"dojo/request":function(){define(["./request/default!"],function(f){return f})},"com/huayun/webgis/symbols/support/lineDashTexture":function(){define(["exports",
"../../gl/LineAtlas"],function(f,d){d=new d(256,256);f.lineAtlas=d})},"com/huayun/webgis/handler/TouchHandler":function(){define(["dojo/_base/declare","dojo/on"],function(f,d,m){return f("com.huayun.webgis.handler.TouchHandler",[],{view:null,_touch:!1,_zoom:!1,_fromX:0,_fromY:0,_fromX1:0,_fromY1:0,_toX:0,_toY:0,_toX1:0,_toY1:0,touchMove:null,touchUp:null,touchRaf:null,mapTouchTolerance:0,isTouching:!1,isZooming:!1,zoomUp:null,zoomMove:null,constructor:function(f){this.view=f;this.mapTouchTolerance=
3;this.touchRaf=null;var c=this;d(f.domNode,"touchstart",function(a){a.preventDefault();var g=a.targetTouches||a.touches;2>g.length&&f.panEnabled&&(c._fromX=a.targetTouches[0].clientX,c._fromY=a.targetTouches[0].clientY,c._touch=!0,c.isTouching||(c._toX=a.targetTouches[0].clientX,c._toY=a.targetTouches[0].clientY),c.touchMove=d(document,"touchmove",function(a){c.touchMoveHandler(a)}),c.touchUp=d(document,"touchend",function(a){c.touchUpHandler(a)}),c.enterFrameHandler());if(1<g.length&&f.zoomEnabled){c._touch=
!1;c.isTouching=!1;c.touchMove&&(c.touchMove.remove(),c.touchUp.remove());c._zoom=!0;var g=a.targetTouches[0].clientX,h=a.targetTouches[1].clientX,e=a.targetTouches[0].clientY;a=a.targetTouches[1].clientY;c.cx=(g+h)/2;c.cy=(e+a)/2;c.lastLen=Math.sqrt((g-h)*(g-h)+(e-a)*(e-a));c.zoomMove=d(document,"touchmove",c.zoomMoveHandler.bind(c));c.zoomEnd=d(document,"touchend",c.zoomEndHandle.bind(c))}})},zoomEndHandle:function(d){if(this.view.zoomEnabled){var c=d.touches||d.targetTouches;d=c[0].clientX-c[1].clientX;
c=c[0].clientY-c[1].clientY;d=Math.sqrt(d*d+c*c);5<d-this.lastLen?(this.view.zoomInWheel(this.cx,this.cy),this.lastLen=d):-5>d-this.lastLen&&(this.view.zoomOutWheel(this.cx,this.cy),this.lastLen=d)}this.zoomMove.remove();this.zoomEnd.remove()},zoomMoveHandler:function(d){if(this.view.zoomEnabled){var c=d.touches||d.targetTouches;d=c[0].clientX-c[1].clientX;c=c[0].clientY-c[1].clientY;d=Math.sqrt(d*d+c*c);5<d-this.lastLen?(this.view.zoomInWheel(this.cx,this.cy),this.lastLen=d):-5>d-this.lastLen&&(this.view.zoomOutWheel(this.cx,
this.cy),this.lastLen=d)}},touchMoveHandler:function(d){2>(d.targetTouches||d.touches).length&&(this._toX=d.targetTouches[0].clientX,this._toY=d.targetTouches[0].clientY)},touchUpHandler:function(d){2>(d.targetTouches||d.touches).length&&(this.isTouching&&(this.isTouching=!1,this.view.stopMove()),this._touch=!1,this.touchMove.remove(),this.touchUp.remove(),this.view.handlePushViewState(),window.cancelAnimationFrame(this.touchRaf))},enterFrameHandler:function(){if(this._touch){var d=this._toX-this._fromX,
c=this._toY-this._fromY;if(this.isTouching)5>Math.abs(c)&&5>Math.abs(d)?(this.isTouching=!1,this.view.stopMove()):(this.isTouching=!0,this.view.mapMove(d,c)),this._fromX=this._toX,this._fromY=this._toY;else if(Math.abs(d)>=this.mapTouchTolerance||Math.abs(c)>=this.mapTouchTolerance)this.isTouching=!0,this._fromX=this._toX,this._fromY=this._toY;this.touchRaf=window.requestAnimationFrame(this.enterFrameHandler.bind(this))}}})})},"com/huayun/webgis/layers/support/expression/FormattedSection":function(){define([],
function(){return function(f,d,m){this.text=f;this.scale=d;this.fontStack=m}})}}});
require({cache:{"dojo/_base/html":function(){define("./kernel ../dom ../dom-style ../dom-attr ../dom-prop ../dom-class ../dom-construct ../dom-geometry".split(" "),function(f,d,m,h,c,a,g,l){f.byId=d.byId;f.isDescendant=d.isDescendant;f.setSelectable=d.setSelectable;f.getAttr=h.get;f.setAttr=h.set;f.hasAttr=h.has;f.removeAttr=h.remove;f.getNodeProp=h.getNodeProp;f.attr=function(a,b,c){return 2==arguments.length?h["string"==typeof b?"get":"set"](a,b):h.set(a,b,c)};f.hasClass=a.contains;f.addClass=a.add;
f.removeClass=a.remove;f.toggleClass=a.toggle;f.replaceClass=a.replace;f._toDom=f.toDom=g.toDom;f.place=g.place;f.create=g.create;f.empty=function(a){g.empty(a)};f._destroyElement=f.destroy=function(a){g.destroy(a)};f._getPadExtents=f.getPadExtents=l.getPadExtents;f._getBorderExtents=f.getBorderExtents=l.getBorderExtents;f._getPadBorderExtents=f.getPadBorderExtents=l.getPadBorderExtents;f._getMarginExtents=f.getMarginExtents=l.getMarginExtents;f._getMarginSize=f.getMarginSize=l.getMarginSize;f._getMarginBox=
f.getMarginBox=l.getMarginBox;f.setMarginBox=l.setMarginBox;f._getContentBox=f.getContentBox=l.getContentBox;f.setContentSize=l.setContentSize;f._isBodyLtr=f.isBodyLtr=l.isBodyLtr;f._docScroll=f.docScroll=l.docScroll;f._getIeDocumentElementOffset=f.getIeDocumentElementOffset=l.getIeDocumentElementOffset;f._fixIeBiDiScrollLeft=f.fixIeBiDiScrollLeft=l.fixIeBiDiScrollLeft;f.position=l.position;f.marginBox=function(a,b){return b?l.setMarginBox(a,b):l.getMarginBox(a)};f.contentBox=function(a,b){return b?
l.setContentSize(a,b):l.getContentBox(a)};f.coords=function(a,b){f.deprecated("dojo.coords()","Use dojo.position() or dojo.marginBox().");a=d.byId(a);var c=m.getComputedStyle(a),c=l.getMarginBox(a,c);a=l.position(a,b);c.x=a.x;c.y=a.y;return c};f.getProp=c.get;f.setProp=c.set;f.prop=function(a,b,d){return 2==arguments.length?c["string"==typeof b?"get":"set"](a,b):c.set(a,b,d)};f.getStyle=m.get;f.setStyle=m.set;f.getComputedStyle=m.getComputedStyle;f.__toPixelValue=f.toPixelValue=m.toPixelValue;f.style=
function(a,b,c){switch(arguments.length){case 1:return m.get(a);case 2:return m["string"==typeof b?"get":"set"](a,b)}return m.set(a,b,c)};return f})},"dijit/tree/TreeStoreModel":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare","dojo/_base/lang"],function(f,d,m,h){return m("dijit.tree.TreeStoreModel",null,{store:null,childrenAttrs:["children"],newItemIdAttr:"id",labelAttr:"",root:null,query:null,deferItemLoadingUntilExpand:!1,constructor:function(c){h.mixin(this,c);this.connects=
[];c=this.store;if(!c.getFeatures()["dojo.data.api.Identity"])throw Error("dijit.tree.TreeStoreModel: store must support dojo.data.Identity");c.getFeatures()["dojo.data.api.Notification"]&&(this.connects=this.connects.concat([d.after(c,"onNew",h.hitch(this,"onNewItem"),!0),d.after(c,"onDelete",h.hitch(this,"onDeleteItem"),!0),d.after(c,"onSet",h.hitch(this,"onSetItem"),!0)]))},destroy:function(){for(var c;c=this.connects.pop();)c.remove()},getRoot:function(c,a){this.root?c(this.root):this.store.fetch({query:this.query,
onComplete:h.hitch(this,function(a){if(1!=a.length)throw Error("dijit.tree.TreeStoreModel: root query returned "+a.length+" items, but must return exactly one");this.root=a[0];c(this.root)}),onError:a})},mayHaveChildren:function(c){return f.some(this.childrenAttrs,function(a){return this.store.hasAttribute(c,a)},this)},getChildren:function(c,a,d){var g=this.store;if(g.isItemLoaded(c)){for(var e=[],b=0;b<this.childrenAttrs.length;b++)var k=g.getValues(c,this.childrenAttrs[b]),e=e.concat(k);var n=0;
this.deferItemLoadingUntilExpand||f.forEach(e,function(a){g.isItemLoaded(a)||n++});0==n?a(e):f.forEach(e,function(b,c){g.isItemLoaded(b)||g.loadItem({item:b,onItem:function(b){e[c]=b;0==--n&&a(e)},onError:d})})}else{var m=h.hitch(this,arguments.callee);g.loadItem({item:c,onItem:function(b){m(b,a,d)},onError:d})}},isItem:function(c){return this.store.isItem(c)},fetchItemByIdentity:function(c){this.store.fetchItemByIdentity(c)},getIdentity:function(c){return this.store.getIdentity(c)},getLabel:function(c){return this.labelAttr?
this.store.getValue(c,this.labelAttr):this.store.getLabel(c)},newItem:function(c,a,d){var f={parent:a,attribute:this.childrenAttrs[0]},e;this.newItemIdAttr&&c[this.newItemIdAttr]?this.fetchItemByIdentity({identity:c[this.newItemIdAttr],scope:this,onItem:function(b){b?this.pasteItem(b,null,a,!0,d):(e=this.store.newItem(c,f))&&void 0!=d&&this.pasteItem(e,a,a,!1,d)}}):(e=this.store.newItem(c,f))&&void 0!=d&&this.pasteItem(e,a,a,!1,d)},pasteItem:function(c,a,d,h,e){var b=this.store,g=this.childrenAttrs[0];
a&&f.forEach(this.childrenAttrs,function(e){if(b.containsValue(a,e,c)){if(!h){var d=f.filter(b.getValues(a,e),function(a){return a!=c});b.setValues(a,e,d)}g=e}});if(d)if("number"==typeof e){var l=b.getValues(d,g).slice();l.splice(e,0,c);b.setValues(d,g,l)}else b.setValues(d,g,b.getValues(d,g).concat(c))},onChange:function(){},onChildrenChange:function(){},onDelete:function(){},onNewItem:function(c,a){a&&this.getChildren(a.item,h.hitch(this,function(c){this.onChildrenChange(a.item,c)}))},onDeleteItem:function(c){this.onDelete(c)},
onSetItem:function(c,a){if(-1!=f.indexOf(this.childrenAttrs,a))this.getChildren(c,h.hitch(this,function(a){this.onChildrenChange(c,a)}));else this.onChange(c)}})})},"dojo/_base/Deferred":function(){define("./kernel ../Deferred ../promise/Promise ../errors/CancelError ../has ./lang ../when".split(" "),function(f,d,m,h,c,a,g){var l=function(){},e=Object.freeze||function(){},b=f.Deferred=function(f){function g(a){if(r)throw Error("This deferred has already been resolved");t=a;r=!0;k()}function k(){for(var b;!b&&
y;){var e=y;y=y.next;if(b=e.progress==l)r=!1;var f=z?e.error:e.resolved;c("config-useDeferredInstrumentation")&&z&&d.instrumentRejected&&d.instrumentRejected(t,!!f);if(f)try{var g=f(t);g&&"function"===typeof g.then?g.then(a.hitch(e.deferred,"resolve"),a.hitch(e.deferred,"reject"),a.hitch(e.deferred,"progress")):(f=b&&void 0===g,b&&!f&&(z=g instanceof Error),e.deferred[f&&z?"reject":"resolve"](f?t:g))}catch(F){e.deferred.reject(F)}else z?e.deferred.reject(t):e.deferred.resolve(t)}}var t,r,q,u,z,v,
y,x=this.promise=new m;this.isResolved=x.isResolved=function(){return 0==u};this.isRejected=x.isRejected=function(){return 1==u};this.isFulfilled=x.isFulfilled=function(){return 0<=u};this.isCanceled=x.isCanceled=function(){return q};this.resolve=this.callback=function(a){this.fired=u=0;this.results=[a,null];g(a)};this.reject=this.errback=function(a){z=!0;this.fired=u=1;c("config-useDeferredInstrumentation")&&d.instrumentRejected&&d.instrumentRejected(a,!!y);g(a);this.results=[null,a]};this.progress=
function(a){for(var b=y;b;){var c=b.progress;c&&c(a);b=b.next}};this.addCallbacks=function(a,b){this.then(a,b,l);return this};x.then=this.then=function(a,c,e){var d=e==l?this:new b(x.cancel);a={resolved:a,error:c,progress:e,deferred:d};y?v=v.next=a:y=v=a;r&&k();return d.promise};var w=this;x.cancel=this.cancel=function(){if(!r){var a=f&&f(w);r||(a instanceof Error||(a=new h(a)),a.log=!1,w.reject(a))}q=!0};e(x)};a.extend(b,{addCallback:function(b){return this.addCallbacks(a.hitch.apply(f,arguments))},
addErrback:function(b){return this.addCallbacks(null,a.hitch.apply(f,arguments))},addBoth:function(b){var c=a.hitch.apply(f,arguments);return this.addCallbacks(c,c)},fired:-1});b.when=f.when=g;return b})},"dijit/tree/_dndSelector":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/kernel dojo/_base/lang dojo/dnd/common dojo/dom dojo/mouse dojo/on dojo/touch ../a11yclick ./_dndContainer".split(" "),function(f,d,m,h,c,a,g,l,e,b,k){return d("dijit.tree._dndSelector",k,{constructor:function(){this.selection=
{};this.anchor=null;this.events.push(l(this.tree.domNode,e.press,h.hitch(this,"onMouseDown")),l(this.tree.domNode,e.release,h.hitch(this,"onMouseUp")),l(this.tree.domNode,e.move,h.hitch(this,"onMouseMove")),l(this.tree.domNode,b.press,h.hitch(this,"onClickPress")),l(this.tree.domNode,b.release,h.hitch(this,"onClickRelease")))},singular:!1,getSelectedTreeNodes:function(){var a=[],b=this.selection,c;for(c in b)a.push(b[c]);return a},selectNone:function(){this.setSelection([]);return this},destroy:function(){this.inherited(arguments);
this.selection=this.anchor=null},addTreeNode:function(a,b){this.setSelection(this.getSelectedTreeNodes().concat([a]));b&&(this.anchor=a);return a},removeTreeNode:function(b){var c=f.filter(this.getSelectedTreeNodes(),function(c){return!a.isDescendant(c.domNode,b.domNode)});this.setSelection(c);return b},isTreeNodeSelected:function(a){return a.id&&!!this.selection[a.id]},setSelection:function(a){var b=this.getSelectedTreeNodes();f.forEach(this._setDifference(b,a),h.hitch(this,function(a){a.setSelected(!1);
this.anchor==a&&delete this.anchor;delete this.selection[a.id]}));f.forEach(this._setDifference(a,b),h.hitch(this,function(a){a.setSelected(!0);this.selection[a.id]=a}));this._updateSelectionProperties()},_setDifference:function(a,b){f.forEach(b,function(a){a.__exclude__=!0});a=f.filter(a,function(a){return!a.__exclude__});f.forEach(b,function(a){delete a.__exclude__});return a},_updateSelectionProperties:function(){var a=this.getSelectedTreeNodes(),b=[],c=[];f.forEach(a,function(a){var e=a.getTreePath();
c.push(a);b.push(e)},this);a=f.map(c,function(a){return a.item});this.tree._set("paths",b);this.tree._set("path",b[0]||[]);this.tree._set("selectedNodes",c);this.tree._set("selectedNode",c[0]||null);this.tree._set("selectedItems",a);this.tree._set("selectedItem",a[0]||null)},onClickPress:function(a){if(!(this.current&&this.current.isExpandable&&this.tree.isExpandoNode(a.target,this.current))){"mousedown"==a.type&&g.isLeft(a)&&a.preventDefault();var b="keydown"==a.type?this.tree.focusedChild:this.current;
if(b){var e=c.getCopyKeyState(a),d=b.id;this.singular||a.shiftKey||!this.selection[d]?(this._doDeselect=!1,this.userSelect(b,e,a.shiftKey)):this._doDeselect=!0}}},onClickRelease:function(a){this._doDeselect&&(this._doDeselect=!1,this.userSelect("keyup"==a.type?this.tree.focusedChild:this.current,c.getCopyKeyState(a),a.shiftKey))},onMouseMove:function(){this._doDeselect=!1},onMouseDown:function(){},onMouseUp:function(){},_compareNodes:function(a,b){if(a===b)return 0;if("sourceIndex"in document.documentElement)return a.sourceIndex-
b.sourceIndex;if("compareDocumentPosition"in document.documentElement)return a.compareDocumentPosition(b)&2?1:-1;if(document.createRange){var c=doc.createRange();c.setStartBefore(a);a=doc.createRange();a.setStartBefore(b);return c.compareBoundaryPoints(c.END_TO_END,a)}throw Error("dijit.tree._compareNodes don't know how to compare two different nodes in this browser");},userSelect:function(a,b,c){if(this.singular)this.anchor==a&&b?this.selectNone():(this.setSelection([a]),this.anchor=a);else if(c&&
this.anchor){b=this._compareNodes(this.anchor.rowNode,a.rowNode);c=this.anchor;0>b?b=c:(b=a,a=c);for(c=[];b!=a;)c.push(b),b=this.tree._getNext(b);c.push(a);this.setSelection(c)}else this.selection[a.id]&&b?this.removeTreeNode(a):b?this.addTreeNode(a,!0):(this.setSelection([a]),this.anchor=a)},getItem:function(a){return{data:this.selection[a],type:["treeNode"]}},forInSelectedItems:function(a,b){b=b||m.global;for(var c in this.selection)a.call(b,this.getItem(c),c,this)}})})},"dojo/uacss":function(){define(["./dom-geometry",
"./_base/lang","./domReady","./sniff","./_base/window"],function(f,d,m,h,c){var a=c.doc.documentElement;c=h("ie");var g=h("trident"),l=h("opera"),e=Math.floor,b=h("ff"),k=f.boxModel.replace(/-/,""),l={dj_quirks:h("quirks"),dj_opera:l,dj_khtml:h("khtml"),dj_webkit:h("webkit"),dj_safari:h("safari"),dj_chrome:h("chrome"),dj_edge:h("edge"),dj_gecko:h("mozilla"),dj_ios:h("ios"),dj_android:h("android")};c&&(l.dj_ie=!0,l["dj_ie"+e(c)]=!0,l.dj_iequirks=h("quirks"));g&&(l.dj_trident=!0,l["dj_trident"+e(g)]=
!0);b&&(l["dj_ff"+e(b)]=!0);l["dj_"+k]=!0;var n="",p;for(p in l)l[p]&&(n+=p+" ");a.className=d.trim(a.className+" "+n);m(function(){if(!f.isBodyLtr()){var b="dj_rtl dijitRtl "+n.replace(/ /g,"-rtl ");a.className=d.trim(a.className+" "+b+"dj_rtl dijitRtl "+n.replace(/ /g,"-rtl "))}});return h})},"dojo/request/watch":function(){define("./util ../errors/RequestTimeoutError ../errors/CancelError ../_base/array ../_base/window ../has!host-browser?dom-addeventlistener?:../on:".split(" "),function(f,d,m,
h,c,a){function g(){for(var a=+new Date,c=0,f;c<b.length&&(f=b[c]);c++){var g=f.response,h=g.options;f.isCanceled&&f.isCanceled()||f.isValid&&!f.isValid(g)?(b.splice(c--,1),l._onAction&&l._onAction()):f.isReady&&f.isReady(g)?(b.splice(c--,1),f.handleResponse(g),l._onAction&&l._onAction()):f.startTime&&f.startTime+(h.timeout||0)<a&&(b.splice(c--,1),f.cancel(new d("Timeout exceeded",g)),l._onAction&&l._onAction())}l._onInFlight&&l._onInFlight(f);b.length||(clearInterval(e),e=null)}function l(a){a.response.options.timeout&&
(a.startTime=+new Date);a.isFulfilled()||(b.push(a),e||(e=setInterval(g,50)),a.response.options.sync&&g())}var e=null,b=[];l.cancelAll=function(){try{h.forEach(b,function(a){try{a.cancel(new m("All requests canceled."))}catch(n){}})}catch(k){}};c&&a&&c.doc.attachEvent&&a(c.global,"unload",function(){l.cancelAll()});return l})},"dojo/text":function(){define(["./_base/kernel","require","./has","./request"],function(f,d,m,h){var c;c=function(a,c,e){h(a,{sync:!!c,headers:{"X-Requested-With":null}}).then(e)};
var a={},g=function(a){if(a){a=a.replace(/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,"");var b=a.match(/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im);b&&(a=b[1])}else a="";return a},l={},e={};f.cache=function(b,e,f){var k;"string"==typeof b?/\//.test(b)?(k=b,f=e):k=d.toUrl(b.replace(/\./g,"/")+(e?"/"+e:"")):(k=b+"",f=e);b=void 0!=f&&"string"!=typeof f?f.value:f;f=f&&f.sanitize;if("string"==typeof b)return a[k]=b,f?g(b):b;if(null===b)return delete a[k],null;k in a||c(k,!0,function(b){a[k]=
b});return f?g(a[k]):a[k]};return{dynamic:!0,normalize:function(a,c){a=a.split("!");var b=a[0];return(/^\./.test(b)?c(b):b)+(a[1]?"!"+a[1]:"")},load:function(b,d,f){b=b.split("!");var k=1<b.length,h=b[0],m=d.toUrl(b[0]);b="url:"+m;var n=l,u=function(a){f(k?g(a):a)};h in a?n=a[h]:d.cache&&b in d.cache?n=d.cache[b]:m in a&&(n=a[m]);if(n===l)if(e[m])e[m].push(u);else{var z=e[m]=[u];c(m,!d.async,function(b){a[h]=a[m]=b;for(var c=0;c<z.length;)z[c++](b);delete e[m]})}else u(n)}}})},"com/huayun/webgis/widget/MapModuleX":function(){define(["dojo/_base/declare",
"dojo/dom-style","../../widget/ModuleX","../../util/StringHelp"],function(f,d,m,h){return f("com.huayun.webgis.wedget.MapModuleX",[m],{_map:null,_mapModuleBeanId:"",_view:null,constructor:function(c){this._map=c.map;this._view=c.view},doInit:function(){},_getMapAttr:function(){if(this._map)return this._map;for(var c=this.get("propertys"),a=0;a<c.length;a++)if("mapModuleBeanId"===c[a].name)return this._mapModuleBeanId=c[a].value,this._map=this.context.lookUp(this._mapModuleBeanId).map},_getViewAttr:function(){if(this._view)return this._view;
for(var c=this.get("propertys"),a=0;a<c.length;a++)if("mapModuleBeanId"===c[a].name)return this._mapModuleBeanId=c[a].value,this.context.lookUp(this._mapModuleBeanId).view}})})},"dijit/hccss":function(){define(["dojo/dom-class","dojo/hccss","dojo/domReady","dojo/_base/window"],function(f,d,m,h){m(function(){d("highcontrast")&&f.add(h.body(),"dijit_a11y")});return d})},"dijit/_Contained":function(){define(["dojo/_base/declare","./registry"],function(f,d){return f("dijit._Contained",null,{_getSibling:function(d){var f=
this.getParent();return f&&f._getSiblingOfChild&&f._getSiblingOfChild(this,"previous"==d?-1:1)||null},getPreviousSibling:function(){return this._getSibling("previous")},getNextSibling:function(){return this._getSibling("next")},getIndexInParent:function(){var d=this.getParent();return d&&d.getIndexOfChild?d.getIndexOfChild(this):-1}})})},"dojo/dom-form":function(){define(["./_base/lang","./dom","./io-query","./json"],function(f,d,m,h){var c={fieldToObject:function(a){var c=null;if(a=d.byId(a)){var f=
a.name,e=(a.type||"").toLowerCase();if(f&&e&&!a.disabled)if("radio"==e||"checkbox"==e)a.checked&&(c=a.value);else if(a.multiple)for(c=[],a=[a.firstChild];a.length;)for(f=a.pop();f;f=f.nextSibling)if(1==f.nodeType&&"option"==f.tagName.toLowerCase())f.selected&&c.push(f.value);else{f.nextSibling&&a.push(f.nextSibling);f.firstChild&&a.push(f.firstChild);break}else c=a.value}return c},toObject:function(a){var g={};a=d.byId(a).elements;for(var h=0,e=a.length;h<e;++h){var b=a[h],k=b.name,m=(b.type||"").toLowerCase();
if(k&&m&&0>"file|submit|image|reset|button".indexOf(m)&&!b.disabled){var p=g,t=k,b=c.fieldToObject(b);if(null!==b){var r=p[t];"string"==typeof r?p[t]=[r,b]:f.isArray(r)?r.push(b):p[t]=b}"image"==m&&(g[k+".x"]=g[k+".y"]=g[k].x=g[k].y=0)}}return g},toQuery:function(a){return m.objectToQuery(c.toObject(a))},toJson:function(a,d){return h.stringify(c.toObject(a),null,d?4:0)}};return c})},"dijit/Viewport":function(){define(["dojo/Evented","dojo/on","dojo/domReady","dojo/sniff","dojo/window"],function(f,
d,m,h,c){var a=new f,g;m(function(){var f=c.getBox();a._rlh=d(window,"resize",function(){var b=c.getBox();if(f.h!=b.h||f.w!=b.w)f=b,a.emit("resize")});if(8==h("ie")){var e=screen.deviceXDPI;setInterval(function(){screen.deviceXDPI!=e&&(e=screen.deviceXDPI,a.emit("resize"))},500)}h("ios")&&(d(document,"focusin",function(a){g=a.target}),d(document,"focusout",function(a){g=null}))});a.getEffectiveBox=function(a){a=c.getBox(a);var e=g&&g.tagName&&g.tagName.toLowerCase();h("ios")&&g&&!g.readOnly&&("textarea"==
e||"input"==e&&/^(color|email|number|password|search|tel|text|url)$/.test(g.type))&&(a.h*=0==orientation||180==orientation?.66:.4,e=g.getBoundingClientRect(),a.h=Math.max(a.h,e.top+e.height));return a};return a})},"com/huayun/util/StringHelp":function(){define([],function(){return{isSpace:function(f){if(null==f||"null"===f)return!0;if("object"===typeof f)return!1;var d=/(^\s*)|(\s*$)/g;return 0===f.replace(d,"").length?!0:!d.test(f)},isStrEqual:function(f,d){var m=!1;this.isSpace(f)&&this.isSpace(d)?
m=!0:f===d&&(m=!0);return m},extractProerty:function(f){var d=/^\$\{(.*)\}$/.exec(f);return null===d?f:d[1]}}})},"dojo/request/handlers":function(){define(["../json","../_base/kernel","../_base/array","../has","../selector/_loader"],function(f,d,m,h){function c(a){var c=b[a.options.handleAs];a.data=c?c(a):a.data||a.text;return a}h.add("activex","undefined"!==typeof ActiveXObject);h.add("dom-parser",function(a){return"DOMParser"in a});var a;if(h("activex")){var g=["Msxml2.DOMDocument.6.0","Msxml2.DOMDocument.4.0",
"MSXML2.DOMDocument.3.0","MSXML.DOMDocument"],l;a=function(a){function b(a){try{var b=new ActiveXObject(a);b.async=!1;b.loadXML(e);c=b;l=a}catch(u){return!1}return!0}var c=a.data,e=a.text;c&&h("dom-qsa2.1")&&!c.querySelectorAll&&h("dom-parser")&&(c=(new DOMParser).parseFromString(e,"application/xml"));c&&c.documentElement||l&&b(l)||m.some(g,b);return c}}var e=function(a){return h("native-xhr2-blob")||"blob"!==a.options.handleAs||"undefined"===typeof Blob?a.xhr.response:new Blob([a.xhr.response],{type:a.xhr.getResponseHeader("Content-Type")})},
b={javascript:function(a){return d.eval(a.text||"")},json:function(a){return f.parse(a.text||null)},xml:a,blob:e,arraybuffer:e,document:e};c.register=function(a,c){b[a]=c};return c})},"com/huayun/webgis/widget/searchs/PolygonSearch":function(){define("dojo/_base/declare dojo/dom dojo/on dojo/query dojo/dom-style dojo/dom-construct dojo/topic ../MapModuleX ../../Feature ../../Graphic ../../geometry/Point ../../geometry/Polyline ../../geometry/Multipoint ../../geometry/Polygon ../../symbols/PointSymbol ../../symbols/LineSymbol ../../symbols/PolygonSymbol dojo/text!../../templates/searchs/polygonSearch.html".split(" "),
function(f,d,m,h,c,a,g,l,e,b,k,n,p,t,r,q,u,z){return f("com.huayun.webgis.widget.searchs.PolygonSearch",[l],{baseClass:"polygonSearch",templateString:z,constructor:function(){this.view=this.map=this.dataList=null},doInit:function(){var a=d.byId("polyList");this.map=this.get("map");this.view=this.get("view");g.subscribe("showPolyInfo",function(b){this.dataList=b;this.showDev();a.style.display="block"}.bind(this));g.subscribe("closeInfo",function(){a.style.display="none"}.bind(this))},showDev:function(){var b=
d.byId("simList");a.empty(b);for(var c=0;c<this.dataList.length;c++){var e=this.dataList[c],f=a.create("li",{index:c,className:"showLi"},b);a.create("div",{index:c,className:"message",innerHTML:c+1+"."+e.attributes.NAME+"---"+e.layerName},f)}}})})},"dijit/_Container":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/dom-construct","dojo/_base/kernel"],function(f,d,m,h){return d("dijit._Container",null,{buildRendering:function(){this.inherited(arguments);this.containerNode||(this.containerNode=
this.domNode)},addChild:function(c,a){var d=this.containerNode;if(0<a){for(d=d.firstChild;0<a;)1==d.nodeType&&a--,d=d.nextSibling;d?a="before":(d=this.containerNode,a="last")}m.place(c.domNode,d,a);this._started&&!c._started&&c.startup()},removeChild:function(c){"number"==typeof c&&(c=this.getChildren()[c]);c&&(c=c.domNode)&&c.parentNode&&c.parentNode.removeChild(c)},hasChildren:function(){return 0<this.getChildren().length},_getSiblingOfChild:function(c,a){var d=this.getChildren();c=f.indexOf(d,
c);return d[c+a]},getIndexOfChild:function(c){return f.indexOf(this.getChildren(),c)}})})},"com/huayun/webgis/action/search/PointSearchAction":function(){define("dojo/_base/declare dojo/on dojo/dom dojo/query dojo/topic dojo/dom-style dojo/dom-construct dojo/_base/window ../../geometry/Point2D ../ActiveMapAction".split(" "),function(f,d,m,h,c,a,g,l,e,b){return f("com.huayun.webgis.action.search.PointSearchAction",[b],{constructor:function(a){f.safeMixin(this,a);this.view=a.view;this.state=!1;this.power=
this.view.map.findLayerById("power");this._onClick=null;this.isPoint=!0},active:function(a){a&&(this.point=a);this.state||(this.state=!0,this.view.selectEnabled=!0,this._onClick=d(this.view.domNode,"click",this._mouseClick.bind(this)))},_mouseClick:function(a){this.doAction(a)},invalid:function(){this.view.panEnabled=!0;c.publish("closeDevInfo");this._endActionMethod.call(this)},doAction:function(a){if(this.view.selectEnabled){var b=this,e=this.view.screenToGeometry(a.clientX,a.clientY);this.view.domNode.style.cursor=
"wait";this.power.queryFeaturesByGeometry(e,5,function(e,d){b.view.domNode.style.cursor="pointer";if(!e){d=d.results;debugger;d&&0<d.length&&b.state?c.publish("showDevInfo",d,a):c.publish("closeDevInfo")}})}},_endActionMethod:function(){this.state=!1;this.isPoint?c.publish("closePoint"):c.publish("closeDevInfo");this._onClick&&(this._onClick.remove(),this._onClick=null)}})})},"com/huayun/webgis/widget/GridLayerControl":function(){define("dojo/_base/declare dojo/topic dojo/on dojo/dom-construct dojo/dom-class dojo/dom-style ./MapModuleX ../../util/HashTable dojo/text!../templates/gridLayerControl.html".split(" "),
function(f,d,m,h,c,a,g,l,e){return f("com.huayun.webgis.widget.GridLayerControl",[g],{templateString:e,baseClass:"gridLayerControlClass",_map:null,_view:null,_visible:!0,_filters:[],_id:"power",_floatNode:null,_showHash:null,_hideHash:null,_allHash:null,constructor:function(){d.subscribe("layerControllerGridChange",this._layerControllerGridChangeHandler.bind(this));d.subscribe("mapImageLayerVisibleChange",this._mapImageLayerVisibleChange.bind(this))},postCreate:function(){this.inherited(arguments);
this._showHash=new l;this._hideHash=new l;this._allHash=new l;this._floatNode=h.create("div",{className:"change-control"},this.domNode);c.add(this._floatNode,"hidden")},doInit:function(){this._map=this.get("map");this._view=this.get("view");var a=this.get("configData").configuration.grid;this._visible=a.visible;this._filters=a.filters;this._visible?(c.remove(this.closeNode,"hidden"),this.gridTxt.innerHTML="\u5173\u95ed\u7535\u7f51"):(c.remove(this.openNode,"hidden"),this.gridTxt.innerHTML="\u6253\u5f00\u7535\u7f51");
this._map.findLayerById(this._id)?this._map.findLayerById(this._id).setVisible(this._visible):d.subscribe("layerComplete",function(a){this._map.findLayerById(this._id).setVisible(this._visible)}.bind(this));this._createCheckBox()},_createCheckBox:function(){for(var a=0;a<this._filters.length;a++){var c=this._filters[a];this._allHash.put(c.id,c);c.visible?this._showHash.put(c.id,c):this._hideHash.put(c.id,c);var e=h.create("div",{className:"grid-label",innerHTML:c.label},this._floatNode,"last");h.create("input",
{type:"checkbox",value:c.id,checked:c.visible,onchange:this._visibleSwitch.bind(this)},e,"first")}},_visibleSwitch:function(a){a.preventDefault();a.stopPropagation();var b=this._allHash.get(a.target.value);a.target.checked?(b.visible=!0,this._showHash.put(a.target.value,b),this._hideHash.remove(a.target.value)):(b.visible=!1,this._hideHash.put(a.target.value,b),this._showHash.remove(a.target.value));a=this._map.findLayerById(this._id);this._isAllShowBoolean()?a.setFilter():0<this._getHideSubLayers(a).length?
(b="\x26layers\x3dhide:"+this._getHideSubLayers(a).toString(),a.setFilter(b)):a.setFilter(null);a.refresh()},_isAllShowBoolean:function(){for(var a=this._allHash.getKeyList(),c=!0,e=0;e<a.length;e++)c&=this._allHash.get(a[e]).visible;return c},_getHideSubLayers:function(a){for(var b=[],c=this._hideHash.getKeyList(),e=0;e<c.length;e++)for(var d=c[e],f=0;f<a.sublayers.length;f++){var g=a.sublayers[f];if(g.name===d){b=b.concat(g.subLayerIds);break}}return b},_changeGridState:function(a){a.preventDefault();
a.stopPropagation();(this._visible=!this._visible)?(c.remove(this.closeNode,"hidden"),c.add(this.openNode,"hidden"),c.remove(this._floatNode,"hidden"),this.gridTxt.innerHTML="\u5173\u95ed\u7535\u7f51"):(c.remove(this.openNode,"hidden"),c.add(this.closeNode,"hidden"),c.add(this._floatNode,"hidden"),this.gridTxt.innerHTML="\u6253\u5f00\u7535\u7f51");this._map.findLayerById(this._id).setVisible(this._visible);d.publish("gridLayerControlChange",this._visible)},_onMouseOverHandler:function(a){a.preventDefault();
a.stopPropagation();this._visible&&c.remove(this._floatNode,"hidden")},_onMouseOutHandler:function(){event.preventDefault();event.stopPropagation();this._visible&&c.add(this._floatNode,"hidden")},_layerControllerGridChangeHandler:function(a){(this._visible=a)?(c.remove(this.closeNode,"hidden"),c.add(this.openNode,"hidden"),this.gridTxt.innerHTML="\u5173\u95ed\u7535\u7f51"):(c.remove(this.openNode,"hidden"),c.add(this.closeNode,"hidden"),this.gridTxt.innerHTML="\u6253\u5f00\u7535\u7f51")},_mapImageLayerVisibleChange:function(a,
e){e===this._id&&((this._visible=a)?(c.remove(this.closeNode,"hidden"),c.add(this.openNode,"hidden"),this.gridTxt.innerHTML="\u5173\u95ed\u7535\u7f51"):(c.remove(this.openNode,"hidden"),c.add(this.closeNode,"hidden"),this.gridTxt.innerHTML="\u6253\u5f00\u7535\u7f51"))}})})},"dijit/a11yclick":function(){define(["dojo/keys","dojo/mouse","dojo/on","dojo/touch"],function(f,d,m,h){function c(a){if((a.keyCode===f.ENTER||a.keyCode===f.SPACE)&&!/input|button|textarea/i.test(a.target.nodeName))for(a=a.target;a;a=
a.parentNode)if(a.dojoClick)return!0}var a;m(document,"keydown",function(d){c(d)?(a=d.target,d.preventDefault()):a=null});m(document,"keyup",function(d){c(d)&&d.target==a&&(a=null,m.emit(d.target,"click",{cancelable:!0,bubbles:!0,ctrlKey:d.ctrlKey,shiftKey:d.shiftKey,metaKey:d.metaKey,altKey:d.altKey,_origType:d.type}))});var g=function(a,c){a.dojoClick=!0;return m(a,"click",c)};g.click=g;g.press=function(a,c){var b=m(a,h.press,function(a){("mousedown"!=a.type||d.isLeft(a))&&c(a)}),e=m(a,"keydown",
function(a){a.keyCode!==f.ENTER&&a.keyCode!==f.SPACE||c(a)});return{remove:function(){b.remove();e.remove()}}};g.release=function(a,c){var b=m(a,h.release,function(a){("mouseup"!=a.type||d.isLeft(a))&&c(a)}),e=m(a,"keyup",function(a){a.keyCode!==f.ENTER&&a.keyCode!==f.SPACE||c(a)});return{remove:function(){b.remove();e.remove()}}};g.move=h.move;return g})},"dojo/cookie":function(){define(["./_base/kernel","./regexp"],function(f,d){f.cookie=function(f,h,c){var a=document.cookie,g;if(1==arguments.length)g=
(g=a.match(new RegExp("(?:^|; )"+d.escapeString(f)+"\x3d([^;]*)")))?decodeURIComponent(g[1]):void 0;else{c=c||{};a=c.expires;if("number"==typeof a){var l=new Date;l.setTime(l.getTime()+864E5*a);a=c.expires=l}a&&a.toUTCString&&(c.expires=a.toUTCString());h=encodeURIComponent(h);var a=f+"\x3d"+h,e;for(e in c)a+="; "+e,l=c[e],!0!==l&&(a+="\x3d"+l);document.cookie=a}return g};f.cookie.isSupported=function(){"cookieEnabled"in navigator||(this("__djCookieTest__","CookiesAllowed"),navigator.cookieEnabled=
"CookiesAllowed"==this("__djCookieTest__"),navigator.cookieEnabled&&this("__djCookieTest__","",{expires:-1}));return navigator.cookieEnabled};return f.cookie})},"dojo/NodeList-dom":function(){define("./_base/kernel ./query ./_base/array ./_base/lang ./dom-class ./dom-construct ./dom-geometry ./dom-attr ./dom-style".split(" "),function(f,d,m,h,c,a,g,l,e){function b(a){return function(b,c,e){return 2==arguments.length?a["string"==typeof c?"get":"set"](b,c):a.set(b,c,e)}}var k=function(a){return 1==
a.length&&"string"==typeof a[0]},n=function(a){var b=a.parentNode;b&&b.removeChild(a)},p=d.NodeList,t=p._adaptWithCondition,r=p._adaptAsForEach,q=p._adaptAsMap;h.extend(p,{_normalize:function(b,c){var e=!0===b.parse;if("string"==typeof b.template){var d=b.templateFunc||f.string&&f.string.substitute;b=d?d(b.template,b):b}d=typeof b;"string"==d||"number"==d?(b=a.toDom(b,c&&c.ownerDocument),b=11==b.nodeType?h._toArray(b.childNodes):[b]):h.isArrayLike(b)?h.isArray(b)||(b=h._toArray(b)):b=[b];e&&(b._runParse=
!0);return b},_cloneNode:function(a){return a.cloneNode(!0)},_place:function(b,c,e,d){if(1==c.nodeType||"only"!=e)for(var g,k=b.length,h=k-1;0<=h;h--){var l=d?this._cloneNode(b[h]):b[h];if(b._runParse&&f.parser&&f.parser.parse)for(g||(g=c.ownerDocument.createElement("div")),g.appendChild(l),f.parser.parse(g),l=g.firstChild;g.firstChild;)g.removeChild(g.firstChild);h==k-1?a.place(l,c,e):c.parentNode.insertBefore(l,c);c=l}},position:q(g.position),attr:t(b(l),k),style:t(b(e),k),addClass:r(c.add),removeClass:r(c.remove),
toggleClass:r(c.toggle),replaceClass:r(c.replace),empty:r(a.empty),removeAttr:r(l.remove),marginBox:q(g.getMarginBox),place:function(b,c){var e=d(b)[0];return this.forEach(function(b){a.place(b,e,c)})},orphan:function(a){return(a?d._filterResult(this,a):this).forEach(n)},adopt:function(a,b){return d(a).place(this[0],b)._stash(this)},query:function(a){if(!a)return this;var b=new p;this.map(function(c){d(a,c).forEach(function(a){void 0!==a&&b.push(a)})});return b._stash(this)},filter:function(a){var b=
arguments,c=this,e=0;if("string"==typeof a){c=d._filterResult(this,b[0]);if(1==b.length)return c._stash(this);e=1}return this._wrap(m.filter(c,b[e],b[e+1]),this)},addContent:function(b,c){b=this._normalize(b,this[0]);for(var e=0,d;d=this[e];e++)b.length?this._place(b,d,c,0<e):a.empty(d);return this}});return p})},"com/huayun/power":function(){define([],1)},"dojo/_base/fx":function(){define("./kernel ./config ./lang ../Evented ./Color ../aspect ../sniff ../dom ../dom-style".split(" "),function(f,d,
m,h,c,a,g,l,e){var b=m.mixin,k={},n=k._Line=function(a,b){this.start=a;this.end=b};n.prototype.getValue=function(a){return(this.end-this.start)*a+this.start};var p=k.Animation=function(a){b(this,a);m.isArray(this.curve)&&(this.curve=new n(this.curve[0],this.curve[1]))};p.prototype=new h;m.extend(p,{duration:350,repeat:0,rate:20,_percent:0,_startRepeatCount:0,_getStep:function(){var a=this._percent,b=this.easing;return b?b(a):a},_fire:function(a,b){b=b||[];if(this[a])if(d.debugAtAllCosts)this[a].apply(this,
b);else try{this[a].apply(this,b)}catch(x){console.error("exception in animation handler for:",a),console.error(x)}return this},play:function(a,b){this._delayTimer&&this._clearTimer();if(b)this._stopTimer(),this._active=this._paused=!1,this._percent=0;else if(this._active&&!this._paused)return this;this._fire("beforeBegin",[this.node]);a=a||this.delay;b=m.hitch(this,"_play",b);if(0<a)return this._delayTimer=setTimeout(b,a),this;b();return this},_play:function(a){this._delayTimer&&this._clearTimer();
this._startTime=(new Date).valueOf();this._paused&&(this._startTime-=this.duration*this._percent);this._active=!0;this._paused=!1;a=this.curve.getValue(this._getStep());this._percent||(this._startRepeatCount||(this._startRepeatCount=this.repeat),this._fire("onBegin",[a]));this._fire("onPlay",[a]);this._cycle();return this},pause:function(){this._delayTimer&&this._clearTimer();this._stopTimer();if(!this._active)return this;this._paused=!0;this._fire("onPause",[this.curve.getValue(this._getStep())]);
return this},gotoPercent:function(a,b){this._stopTimer();this._active=this._paused=!0;this._percent=a;b&&this.play();return this},stop:function(a){this._delayTimer&&this._clearTimer();if(!this._timer)return this;this._stopTimer();a&&(this._percent=1);this._fire("onStop",[this.curve.getValue(this._getStep())]);this._active=this._paused=!1;return this},destroy:function(){this.stop()},status:function(){return this._active?this._paused?"paused":"playing":"stopped"},_cycle:function(){if(this._active){var a=
(new Date).valueOf(),a=0===this.duration?1:(a-this._startTime)/this.duration;1<=a&&(a=1);this._percent=a;this.easing&&(a=this.easing(a));this._fire("onAnimate",[this.curve.getValue(a)]);1>this._percent?this._startTimer():(this._active=!1,0<this.repeat?(this.repeat--,this.play(null,!0)):-1==this.repeat?this.play(null,!0):this._startRepeatCount&&(this.repeat=this._startRepeatCount,this._startRepeatCount=0),this._percent=0,this._fire("onEnd",[this.node]),!this.repeat&&this._stopTimer())}return this},
_clearTimer:function(){clearTimeout(this._delayTimer);delete this._delayTimer}});var t=0,r=null,q={run:function(){}};m.extend(p,{_startTimer:function(){this._timer||(this._timer=a.after(q,"run",m.hitch(this,"_cycle"),!0),t++);r||(r=setInterval(m.hitch(q,"run"),this.rate))},_stopTimer:function(){this._timer&&(this._timer.remove(),this._timer=null,t--);0>=t&&(clearInterval(r),r=null,t=0)}});var u=g("ie")?function(a){var b=a.style;b.width.length||"auto"!=e.get(a,"width")||(b.width="auto")}:function(){};
k._fade=function(c){c.node=l.byId(c.node);var d=b({properties:{}},c);c=d.properties.opacity={};c.start="start"in d?d.start:function(){return+e.get(d.node,"opacity")||0};c.end=d.end;c=k.animateProperty(d);a.after(c,"beforeBegin",m.partial(u,d.node),!0);return c};k.fadeIn=function(a){return k._fade(b({end:1},a))};k.fadeOut=function(a){return k._fade(b({end:0},a))};k._defaultEasing=function(a){return.5+Math.sin((a+1.5)*Math.PI)/2};var z=function(a){this._properties=a;for(var b in a){var e=a[b];e.start instanceof
c&&(e.tempColor=new c)}};z.prototype.getValue=function(a){var b={},e;for(e in this._properties){var d=this._properties[e],f=d.start;f instanceof c?b[e]=c.blendColors(f,d.end,a,d.tempColor).toCss():m.isArray(f)||(b[e]=(d.end-f)*a+f+("opacity"!=e?d.units||"px":0))}return b};k.animateProperty=function(d){var g=d.node=l.byId(d.node);d.easing||(d.easing=f._defaultEasing);d=new p(d);a.after(d,"beforeBegin",m.hitch(d,function(){var a={},d;for(d in this.properties){var f=function(a,b){var c={height:a.offsetHeight,
width:a.offsetWidth}[b];if(void 0!==c)return c;c=e.get(a,b);return"opacity"==b?+c:h?c:parseFloat(c)};if("width"==d||"height"==d)this.node.display="block";var k=this.properties[d];m.isFunction(k)&&(k=k(g));k=a[d]=b({},m.isObject(k)?k:{end:k});m.isFunction(k.start)&&(k.start=k.start(g));m.isFunction(k.end)&&(k.end=k.end(g));var h=0<=d.toLowerCase().indexOf("color");"end"in k?"start"in k||(k.start=f(g,d)):k.end=f(g,d);h?(k.start=new c(k.start),k.end=new c(k.end)):k.start="opacity"==d?+k.start:parseFloat(k.start)}this.curve=
new z(a)}),!0);a.after(d,"onAnimate",m.hitch(e,"set",d.node),!0);return d};k.anim=function(a,b,c,e,d,f){return k.animateProperty({node:a,duration:c||p.prototype.duration,properties:b,easing:e,onEnd:d}).play(f||0)};b(f,k);f._Animation=p;return k})},"com/huayun/webgis/widget/DeviceTree":function(){define("dojo/_base/declare dojo/dom-class dojo/dom-style dojo/_base/array dojo/request dijit/registry com/huayun/facades/ConfigFacade dojo/data/ItemFileWriteStore dojo/store/Observable dijit/tree/ForestStoreModel dijit/Tree dijit/Menu dijit/MenuItem dojo/topic ./MapModuleX ../Feature ../Graphic ../geometry/Point ../geometry/Polyline ../geometry/Multipoint ../geometry/Polygon ../symbols/PointSymbol ../symbols/LineSymbol ../symbols/PolygonSymbol ../utils/wktUtil ./LocatingController dojo/text!../templates/deviceTree.html".split(" "),
function(f,d,m,h,c,a,g,l,e,b,k,n,p,t,r,q,u,z,v,y,x,w,A,B,E,C,F){return f("com.huayun.webgis.widget.DeviceTree",[r],{map:null,view:null,localTool:null,templateString:F,name:"\u8bbe\u5907\u6811",vdc_url:"http://vdc-server.test.cloud.zj.sgcc.com.cn/",pdc_url:"http://pdc-server.test.cloud.zj.sgcc.com.cn/",data_url:"http://pdc-server.test.cloud.zj.sgcc.com.cn/deviceService",width:"400px",height:"800px",model:null,store:null,parentNode:null,deviceTreeConfigData:null,rootData:{name:"\u6d59\u6c5f\u7701\u7535\u529b\u516c\u53f8",
id:"8a812897493378a001495677ad086663",type:0,buttonList:null,iconClassName:"unit",parentNode:null,children:[]},configFacade:null,buttonArray:null,constructor:function(a){this.configFacade=new g;this.configData=a.configData},postCreate:function(){this.inherited(arguments);m.set(this.domNode,"pointer-events","all")},_assembleDataHandle:function(a){var b=this,c=this.parentNode,e=a.configInfo;h.forEach(a.data,function(a){a.id=a[e.key];a.name=a[e.label];a.type=e.index;a.buttonList=e.buttonList;a.iconClassName=
e.iconClassName;a.parentNode=c;a.children=[];b.store.newItem(a,{parent:c,attribute:"children"})})},clear:function(){t.publish("clearLocate")},_getTreeDataHandle:function(a){var b=this;h.forEach(a,function(a){b.configFacade.getDepartment(a.url+"\x26access_token\x3dYH6fXTGYH4DIumSNOii+IzvIeZSrvghHn/FxVfevu92cu0Gzb4yB4MnKjTxLwYh7SELU8C15v07+mXROfZQYDBSzyeoavyabrZ1L+BJwLu0\x3d",function(c){"0000"==c.resultState&&(c=c.data,0!=c.length&&b._assembleDataHandle({configInfo:a,data:c}))},function(a){})})},_addFileHandle:function(a){var b=
this.parentNode,c=this,e=[];h.forEach(a,function(a,d){e.push(a);a.ID=b.ID;a.id=b.ID+a.className+d;a.type=a.index;a.parentNode=b;a.childIconClass=a.childIconClass;a.children=[];c.store.newItem(a,{parent:b,attribute:"children"})})},_getNextConfigs:function(){var a=[],b=this.parentNode.type[0];h.forEach(this.deviceTreeConfigData.configuration.items,function(c){-1<c.parent.indexOf(b)&&a.push(c)});if(0!=a.length){var c=this.pdc_url,e=this.vdc_url;h.forEach(a,function(a){if("featureService"==a.serviceName||
"dataService"==a.serviceName)a.url=e+a.serviceAddress;"deviceService"==a.serviceName&&(a.url=c+a.serviceAddress)});var d=[],f=this.parentNode,g=[];h.forEach(a,function(a){var b=Object.assign({},a),c=b.url;a=c.match(/{(.*?)}/g);null!=a&&h.forEach(a,function(a){var e=a.replace(/{|}/g,"");c=c.replace(a,f[e]);b.url=c});b.isFile&&g.push(b);d.push(b)});0<g.length?this._addFileHandle(g):this._getTreeDataHandle(d)}},_getTreeDataByFile:function(a){var b=this.parentNode,c=this;this.configFacade.getDepartment(a+
"\x26access_token\x3dYH6fXTGYH4DIumSNOii+IzvIeZSrvghHn/FxVfevu92cu0Gzb4yB4MnKjTxLwYh7SELU8C15v07+mXROfZQYDBSzyeoavyabrZ1L+BJwLu0\x3d",function(a){"0000"==a.resultState&&(a=a.data,0!=a.length&&h.forEach(a,function(a){a.id=a[b.key];a.name=a[b.label];a.type=b.index;a.iconClassName=b.childIconClass;a.parentNode=b;a.buttonList=b.buttonList;a.children=[];c.store.newItem(a,{parent:b,attribute:"children"})}))},function(a){})},_getNextLevelData:function(){this.parentNode.isFile?this._getTreeDataByFile(this.parentNode.url[0]):
this._getNextConfigs()},postCreate:function(){this.inherited(arguments);var a=this;this.store=new l({data:{identifier:"id",label:"name",items:[this.rootData]}});var e=new b({store:a.store,query:{type:"0"},rootId:"root",rootLabel:"Continents",childrenAttrs:["children"],mayHaveChildren:function(a){}});(new k({id:["tree"],model:e,showRoot:!1,persist:!0,autoExpand:!0,onClick:function(b){a.parentNode=b;b.children.length||a._getNextLevelData()},getIconClass:function(a){return a.iconClassName},_createTreeNode:function(a){var b=
new k._TreeNode(a);if(!a.isExpandable){a=b.item.buttonList;var c=b.item.isFile;null==a[0]||c||d.add(b.rowNode,a[0].className)}return b}},a.deviceTreeNode)).startup();t.subscribe("deviceTreeRightMenuClickHandle",function(a){/!*\u63a5\u6536\u4e8b\u4ef6\u4fe1\u606f*!/;a=a.objectInformation;var b=this.data_url,b=a.CLASS_NAME?b+("/"+a.CLASS_NAME[0]+"/"+a.id):b+("/Substation/"+a.id);c.get(b+"?RUN_STATUS\x3d"+a.RUN_STATUS[0]+"\x26depart\x3d"+a.DEPART[0]+"\x26access_token\x3dYH6fXTGYH4DIumSNOii+IzvIeZSrvghHn/FxVfevu92cu0Gzb4yB4MnKjTxLwYh7SELU8C15v07+mXROfZQYDBSzyeoavyabrZ1L+BJwLu0\x3d",
{handleAs:"json"}).then(function(a){this._drawGraphicHandle(E.parse2Geometry(a.data[0].SHAPE))}.bind(this),function(a){})}.bind(this))},_drawGraphicHandle:function(a){var b=a.type,c=this.map.findLayerById("drawLayer");"point"===b?this.view.setCenter([a.x,a.y]):this.view.setCenter([a.path[0][0].x,a.path[0][0].y]);var e=new w({color:"#FFFF00",radious:5,strokeColor:"#0000FF",strokeWidth:1}),d=new A({color:"#ff2f39",width:3}),f=new B({color:"#0FF",opacity:.5});switch(b){case "point":d=new z(a.x,a.y);
this.addgraphic(c,d,e);break;case "multipoint":d=a.points.map(function(a){return new z(a.x,a.y)});d=new y(d);this.addgraphic(c,d,e);break;case "line":e=a.path.map(function(a){return a.map(function(a){return new z(a.x,a.y)})});e=new v(e);this.addgraphic(c,e,d);break;default:e=a.rings.map(function(a){return a.map(function(a){return new z(a.x,a.y)})}),e=new x(e),this.addgraphic(c,e,f)}},addgraphic:function(a,b,c){b=new q({attributes:null,geometry:b});c=new u({feature:b,symbol:c});a.addGraphic(c);this.view.threeRender()},
_mountMenuHandle:function(){h.forEach(this.buttonArray,function(b){var c=b.list,e=new n({style:"display: none;",targetNodeIds:["tree"],selector:"."+b.className});h.forEach(c,function(b){b=new p({label:"\x3cdiv\x3e"+b.right_label+"\x3c/div\x3e",onClick:function(b){b=b.target.innerText;var c=a.byNode(this.getParent().currentTarget.parentNode).item;t.publish("deviceTreeRightMenuClickHandle",{menuName:b,objectInformation:c,vdc_url:this.vdc_url,pdc_url:this.pdc_url})}});e.addChild(b);e.startup()}.bind(this))})},
_getButtonListHandle:function(){var a=this.deviceTreeConfigData.configuration.items,b=this,c={};this.buttonArray=[];h.forEach(a,function(a){null!=a.buttonList&&(a=a.buttonList,c[a.className]||(b.buttonArray.push(a),c[a.className]=!0))});this._mountMenuHandle()},doInit:function(){this.deviceTreeConfigData=this.get("configData");this.map=this.get("map");this.view=this.get("view");this._getButtonListHandle()}})})},"dojo/fx":function(){define("./_base/lang ./Evented ./_base/kernel ./_base/array ./aspect ./_base/fx ./dom ./dom-style ./dom-geometry ./ready require".split(" "),
function(f,d,m,h,c,a,g,l,e,b,k){m.isAsync||b(0,function(){k(["./fx/Toggler"])});m=m.fx={};b={_fire:function(a,b){this[a]&&this[a].apply(this,b||[]);return this}};var n=function(a){this._index=-1;this._animations=a||[];this._current=this._onAnimateCtx=this._onEndCtx=null;this.duration=0;h.forEach(this._animations,function(a){a&&("undefined"!=typeof a.duration&&(this.duration+=a.duration),a.delay&&(this.duration+=a.delay))},this)};n.prototype=new d;f.extend(n,{_onAnimate:function(){this._fire("onAnimate",
arguments)},_onEnd:function(){this._onAnimateCtx.remove();this._onEndCtx.remove();this._onAnimateCtx=this._onEndCtx=null;this._index+1==this._animations.length?this._fire("onEnd"):(this._current=this._animations[++this._index],this._onAnimateCtx=c.after(this._current,"onAnimate",f.hitch(this,"_onAnimate"),!0),this._onEndCtx=c.after(this._current,"onEnd",f.hitch(this,"_onEnd"),!0),this._current.play(0,!0))},play:function(a,b){this._current||(this._current=this._animations[this._index=0]);if(!b&&"playing"==
this._current.status())return this;var e=c.after(this._current,"beforeBegin",f.hitch(this,function(){this._fire("beforeBegin")}),!0),d=c.after(this._current,"onBegin",f.hitch(this,function(a){this._fire("onBegin",arguments)}),!0),g=c.after(this._current,"onPlay",f.hitch(this,function(a){this._fire("onPlay",arguments);e.remove();d.remove();g.remove()}));this._onAnimateCtx&&this._onAnimateCtx.remove();this._onAnimateCtx=c.after(this._current,"onAnimate",f.hitch(this,"_onAnimate"),!0);this._onEndCtx&&
this._onEndCtx.remove();this._onEndCtx=c.after(this._current,"onEnd",f.hitch(this,"_onEnd"),!0);this._current.play.apply(this._current,arguments);return this},pause:function(){if(this._current){var a=c.after(this._current,"onPause",f.hitch(this,function(b){this._fire("onPause",arguments);a.remove()}),!0);this._current.pause()}return this},gotoPercent:function(a,b){this.pause();var c=this.duration*a;this._current=null;h.some(this._animations,function(a,b){if(c<=a.duration)return this._current=a,this._index=
b,!0;c-=a.duration;return!1},this);this._current&&this._current.gotoPercent(c/this._current.duration);b&&this.play();return this},stop:function(a){if(this._current){if(a){for(;this._index+1<this._animations.length;++this._index)this._animations[this._index].stop(!0);this._current=this._animations[this._index]}var b=c.after(this._current,"onStop",f.hitch(this,function(a){this._fire("onStop",arguments);b.remove()}),!0);this._current.stop()}return this},status:function(){return this._current?this._current.status():
"stopped"},destroy:function(){this.stop();this._onAnimateCtx&&this._onAnimateCtx.remove();this._onEndCtx&&this._onEndCtx.remove()}});f.extend(n,b);m.chain=function(a){return new n(f.isArray(a)?a:Array.prototype.slice.call(a,0))};var p=function(b){this._animations=b||[];this._connects=[];this.duration=this._finished=0;h.forEach(b,function(a){var b=a.duration;a.delay&&(b+=a.delay);this.duration<b&&(this.duration=b);this._connects.push(c.after(a,"onEnd",f.hitch(this,"_onEnd"),!0))},this);this._pseudoAnimation=
new a.Animation({curve:[0,1],duration:this.duration});var e=this;h.forEach("beforeBegin onBegin onPlay onAnimate onPause onStop onEnd".split(" "),function(a){e._connects.push(c.after(e._pseudoAnimation,a,function(){e._fire(a,arguments)},!0))})};f.extend(p,{_doAction:function(a,b){h.forEach(this._animations,function(c){c[a].apply(c,b)});return this},_onEnd:function(){++this._finished>this._animations.length&&this._fire("onEnd")},_call:function(a,b){var c=this._pseudoAnimation;c[a].apply(c,b)},play:function(a,
b){this._finished=0;this._doAction("play",arguments);this._call("play",arguments);return this},pause:function(){this._doAction("pause",arguments);this._call("pause",arguments);return this},gotoPercent:function(a,b){var c=this.duration*a;h.forEach(this._animations,function(a){a.gotoPercent(a.duration<c?1:c/a.duration,b)});this._call("gotoPercent",arguments);return this},stop:function(a){this._doAction("stop",arguments);this._call("stop",arguments);return this},status:function(){return this._pseudoAnimation.status()},
destroy:function(){this.stop();h.forEach(this._connects,function(a){a.remove()})}});f.extend(p,b);m.combine=function(a){return new p(f.isArray(a)?a:Array.prototype.slice.call(a,0))};m.wipeIn=function(b){var e=b.node=g.byId(b.node),d=e.style,k;b=a.animateProperty(f.mixin({properties:{height:{start:function(){k=d.overflow;d.overflow="hidden";if("hidden"==d.visibility||"none"==d.display)return d.height="1px",d.display="",d.visibility="",1;var a=l.get(e,"height");return Math.max(a,1)},end:function(){return e.scrollHeight}}}},
b));var h=function(){d.height="auto";d.overflow=k};c.after(b,"onStop",h,!0);c.after(b,"onEnd",h,!0);return b};m.wipeOut=function(b){var e=(b.node=g.byId(b.node)).style,d;b=a.animateProperty(f.mixin({properties:{height:{end:1}}},b));c.after(b,"beforeBegin",function(){d=e.overflow;e.overflow="hidden";e.display=""},!0);var k=function(){e.overflow=d;e.height="auto";e.display="none"};c.after(b,"onStop",k,!0);c.after(b,"onEnd",k,!0);return b};m.slideTo=function(b){var d=null,k=null,h=function(a){return function(){var b=
l.getComputedStyle(a),c=b.position;d="absolute"==c?a.offsetTop:parseInt(b.top)||0;k="absolute"==c?a.offsetLeft:parseInt(b.left)||0;"absolute"!=c&&"relative"!=c&&(b=e.position(a,!0),d=b.y,k=b.x,a.style.position="absolute",a.style.top=d+"px",a.style.left=k+"px")}}(b.node=g.byId(b.node));h();b=a.animateProperty(f.mixin({properties:{top:b.top||0,left:b.left||0}},b));c.after(b,"beforeBegin",h,!0);return b};return m})},"com/huayun/webgis/widget/searchs/RectSearch":function(){define("dojo/_base/declare dojo/dom dojo/dom-construct dojo/topic ../MapModuleX ../../Feature ../../Graphic ../../geometry/Point ../../geometry/Polyline ../../geometry/Multipoint ../../geometry/Polygon ../../symbols/PointSymbol ../../symbols/LineSymbol ../../symbols/PolygonSymbol dojo/text!../../templates/searchs/rectSearch.html".split(" "),
function(f,d,m,h,c,a,g,l,e,b,k,n,p,t,r){return f("com.huayun.webgis.widget.searchs.RectSearch",[c],{baseClass:"rectSearch",templateString:r,constructor:function(){this.view=this.map=this.dataList=null},doInit:function(){var a=d.byId("rectList");this.map=this.get("map");this.view=this.get("view");h.subscribe("showRectInfo",function(b){this.dataList=b;this.showDev();a.style.display="block"}.bind(this));h.subscribe("closeRectInfo",function(){a.style.display="none"}.bind(this))},showDev:function(){var a=
d.byId("rectExList");m.empty(a);for(var b=0;b<this.dataList.length;b++){var c=this.dataList[b],e=m.create("li",{index:b,className:"showLi"},a);m.create("div",{index:b,className:"message",innerHTML:b+1+"."+c.attributes.NAME+"---"+c.layerName},e)}}})})},"dojo/errors/RequestTimeoutError":function(){define(["./create","./RequestError"],function(f,d){return f("RequestTimeoutError",null,d,{dojoType:"timeout"})})},"dijit/Tree":function(){define("dojo/_base/array dojo/aspect dojo/cookie dojo/_base/declare dojo/Deferred dojo/promise/all dojo/dom dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/errors/create dojo/fx dojo/has dojo/_base/kernel dojo/keys dojo/_base/lang dojo/on dojo/topic dojo/touch dojo/when ./a11yclick ./focus ./registry ./_base/manager ./_Widget ./_TemplatedMixin ./_Container ./_Contained ./_CssStateMixin ./_KeyNavMixin dojo/text!./templates/TreeNode.html dojo/text!./templates/Tree.html ./tree/TreeStoreModel ./tree/ForestStoreModel ./tree/_dndSelector dojo/query!css2".split(" "),
function(f,d,m,h,c,a,g,l,e,b,k,n,p,t,r,q,u,z,v,y,x,w,A,B,E,C,F,G,I,M,D,H,J,Q,L){function K(a){return q.delegate(a.promise||a,{addCallback:function(a){this.then(a)},addErrback:function(a){this.otherwise(a)}})}var P=h("dijit._TreeNode",[E,C,F,G,I],{item:null,isTreeNode:!0,label:"",_setLabelAttr:function(a){this.labelNode["html"==this.labelType?"innerHTML":"innerText"in this.labelNode?"innerText":"textContent"]=a;this._set("label",a);p("dojo-bidi")&&this.applyTextDir(this.labelNode)},labelType:"text",
isExpandable:null,isExpanded:!1,state:"NotLoaded",templateString:D,baseClass:"dijitTreeNode",cssStateNodes:{rowNode:"dijitTreeRow"},_setTooltipAttr:{node:"rowNode",type:"attribute",attribute:"title"},buildRendering:function(){this.inherited(arguments);this._setExpando();this._updateItemClasses(this.item);this.isExpandable&&this.labelNode.setAttribute("aria-expanded",this.isExpanded);this.setSelected(!1)},_setIndentAttr:function(a){var c=Math.max(a,0)*this.tree._nodePixelIndent+"px";b.set(this.domNode,
"backgroundPosition",c+" 0px");b.set(this.rowNode,this.isLeftToRight()?"paddingLeft":"paddingRight",c);f.forEach(this.getChildren(),function(b){b.set("indent",a+1)});this._set("indent",a)},markProcessing:function(){this.state="Loading";this._setExpando(!0)},unmarkProcessing:function(){this._setExpando(!1)},_updateItemClasses:function(a){var b=this.tree,c=b.model;b._v10Compat&&a===c.root&&(a=null);this._applyClassAndStyle(a,"icon","Icon");this._applyClassAndStyle(a,"label","Label");this._applyClassAndStyle(a,
"row","Row");this.tree._startPaint(!0)},_applyClassAndStyle:function(a,c,e){var d="_"+c+"Class";c+="Node";var f=this[d];this[d]=this.tree["get"+e+"Class"](a,this.isExpanded);l.replace(this[c],this[d]||"",f||"");b.set(this[c],this.tree["get"+e+"Style"](a,this.isExpanded)||{})},_updateLayout:function(){var a=this.getParent(),a=!a||!a.rowNode||"none"==a.rowNode.style.display;l.toggle(this.domNode,"dijitTreeIsRoot",a);l.toggle(this.domNode,"dijitTreeIsLast",!a&&!this.getNextSibling())},_setExpando:function(a){var b=
["dijitTreeExpandoLoading","dijitTreeExpandoOpened","dijitTreeExpandoClosed","dijitTreeExpandoLeaf"];a=a?0:this.isExpandable?this.isExpanded?1:2:3;l.replace(this.expandoNode,b[a],b);this.expandoNodeText.innerHTML=["*","-","+","*"][a]},expand:function(){if(this._expandDeferred)return K(this._expandDeferred);this._collapseDeferred&&(this._collapseDeferred.cancel(),delete this._collapseDeferred);this.isExpanded=!0;this.labelNode.setAttribute("aria-expanded","true");(this.tree.showRoot||this!==this.tree.rootNode)&&
this.containerNode.setAttribute("role","group");l.add(this.contentNode,"dijitTreeContentExpanded");this._setExpando();this._updateItemClasses(this.item);this==this.tree.rootNode&&this.tree.showRoot&&this.tree.domNode.setAttribute("aria-expanded","true");var a=n.wipeIn({node:this.containerNode,duration:B.defaultDuration}),b=this._expandDeferred=new c(function(){a.stop()});d.after(a,"onEnd",function(){b.resolve(!0)},!0);a.play();return K(b)},collapse:function(){if(this._collapseDeferred)return K(this._collapseDeferred);
this._expandDeferred&&(this._expandDeferred.cancel(),delete this._expandDeferred);this.isExpanded=!1;this.labelNode.setAttribute("aria-expanded","false");this==this.tree.rootNode&&this.tree.showRoot&&this.tree.domNode.setAttribute("aria-expanded","false");l.remove(this.contentNode,"dijitTreeContentExpanded");this._setExpando();this._updateItemClasses(this.item);var a=n.wipeOut({node:this.containerNode,duration:B.defaultDuration}),b=this._collapseDeferred=new c(function(){a.stop()});d.after(a,"onEnd",
function(){b.resolve(!0)},!0);a.play();return K(b)},indent:0,setChildItems:function(b){var c=this.tree,e=c.model,d=[],k=c.focusedChild,h=this.getChildren();f.forEach(h,function(a){F.prototype.removeChild.call(this,a)},this);this.defer(function(){f.forEach(h,function(a){if(!a._destroyed&&!a.getParent()){var b=function(a){var d=e.getIdentity(a.item),g=c._itemNodesMap[d];1==g.length?delete c._itemNodesMap[d]:(d=f.indexOf(g,a),-1!=d&&g.splice(d,1));f.forEach(a.getChildren(),b)};c.dndController.removeTreeNode(a);
b(a);if(c.persist){var d=f.map(a.getTreePath(),function(a){return c.model.getIdentity(a)}).join("/"),h;for(h in c._openedNodes)h.substr(0,d.length)==d&&delete c._openedNodes[h];c._saveExpandedNodes()}c.lastFocusedChild&&!g.isDescendant(c.lastFocusedChild.domNode,c.domNode)&&delete c.lastFocusedChild;k&&!g.isDescendant(k.domNode,c.domNode)&&c.focus();a.destroyRecursive()}})});this.state="Loaded";b&&0<b.length?(this.isExpandable=!0,f.forEach(b,function(a){var b=e.getIdentity(a),f=c._itemNodesMap[b],
g;if(f)for(var k=0;k<f.length;k++)if(f[k]&&!f[k].getParent()){g=f[k];g.set("indent",this.indent+1);break}g||(g=this.tree._createTreeNode({item:a,tree:c,isExpandable:e.mayHaveChildren(a),label:c.getLabel(a),labelType:c.model&&c.model.labelType||"text",tooltip:c.getTooltip(a),ownerDocument:c.ownerDocument,dir:c.dir,lang:c.lang,textDir:c.textDir,indent:this.indent+1}),f?f.push(g):c._itemNodesMap[b]=[g]);this.addChild(g);(this.tree.autoExpand||this.tree._state(g))&&d.push(c._expandNode(g))},this),f.forEach(this.getChildren(),
function(a){a._updateLayout()})):this.isExpandable=!1;this._setExpando&&this._setExpando(!1);this._updateItemClasses(this.item);b=a(d);this.tree._startPaint(b);return K(b)},getTreePath:function(){for(var a=this,b=[];a&&a!==this.tree.rootNode;)b.unshift(a.item),a=a.getParent();b.unshift(this.tree.rootNode.item);return b},getIdentity:function(){return this.tree.model.getIdentity(this.item)},removeChild:function(a){this.inherited(arguments);var b=this.getChildren();0==b.length&&(this.isExpandable=!1,
this.collapse());f.forEach(b,function(a){a._updateLayout()})},makeExpandable:function(){this.isExpandable=!0;this._setExpando(!1)},setSelected:function(a){this.labelNode.setAttribute("aria-selected",a?"true":"false");l.toggle(this.rowNode,"dijitTreeRowSelected",a)},focus:function(){w.focus(this.focusNode)}});p("dojo-bidi")&&P.extend({_setTextDirAttr:function(a){!a||this.textDir==a&&this._created||(this._set("textDir",a),this.applyTextDir(this.labelNode),f.forEach(this.getChildren(),function(b){b.set("textDir",
a)},this))}});var U=h("dijit.Tree",[E,M,C,I],{baseClass:"dijitTree",store:null,model:null,query:null,label:"",showRoot:!0,childrenAttr:["children"],paths:[],path:[],selectedItems:null,selectedItem:null,openOnClick:!1,openOnDblClick:!1,templateString:H,persist:!1,autoExpand:!1,dndController:L,dndParams:"onDndDrop itemCreator onDndCancel checkAcceptance checkItemAcceptance dragThreshold betweenThreshold".split(" "),onDndDrop:null,itemCreator:null,onDndCancel:null,checkAcceptance:null,checkItemAcceptance:null,
dragThreshold:5,betweenThreshold:0,_nodePixelIndent:19,_publish:function(a,b){z.publish(this.id,q.mixin({tree:this,event:a},b||{}))},postMixInProperties:function(){this.tree=this;this.autoExpand&&(this.persist=!1);this._itemNodesMap={};!this.cookieName&&this.id&&(this.cookieName=this.id+"SaveStateCookie");this.expandChildrenDeferred=new c;this.pendingCommandsPromise=this.expandChildrenDeferred.promise;this.inherited(arguments)},postCreate:function(){this._initState();var a=this;this.own(u(this.containerNode,
u.selector(".dijitTreeNode",v.enter),function(b){a._onNodeMouseEnter(A.byNode(this),b)}),u(this.containerNode,u.selector(".dijitTreeNode",v.leave),function(b){a._onNodeMouseLeave(A.byNode(this),b)}),u(this.containerNode,u.selector(".dijitTreeRow",x.press),function(b){a._onNodePress(A.getEnclosingWidget(this),b)}),u(this.containerNode,u.selector(".dijitTreeRow",x),function(b){a._onClick(A.getEnclosingWidget(this),b)}),u(this.containerNode,u.selector(".dijitTreeRow","dblclick"),function(b){a._onDblClick(A.getEnclosingWidget(this),
b)}));this.model||this._store2model();this.own(d.after(this.model,"onChange",q.hitch(this,"_onItemChange"),!0),d.after(this.model,"onChildrenChange",q.hitch(this,"_onItemChildrenChange"),!0),d.after(this.model,"onDelete",q.hitch(this,"_onItemDelete"),!0));this.inherited(arguments);if(this.dndController){q.isString(this.dndController)&&(this.dndController=q.getObject(this.dndController));for(var b={},c=0;c<this.dndParams.length;c++)this[this.dndParams[c]]&&(b[this.dndParams[c]]=this[this.dndParams[c]]);
this.dndController=new this.dndController(this,b)}this._load();this.onLoadDeferred=K(this.pendingCommandsPromise);this.onLoadDeferred.then(q.hitch(this,"onLoad"))},_store2model:function(){this._v10Compat=!0;t.deprecated("Tree: from version 2.0, should specify a model object rather than a store/query");var a={id:this.id+"_ForestStoreModel",store:this.store,query:this.query,childrenAttrs:this.childrenAttr};this.params.mayHaveChildren&&(a.mayHaveChildren=q.hitch(this,"mayHaveChildren"));this.params.getItemChildren&&
(a.getChildren=q.hitch(this,function(a,b,c){this.getItemChildren(this._v10Compat&&a===this.model.root?null:a,b,c)}));this.model=new Q(a);this.showRoot=!!this.label},onLoad:function(){},_load:function(){this.model.getRoot(q.hitch(this,function(a){var b=this.rootNode=this.tree._createTreeNode({item:a,tree:this,isExpandable:!0,label:this.label||this.getLabel(a),labelType:this.model.labelType||"text",textDir:this.textDir,indent:this.showRoot?0:-1});this.showRoot?(this.domNode.setAttribute("aria-multiselectable",
!this.dndController.singular),this.rootLoadingIndicator.style.display="none"):(b.rowNode.style.display="none",this.domNode.setAttribute("role","presentation"),this.domNode.removeAttribute("aria-expanded"),this.domNode.removeAttribute("aria-multiselectable"),this["aria-label"]?(b.containerNode.setAttribute("aria-label",this["aria-label"]),this.domNode.removeAttribute("aria-label")):this["aria-labelledby"]&&(b.containerNode.setAttribute("aria-labelledby",this["aria-labelledby"]),this.domNode.removeAttribute("aria-labelledby")),
b.labelNode.setAttribute("role","presentation"),b.labelNode.removeAttribute("aria-selected"),b.containerNode.setAttribute("role","tree"),b.containerNode.setAttribute("aria-expanded","true"),b.containerNode.setAttribute("aria-multiselectable",!this.dndController.singular));this.containerNode.appendChild(b.domNode);a=this.model.getIdentity(a);this._itemNodesMap[a]?this._itemNodesMap[a].push(b):this._itemNodesMap[a]=[b];b._updateLayout();this._expandNode(b).then(q.hitch(this,function(){this._destroyed||
(this.rootLoadingIndicator.style.display="none",this.expandChildrenDeferred.resolve(!0))}))}),q.hitch(this,function(a){console.error(this,": error loading root: ",a)}))},getNodesByItem:function(a){if(!a)return[];a=q.isString(a)?a:this.model.getIdentity(a);return[].concat(this._itemNodesMap[a])},_setSelectedItemAttr:function(a){this.set("selectedItems",[a])},_setSelectedItemsAttr:function(a){var b=this;return this.pendingCommandsPromise=this.pendingCommandsPromise.always(q.hitch(this,function(){var c=
f.map(a,function(a){return!a||q.isString(a)?a:b.model.getIdentity(a)}),e=[];f.forEach(c,function(a){e=e.concat(b._itemNodesMap[a]||[])});this.set("selectedNodes",e)}))},_setPathAttr:function(a){return a.length?K(this.set("paths",[a]).then(function(a){return a[0]})):K(this.set("paths",[]).then(function(a){return a[0]}))},_setPathsAttr:function(b){function c(a,b){var d=a.shift(),g=f.filter(b,function(a){return a.getIdentity()==d})[0];if(g)return a.length?e._expandNode(g).then(function(){return c(a,
g.getChildren())}):g;throw new U.PathError("Could not expand path at "+d);}var e=this;return K(this.pendingCommandsPromise=this.pendingCommandsPromise.always(function(){return a(f.map(b,function(a){a=f.map(a,function(a){return a&&q.isObject(a)?e.model.getIdentity(a):a});if(a.length)return c(a,[e.rootNode]);throw new U.PathError("Empty path");}))}).then(function(a){e.set("selectedNodes",a);return e.paths}))},_setSelectedNodeAttr:function(a){this.set("selectedNodes",[a])},_setSelectedNodesAttr:function(a){this.dndController.setSelection(a)},
expandAll:function(){function b(e){return c._expandNode(e).then(function(){var c=f.filter(e.getChildren()||[],function(a){return a.isExpandable});return a(f.map(c,b))})}var c=this;return K(b(this.rootNode))},collapseAll:function(){function b(e){var d=f.filter(e.getChildren()||[],function(a){return a.isExpandable}),d=a(f.map(d,b));return!e.isExpanded||e==c.rootNode&&!c.showRoot?d:d.then(function(){return c._collapseNode(e)})}var c=this;return K(b(this.rootNode))},mayHaveChildren:function(){},getItemChildren:function(){},
getLabel:function(a){return this.model.getLabel(a)},getIconClass:function(a,b){return!a||this.model.mayHaveChildren(a)?b?"dijitFolderOpened":"dijitFolderClosed":"dijitLeaf"},getLabelClass:function(){},getRowClass:function(){},getIconStyle:function(){},getLabelStyle:function(){},getRowStyle:function(){},getTooltip:function(){return""},_onDownArrow:function(a,b){(a=this._getNext(b))&&a.isTreeNode&&this.focusNode(a)},_onUpArrow:function(a,b){if(a=b.getPreviousSibling())for(b=a;b.isExpandable&&b.isExpanded&&
b.hasChildren();)b=b.getChildren(),b=b[b.length-1];else if(a=b.getParent(),this.showRoot||a!==this.rootNode)b=a;b&&b.isTreeNode&&this.focusNode(b)},_onRightArrow:function(a,b){b.isExpandable&&!b.isExpanded?this._expandNode(b):b.hasChildren()&&(b=b.getChildren()[0])&&b.isTreeNode&&this.focusNode(b)},_onLeftArrow:function(a,b){b.isExpandable&&b.isExpanded?this._collapseNode(b):(a=b.getParent())&&a.isTreeNode&&(this.showRoot||a!==this.rootNode)&&this.focusNode(a)},focusLastChild:function(){var a=this._getLast();
a&&a.isTreeNode&&this.focusNode(a)},_getFirst:function(){return this.showRoot?this.rootNode:this.rootNode.getChildren()[0]},_getLast:function(){for(var a=this.rootNode;a.isExpanded;){var b=a.getChildren();if(!b.length)break;a=b[b.length-1]}return a},_getNext:function(a){if(a.isExpandable&&a.isExpanded&&a.hasChildren())return a.getChildren()[0];for(;a&&a.isTreeNode;){var b=a.getNextSibling();if(b)return b;a=a.getParent()}return null},childSelector:".dijitTreeRow",isExpandoNode:function(a,b){return g.isDescendant(a,
b.expandoNode)||g.isDescendant(a,b.expandoNodeText)},_onNodePress:function(a,b){this.focusNode(a)},__click:function(a,b,c,e){var d=this.isExpandoNode(b.target,a);a.isExpandable&&(c||d)?this._onExpandoClick({node:a}):(this._publish("execute",{item:a.item,node:a,evt:b}),this[e](a.item,a,b),this.focusNode(a));b.stopPropagation();b.preventDefault()},_onClick:function(a,b){this.__click(a,b,this.openOnClick,"onClick")},_onDblClick:function(a,b){this.__click(a,b,this.openOnDblClick,"onDblClick")},_onExpandoClick:function(a){a=
a.node;this.focusNode(a);a.isExpanded?this._collapseNode(a):this._expandNode(a)},onClick:function(){},onDblClick:function(){},onOpen:function(){},onClose:function(){},_getNextNode:function(a){t.deprecated(this.declaredClass+"::_getNextNode(node) is deprecated. Use _getNext(node) instead.","","2.0");return this._getNext(a)},_getRootOrFirstNode:function(){t.deprecated(this.declaredClass+"::_getRootOrFirstNode() is deprecated. Use _getFirst() instead.","","2.0");return this._getFirst()},_collapseNode:function(a){a._expandNodeDeferred&&
delete a._expandNodeDeferred;if("Loading"!=a.state&&a.isExpanded){var b=a.collapse();this.onClose(a.item,a);this._state(a,!1);this._startPaint(b);return b}},_expandNode:function(a){if(a._expandNodeDeferred)return a._expandNodeDeferred;var b=this.model,e=a.item,d=this;a._loadDeferred||(a.markProcessing(),a._loadDeferred=new c,b.getChildren(e,function(b){a.unmarkProcessing();a.setChildItems(b).then(function(){a._loadDeferred.resolve(b)})},function(b){console.error(d,": error loading "+a.label+" children: ",
b);a._loadDeferred.reject(b)}));b=a._loadDeferred.then(q.hitch(this,function(){var b=a.expand();this.onOpen(a.item,a);this._state(a,!0);return b}));this._startPaint(b);return b},focusNode:function(a){for(var b=[],c=this.domNode;c&&c.tagName&&"IFRAME"!==c.tagName.toUpperCase();c=c.parentNode)b.push({domNode:c.contentWindow||c,scrollLeft:c.scrollLeft||0,scrollTop:c.scrollTop||0});this.focusChild(a);this.defer(function(){for(var a=0,c=b.length;a<c;a++)b[a].domNode.scrollLeft=b[a].scrollLeft,b[a].domNode.scrollTop=
b[a].scrollTop},0)},_onNodeMouseEnter:function(){},_onNodeMouseLeave:function(){},_onItemChange:function(a){var b=this.model.getIdentity(a);if(b=this._itemNodesMap[b]){var c=this.getLabel(a),e=this.getTooltip(a);f.forEach(b,function(b){b.set({item:a,label:c,tooltip:e});b._updateItemClasses(a)})}},_onItemChildrenChange:function(a,b){a=this.model.getIdentity(a);(a=this._itemNodesMap[a])&&f.forEach(a,function(a){a.setChildItems(b)})},_onItemDelete:function(a){a=this.model.getIdentity(a);var b=this._itemNodesMap[a];
b&&(f.forEach(b,function(a){this.dndController.removeTreeNode(a);var b=a.getParent();b&&b.removeChild(a);this.lastFocusedChild&&!g.isDescendant(this.lastFocusedChild.domNode,this.domNode)&&delete this.lastFocusedChild;this.focusedChild&&!g.isDescendant(this.focusedChild.domNode,this.domNode)&&this.focus();a.destroyRecursive()},this),delete this._itemNodesMap[a])},_initState:function(){this._openedNodes={};if(this.persist&&this.cookieName){var a=m(this.cookieName);a&&f.forEach(a.split(","),function(a){this._openedNodes[a]=
!0},this)}},_state:function(a,b){if(!this.persist)return!1;var c=f.map(a.getTreePath(),function(a){return this.model.getIdentity(a)},this).join("/");if(1===arguments.length)return this._openedNodes[c];b?this._openedNodes[c]=!0:delete this._openedNodes[c];this._saveExpandedNodes()},_saveExpandedNodes:function(){if(this.persist&&this.cookieName){var a=[],b;for(b in this._openedNodes)a.push(b);m(this.cookieName,a.join(","),{expires:365})}},destroy:function(){this._curSearch&&(this._curSearch.timer.remove(),
delete this._curSearch);this.rootNode&&this.rootNode.destroyRecursive();this.dndController&&!q.isString(this.dndController)&&this.dndController.destroy();this.rootNode=null;this.inherited(arguments)},destroyRecursive:function(){this.destroy()},resize:function(a){a&&e.setMarginBox(this.domNode,a);this._nodePixelIndent=e.position(this.tree.indentDetector).w||this._nodePixelIndent;this.expandChildrenDeferred.then(q.hitch(this,function(){this.rootNode.set("indent",this.showRoot?0:-1);this._adjustWidths()}))},
_outstandingPaintOperations:0,_startPaint:function(a){this._outstandingPaintOperations++;this._adjustWidthsTimer&&(this._adjustWidthsTimer.remove(),delete this._adjustWidthsTimer);var b=q.hitch(this,function(){this._outstandingPaintOperations--;0>=this._outstandingPaintOperations&&!this._adjustWidthsTimer&&this._started&&(this._adjustWidthsTimer=this.defer("_adjustWidths"))});y(a,b,b)},_adjustWidths:function(){this._adjustWidthsTimer&&(this._adjustWidthsTimer.remove(),delete this._adjustWidthsTimer);
this.containerNode.style.width="auto";this.containerNode.style.width=this.domNode.scrollWidth>this.domNode.offsetWidth?"auto":"100%"},_createTreeNode:function(a){return new P(a)},focus:function(){this.lastFocusedChild?this.focusNode(this.lastFocusedChild):this.focusFirstChild()}});p("dojo-bidi")&&U.extend({_setTextDirAttr:function(a){a&&this.textDir!=a&&(this._set("textDir",a),this.rootNode.set("textDir",a))}});U.PathError=k("TreePathError");U._TreeNode=P;return U})},"dojo/json":function(){define(["./has"],
function(f){var d="undefined"!=typeof JSON;f.add("json-parse",d);f.add("json-stringify",d&&'{"a":1}'==JSON.stringify({a:0},function(d,c){return c||1}));if(f("json-stringify"))return JSON;var m=function(d){return('"'+d.replace(/(["\\])/g,"\\$1")+'"').replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r")};return{parse:f("json-parse")?JSON.parse:function(d,c){if(c&&!/^([\s\[\{]*(?:"(?:\\.|[^"])*"|-?\d[\d\.]*(?:[Ee][+-]?\d+)?|null|true|false|)[\s\]\}]*(?:,|:|$))+$/.test(d))throw new SyntaxError("Invalid characters in JSON");
return eval("("+d+")")},stringify:function(d,c,a){function f(e,b,d){c&&(e=c(d,e));var g;g=typeof e;if("number"==g)return isFinite(e)?e+"":"null";if("boolean"==g)return e+"";if(null===e)return"null";if("string"==typeof e)return m(e);if("function"==g||"undefined"==g)return h;if("function"==typeof e.toJSON)return f(e.toJSON(d),b,d);if(e instanceof Date)return'"{FullYear}-{Month+}-{Date}T{Hours}:{Minutes}:{Seconds}Z"'.replace(/\{(\w+)(\+)?\}/g,function(a,b,c){a=e["getUTC"+b]()+(c?1:0);return 10>a?"0"+
a:a});if(e.valueOf()!==e)return f(e.valueOf(),b,d);var k=a?b+a:"",l=a?" ":"",r=a?"\n":"";if(e instanceof Array){var l=e.length,q=[];for(d=0;d<l;d++)g=f(e[d],k,d),"string"!=typeof g&&(g="null"),q.push(r+k+g);return"["+q.join(",")+r+b+"]"}q=[];for(d in e){var u;if(e.hasOwnProperty(d)){if("number"==typeof d)u='"'+d+'"';else if("string"==typeof d)u=m(d);else continue;g=f(e[d],k,d);"string"==typeof g&&q.push(r+k+u+":"+l+g)}}return"{"+q.join(",")+r+b+"}"}var h;"string"==typeof c&&(a=c,c=null);return f(d,
"","")}}})},"dojo/_base/json":function(){define(["./kernel","../json"],function(f,d){f.fromJson=function(d){return eval("("+d+")")};f._escapeString=d.stringify;f.toJsonIndentStr="\t";f.toJson=function(m,h){return d.stringify(m,function(c,a){return a&&(c=a.__json__||a.json,"function"==typeof c)?c.call(a):a},h&&f.toJsonIndentStr)};return f})},"dijit/BackgroundIframe":function(){define("require ./main dojo/_base/config dojo/dom-construct dojo/dom-style dojo/_base/lang dojo/on dojo/sniff".split(" "),
function(f,d,m,h,c,a,g,l){l.add("config-bgIframe",(l("ie")||l("trident"))&&!/IEMobile\/10\.0/.test(navigator.userAgent));var e=new function(){var a=[];this.pop=function(){var b;a.length?(b=a.pop(),b.style.display=""):(9>l("ie")?(b=m.dojoBlankHtmlUrl||f.toUrl("dojo/resources/blank.html")||'javascript:""',b=document.createElement("\x3ciframe src\x3d'"+b+"' role\x3d'presentation' style\x3d'position: absolute; left: 0px; top: 0px;z-index: -1; filter:Alpha(Opacity\x3d\"0\");'\x3e")):(b=h.create("iframe"),
b.src='javascript:""',b.className="dijitBackgroundIframe",b.setAttribute("role","presentation"),c.set(b,"opacity",.1)),b.tabIndex=-1);return b};this.push=function(b){b.style.display="none";a.push(b)}};d.BackgroundIframe=function(b){if(!b.id)throw Error("no id");if(l("config-bgIframe")){var d=this.iframe=e.pop();b.appendChild(d);7>l("ie")||l("quirks")?(this.resize(b),this._conn=g(b,"resize",a.hitch(this,"resize",b))):c.set(d,{width:"100%",height:"100%"})}};a.extend(d.BackgroundIframe,{resize:function(a){this.iframe&&
c.set(this.iframe,{width:a.offsetWidth+"px",height:a.offsetHeight+"px"})},destroy:function(){this._conn&&(this._conn.remove(),this._conn=null);this.iframe&&(this.iframe.parentNode.removeChild(this.iframe),e.push(this.iframe),delete this.iframe)}});return d.BackgroundIframe})},"com/huayun/webgis/action/search/RectSearchAction":function(){define("dojo/_base/declare dojo/on dojo/topic dojo/dom-class dojo/dom-construct ../../geometry/Polygon ../../Graphic ../../Feature ../../geometry/Point2D ../../symbols/PolygonSymbol ../../symbols/PointSymbol ../ActiveMapAction".split(" "),
function(f,d,m,h,c,a,g,l,e,b,k,n){return f("com.huayun.webgis.action.search.RectSearchAction",[n],{constructor:function(a){f.safeMixin(this,a);this.view=a.view;this.state=this.view.selectEnabled=!1;this.power=this.view.map.findLayerById("power");this.drawLayer=this.view.map.findLayerById("drawLayer");this._mouseUp=this._mouseMove=this._mouseDown=null;this._vertexArr=[];this._symbol=new b({color:"#8F8FFF",opacity:.5});this._vertexSymbol=new k({radius:5,color:"#0000FF"});this._currentGraphic=null;this.startPoint=
{};this.endPoint={};this._lineGraphicList=[];this._lineGraphicHash={};var c=this;m.subscribe("measurement-delete",function(a){(a=c._lineGraphicHash[a])&&0<a.length&&a.forEach(function(a){c.drawLayer.removeGraphic(a)})})},active:function(){this.state||(this.state=!0,this.view.selectEnabled=!1,this.view.panEnabled=!1,this._mouseDown=d(this.view.container,"mousedown",this._onMouseDown.bind(this)),this._mouseUp=d(this.view.container,"mouseup",this._onMouseUp.bind(this)),h.add(this.view.domNode,"draw-cursor-style"))},
_onMouseDown:function(a){a.preventDefault();a.stopPropagation();a=this.view.screenToGeometry(a.x,a.y);this.startPoint.x=a.x;this.startPoint.y=a.y;this._lineGraphicList=[];this._drawDotMark(a);this._mouseMove||(this._mouseMove=d(this.view.domNode,"mousemove",this._onMouseMove.bind(this)))},_onMouseMove:function(b){b.preventDefault();b.stopPropagation();if(this.startPoint){this.endPoint=this.view.screenToGeometry(b.x,b.y);this.drawLayer.removeGraphic(this._currentGraphic);this._vertexArr=[];b=new a;
var c=new l({attribute:null,geometry:b}),c=new g({feature:c,symbol:this._symbol});this.getOtherPoints();b.setPath([this._vertexArr]);this._currentGraphic=c;this.drawLayer.addGraphic(c);this.drawLayer.layerView.view.threeRender()}},_onMouseUp:function(a){a.preventDefault();a.stopPropagation();this._drawDotMark(this.endPoint);this._currentGraphic.rg=this._lineGraphicList;this.showDeleBtn(a,this._currentGraphic.id);a=this._currentGraphic.feature.geometry;var b=this;this.view.domNode.style.cursor="wait";
b.invalid();this.power.queryFeaturesByGeometry(a,0,function(a,c){b.view.domNode.style.cursor="pointer";a||((c=c.results)&&0<c.length?m.publish("showRectInfo",c):m.publish("closeRectInfo"))})},getOtherPoints:function(){var a,b,c,d;a=this.endPoint.x;b=this.startPoint.y;c=this.startPoint.x;d=this.endPoint.y;this._vertexArr.push(new e(this.startPoint.x,this.startPoint.y));this._vertexArr.push(new e(a,b));this._vertexArr.push(new e(this.endPoint.x,this.endPoint.y));this._vertexArr.push(new e(c,d));this._vertexArr.push(new e(this.startPoint.x,
this.startPoint.y))},showDeleBtn:function(a,b){var e=this;b=c.create("div",{className:"graphicRectClose",style:{width:"8px",height:"8px",position:"absolute",color:"red",border:"2px solid red",display:"block",cursor:"pointer",textAlign:"center",fontSize:"4px",margin:"0 auto",lineHeight:"5px",backgroundColor:"white"},innerHTML:"x"},document.body);d(b,"click",function(a){e.drawLayer.clear();c.destroy(this);m.publish("closeRectInfo")});b.style.left=a.clientX+5+"px";b.style.top=a.clientY+5+"px";return b},
invalid:function(){this.state&&(this._endDrawMethod(),this.state=!1,this.view.panEnabled=!0,this.view.selectEnabled=!0,null!==this._mouseDown&&(this._mouseDown.remove(),this._mouseDown=null),null!==this._mouseUp&&(this._mouseUp.remove(),this._mouseUp=null),h.remove(this.view.domNode,"draw-cursor-style"))},_drawDotMark:function(a){a=new e(a.x,a.y);a=new l({attribute:null,geometry:a});a=new g({feature:a,symbol:this._vertexSymbol});this.drawLayer.addGraphic(a);this._lineGraphicList.push(a);this.drawLayer.layerView.view.threeRender()},
_endDrawMethod:function(){this._lineGraphicHash[this._currentGraphic.id]=this.lineGraphicList;null!==this._mouseMove&&(this._mouseMove.remove(),this._mouseMove=null);this._lineGraphicList=this._currentGraphic=null}})})},"dojo/_base/query":function(){define(["../query","./NodeList"],function(f){return f})},"com/huayun/facades/ConfigFacade":function(){define(["dojo/_base/declare","dojo/request"],function(f,d){return f("com.huayun.facades.ConfigFacade",null,{url:null,constructor:function(){},getConfigData:function(f,
h,c){d.get(f,{handleAs:"json"}).then(function(a){h(a)},function(a){c(a)})},getZoneSelect:function(f,h,c){d.get(f,{handleAs:"json"}).then(function(a){h(a)},function(a){c(a)})},getInterestPlace:function(f,h,c,a){d.post(f,{handleAs:"json",data:h}).then(function(a){c(a)},function(c){a(c)})},getCostPath:function(f,h,c){d.get(f,{handleAs:"json"}).then(function(a){h(a)},function(a){c(a)})},getAddressAround:function(f,h,c,a){d.post(f,{handleAs:"json",data:h}).then(function(a){c(a)},function(c){a(c)})},getDepartment:function(f,
h,c){d.get(f,{handleAs:"json"}).then(function(a){h(a)},function(a){c(a)})},getSubstationData:function(f,h,c){d.get(f,{handleAs:"json"}).then(function(a){h(a)},function(a){c(a)})}})})},"dojo/Stateful":function(){define(["./_base/declare","./_base/lang","./_base/array","./when"],function(f,d,m,h){return f("dojo.Stateful",null,{_attrPairNames:{},_getAttrNames:function(c){var a=this._attrPairNames;return a[c]?a[c]:a[c]={s:"_"+c+"Setter",g:"_"+c+"Getter"}},postscript:function(c){c&&this.set(c)},_get:function(c,
a){return"function"===typeof this[a.g]?this[a.g]():this[c]},get:function(c){return this._get(c,this._getAttrNames(c))},set:function(c,a){if("object"===typeof c){for(var d in c)c.hasOwnProperty(d)&&"_watchCallbacks"!=d&&this.set(d,c[d]);return this}d=this._getAttrNames(c);var f=this._get(c,d);d=this[d.s];var e;"function"===typeof d?e=d.apply(this,Array.prototype.slice.call(arguments,1)):this[c]=a;if(this._watchCallbacks){var b=this;h(e,function(){b._watchCallbacks(c,f,a)})}return this},_changeAttrValue:function(c,
a){var d=this.get(c);this[c]=a;this._watchCallbacks&&this._watchCallbacks(c,d,a);return this},watch:function(c,a){var d=this._watchCallbacks;if(!d)var f=this,d=this._watchCallbacks=function(a,c,e,g){var b=function(b){if(b){b=b.slice();for(var d=0,g=b.length;d<g;d++)b[d].call(f,a,c,e)}};b(d["_"+a]);g||b(d["*"])};a||"function"!==typeof c?c="_"+c:(a=c,c="*");var e=d[c];"object"!==typeof e&&(e=d[c]=[]);e.push(a);c={};c.unwatch=c.remove=function(){var b=m.indexOf(e,a);-1<b&&e.splice(b,1)};return c}})})},
"dojo/data/util/sorter":function(){define(["../../_base/lang"],function(f){var d={};f.setObject("dojo.data.util.sorter",d);d.basicComparator=function(d,f){var c=-1;null===d&&(d=void 0);null===f&&(f=void 0);if(d==f)c=0;else if(d>f||null==d)c=1;return c};d.createSortFunction=function(f,h){function c(a,b,c,e){return function(d,f){d=e.getValue(d,a);f=e.getValue(f,a);return b*c(d,f)}}for(var a=[],g,l=h.comparatorMap,e=d.basicComparator,b=0;b<f.length;b++){g=f[b];var k=g.attribute;if(k){g=g.descending?
-1:1;var m=e;l&&("string"!==typeof k&&"toString"in k&&(k=k.toString()),m=l[k]||e);a.push(c(k,g,m,h))}}return function(b,c){for(var e=0;e<a.length;){var d=a[e++](b,c);if(0!==d)return d}return 0}};return d})},"com/huayun/event/EventDispatch":function(){define(["dojo/_base/declare"],function(f){return f("com.huayun.event.EventDispatch",null,{_eventList:null,constructor:function(){this._eventList={}},addEventListener:function(d,f,h){var c=this._eventList[d];void 0===c&&(c=[],this._eventList[d]=c);d={func:f,
context:h};c.push(d);return d},removeEventListener:function(d,f,h){d=this._eventList[d];if(void 0!==d)for(var c=d.length,a=0;a<c;a++){var g=d[a];if(g.func===f&&g.context===h){d.splice(a,1);break}}},hasEventListener:function(d){return void 0!==this._eventList[d]?!0:!1},dispatchEvent:function(d,f){d=this._eventList[d];if(void 0!==d)for(var h=d.length,c=0;c<h;c++){var a=d[c],g=a.func,a=a.context;null!==a?g.call(a,f):g(f)}}})})},"dojo/touch":function(){define("./_base/kernel ./aspect ./dom ./dom-class ./_base/lang ./on ./has ./mouse ./domReady ./_base/window".split(" "),
function(f,d,m,h,c,a,g,l,e,b){function k(b,c,e){return r&&e?function(b,c){return a(b,e,c)}:u?function(e,d){var f=a(e,c,function(a){d.call(this,a);F=(new Date).getTime()}),g=a(e,b,function(a){(!F||(new Date).getTime()>F+1E3)&&d.call(this,a)});return{remove:function(){f.remove();g.remove()}}}:function(c,e){return a(c,b,e)}}function n(a){do if(void 0!==a.dojoClick)return a;while(a=a.parentNode)}function p(c,e,d){if(!l.isRight(c)){var f=n(c.target);if(v=!c.target.disabled&&f&&f.dojoClick)if(x=(y="useTarget"==
v)?f:c.target,y&&c.preventDefault(),w=c.changedTouches?c.changedTouches[0].pageX-b.global.pageXOffset:c.clientX,A=c.changedTouches?c.changedTouches[0].pageY-b.global.pageYOffset:c.clientY,B=("object"==typeof v?v.x:"number"==typeof v?v:0)||4,E=("object"==typeof v?v.y:"number"==typeof v?v:0)||4,!z){c=function(a){b.doc.addEventListener(a,function(b){var c=b.target;v&&!b._dojo_click&&(new Date).getTime()<=C+1E3&&("INPUT"!=c.tagName||!h.contains(c,"dijitOffScreen"))&&(b.stopPropagation(),b.stopImmediatePropagation&&
b.stopImmediatePropagation(),"click"==a&&("INPUT"!=c.tagName||"radio"==c.type&&(h.contains(c,"dijitCheckBoxInput")||h.contains(c,"mblRadioButton"))||"checkbox"==c.type&&(h.contains(c,"dijitCheckBoxInput")||h.contains(c,"mblCheckBox")))&&"TEXTAREA"!=c.tagName&&"AUDIO"!=c.tagName&&"VIDEO"!=c.tagName&&b.preventDefault())},!0)};var g=function(a){v=y?m.isDescendant(b.doc.elementFromPoint(a.changedTouches?a.changedTouches[0].pageX-b.global.pageXOffset:a.clientX,a.changedTouches?a.changedTouches[0].pageY-
b.global.pageYOffset:a.clientY),x):v&&(a.changedTouches?a.changedTouches[0].target:a.target)==x&&Math.abs((a.changedTouches?a.changedTouches[0].pageX-b.global.pageXOffset:a.clientX)-w)<=B&&Math.abs((a.changedTouches?a.changedTouches[0].pageY-b.global.pageYOffset:a.clientY)-A)<=E};z=!0;b.doc.addEventListener(e,function(a){l.isRight(a)||(g(a),y&&a.preventDefault())},!0);b.doc.addEventListener(d,function(b){if(!l.isRight(b)&&(g(b),v)){var c=function(a){var c=document.createEvent("MouseEvents");c._dojo_click=
!0;c.initMouseEvent(a,!0,!0,b.view,b.detail,d.screenX,d.screenY,d.clientX,d.clientY,b.ctrlKey,b.altKey,b.shiftKey,b.metaKey,0,null);return c};C=(new Date).getTime();var e=y?x:b.target;"LABEL"===e.tagName&&(e=m.byId(e.getAttribute("for"))||e);var d=b.changedTouches?b.changedTouches[0]:b,f=c("mousedown"),k=c("mouseup"),h=c("click");setTimeout(function(){a.emit(e,"mousedown",f);a.emit(e,"mouseup",k);a.emit(e,"click",h);C=(new Date).getTime()},0)}},!0);c("click");c("mousedown");c("mouseup")}}}var t=5>
g("ios"),r=g("pointer-events")||g("MSPointer"),q=function(){var a={},b;for(b in{down:1,move:1,up:1,cancel:1,over:1,out:1})a[b]=g("MSPointer")?"MSPointer"+b.charAt(0).toUpperCase()+b.slice(1):"pointer"+b;return a}(),u=g("touch-events"),z,v,y=!1,x,w,A,B,E,C,F,G;g("touch")&&(r?e(function(){b.doc.addEventListener(q.down,function(a){p(a,q.move,q.up)},!0)}):e(function(){function e(a){var b=c.delegate(a,{bubbles:!0});6<=g("ios")&&(b.touches=a.touches,b.altKey=a.altKey,b.changedTouches=a.changedTouches,b.ctrlKey=
a.ctrlKey,b.metaKey=a.metaKey,b.shiftKey=a.shiftKey,b.targetTouches=a.targetTouches);return b}G=b.body();b.doc.addEventListener("touchstart",function(b){F=(new Date).getTime();var c=G;G=b.target;a.emit(c,"dojotouchout",{relatedTarget:G,bubbles:!0});a.emit(G,"dojotouchover",{relatedTarget:c,bubbles:!0});p(b,"touchmove","touchend")},!0);a(b.doc,"touchmove",function(c){F=(new Date).getTime();var d=b.doc.elementFromPoint(c.pageX-(t?0:b.global.pageXOffset),c.pageY-(t?0:b.global.pageYOffset));d&&(G!==d&&
(a.emit(G,"dojotouchout",{relatedTarget:d,bubbles:!0}),a.emit(d,"dojotouchover",{relatedTarget:G,bubbles:!0}),G=d),a.emit(d,"dojotouchmove",e(c))||c.preventDefault())});a(b.doc,"touchend",function(c){F=(new Date).getTime();var d=b.doc.elementFromPoint(c.pageX-(t?0:b.global.pageXOffset),c.pageY-(t?0:b.global.pageYOffset))||b.body();a.emit(d,"dojotouchend",e(c))})}));d={press:k("mousedown","touchstart",q.down),move:k("mousemove","dojotouchmove",q.move),release:k("mouseup","dojotouchend",q.up),cancel:k(l.leave,
"touchcancel",r?q.cancel:null),over:k("mouseover","dojotouchover",q.over),out:k("mouseout","dojotouchout",q.out),enter:l._eventHandler(k("mouseover","dojotouchover",q.over)),leave:l._eventHandler(k("mouseout","dojotouchout",q.out))};return f.touch=d})},"dijit/_CssStateMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-class dojo/has dojo/_base/lang dojo/on dojo/domReady dojo/touch dojo/_base/window ./a11yclick ./registry".split(" "),function(f,d,m,h,c,a,g,l,e,b,k,n){d=
d("dijit._CssStateMixin",[],{hovering:!1,active:!1,_applyAttributes:function(){this.inherited(arguments);f.forEach("disabled readOnly checked selected focused state hovering active _opened".split(" "),function(b){this.watch(b,a.hitch(this,"_setStateClass"))},this);for(var b in this.cssStateNodes||{})this._trackMouseState(this[b],this.cssStateNodes[b]);this._trackMouseState(this.domNode,this.baseClass);this._setStateClass()},_cssMouseEvent:function(a){if(!this.disabled)switch(a.type){case "mouseover":case "MSPointerOver":case "pointerover":this._set("hovering",
!0);this._set("active",this._mouseDown);break;case "mouseout":case "MSPointerOut":case "pointerout":this._set("hovering",!1);this._set("active",!1);break;case "mousedown":case "touchstart":case "MSPointerDown":case "pointerdown":case "keydown":this._set("active",!0);break;case "mouseup":case "dojotouchend":case "MSPointerUp":case "pointerup":case "keyup":this._set("active",!1)}},_setStateClass:function(){function a(a){b=b.concat(f.map(b,function(b){return b+a}),"dijit"+a)}var b=this.baseClass.split(" ");
this.isLeftToRight()||a("Rtl");var c="mixed"==this.checked?"Mixed":this.checked?"Checked":"";this.checked&&a(c);this.state&&a(this.state);this.selected&&a("Selected");this._opened&&a("Opened");this.disabled?a("Disabled"):this.readOnly?a("ReadOnly"):this.active?a("Active"):this.hovering&&a("Hover");this.focused&&a("Focused");var c=this.stateNode||this.domNode,e={};f.forEach(c.className.split(" "),function(a){e[a]=!0});"_stateClasses"in this&&f.forEach(this._stateClasses,function(a){delete e[a]});f.forEach(b,
function(a){e[a]=!0});var d=[],g;for(g in e)d.push(g);c.className=d.join(" ");this._stateClasses=b},_subnodeCssMouseEvent:function(a,b,c){function e(c){h.toggle(a,b+"Active",c)}if(!this.disabled&&!this.readOnly)switch(c.type){case "mouseover":case "MSPointerOver":case "pointerover":h.toggle(a,b+"Hover",!0);break;case "mouseout":case "MSPointerOut":case "pointerout":h.toggle(a,b+"Hover",!1);e(!1);break;case "mousedown":case "touchstart":case "MSPointerDown":case "pointerdown":case "keydown":e(!0);
break;case "mouseup":case "MSPointerUp":case "pointerup":case "dojotouchend":case "keyup":e(!1);break;case "focus":case "focusin":h.toggle(a,b+"Focused",!0);break;case "blur":case "focusout":h.toggle(a,b+"Focused",!1)}},_trackMouseState:function(a,b){a._cssState=b}});l(function(){function a(a,b,c){if(!c||!m.isDescendant(c,b))for(;b&&b!=c;b=b.parentNode)if(b._cssState){var e=n.getEnclosingWidget(b);e&&(b==e.domNode?e._cssMouseEvent(a):e._subnodeCssMouseEvent(b,b._cssState,a))}}var c=b.body(),d;g(c,
e.over,function(b){a(b,b.target,b.relatedTarget)});g(c,e.out,function(b){a(b,b.target,b.relatedTarget)});g(c,k.press,function(b){d=b.target;a(b,d)});g(c,k.release,function(b){a(b,d);d=null});g(c,"focusin, focusout",function(a){var b=a.target;if(b._cssState&&!b.getAttribute("widgetId")){var c=n.getEnclosingWidget(b);c&&c._subnodeCssMouseEvent(b,b._cssState,a)}})});return d})},"dojo/hccss":function(){define("require ./_base/config ./dom-class ./dom-style ./has ./domReady ./_base/window".split(" "),
function(f,d,m,h,c,a,g){c.add("highcontrast",function(){var a=g.doc.createElement("div");try{a.style.cssText='border: 1px solid; border-color:red green; position: absolute; height: 5px; top: -999px;background-image: url("'+(d.blankGif||f.toUrl("./resources/blank.gif"))+'");';g.body().appendChild(a);var e=h.getComputedStyle(a),b=e.backgroundImage;return e.borderTopColor==e.borderRightColor||b&&("none"==b||"url(invalid-url:)"==b)}catch(k){return console.warn("hccss: exception detecting high-contrast mode, document is likely hidden: "+
k.toString()),!1}finally{8>=c("ie")?a.outerHTML="":g.body().removeChild(a)}});a(function(){c("highcontrast")&&m.add(g.body(),"dj_a11y")});return c})},"dojo/string":function(){define(["./_base/kernel","./_base/lang"],function(f,d){var m=/[&<>'"\/]/g,h={"\x26":"\x26amp;","\x3c":"\x26lt;","\x3e":"\x26gt;",'"':"\x26quot;","'":"\x26#x27;","/":"\x26#x2F;"},c={};d.setObject("dojo.string",c);c.escape=function(a){return a?a.replace(m,function(a){return h[a]}):""};c.rep=function(a,c){if(0>=c||!a)return"";for(var d=
[];;){c&1&&d.push(a);if(!(c>>=1))break;a+=a}return d.join("")};c.pad=function(a,d,f,e){f||(f="0");a=String(a);d=c.rep(f,Math.ceil((d-a.length)/f.length));return e?a+d:d+a};c.substitute=function(a,c,h,e){e=e||f.global;h=h?d.hitch(e,h):function(a){return a};return a.replace(/\$\{([^\s\:\}]*)(?:\:([^\s\:\}]+))?\}/g,function(a,f,g){if(""==f)return"$";a=d.getObject(f,!1,c);g&&(a=d.getObject(g,!1,e).call(e,a,f));g=h(a,f);if("undefined"===typeof g)throw Error('string.substitute could not find key "'+f+'" in template');
return g.toString()})};c.trim=String.prototype.trim?d.trim:function(a){a=a.replace(/^\s+/,"");for(var c=a.length-1;0<=c;c--)if(/\S/.test(a.charAt(c))){a=a.substring(0,c+1);break}return a};return c})},"dojo/domReady":function(){define(["./global","./has"],function(f,d){function m(a){e.push(a);l&&h()}function h(){if(!b){for(b=!0;e.length;)try{e.shift()(c)}catch(q){console.error(q,"in domReady callback",q.stack)}b=!1;m._onQEmpty()}}var c=document,a={loaded:1,complete:1},g="string"!=typeof c.readyState,
l=!!a[c.readyState],e=[],b;m.load=function(a,b,c){m(c)};m._Q=e;m._onQEmpty=function(){};g&&(c.readyState="loading");if(!l){var k=[],n=function(b){b=b||f.event;l||"readystatechange"==b.type&&!a[c.readyState]||(g&&(c.readyState="complete"),l=1,h())},p=function(a,b){a.addEventListener(b,n,!1);e.push(function(){a.removeEventListener(b,n,!1)})};if(!d("dom-addeventlistener")){var p=function(a,b){b="on"+b;a.attachEvent(b,n);e.push(function(){a.detachEvent(b,n)})},t=c.createElement("div");try{t.doScroll&&
null===f.frameElement&&k.push(function(){try{return t.doScroll("left"),1}catch(q){}})}catch(q){}}p(c,"DOMContentLoaded");p(f,"load");"onreadystatechange"in c?p(c,"readystatechange"):g||k.push(function(){return a[c.readyState]});if(k.length){var r=function(){if(!l){for(var a=k.length;a--;)if(k[a]()){n("poller");return}setTimeout(r,30)}};r()}}return m})},"dojo/data/util/filter":function(){define(["../../_base/lang"],function(f){var d={};f.setObject("dojo.data.util.filter",d);d.patternToRegExp=function(d,
f){for(var c="^",a=null,g=0;g<d.length;g++)switch(a=d.charAt(g),a){case "\\":c+=a;g++;c+=d.charAt(g);break;case "*":c+=".*";break;case "?":c+=".";break;case "$":case "^":case "/":case "+":case ".":case "|":case "(":case ")":case "{":case "}":case "[":case "]":c+="\\";default:c+=a}c+="$";return f?new RegExp(c,"mi"):new RegExp(c,"m")};return d})},"dijit/_AttachMixin":function(){define("require dojo/_base/array dojo/_base/connect dojo/_base/declare dojo/_base/lang dojo/mouse dojo/on dojo/touch ./_WidgetBase".split(" "),
function(f,d,m,h,c,a,g,l,e){var b=c.delegate(l,{mouseenter:a.enter,mouseleave:a.leave,keypress:m._keypress}),k;m=h("dijit._AttachMixin",null,{constructor:function(){this._attachPoints=[];this._attachEvents=[]},buildRendering:function(){this.inherited(arguments);this._attachTemplateNodes(this.domNode);this._beforeFillContent()},_beforeFillContent:function(){},_attachTemplateNodes:function(a){for(var b=a;;)if(1==b.nodeType&&(this._processTemplateNode(b,function(a,b){return a.getAttribute(b)},this._attach)||
this.searchContainerNode)&&b.firstChild)b=b.firstChild;else{if(b==a)break;for(;!b.nextSibling;)if(b=b.parentNode,b==a)return;b=b.nextSibling}},_processTemplateNode:function(a,b,e){var d=!0,f=this.attachScope||this,g=b(a,"dojoAttachPoint")||b(a,"data-dojo-attach-point");if(g)for(var k=g.split(/\s*,\s*/);g=k.shift();)c.isArray(f[g])?f[g].push(a):f[g]=a,d="containerNode"!=g,this._attachPoints.push(g);if(b=b(a,"dojoAttachEvent")||b(a,"data-dojo-attach-event"))for(g=b.split(/\s*,\s*/),k=c.trim;b=g.shift();)if(b){var h=
null;-1!=b.indexOf(":")?(h=b.split(":"),b=k(h[0]),h=k(h[1])):b=k(b);h||(h=b);this._attachEvents.push(e(a,b,c.hitch(f,h)))}return d},_attach:function(a,c,e){c=c.replace(/^on/,"").toLowerCase();c="dijitclick"==c?k||(k=f("./a11yclick")):b[c]||c;return g(a,c,e)},_detachTemplateNodes:function(){var a=this.attachScope||this;d.forEach(this._attachPoints,function(b){delete a[b]});this._attachPoints=[];d.forEach(this._attachEvents,function(a){a.remove()});this._attachEvents=[]},destroyRendering:function(){this._detachTemplateNodes();
this.inherited(arguments)}});c.extend(e,{dojoAttachEvent:"",dojoAttachPoint:""});return m})},"dijit/_KeyNavContainer":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/_base/kernel dojo/keys dojo/_base/lang ./registry ./_Container ./_FocusMixin ./_KeyNavMixin".split(" "),function(f,d,m,h,c,a,g,l,e,b){return d("dijit._KeyNavContainer",[e,b,l],{connectKeyNavHandlers:function(b,e){var d=this._keyNavCodes={},g=a.hitch(this,"focusPrev"),k=a.hitch(this,"focusNext");f.forEach(b,function(a){d[a]=
g});f.forEach(e,function(a){d[a]=k});d[c.HOME]=a.hitch(this,"focusFirstChild");d[c.END]=a.hitch(this,"focusLastChild")},startupKeyNavChildren:function(){h.deprecated("startupKeyNavChildren() call no longer needed","","2.0")},startup:function(){this.inherited(arguments);f.forEach(this.getChildren(),a.hitch(this,"_startupChild"))},addChild:function(a,b){this.inherited(arguments);this._startupChild(a)},_startupChild:function(a){a.set("tabIndex","-1")},_getFirst:function(){var a=this.getChildren();return a.length?
a[0]:null},_getLast:function(){var a=this.getChildren();return a.length?a[a.length-1]:null},focusNext:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,1))},focusPrev:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,-1),!0)},childSelector:function(a){return(a=g.byNode(a))&&a.getParent()==this}})})},"com/huayun/webgis/widget/searchs/ReactionSearch":function(){define("dojo/_base/declare dojo/dom dojo/on dojo/query dojo/dom-style dojo/dom-construct dojo/topic ../MapModuleX ../../Feature ../../Graphic ../../geometry/Point ../../geometry/Polyline ../../geometry/Multipoint ../../geometry/Polygon ../../symbols/PointSymbol ../../symbols/LineSymbol ../../symbols/PolygonSymbol dojo/text!../../templates/searchs/reactionSearch.html".split(" "),
function(f,d,m,h,c,a,g,l,e,b,k,n,p,t,r,q,u,z){return f("com.huayun.webgis.widget.searchs.ReactionSearch",[l],{baseClass:"reactionSearch",templateString:z,constructor:function(){this.view=this.map=this.point=this.dataList=null},doInit:function(){var a=d.byId("showList");this.map=this.get("map");this.view=this.get("view");g.subscribe("showDevInfo",function(b,c){this.dataList=b;this.point=c;this.showDev();a.style.display="block";a.style.left=c.clientX+"px";a.style.top=c.clientY+"px"}.bind(this));g.subscribe("closeDevInfo",
function(){a.style.display="none";devMoreInfo.style.display="none"}.bind(this))},showDev:function(){var b=d.byId("devList"),c=d.byId("moreInfoList");devMoreInfo.style.display="none";a.empty(c);a.empty(b);for(c=0;c<this.dataList.length;c++){var e=this.dataList[c],f=a.create("li",{index:c,className:"showLi"},b);a.create("div",{index:c,className:"message",innerHTML:c+1+"."+e.attributes.NAME+"---"+e.layerName},f);a.create("button",{index:c,className:"locationBtn",innerHTML:"\u5b9a\u4f4d"},f)}},isMessage:function(a){"message"===
a.target.className?this.showMoreInfo(a):this.mscLocation(a)},mscLocation:function(a){a=a.target.getAttribute("index");var b=this.dataList[a].geometry,c=this.dataList[a].geometryType;a=this.map.findLayerById("drawLayer");var e=new r({color:"#FFFF00",radious:5,strokeColor:"#0000FF",strokeWidth:1}),d=new q({color:"#ff2f39",width:3}),f=new u({color:"#0FF",opacity:.5});switch(c){case "esriGeometryPoint":b=b[0][0];d=new k(b.x,b.y);this.addgraphic(a,d,e);break;case "esriGeometryMultipoint":b=b[0];d=b.points.map(function(a){return new k(a[0],
a[1])});d=new p(d);this.addgraphic(a,d,e);break;case "esriGeometryPolyline":e=b.paths.map(function(a){return a.map(function(a){return new k(a[0],a[1])})});e=new n(e);this.addgraphic(a,e,d);break;default:e=b.rings.map(function(a){return a.map(function(a){return new k(a[0],a[1])})}),e=new t(e),this.addgraphic(a,e,f)}},addgraphic:function(a,c,d){c=new e({attributes:null,geometry:c});d=new b({feature:c,symbol:d});a.addGraphic(d);this.view.threeRender()},showMoreInfo:function(b){var c=d.byId("devMoreInfo");
b=b.target.getAttribute("index");b=this.dataList[b].attributes;c.style.display="block";c.style.zIndex="500";a.empty(moreInfoList);this.createTable(b)},closeMoreInfo:function(){devMoreInfo.style.display="none"},createTable:function(b){for(key in b)if("SHAPE"!==key&&"SUBGEOREGION"!==key){var c=a.create("tr",{className:"attrTr"},moreInfoList);a.create("td",{className:"td1",noWrap:"false",innerHTML:key},c);a.create("td",{className:"td2",noWrap:"false",innerHTML:b[key]},c)}}})})},"dijit/_KeyNavMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/on dijit/registry dijit/_FocusMixin".split(" "),
function(f,d,m,h,c,a,g,l){return d("dijit._KeyNavMixin",l,{tabIndex:"0",childSelector:null,postCreate:function(){this.inherited(arguments);m.set(this.domNode,"tabIndex",this.tabIndex);if(!this._keyNavCodes){var e=this._keyNavCodes={};e[h.HOME]=c.hitch(this,"focusFirstChild");e[h.END]=c.hitch(this,"focusLastChild");e[this.isLeftToRight()?h.LEFT_ARROW:h.RIGHT_ARROW]=c.hitch(this,"_onLeftArrow");e[this.isLeftToRight()?h.RIGHT_ARROW:h.LEFT_ARROW]=c.hitch(this,"_onRightArrow");e[h.UP_ARROW]=c.hitch(this,
"_onUpArrow");e[h.DOWN_ARROW]=c.hitch(this,"_onDownArrow")}var b=this,e="string"==typeof this.childSelector?this.childSelector:c.hitch(this,"childSelector");this.own(a(this.domNode,"keypress",c.hitch(this,"_onContainerKeypress")),a(this.domNode,"keydown",c.hitch(this,"_onContainerKeydown")),a(this.domNode,"focus",c.hitch(this,"_onContainerFocus")),a(this.containerNode,a.selector(e,"focusin"),function(a){b._onChildFocus(g.getEnclosingWidget(this),a)}))},_onLeftArrow:function(){},_onRightArrow:function(){},
_onUpArrow:function(){},_onDownArrow:function(){},focus:function(){this.focusFirstChild()},_getFirstFocusableChild:function(){return this._getNextFocusableChild(null,1)},_getLastFocusableChild:function(){return this._getNextFocusableChild(null,-1)},focusFirstChild:function(){this.focusChild(this._getFirstFocusableChild())},focusLastChild:function(){this.focusChild(this._getLastFocusableChild())},focusChild:function(a,b){a&&(this.focusedChild&&a!==this.focusedChild&&this._onChildBlur(this.focusedChild),
a.set("tabIndex",this.tabIndex),a.focus(b?"end":"start"))},_onContainerFocus:function(a){a.target!==this.domNode||this.focusedChild||this.focus()},_onFocus:function(){m.set(this.domNode,"tabIndex","-1");this.inherited(arguments)},_onBlur:function(a){m.set(this.domNode,"tabIndex",this.tabIndex);this.focusedChild&&(this.focusedChild.set("tabIndex","-1"),this.lastFocusedChild=this.focusedChild,this._set("focusedChild",null));this.inherited(arguments)},_onChildFocus:function(a){a&&a!=this.focusedChild&&
(this.focusedChild&&!this.focusedChild._destroyed&&this.focusedChild.set("tabIndex","-1"),a.set("tabIndex",this.tabIndex),this.lastFocused=a,this._set("focusedChild",a))},_searchString:"",multiCharSearchDuration:1E3,onKeyboardSearch:function(a,b,c,d){a&&this.focusChild(a)},_keyboardSearchCompare:function(a,b){var c=a.domNode;a=(a.label||(c.focusNode?c.focusNode.label:"")||c.innerText||c.textContent||"").replace(/^\s+/,"").substr(0,b.length).toLowerCase();return b.length&&a==b?-1:0},_onContainerKeydown:function(a){var b=
this._keyNavCodes[a.keyCode];b?(b(a,this.focusedChild),a.stopPropagation(),a.preventDefault(),this._searchString=""):a.keyCode!=h.SPACE||!this._searchTimer||a.ctrlKey||a.altKey||a.metaKey||(a.stopImmediatePropagation(),a.preventDefault(),this._keyboardSearch(a," "))},_onContainerKeypress:function(a){a.charCode<=h.SPACE||a.ctrlKey||a.altKey||a.metaKey||(a.preventDefault(),a.stopPropagation(),this._keyboardSearch(a,String.fromCharCode(a.charCode).toLowerCase()))},_keyboardSearch:function(a,b){var d=
null,e,f=0;c.hitch(this,function(){this._searchTimer&&this._searchTimer.remove();this._searchString+=b;var a=/^(.)\1*$/.test(this._searchString)?1:this._searchString.length;e=this._searchString.substr(0,a);this._searchTimer=this.defer(function(){this._searchTimer=null;this._searchString=""},this.multiCharSearchDuration);var c=this.focusedChild||null;if(1==a||!c)if(c=this._getNextFocusableChild(c,1),!c)return;a=c;do{var g=this._keyboardSearchCompare(c,e);g&&0==f++&&(d=c);if(-1==g){f=-1;break}c=this._getNextFocusableChild(c,
1)}while(c&&c!=a)})();this.onKeyboardSearch(d,a,e,f)},_onChildBlur:function(){},_getNextFocusableChild:function(a,b){var c=a;do{if(a)a=this._getNext(a,b);else if(a=this[0<b?"_getFirst":"_getLast"](),!a)break;if(null!=a&&a!=c&&a.isFocusable())return a}while(a!=c);return null},_getFirst:function(){return null},_getLast:function(){return null},_getNext:function(a,b){if(a)for(a=a.domNode;a;)if((a=a[0>b?"previousSibling":"nextSibling"])&&"getAttribute"in a){var c=g.byNode(a);if(c)return c}return null}})})},
"dojo/debounce":function(){define([],function(){return function(f,d){var m;return function(){m&&clearTimeout(m);var h=this,c=arguments;m=setTimeout(function(){f.apply(h,c)},d)}}})},"dijit/registry":function(){define(["dojo/_base/array","dojo/_base/window","./main"],function(f,d,m){var h={},c={},a={length:0,add:function(a){if(c[a.id])throw Error("Tried to register widget with id\x3d\x3d"+a.id+" but that id is already registered");c[a.id]=a;this.length++},remove:function(a){c[a]&&(delete c[a],this.length--)},
byId:function(a){return"string"==typeof a?c[a]:a},byNode:function(a){return c[a.getAttribute("widgetId")]},toArray:function(){var a=[],d;for(d in c)a.push(c[d]);return a},getUniqueId:function(a){var d;do d=a+"_"+(a in h?++h[a]:h[a]=0);while(c[d]);return"dijit"==m._scopeName?d:m._scopeName+"_"+d},findWidgets:function(a,d){function e(a){for(a=a.firstChild;a;a=a.nextSibling)if(1==a.nodeType){var f=a.getAttribute("widgetId");f?(f=c[f])&&b.push(f):a!==d&&e(a)}}var b=[];e(a);return b},_destroyAll:function(){m._curFocus=
null;m._prevFocus=null;m._activeStack=[];f.forEach(a.findWidgets(d.body()),function(a){a._destroyed||(a.destroyRecursive?a.destroyRecursive():a.destroy&&a.destroy())})},getEnclosingWidget:function(a){for(;a;){var d=1==a.nodeType&&a.getAttribute("widgetId");if(d)return c[d];a=a.parentNode}return null},_hash:c};return m.registry=a})},"dijit/Destroyable":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare"],function(f,d,m){return m("dijit.Destroyable",null,{destroy:function(d){this._destroyed=
!0},own:function(){var h=["destroyRecursive","destroy","remove"];f.forEach(arguments,function(c){function a(){l.remove();f.forEach(e,function(a){a.remove()})}var g,l=d.before(this,"destroy",function(a){c[g](a)}),e=[];c.then?(g="cancel",c.then(a,a)):f.forEach(h,function(b){"function"===typeof c[b]&&(g||(g=b),e.push(d.after(c,b,a,!0)))})},this);return arguments}})})},"dijit/_base/manager":function(){define(["dojo/_base/array","dojo/_base/config","dojo/_base/lang","../registry","../main"],function(f,
d,m,h,c){var a={};f.forEach("byId getUniqueId findWidgets _destroyAll byNode getEnclosingWidget".split(" "),function(c){a[c]=h[c]});m.mixin(a,{defaultDuration:d.defaultDuration||200});m.mixin(c,a);return c})},"dojo/_base/Color":function(){define(["./kernel","./lang","./array","./config"],function(f,d,m,h){var c=f.Color=function(a){a&&this.setColor(a)};c.named={black:[0,0,0],silver:[192,192,192],gray:[128,128,128],white:[255,255,255],maroon:[128,0,0],red:[255,0,0],purple:[128,0,128],fuchsia:[255,0,
255],green:[0,128,0],lime:[0,255,0],olive:[128,128,0],yellow:[255,255,0],navy:[0,0,128],blue:[0,0,255],teal:[0,128,128],aqua:[0,255,255],transparent:h.transparentColor||[0,0,0,0]};d.extend(c,{r:255,g:255,b:255,a:1,_set:function(a,c,d,e){this.r=a;this.g=c;this.b=d;this.a=e},setColor:function(a){d.isString(a)?c.fromString(a,this):d.isArray(a)?c.fromArray(a,this):(this._set(a.r,a.g,a.b,a.a),a instanceof c||this.sanitize());return this},sanitize:function(){return this},toRgb:function(){return[this.r,
this.g,this.b]},toRgba:function(){return[this.r,this.g,this.b,this.a]},toHex:function(){return"#"+m.map(["r","g","b"],function(a){a=this[a].toString(16);return 2>a.length?"0"+a:a},this).join("")},toCss:function(a){var c=this.r+", "+this.g+", "+this.b;return(a?"rgba("+c+", "+this.a:"rgb("+c)+")"},toString:function(){return this.toCss(!0)}});c.blendColors=f.blendColors=function(a,d,f,e){e=e||new c;e.r=Math.round(a.r+(d.r-a.r)*f);e.g=Math.round(a.g+(d.g-a.g)*f);e.b=Math.round(a.b+(d.b-a.b)*f);e.a=a.a+
(d.a-a.a)*f;return e.sanitize()};c.fromRgb=f.colorFromRgb=function(a,d){return(a=a.toLowerCase().match(/^rgba?\(([\s\.,0-9]+)\)/))&&c.fromArray(a[1].split(/\s*,\s*/),d)};c.fromHex=f.colorFromHex=function(a,d){var f=d||new c,e=4==a.length?4:8,b=(1<<e)-1;a=Number("0x"+a.substr(1));if(isNaN(a))return null;m.forEach(["b","g","r"],function(c){var d=a&b;a>>=e;f[c]=4==e?17*d:d});f.a=1;return f};c.fromArray=f.colorFromArray=function(a,d){d=d||new c;d._set(Number(a[0]),Number(a[1]),Number(a[2]),Number(a[3]));
isNaN(d.a)&&(d.a=1);return d.sanitize()};c.fromString=f.colorFromString=function(a,d){var f=c.named[a];return f&&c.fromArray(f,d)||c.fromRgb(a,d)||c.fromHex(a,d)};return c})},"com/huayun/webgis/utils/wktUtil":function(){define(["exports","../geometry/Point","../geometry/Multipoint","../geometry/Polyline","../geometry/Polygon"],function(f,d,m,h,c){var a=/(\w+)/,g=/(\d+\.?\d+\s+\d+\.?\d+)/g,l=/(\d+\.?\d+\s+\d+\.?\d+)/g,e=/\((\s*\d+\.?\d+\s+\d+\.?\d*,*\s*)+\)/g,b=/(\((\d+\.?\d+\s+\d+\.?\d*,*\s*)+\))/g,
k=/(\((\((\s*\d+\.?\d+\s+\d+\.?\d*,*\s*)+\)){1}(,*\s*\((\s*\d+\.?\d+\s+\d+\.?\d*,*\s*)*\))*\))+/g;f.parse2Geometry=function(f){if("string"===typeof f&&0<f.length){var n=[],t=null;switch(f.match(a)[0].toLowerCase()){case "point":return n=f.match(g),t=n[0].split(" "),new d(Number(t[0]),Number(t[1]));case "multipoint":var n=f.match(g),r=[];n.forEach(function(a){t=a.split(" ");r.push(new d(Number(t[0]),Number(t[1])))}.bind(this));return new m(r);case "linestring":var q=[];f.match(l).forEach(function(a){n=
a.split(" ");t=new d(Number(n[0]),Number(n[1]));q.push(t)}.bind(this));return new h([q]);case "multilinestring":var u=[];f.match(b).forEach(function(a){var b=[];a.match(l).forEach(function(a){n=a.split(" ");t=new d(Number(n[0]),Number(n[1]));b.push(t)});u.push(b)}.bind(this));return new h(u);case "polygon":var z=[];f.match(e).forEach(function(a){var b=[];a.match(g).forEach(function(a){n=a.split(" ");t=new d(Number(n[0]),Number(n[1]));b.push(t)});z.push(b)}.bind(this));return new c(z);case "multipolygon":var v=
[];f.match(k).forEach(function(a){var b=[];a.match(e).forEach(function(a){var c=[];a.match(g).forEach(function(a){n=a.split(" ");t=new d(Number(n[0]),Number(n[1]));c.push(t)});b.push(c)});v.push(new c(b))});return v}}else console.warn("\u5f53\u524d\u6570\u636e\u4e3a\u65e0\u6548\u6570\u636e:"+f);return null};f.parse2Array=function(c){if("string"===typeof c&&0<c.length){var f=[],h=null;switch(c.match(a)[0].toLowerCase()){case "point":return f=c.match(g),h=f[0].split(" "),new d(Number(h[0]),Number(h[1]));
case "multipoint":var f=c.match(g),m=[];f.forEach(function(a){h=a.split(" ");m.push(new d(Number(h[0]),Number(h[1])))}.bind(this));return m;case "linestring":var n=[];c.match(l).forEach(function(a){f=a.split(" ");h=new d(Number(f[0]),Number(f[1]));n.push(h)}.bind(this));return n;case "multilinestring":var u=[];c.match(b).forEach(function(a){var b=[];a.match(l).forEach(function(a){f=a.split(" ");h=new d(Number(f[0]),Number(f[1]));b.push(h)});u.push(b)}.bind(this));return u;case "polygon":var z=[];
c.match(e).forEach(function(a){f=a.split(" ");h=new d(Number(f[0]),Number(f[1]));z.push(h)}.bind(this));return z;case "multipolygon":var v=[];c.match(k).forEach(function(a){var b=[];a.match(e).forEach(function(a){f=a.split(" ");h=new d(Number(f[0]),Number(f[1]));b.push(h)});v.push(b)});return v}}else console.warn("\u5f53\u524d\u6570\u636e\u4e3a\u65e0\u6548\u6570\u636e:"+c);return null}})},"dijit/a11y":function(){define("dojo/_base/array dojo/dom dojo/dom-attr dojo/dom-style dojo/_base/lang dojo/sniff ./main".split(" "),
function(f,d,m,h,c,a,g){var l={_isElementShown:function(a){var b=h.get(a);return"hidden"!=b.visibility&&"collapsed"!=b.visibility&&"none"!=b.display&&"hidden"!=m.get(a,"type")},hasDefaultTabStop:function(a){switch(a.nodeName.toLowerCase()){case "a":return m.has(a,"href");case "area":case "button":case "input":case "object":case "select":case "textarea":return!0;case "iframe":var b;try{var c=a.contentDocument;if("designMode"in c&&"on"==c.designMode)return!0;b=c.body}catch(n){try{b=a.contentWindow.document.body}catch(p){return!1}}return b&&
("true"==b.contentEditable||b.firstChild&&"true"==b.firstChild.contentEditable);default:return"true"==a.contentEditable}},effectiveTabIndex:function(a){if(!m.get(a,"disabled"))return m.has(a,"tabIndex")?+m.get(a,"tabIndex"):l.hasDefaultTabStop(a)?0:void 0},isTabNavigable:function(a){return 0<=l.effectiveTabIndex(a)},isFocusable:function(a){return-1<=l.effectiveTabIndex(a)},_getTabNavigable:function(c){function b(a){return a&&"input"==a.tagName.toLowerCase()&&a.type&&"radio"==a.type.toLowerCase()&&
a.name&&a.name.toLowerCase()}function d(a){return z[b(a)]||a}var e,f,g,h,q,u,z={},v=l._isElementShown,y=l.effectiveTabIndex,x=function(c){for(c=c.firstChild;c;c=c.nextSibling)if(!(1!=c.nodeType||9>=a("ie")&&"HTML"!==c.scopeName)&&v(c)){var d=y(c);if(0<=d){if(0==d)e||(e=c),f=c;else if(0<d){if(!g||d<h)h=d,g=c;if(!q||d>=u)u=d,q=c}d=b(c);m.get(c,"checked")&&d&&(z[d]=c)}"SELECT"!=c.nodeName.toUpperCase()&&x(c)}};v(c)&&x(c);return{first:d(e),last:d(f),lowest:d(g),highest:d(q)}},getFirstInTabbingOrder:function(a,
b){a=l._getTabNavigable(d.byId(a,b));return a.lowest?a.lowest:a.first},getLastInTabbingOrder:function(a,b){a=l._getTabNavigable(d.byId(a,b));return a.last?a.last:a.highest}};c.mixin(g,l);return l})},"com/huayun/webgis/action/search/PolygonSearchAction":function(){define("dojo/_base/declare dojo/on dojo/topic dojo/dom-class dojo/dom-construct ../../geometry/Polygon ../../Graphic ../../Feature ../../geometry/Point2D ../../symbols/PolygonSymbol ../../symbols/PointSymbol ../ActiveMapAction".split(" "),
function(f,d,m,h,c,a,g,l,e,b,k,n){return f("com.huayun.webgis.action.search.PlygonSearchAction",[n],{constructor:function(a){f.safeMixin(this,a);this.view=a.view;this.state=this.view.selectEnabled=!1;this.power=this.view.map.findLayerById("power");this.drawLayer=this.view.map.findLayerById("drawLayer");this._lastPoint=this._mouseClickMove=this._dblMouseClick=this._mouseClick=null;this._vertexArr=[];this._polygonList=[];this._symbol=new b({color:"#8F8FFF",opacity:.5});this._vertexSymbol=new k({radius:5,
color:"#0000FF"});this._currentGraphic=null;this._lineGraphicList=[];this._lineGraphicHash={};var c=this;m.subscribe("measurement-delete",function(a){(a=c._lineGraphicHash[a])&&0<a.length&&a.forEach(function(a){c.drawLayer.removeGraphic(a)})})},active:function(){this.state||(this.state=!0,this.view.selectEnabled=!1,this.view.panEnabled=!1,this._mouseClick=d(this.view.container,"click",this._onMouseClick.bind(this)),this._dblMouseClick=d(this.view.container,"dblclick",this._onDoubleMouseClick.bind(this)),
h.add(this.view.domNode,"draw-cursor-style"))},_onMouseClick:function(a){a.preventDefault();a.stopPropagation();var b=this.view.screenToGeometry(a.x,a.y);this._mouseMove||(this._mouseMove=d(this.view.domNode,"mousemove",this._onMouseMove.bind(this)));null===this._lastPoint?(this._lineGraphicList=[],this.doAction(b)):a.x!==this._lastPoint.x&&a.y!==this._lastPoint.y&&this.doAction(b);this._lastPoint={x:a.x,y:a.y}},_onMouseMove:function(b){b=this.view.screenToGeometry(b.x,b.y);this.drawLayer.removeGraphic(this._currentGraphic);
var c=new a,d=new l({attribute:null,geometry:c}),d=new g({feature:d,symbol:this._symbol});this._preClick?(this._vertexArr.push(new e(b.x,b.y)),this._preClick=!1):this._vertexArr.splice(this._vertexArr.length-1,1,new e(b.x,b.y));c.setPath([this._vertexArr]);this._currentGraphic=d;this.drawLayer.addGraphic(d);this.drawLayer.layerView.view.threeRender()},_onDoubleMouseClick:function(a){a.preventDefault();a.stopPropagation();this._currentGraphic.rg=this._lineGraphicList;this.showDeleButton(a,this._currentGraphic.id);
a=this._currentGraphic.feature.geometry;var b=this;this.view.domNode.style.cursor="wait";b.invalid();debugger;this.power.queryFeaturesByGeometry(a,0,function(a,c){b.view.domNode.style.cursor="pointer";a||((c=c.results)&&0<c.length?m.publish("showPolyInfo",c):m.publish("closeInfo"))})},showDeleButton:function(a,b){var e=this,f=c.create("div",{className:"graphicPolyClose",style:{width:"8px",height:"8px",position:"absolute",color:"red",border:"2px solid red",display:"block",cursor:"pointer",textAlign:"center",
fontSize:"4px",margin:"0 auto",lineHeight:"5px",backgroundColor:"white"},innerHTML:"x"},document.body);d(f,"click",function(a){a=e.drawLayer.graphics;for(var d,f=0,g=a.length;f<g&&(d=a[f],d.id!==b);f++);d&&(e.drawLayer.removeGraphic(d),d.rg.forEach(function(a){e.drawLayer.removeGraphic(a)}),c.destroy(this),m.publish("closeInfo"))});f.style.left=a.clientX+5+"px";f.style.top=a.clientY+5+"px";return f},invalid:function(){this.state&&(this._endDrawMethod(),this.state=!1,this.view.panEnabled=!0,this.view.selectEnabled=
!0,null!==this._mouseClick&&(this._mouseClick.remove(),this._mouseClick=null),null!==this._dblMouseClick&&(this._dblMouseClick.remove(),this._dblMouseClick=null),h.remove(this.view.domNode,"draw-cursor-style"))},doAction:function(a){this._drawDotMark(a)},_drawDotMark:function(a){var b=new e(a.x,a.y),c=new l({attribute:null,geometry:b}),c=new g({feature:c,symbol:this._vertexSymbol});this.drawLayer.addGraphic(c);this._lineGraphicList.push(c);c=this._vertexArr.length;this._preClick=!0;3>c?this._vertexArr.push(new e(b.x,
b.y)):this._vertexArr.splice(this._vertexArr.length-1,1,new e(a.x,a.y));this.drawLayer.layerView.view.threeRender()},_endDrawMethod:function(){this._lineGraphicHash[this._currentGraphic.id]=this._lineGraphicList;null!==this._mouseClickMove&&(this._mouseClickMove.remove(),this._mouseClickMove=null);this._vertexArr=[];this._lineGraphicList=this._lastPoint=this._currentGraphic=null}})})},"com/huayun/webgis/widget/LocatingController":function(){define("dojo/_base/declare dojo/topic dojo/_base/query ./MapModuleX ../Feature ../Graphic ../geometry/Extent ../geometry/Polygon ../geometry/Polyline ../symbols/PointSymbol ../symbols/LineSymbol ../symbols/PolygonSymbol ../geometry/Point2D dojo/text!../templates/locatingController.html".split(" "),
function(f,d,m,h,c,a,g,l,e,b,k,n,p,t){return f("com.huayun.webgis.widget.LocatingController",[h],{map:null,view:null,maxLevel:null,templateString:t,name:"",baseClass:"locating-panel",backgroundColor:"",width:400,height:"100%",_graphicLayer:{},_graphicLayerView:{},inputDefaultValue:{point:"POINT(510956.68552086304 3351006.8744868394)",points:"multipoint(510956.68552086304 3351006.8744868394,510756.68552086304 3351206.8744868394,510356.68552086304 3350906.8744868394)",line:"linestring(510956.68552086304 3351006.8744868394,510756.68552086304 3351206.8744868394)",
lines:"multilinestring((473159.904 3347918.429,472572.073 3347775.921)(535989.234 3337808.425,441290.124 3340479.781))",plane:"polygon(510956.68552086304 3351006.8744868394,510756.68552086304 3351206.8744868394,510356.68552086304 3350906.8744868394)"},drawOptions:{color:"rgba(65,105,225,.5)",lineWidth:2},doInit:function(){this.map=this.get("map");this.view=this.get("view");this.maxLevel=this.view.viewpoint.maxLevel;this._graphicLayerView=this.view.findLayerViewById("drawLayer");this._graphicLayer=
this.map.findLayerById("drawLayer");this.dotSymbol=new b({radius:10,color:"#2196F3",strokeColor:"#8BC34A",strokeWidth:1});this._lineSymbol=new k({color:"#009688",width:5});this._polygonSymbol=new n({color:"#4CAF50",opacity:.8})},clearLocating:function(){this._graphicLayer.clear()},locateOnPoint:function(){this.clearLocating();var b=m("#point")[0].value,d=this.geometry2geoJson(b),b=Number(d.coordinates[0]),d=Number(d.coordinates[1]),e=new p(b,d),e=new c({geometry:e}),e=new a({feature:e,symbol:this.dotSymbol});
this._graphicLayer.addGraphic(e);this.view.centerAt(b,d,this.maxLevel)},locateOnPoints:function(){this.clearLocating();var b=m("#points")[0].value,b=this.geometry2geoJson(b),d=this.getCenterPoint(b.coordinates),e=[],f=[];b.coordinates.forEach(function(b){var d=Number(b[0]);b=Number(b[1]);e.push(d);f.push(b);d=new p(d,b,.1);d=new c({geometry:d});d=new a({feature:d,symbol:this.dotSymbol,graphicLayer:this._graphicLayer});this._graphicLayer.addGraphic(d)}.bind(this));this.view.threeRender();this.view.centerAt(d.x,
d.y);this._getMinRange(e,f,d)},addLine:function(b,d){var f=new e;f.setPath([[b,d]]);b=new c({geometry:f});b=new a({feature:b,symbol:this._lineSymbol});this._graphicLayer.addGraphic(b)},locateOnLineString:function(){this.clearLocating();var a=m("#line")[0].value,b=this.geometry2geoJson(a),a=this.getCenterPoint(b.coordinates),c=new p(Number(b.coordinates[0][0]),Number(b.coordinates[0][1])),b=new p(Number(b.coordinates[1][0]),Number(b.coordinates[1][1]));this._getMinRange([c.x,b.x],[c.y,b.y],a);this.addLine(c,
b);this.view.centerAt(a.x,a.y)},addPolygon:function(b){for(var d=[],e=0;e<b.length;e++)d.push(b[e]);b=new l;b.setPath([d]);d=new c({attribute:null,geometry:b,type:"polygon"});d=new a({feature:d,symbol:this._polygonSymbol});this._graphicLayer.addGraphic(d)},locateInPolygon:function(){this.clearLocating();for(var a=m("#plane")[0].value,b=this.geometry2geoJson(a),a=this.getCenterPoint(b.coordinates),c=[],b=b.coordinates,d,e=[],f=[],g=0;g<b.length;g++){var k=Number(b[g][0]),h=Number(b[g][1]);d=new p(k,
h);e.push(k);f.push(h);c.push(d)}this.addPolygon(c);this.view.centerAt(a.x,a.y)},geometry2geoJson:function(a){var b={};a=a.toLocaleUpperCase();if(a.startsWith("POINT")){b.type="POINT";var c=a.indexOf("("),d=a.indexOf(")");a=a.slice(c+1,d).split(" ");b.coordinates=a}else if(a.startsWith("MULTIPOINT")){b.type="MULTIPOINT";var c=a.indexOf("("),d=a.indexOf(")"),e=[];a.slice(c+1,d).split(",").forEach(function(a){e.push(a.split(" "))});b.coordinates=e}else if(a.startsWith("LINESTRING")){b.type="LINESTRING";
var c=a.indexOf("("),d=a.indexOf(")"),f=[];a.slice(c+1,d).split(",").forEach(function(a){f.push(a.split(" "))});b.coordinates=f}else if(!a.startsWith("MULTILINESTRING")&&a.startsWith("POLYGON")){b.type="POLYGON";var c=a.indexOf("("),d=a.indexOf(")"),g=[];a.substring(c+1,a.length-1).split(",").forEach(function(a){g.push(a.split(" "))});b.coordinates=g}return b},getCenterPoint:function(a,b){if(a&&0<a.length)var c=a[0][0],d=a[0][1],e=a[0][0],f=a[0][1];a.forEach(function(a){c=a[0]<c?a[0]:c;e=a[0]>e?a[0]:
e;d=a[1]<d?a[1]:d;f=a[1]>f?a[1]:f});a={x:(Number(c)+Number(e))/2,y:(Number(d)+Number(f))/2};b&&b(a);return a},getLevelExtent:function(a){if(a&&0<a.length)var b=a[0][0],c=a[0][1],d=a[0][0],e=a[0][1];a.forEach(function(a){b=a[0]<b?a[0]:b;d=a[0]>d?a[0]:d;c=a[1]<c?a[1]:c;e=a[1]>e?a[1]:e});return new g(b,c,d,e)},drawPoint:function(a){},_getMinRange:function(a,b,c){var e=Math.min.apply(null,a);a=Math.max.apply(null,a);var f=Math.min.apply(null,b);b=Math.max.apply(null,b);e=new g(e,f,a,b);this.view.setExtent(e,
c);d.publish("changeLevel",{level:this.view.level,diffLevel:this.maxLevel-this.view.level})}})})},"dojo/request/xhr":function(){define(["../errors/RequestError","./watch","./handlers","./util","../has"],function(f,d,m,h,c){function a(a,b){var c=a.xhr;a.status=a.xhr.status;try{a.text=c.responseText}catch(y){}"xml"===a.options.handleAs&&(a.data=c.responseXML);var d;if(b)this.reject(b);else{try{m(a)}catch(y){d=y}h.checkStatus(c.status)?d?this.reject(d):this.resolve(a):(b=d?new f("Unable to load "+a.url+
" status: "+c.status+" and an error in handleAs: transformation of response",a):new f("Unable to load "+a.url+" status: "+c.status,a),this.reject(b))}}function g(a){return this.xhr.getResponseHeader(a)}function l(m,u,z){var q=c("native-formdata")&&u&&u.data&&u.data instanceof FormData,y=h.parseArgs(m,h.deepCreate(r,u),q);m=y.url;u=y.options;var x=!u.data&&"POST"!==u.method&&"PUT"!==u.method;10>=c("ie")&&(m=m.split("#")[0]);var w,A=h.deferred(y,p,b,k,a,function(){w&&w()}),B=y.xhr=l._create();if(!B)return A.cancel(new f("XHR was not created")),
z?A:A.promise;y.getHeader=g;n&&(w=n(B,A,y,u.uploadProgress));var E="undefined"===typeof u.data?null:u.data,C=!u.sync,F=u.method;try{B.open(F,m,C,u.user||t,u.password||t);u.withCredentials&&(B.withCredentials=u.withCredentials);c("native-response-type")&&u.handleAs in e&&(B.responseType=e[u.handleAs]);var G=u.headers;m=q||x?!1:"application/x-www-form-urlencoded";if(G)for(var I in G)"content-type"===I.toLowerCase()?m=G[I]:G[I]&&B.setRequestHeader(I,G[I]);m&&!1!==m&&B.setRequestHeader("Content-Type",
m);G&&"X-Requested-With"in G||B.setRequestHeader("X-Requested-With","XMLHttpRequest");h.notify&&h.notify.emit("send",y,A.promise.cancel);B.send(E)}catch(M){A.reject(M)}d(A);B=null;return z?A:A.promise}c.add("native-xhr",function(){return"undefined"!==typeof XMLHttpRequest});c.add("dojo-force-activex-xhr",function(){return c("activex")&&"file:"===window.location.protocol});c.add("native-xhr2",function(){if(c("native-xhr")&&!c("dojo-force-activex-xhr")){var a=new XMLHttpRequest;return"undefined"!==
typeof a.addEventListener&&("undefined"===typeof opera||"undefined"!==typeof a.upload)}});c.add("native-formdata",function(){return"undefined"!==typeof FormData});c.add("native-blob",function(){return"undefined"!==typeof Blob});c.add("native-arraybuffer",function(){return"undefined"!==typeof ArrayBuffer});c.add("native-response-type",function(){return c("native-xhr")&&"undefined"!==typeof(new XMLHttpRequest).responseType});c.add("native-xhr2-blob",function(){if(c("native-response-type")){var a=new XMLHttpRequest;
a.open("GET","https://dojotoolkit.org/",!0);a.responseType="blob";var b=a.responseType;a.abort();return"blob"===b}});var e={blob:c("native-xhr2-blob")?"blob":"arraybuffer",document:"document",arraybuffer:"arraybuffer"},b,k,n,p;c("native-xhr2")?(b=function(a){return!this.isFulfilled()},p=function(a,b){b.xhr.abort()},n=function(a,b,c,d){function e(a){b.handleResponse(c)}function g(a){a=new f("Unable to load "+c.url+" status: "+a.target.status,c);b.handleResponse(c,a)}function k(a,d){c.transferType=
a;d.lengthComputable?(c.loaded=d.loaded,c.total=d.total,b.progress(c)):3===c.xhr.readyState&&(c.loaded="loaded"in d?d.loaded:d.position,b.progress(c))}function h(a){return k("download",a)}function l(a){return k("upload",a)}a.addEventListener("load",e,!1);a.addEventListener("error",g,!1);a.addEventListener("progress",h,!1);d&&a.upload&&a.upload.addEventListener("progress",l,!1);return function(){a.removeEventListener("load",e,!1);a.removeEventListener("error",g,!1);a.removeEventListener("progress",
h,!1);a.upload.removeEventListener("progress",l,!1);a=null}}):(b=function(a){return a.xhr.readyState},k=function(a){return 4===a.xhr.readyState},p=function(a,b){a=b.xhr;b=typeof a.abort;"function"!==b&&"object"!==b&&"unknown"!==b||a.abort()});var t,r={data:null,query:null,sync:!1,method:"GET"};l._create=function(){throw Error("XMLHTTP not available");};if(c("native-xhr")&&!c("dojo-force-activex-xhr"))l._create=function(){return new XMLHttpRequest};else if(c("activex"))try{new ActiveXObject("Msxml2.XMLHTTP"),
l._create=function(){return new ActiveXObject("Msxml2.XMLHTTP")}}catch(q){try{new ActiveXObject("Microsoft.XMLHTTP"),l._create=function(){return new ActiveXObject("Microsoft.XMLHTTP")}}catch(u){}}h.addCommonMethods(l);return l})},"dijit/Menu":function(){define("require dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-geometry dojo/dom-style dojo/keys dojo/_base/lang dojo/on dojo/sniff dojo/_base/window dojo/window ./popup ./DropDownMenu dojo/ready".split(" "),function(f,d,m,h,c,
a,g,l,e,b,k,n,p,t,r,q){k("dijit-legacy-requires")&&q(0,function(){f(["dijit/MenuItem","dijit/PopupMenuItem","dijit/CheckedMenuItem","dijit/MenuSeparator"])});return m("dijit.Menu",r,{constructor:function(){this._bindings=[]},targetNodeIds:[],selector:"",contextMenuForWindow:!1,leftClickToOpen:!1,refocus:!0,postCreate:function(){this.contextMenuForWindow?this.bindDomNode(this.ownerDocumentBody):d.forEach(this.targetNodeIds,this.bindDomNode,this);this.inherited(arguments)},_iframeContentWindow:function(a){return p.get(this._iframeContentDocument(a))||
this._iframeContentDocument(a).__parent__||a.name&&document.frames[a.name]||null},_iframeContentDocument:function(a){return a.contentDocument||a.contentWindow&&a.contentWindow.document||a.name&&document.frames[a.name]&&document.frames[a.name].document||null},bindDomNode:function(a){a=h.byId(a,this.ownerDocument);var d;if("iframe"==a.tagName.toLowerCase()){var f=a;d=this._iframeContentWindow(f);d=n.body(d.document)}else d=a==n.body(this.ownerDocument)?this.ownerDocument.documentElement:a;var g={node:a,
iframe:f};c.set(a,"_dijitMenu"+this.id,this._bindings.push(g));var k=e.hitch(this,function(a){var c=this.selector,d=c?function(a){return b.selector(c,a)}:function(a){return a},e=this;return[b(a,d(this.leftClickToOpen?"click":"contextmenu"),function(a){a.stopPropagation();a.preventDefault();(new Date).getTime()<e._lastKeyDown+500||e._scheduleOpen(this,f,{x:a.pageX,y:a.pageY},a.target)}),b(a,d("keydown"),function(a){if(93==a.keyCode||a.shiftKey&&a.keyCode==l.F10||e.leftClickToOpen&&a.keyCode==l.SPACE)a.stopPropagation(),
a.preventDefault(),e._scheduleOpen(this,f,null,a.target),e._lastKeyDown=(new Date).getTime()})]});g.connects=d?k(d):[];f&&(g.onloadHandler=e.hitch(this,function(){var a=this._iframeContentWindow(f),a=n.body(a.document);g.connects=k(a)}),f.addEventListener?f.addEventListener("load",g.onloadHandler,!1):f.attachEvent("onload",g.onloadHandler))},unBindDomNode:function(a){var b;try{b=h.byId(a,this.ownerDocument)}catch(w){return}a="_dijitMenu"+this.id;if(b&&c.has(b,a)){for(var d=c.get(b,a)-1,e=this._bindings[d],
f;f=e.connects.pop();)f.remove();(f=e.iframe)&&(f.removeEventListener?f.removeEventListener("load",e.onloadHandler,!1):f.detachEvent("onload",e.onloadHandler));c.remove(b,a);delete this._bindings[d]}},_scheduleOpen:function(a,b,c,d){this._openTimer||(this._openTimer=this.defer(function(){delete this._openTimer;this._openMyself({target:d,delegatedTarget:a,iframe:b,coords:c})},1))},_openMyself:function(b){function c(){p.refocus&&r&&r.focus();t.close(p)}var d=b.target,e=b.iframe,f=b.coords,l=!f;this.currentTarget=
b.delegatedTarget;if(f){if(e){b=a.position(e,!0);var d=this._iframeContentWindow(e),d=a.docScroll(d.document),m=g.getComputedStyle(e),n=g.toPixelValue,q=(k("ie")&&k("quirks")?0:n(e,m.paddingLeft))+(k("ie")&&k("quirks")?n(e,m.borderLeftWidth):0),e=(k("ie")&&k("quirks")?0:n(e,m.paddingTop))+(k("ie")&&k("quirks")?n(e,m.borderTopWidth):0);f.x+=b.x+q-d.x;f.y+=b.y+e-d.y}}else f=a.position(d,!0),f.x+=10,f.y+=10;var p=this,e=this._focusManager.get("prevNode");b=this._focusManager.get("curNode");var r=!b||
h.isDescendant(b,this.domNode)?e:b;t.open({popup:this,x:f.x,y:f.y,onExecute:c,onCancel:c,orient:this.isLeftToRight()?"L":"R"});this.focus();l||this.defer(function(){this._cleanUp(!0)});this._onBlur=function(){this.inherited("_onBlur",arguments);t.close(this)}},destroy:function(){d.forEach(this._bindings,function(a){a&&this.unBindDomNode(a.node)},this);this.inherited(arguments)}})})},"dojo/regexp":function(){define(["./_base/kernel","./_base/lang"],function(f,d){var m={};d.setObject("dojo.regexp",
m);m.escapeString=function(d,c){return d.replace(/([\.$?*|{}\(\)\[\]\\\/\+\-^])/g,function(a){return c&&-1!=c.indexOf(a)?a:"\\"+a})};m.buildGroupRE=function(d,c,a){if(!(d instanceof Array))return c(d);for(var f=[],h=0;h<d.length;h++)f.push(c(d[h]));return m.group(f.join("|"),a)};m.group=function(d,c){return"("+(c?"?:":"")+d+")"};return m})},"dojo/dnd/common":function(){define(["../sniff","../_base/kernel","../_base/lang","../dom"],function(f,d,m,h){var c=m.getObject("dojo.dnd",!0);c.getCopyKeyState=
function(a){return a[f("mac")?"metaKey":"ctrlKey"]};c._uniqueId=0;c.getUniqueId=function(){var a;do a=d._scopeName+"Unique"+ ++c._uniqueId;while(h.byId(a));return a};c._empty={};c.isFormElement=function(a){a=a.target;3==a.nodeType&&(a=a.parentNode);return 0<=" a button textarea input select option ".indexOf(" "+a.tagName.toLowerCase()+" ")};return c})},"dojo/_base/NodeList":function(){define(["./kernel","../query","./array","./html","../NodeList-dom"],function(f,d,m){d=d.NodeList;var h=d.prototype;
h.connect=d._adaptAsForEach(function(){return f.connect.apply(this,arguments)});h.coords=d._adaptAsMap(f.coords);d.events="blur focus change click error keydown keypress keyup load mousedown mouseenter mouseleave mousemove mouseout mouseover mouseup submit".split(" ");m.forEach(d.events,function(c){var a="on"+c;h[a]=function(c,d){return this.connect(a,c,d)}});return f.NodeList=d})},"dijit/place":function(){define("dojo/_base/array dojo/dom-geometry dojo/dom-style dojo/_base/kernel dojo/_base/window ./Viewport ./main".split(" "),
function(f,d,m,h,c,a,g){function l(b,e,g,h){var k=a.getEffectiveBox(b.ownerDocument);b.parentNode&&"body"==String(b.parentNode.tagName).toLowerCase()||c.body(b.ownerDocument).appendChild(b);var l=null;f.some(e,function(a){var c=a.corner,e=a.pos,f=0,m={w:{L:k.l+k.w-e.x,R:e.x-k.l,M:k.w}[c.charAt(1)],h:{T:k.t+k.h-e.y,B:e.y-k.t,M:k.h}[c.charAt(0)]},n=b.style;n.left=n.right="auto";g&&(f=g(b,a.aroundCorner,c,m,h),f="undefined"==typeof f?0:f);var q=b.style,p=q.display,r=q.visibility;"none"==q.display&&(q.visibility=
"hidden",q.display="");n=d.position(b);q.display=p;q.visibility=r;p={L:e.x,R:e.x-n.w,M:Math.max(k.l,Math.min(k.l+k.w,e.x+(n.w>>1))-n.w)}[c.charAt(1)];r={T:e.y,B:e.y-n.h,M:Math.max(k.t,Math.min(k.t+k.h,e.y+(n.h>>1))-n.h)}[c.charAt(0)];e=Math.max(k.l,p);q=Math.max(k.t,r);p=Math.min(k.l+k.w,p+n.w)-e;r=Math.min(k.t+k.h,r+n.h)-q;f+=n.w-p+(n.h-r);if(null==l||f<l.overflow)l={corner:c,aroundCorner:a.aroundCorner,x:e,y:q,w:p,h:r,overflow:f,spaceAvailable:m};return!f});l.overflow&&g&&g(b,l.aroundCorner,l.corner,
l.spaceAvailable,h);e=l.y;var n=l.x,p=c.body(b.ownerDocument);/relative|absolute/.test(m.get(p,"position"))&&(e-=m.get(p,"marginTop"),n-=m.get(p,"marginLeft"));p=b.style;p.top=e+"px";p.left=n+"px";p.right="auto";return l}var e={TL:"BR",TR:"BL",BL:"TR",BR:"TL"};return g.place={at:function(a,c,d,g,h){d=f.map(d,function(a){var b={corner:a,aroundCorner:e[a],pos:{x:c.x,y:c.y}};g&&(b.pos.x+="L"==a.charAt(1)?g.x:-g.x,b.pos.y+="T"==a.charAt(0)?g.y:-g.y);return b});return l(a,d,h)},around:function(a,c,e,g,
t){function b(a,b){C.push({aroundCorner:a,corner:b,pos:{x:{L:w,R:w+B,M:w+(B>>1)}[a.charAt(1)],y:{T:A,B:A+E,M:A+(E>>1)}[a.charAt(0)]}})}var k;if("string"==typeof c||"offsetWidth"in c||"ownerSVGElement"in c){if(k=d.position(c,!0),/^(above|below)/.test(e[0])){var n=d.getBorderExtents(c),p=c.firstChild?d.getBorderExtents(c.firstChild):{t:0,l:0,b:0,r:0},v=d.getBorderExtents(a),y=a.firstChild?d.getBorderExtents(a.firstChild):{t:0,l:0,b:0,r:0};k.y+=Math.min(n.t+p.t,v.t+y.t);k.h-=Math.min(n.t+p.t,v.t+y.t)+
Math.min(n.b+p.b,v.b+y.b)}}else k=c;if(c.parentNode)for(n="absolute"==m.getComputedStyle(c).position,c=c.parentNode;c&&1==c.nodeType&&"BODY"!=c.nodeName;){p=d.position(c,!0);v=m.getComputedStyle(c);/relative|absolute/.test(v.position)&&(n=!1);if(!n&&/hidden|auto|scroll/.test(v.overflow)){var y=Math.min(k.y+k.h,p.y+p.h),x=Math.min(k.x+k.w,p.x+p.w);k.x=Math.max(k.x,p.x);k.y=Math.max(k.y,p.y);k.h=y-k.y;k.w=x-k.x}"absolute"==v.position&&(n=!0);c=c.parentNode}var w=k.x,A=k.y,B="w"in k?k.w:k.w=k.width,
E="h"in k?k.h:(h.deprecated("place.around: dijit/place.__Rectangle: { x:"+w+", y:"+A+", height:"+k.height+", width:"+B+" } has been deprecated.  Please use { x:"+w+", y:"+A+", h:"+k.height+", w:"+B+" }","","2.0"),k.h=k.height),C=[];f.forEach(e,function(a){var c=g;switch(a){case "above-centered":b("TM","BM");break;case "below-centered":b("BM","TM");break;case "after-centered":c=!c;case "before-centered":b(c?"ML":"MR",c?"MR":"ML");break;case "after":c=!c;case "before":b(c?"TL":"TR",c?"TR":"TL");b(c?
"BL":"BR",c?"BR":"BL");break;case "below-alt":c=!c;case "below":b(c?"BL":"BR",c?"TL":"TR");b(c?"BR":"BL",c?"TR":"TL");break;case "above-alt":c=!c;case "above":b(c?"TL":"TR",c?"BL":"BR");b(c?"TR":"TL",c?"BR":"BL");break;default:b(a.aroundCorner,a.corner)}});a=l(a,C,t,{w:B,h:E});a.aroundNodePos=k;return a}}})},"dojo/store/Observable":function(){define(["../_base/kernel","../_base/lang","../when","../_base/array"],function(f,d,m,h){f=function(c){function a(a,d){var e=c[a];e&&(c[a]=function(f){var g;
"put"===a&&(g=c.getIdentity(f));if(b)return e.apply(this,arguments);b=!0;try{var k=e.apply(this,arguments);m(k,function(a){d("object"==typeof a&&a||f,g)});return k}finally{b=!1}})}var f=[],l=0;c=d.delegate(c);c.notify=function(a,b){l++;for(var c=f.slice(),d=0,e=c.length;d<e;d++)c[d](a,b)};var e=c.query;c.query=function(a,b){b=b||{};var g=e.apply(this,arguments);if(g&&g.forEach){var k=d.mixin({},b);delete k.start;delete k.count;var n=c.queryEngine&&c.queryEngine(a,k),q=l,u=[],z;g.observe=function(a,
d){1==u.push(a)&&f.push(z=function(a,e){m(g,function(f){var g=f.length!=b.count,k,m;if(++q!=l)throw Error("Query is out of date, you must observe() the query prior to any data modifications");var p,r=-1,t=-1;if(void 0!==e){var v=[].concat(f);n&&!a&&(v=n(f));k=0;for(m=f.length;k<m;k++){var z=f[k];if(c.getIdentity(z)==e&&!(0>v.indexOf(z))){p=z;r=k;!n&&a||f.splice(k,1);break}}}n?a&&(n.matches?n.matches(a):n([a]).length)&&(k=-1<r?r:f.length,f.splice(k,0,a),t=h.indexOf(n(f),a),f.splice(k,1),b.start&&0==
t||!g&&t==f.length?t=-1:f.splice(t,0,a)):a&&(void 0!==e?t=r:b.start||(t=c.defaultIndex||0,f.splice(t,0,a)));if((-1<r||-1<t)&&(d||!n||r!=t))for(g=u.slice(),k=0;f=g[k];k++)f(a||p,r,t)})});var e={};e.remove=e.cancel=function(){var b=h.indexOf(u,a);-1<b&&(u.splice(b,1),u.length||f.splice(h.indexOf(f,z),1))};return e}}return g};var b;a("put",function(a,b){c.notify(a,b)});a("add",function(a){c.notify(a)});a("remove",function(a){c.notify(void 0,a)});return c};d.setObject("dojo.store.Observable",f);return f})},
"dijit/DropDownMenu":function(){define(["dojo/_base/declare","dojo/keys","dojo/text!./templates/Menu.html","./_MenuBase"],function(f,d,m,h){return f("dijit.DropDownMenu",h,{templateString:m,baseClass:"dijitMenu",_onUpArrow:function(){this.focusPrev()},_onDownArrow:function(){this.focusNext()},_onRightArrow:function(c){this._moveToPopup(c);c.stopPropagation();c.preventDefault()},_onLeftArrow:function(c){if(this.parentMenu)if(this.parentMenu._isMenuBar)this.parentMenu.focusPrev();else this.onCancel(!1);
else c.stopPropagation(),c.preventDefault()}})})},"com/huayun/widget/ModuleX":function(){define("dojo/_base/declare dojo/ready dojo/dom dojo/dom-style ../facades/ConfigFacade ../util/StringHelp ../event/EventDispatch dijit/_WidgetBase dijit/_TemplatedMixin dijit/_OnDijitClickMixin dojo/text!./templates/ModuleX.html".split(" "),function(f,d,m,h,c,a,g,l,e,b,k){return f("com.huayun.framework.widget.ModuleX",[g,l,e,b],{templateString:k,constructor:function(a){a=a||{};this.context=null;this._configData=
a.configData;this._completeFlag=this._isConfigData=!1;this._configUrl="";this._propertys=this._onReadyFun=this._moduleXVo=null;this.isOnReady=!1;this.configFacade=new c;this.style=a.style},postCreate:function(){this.inherited(arguments);a.isSpace(this.configUrl)&&a.isSpace(this.isConfigData)?this._isConfigData=!1:(this._isConfigData=!0,this._configUrl=this.configUrl);this.style&&this.set("style",this.style)},placeAt:function(){this.inherited(arguments);this._completeFlag=!0},startup:function(){this.inherited(arguments);
this.isOnReady=!0;this.tryInit(this.id)},_setIsConfigDataAttr:function(a){this._isConfigData=a},_getIsConfigDataAttr:function(){return this._isConfigData},_setPropertysAttr:function(a){this._propertys=a;this._setPorpertyMethod(a)},_setModuleXVoAttr:function(a){this._moduleXVo=a},_getPropertysAttr:function(){return this._propertys},_getConfigUrlAttr:function(){return this._configUrl},_setPorpertyMethod:function(b){if(!a.isSpace(b)&&0<b.length)for(var c=0;c<b.length;c++)switch(b[c].type){case "ref":this.context.beanProcess(this._moduleXVo,
this);break;case "number":this[b[c].name]=Number(b[c].value);break;default:this[b[c].name]=b[c].value}},_setStyleAttr:function(b){if(!a.isSpace(b))for(var c in b)h.set(this.domNode,c,b[c])},_setConfigUrlAttr:function(b){var c=require.toUrl(b);a.isSpace(b)||(this.set("isConfigData",!0),this._configUrl=c,this._loaderConfigData())},_setConfigDataAttr:function(a){this._configData=a;this.tryInit(this.id)},_getConfigDataAttr:function(){return this._configData},_setOnReadyFunAttr:function(a){this._onReadyFun=
a},_loaderConfigData:function(){this.configFacade.getConfigData(require.toUrl(this._configUrl),function(a){this.set("configData",a)}.bind(this),function(a){}.bind(this))},tryInit:function(a){this._isConfigData?this._completeFlag&&null!==this._configData&&this.isOnReady&&(this.doInit(),this.readyCall()):this._completeFlag&&this.isOnReady&&(this.doInit(),this.readyCall())},doInit:function(){},readyCall:function(){this._onReadyFun&&this._onReadyFun()},createModuleX:function(a,b){},startBean:function(){}})})},
"com/huayun/util/HashTable":function(){define(["dojo/_base/declare"],function(f){var d=function(d){for(var f=0,c=0;c<d.length;c++)f+=d.charCodeAt(c);return f};return f("com.huayun.util.HashTable",null,{constructor:function(){this.table=[];this._keyList=[]},put:function(f,h){this._keyList.push(f);this.table[d(f)]=h},remove:function(f){this._keyList.splice(this._keyList.indexOf(f),1);this.table[d(f)]=void 0},get:function(f){return this.table[d(f)]},containsKey:function(d){for(var f in this._keyList)if(d===
this._keyList[f])return!0;return!1},getKeyList:function(){return this._keyList},size:function(){return this._keyList.length},clearn:function(){this.table=[];this._keyList=[]}})})},"dijit/_Widget":function(){define("dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/has dojo/_base/kernel dojo/_base/lang dojo/query dojo/ready ./registry ./_WidgetBase ./_OnDijitClickMixin ./_FocusMixin dojo/uacss ./hccss".split(" "),function(f,d,m,h,c,a,g,l,e,b,k,n,p){function t(){}function r(a){return function(b,
c,d,e){return b&&"string"==typeof c&&b[c]==t?b.on(c.substring(2).toLowerCase(),g.hitch(d,e)):a.apply(m,arguments)}}f.around(m,"connect",r);a.connect&&f.around(a,"connect",r);f=h("dijit._Widget",[k,n,p],{onClick:t,onDblClick:t,onKeyDown:t,onKeyPress:t,onKeyUp:t,onMouseDown:t,onMouseMove:t,onMouseOut:t,onMouseOver:t,onMouseLeave:t,onMouseEnter:t,onMouseUp:t,constructor:function(a){this._toConnect={};for(var b in a)this[b]===t&&(this._toConnect[b.replace(/^on/,"").toLowerCase()]=a[b],delete a[b])},postCreate:function(){this.inherited(arguments);
for(var a in this._toConnect)this.on(a,this._toConnect[a]);delete this._toConnect},on:function(a,b){return this[this._onMap(a)]===t?m.connect(this.domNode,a.toLowerCase(),this,b):this.inherited(arguments)},_setFocusedAttr:function(a){this._focused=a;this._set("focused",a)},setAttribute:function(b,c){a.deprecated(this.declaredClass+"::setAttribute(attr, value) is deprecated. Use set() instead.","","2.0");this.set(b,c)},attr:function(a,b){return 2<=arguments.length||"object"===typeof a?this.set.apply(this,
arguments):this.get(a)},getDescendants:function(){a.deprecated(this.declaredClass+"::getDescendants() is deprecated. Use getChildren() instead.","","2.0");return this.containerNode?l("[widgetId]",this.containerNode).map(b.byNode):[]},_onShow:function(){this.onShow()},onShow:function(){},onHide:function(){},onClose:function(){return!0}});c("dijit-legacy-requires")&&e(0,function(){require(["dijit/_base"])});return f})},"dojo/cache":function(){define(["./_base/kernel","./text"],function(f){return f.cache})},
"com/huayun/webgis/widget/DeviceSearch":function(){define("dojo/_base/declare dojo/request dojo/query dojo/dom-class ./DeviceResult ./MapModuleX dojo/text!../templates/deviceSearch.html".split(" "),function(f,d,m,h,c,a,g){return f("com.huayun.webgis.widget.DeviceSearch",[a],{baseClass:"deviceSearch",templateString:g,constructor:function(){this.modelClass=this.dy=this.pd=this.sbd=this.map=null;this.vdcService=this.ftsService="";this.currentState="sbd";this.data=null;this.maxPage=this.page=1;this.view=
null},doInit:function(){this.map=this.get("map");this.view=this.get("view");this.modelClass={};var a=this.get("configData");this.sbd=a.data[0].types;this.pd=a.data[1].types;this.dy=a.data[2].types;this.ftsService=a.ftsService;this.vdcService=a.vdcService;var c=document.createElement("option");c.value=" ";c.text="\u8bf7\u9009\u62e9";this.selectNode.add(c);for(var b=0;b<this.sbd.length;b++)c=document.createElement("option"),c.value=this.sbd[b].class_id,c.text=this.sbd[b].class_desc,this.selectNode.add(c);
d.get(a.modelClass,{handleAs:"json"}).then(function(a){a=a.data;for(var b,c=0;c<a.length;c++)b=a[c],this.modelClass[b.CLASS_ID]={name:b.CLASS_NAME,table:b.G_TABLE_NAME}}.bind(this))},search:function(){var a=this.selectNode.value,e=this.searchName.value,b=this.modelClass[a].name,f=this.modelClass[a].table;this.searchResult.innerHTML="";d.get(this.ftsService+"?name\x3d"+e+"\x26class_name\x3d"+b,{handleAs:"json"}).then(function(a){if("0000"===a.resultState)if(this.data=a=a.data,this.countResult.innerText=
"( "+a.length+" )",this.pageResult.style.visibility=6>a.length?"hidden":"visible",0===a.length)alert("\u672a\u67e5\u8be2\u5230\u8bbe\u5907");else{var b="/",e=Math.min(5,a.length);this.page=1;this.maxPage=Math.ceil(a.length/5);this.countPage.innerHTML=this.page+"/"+this.maxPage;for(var g=0;g<e;g++)b+=a[g].PSR_ID+",";d.get(this.vdcService+f+b.substr(0,b.length-1),{handleAs:"json"}).then(function(a){if("0000"===a.resultState){a=a.data;for(var b=0;b<a.length;b++){var d=new c({sequence:b+1,name:a[b].NAME,
shape:a[b].SHAPE,map:this.map});this.searchResult.append(d.domNode)}}}.bind(this))}}.bind(this))},switchSBD:function(a){if("sbd"!==this.currentState){m(".title-container span").forEach(function(a){h.remove(a,"active")});h.add(a.target,"active");for(a=this.selectNode.children.length;0<a;a--)this.selectNode.remove(a);var c;for(a=0;a<this.sbd.length;a++)c=document.createElement("option"),c.value=this.sbd[a].class_id,c.text=this.sbd[a].class_desc,this.selectNode.add(c);this.currentState="sbd"}},switchPD:function(a){if("pd"!==
this.currentState){m(".title-container span").forEach(function(a){h.remove(a,"active")});h.add(a.target,"active");for(a=this.selectNode.children.length;0<a;a--)this.selectNode.remove(a);var c;for(a=0;a<this.pd.length;a++)c=document.createElement("option"),c.value=this.pd[a].class_id,c.text=this.pd[a].class_desc,this.selectNode.add(c);this.currentState="pd"}},switchDY:function(a){if("dy"!==this.currentState){m(".title-container span").forEach(function(a){h.remove(a,"active")});h.add(a.target,"active");
for(a=this.selectNode.children.length;0<a;a--)this.selectNode.remove(a);var c;for(a=0;a<this.dy.length;a++)c=document.createElement("option"),c.value=this.dy[a].class_id,c.text=this.dy[a].class_desc,this.selectNode.add(c);this.currentState="dy"}},prePage:function(){if(1<this.page){this.searchResult.innerHTML="";--this.page;this.countPage.innerHTML=this.page+"/"+this.maxPage;for(var a="/",e=this.modelClass[this.selectNode.value].table,b=Math.min(5*this.page,this.data.length),f=5*(this.page-1);f<b;f++)a+=
this.data[f].PSR_ID+",";d.get(this.vdcService+e+a.substr(0,a.length-1),{handleAs:"json"}).then(function(a){if("0000"===a.resultState){a=a.data;for(var b=0;b<a.length;b++){var d=new c({sequence:b+1,name:a[b].NAME,shape:a[b].SHAPE,map:this.map});this.searchResult.append(d.domNode)}}}.bind(this))}},nextPage:function(){if(this.page<this.maxPage){this.searchResult.innerHTML="";this.page+=1;this.countPage.innerHTML=this.page+"/"+this.maxPage;for(var a="/",e=this.modelClass[this.selectNode.value].table,
b=Math.min(5*this.page,this.data.length),f=5*(this.page-1);f<b;f++)a+=this.data[f].PSR_ID+",";d.get(this.vdcService+e+a.substr(0,a.length-1),{handleAs:"json"}).then(function(a){if("0000"===a.resultState){a=a.data;for(var b=0;b<a.length;b++){var d=new c({sequence:b+1,name:a[b].NAME,shape:a[b].SHAPE,map:this.map});this.searchResult.append(d.domNode)}}}.bind(this))}}})})},"dijit/_OnDijitClickMixin":function(){define("dojo/on dojo/_base/array dojo/keys dojo/_base/declare dojo/has ./a11yclick".split(" "),
function(f,d,m,h,c,a){f=h("dijit._OnDijitClickMixin",null,{connect:function(c,d,e){return this.inherited(arguments,[c,"ondijitclick"==d?a:d,e])}});f.a11yclick=a;return f})},"dijit/_FocusMixin":function(){define(["./focus","./_WidgetBase","dojo/_base/declare","dojo/_base/lang"],function(f,d,m,h){h.extend(d,{focused:!1,onFocus:function(){},onBlur:function(){},_onFocus:function(){this.onFocus()},_onBlur:function(){this.onBlur()}});return m("dijit._FocusMixin",null,{_focusManager:f})})},"dijit/focus":function(){define("dojo/aspect dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/Evented dojo/_base/lang dojo/on dojo/domReady dojo/sniff dojo/Stateful dojo/_base/window dojo/window ./a11y ./registry ./main".split(" "),
function(f,d,m,h,c,a,g,l,e,b,k,n,p,t,r,q,u){var z,v,y=new (d([n,g],{curNode:null,activeStack:[],constructor:function(){var b=l.hitch(this,function(a){m.isDescendant(this.curNode,a)&&this.set("curNode",null);m.isDescendant(this.prevNode,a)&&this.set("prevNode",null)});f.before(a,"empty",b);f.before(a,"destroy",b)},registerIframe:function(a){return this.registerWin(a.contentWindow,a)},registerWin:function(a,b){var c=this,d=a.document&&a.document.body;if(d){var f=k("pointer-events")?"pointerdown":k("MSPointer")?
"MSPointerDown":k("touch-events")?"mousedown, touchstart":"mousedown",g=e(a.document,f,function(a){a&&a.target&&null==a.target.parentNode||c._onTouchNode(b||a.target,"mouse")}),h=e(d,"focusin",function(a){if(a.target.tagName){var d=a.target.tagName.toLowerCase();"#document"!=d&&"body"!=d&&(r.isFocusable(a.target)?c._onFocusNode(b||a.target):c._onTouchNode(b||a.target))}}),l=e(d,"focusout",function(a){c._onBlurNode(b||a.target)});return{remove:function(){g.remove();h.remove();l.remove();d=g=h=l=null}}}},
_onBlurNode:function(a){a=(new Date).getTime();a<z+100||(this._clearFocusTimer&&clearTimeout(this._clearFocusTimer),this._clearFocusTimer=setTimeout(l.hitch(this,function(){this.set("prevNode",this.curNode);this.set("curNode",null)}),0),this._clearActiveWidgetsTimer&&clearTimeout(this._clearActiveWidgetsTimer),a<v+100||(this._clearActiveWidgetsTimer=setTimeout(l.hitch(this,function(){delete this._clearActiveWidgetsTimer;this._setStack([])}),0)))},_onTouchNode:function(a,b){v=(new Date).getTime();
this._clearActiveWidgetsTimer&&(clearTimeout(this._clearActiveWidgetsTimer),delete this._clearActiveWidgetsTimer);c.contains(a,"dijitPopup")&&(a=a.firstChild);var d=[];try{for(;a;){var e=h.get(a,"dijitPopupParent");if(e)a=q.byId(e).domNode;else if(a.tagName&&"body"==a.tagName.toLowerCase()){if(a===p.body())break;a=t.get(a.ownerDocument).frameElement}else{var f=a.getAttribute&&a.getAttribute("widgetId"),g=f&&q.byId(f);!g||"mouse"==b&&g.get("disabled")||d.unshift(f);a=a.parentNode}}}catch(G){}this._setStack(d,
b)},_onFocusNode:function(a){a&&9!=a.nodeType&&(z=(new Date).getTime(),this._clearFocusTimer&&(clearTimeout(this._clearFocusTimer),delete this._clearFocusTimer),this._onTouchNode(a),a!=this.curNode&&(this.set("prevNode",this.curNode),this.set("curNode",a)))},_setStack:function(a,b){var c=this.activeStack,d=c.length-1,e=a.length-1;if(a[e]!=c[d]){this.set("activeStack",a);var f;for(f=d;0<=f&&c[f]!=a[f];f--)if(d=q.byId(c[f]))d._hasBeenBlurred=!0,d.set("focused",!1),d._focusManager==this&&d._onBlur(b),
this.emit("widget-blur",d,b);for(f++;f<=e;f++)if(d=q.byId(a[f]))d.set("focused",!0),d._focusManager==this&&d._onFocus(b),this.emit("widget-focus",d,b)}},focus:function(a){if(a)try{a.focus()}catch(A){}}}));b(function(){var a=y.registerWin(t.get(document));k("ie")&&e(window,"unload",function(){a&&(a.remove(),a=null)})});u.focus=function(a){y.focus(a)};for(var x in y)/^_/.test(x)||(u.focus[x]="function"==typeof y[x]?l.hitch(y,x):y[x]);y.watch(function(a,b,c){u.focus[a]=c});return y})},"dojo/data/ItemFileWriteStore":function(){define("../_base/lang ../_base/declare ../_base/array ../_base/json ../_base/kernel ./ItemFileReadStore ../date/stamp".split(" "),
function(f,d,m,h,c,a,g){return d("dojo.data.ItemFileWriteStore",a,{constructor:function(a){this._features["dojo.data.api.Write"]=!0;this._features["dojo.data.api.Notification"]=!0;this._pending={_newItems:{},_modifiedItems:{},_deletedItems:{}};this._datatypeMap.Date.serialize||(this._datatypeMap.Date.serialize=function(a){return g.toISOString(a,{zulu:!0})});a&&!1===a.referenceIntegrity&&(this.referenceIntegrity=!1);this._saveInProgress=!1},referenceIntegrity:!0,_assert:function(a){if(!a)throw Error("assertion failed in ItemFileWriteStore");
},_getIdentifierAttribute:function(){return this.getFeatures()["dojo.data.api.Identity"]},newItem:function(a,c){this._assert(!this._saveInProgress);this._loadFinished||this._forceLoad();if("object"!=typeof a&&"undefined"!=typeof a)throw Error("newItem() was passed something other than an object");var b=null,d=this._getIdentifierAttribute();if(d===Number)b=this._arrayOfAllItems.length;else{b=a[d];if("undefined"===typeof b)throw Error("newItem() was not passed an identity for the new item");if(f.isArray(b))throw Error("newItem() was not passed an single-valued identity");
}this._itemsByIdentity&&this._assert("undefined"===typeof this._itemsByIdentity[b]);this._assert("undefined"===typeof this._pending._newItems[b]);this._assert("undefined"===typeof this._pending._deletedItems[b]);var e={};e[this._storeRefPropName]=this;e[this._itemNumPropName]=this._arrayOfAllItems.length;this._itemsByIdentity&&(this._itemsByIdentity[b]=e,e[d]=[b]);this._arrayOfAllItems.push(e);d=null;if(c&&c.parent&&c.attribute){var d={item:c.parent,attribute:c.attribute,oldValue:void 0},g=this.getValues(c.parent,
c.attribute);if(g&&0<g.length){var h=g.slice(0,g.length);d.oldValue=1===g.length?g[0]:g.slice(0,g.length);h.push(e);this._setValueOrValues(c.parent,c.attribute,h,!1);d.newValue=this.getValues(c.parent,c.attribute)}else this._setValueOrValues(c.parent,c.attribute,e,!1),d.newValue=e}else e[this._rootItemPropName]=!0,this._arrayOfTopLevelItems.push(e);this._pending._newItems[b]=e;for(var l in a){if(l===this._storeRefPropName||l===this._itemNumPropName)throw Error("encountered bug in ItemFileWriteStore.newItem");
c=a[l];f.isArray(c)||(c=[c]);e[l]=c;if(this.referenceIntegrity)for(b=0;b<c.length;b++)g=c[b],this.isItem(g)&&this._addReferenceToMap(g,e,l)}this.onNew(e,d);return e},_removeArrayElement:function(a,c){c=m.indexOf(a,c);return-1!=c?(a.splice(c,1),!0):!1},deleteItem:function(a){this._assert(!this._saveInProgress);this._assertIsItem(a);var c=a[this._itemNumPropName],b=this.getIdentity(a);if(this.referenceIntegrity){var d=this.getAttributes(a);a[this._reverseRefMap]&&(a["backup_"+this._reverseRefMap]=f.clone(a[this._reverseRefMap]));
m.forEach(d,function(b){m.forEach(this.getValues(a,b),function(c){this.isItem(c)&&(a["backupRefs_"+this._reverseRefMap]||(a["backupRefs_"+this._reverseRefMap]=[]),a["backupRefs_"+this._reverseRefMap].push({id:this.getIdentity(c),attr:b}),this._removeReferenceFromMap(c,a,b))},this)},this);if(d=a[this._reverseRefMap])for(var g in d){var h=null;if(h=this._itemsByIdentity?this._itemsByIdentity[g]:this._arrayOfAllItems[g])for(var l in d[g]){var r=this.getValues(h,l)||[],q=m.filter(r,function(a){return!(this.isItem(a)&&
this.getIdentity(a)==b)},this);this._removeReferenceFromMap(a,h,l);q.length<r.length&&this._setValueOrValues(h,l,q,!0)}}}this._arrayOfAllItems[c]=null;a[this._storeRefPropName]=null;this._itemsByIdentity&&delete this._itemsByIdentity[b];this._pending._deletedItems[b]=a;a[this._rootItemPropName]&&this._removeArrayElement(this._arrayOfTopLevelItems,a);this.onDelete(a);return!0},setValue:function(a,c,b){return this._setValueOrValues(a,c,b,!0)},setValues:function(a,c,b){return this._setValueOrValues(a,
c,b,!0)},unsetAttribute:function(a,c){return this._setValueOrValues(a,c,[],!0)},_setValueOrValues:function(a,c,b,d){this._assert(!this._saveInProgress);this._assertIsItem(a);this._assert(f.isString(c));this._assert("undefined"!==typeof b);var e=this._getIdentifierAttribute();if(c==e)throw Error("ItemFileWriteStore does not have support for changing the value of an item's identifier.");var e=this._getValueOrValues(a,c),g=this.getIdentity(a);if(!this._pending._modifiedItems[g]){var k={},h;for(h in a)k[h]=
h===this._storeRefPropName||h===this._itemNumPropName||h===this._rootItemPropName?a[h]:h===this._reverseRefMap?f.clone(a[h]):a[h].slice(0,a[h].length);this._pending._modifiedItems[g]=k}g=!1;if(f.isArray(b)&&0===b.length){if(g=delete a[c],b=void 0,this.referenceIntegrity&&e){h=e;f.isArray(h)||(h=[h]);for(var l=0;l<h.length;l++)k=h[l],this.isItem(k)&&this._removeReferenceFromMap(k,a,c)}}else{g=f.isArray(b)?b.slice(0,b.length):[b];if(this.referenceIntegrity)if(e){h=e;f.isArray(h)||(h=[h]);var u={};m.forEach(h,
function(a){this.isItem(a)&&(a=this.getIdentity(a),u[a.toString()]=!0)},this);m.forEach(g,function(b){if(this.isItem(b)){var d=this.getIdentity(b);u[d.toString()]?delete u[d.toString()]:this._addReferenceToMap(b,a,c)}},this);for(l in u)this._removeReferenceFromMap(this._itemsByIdentity?this._itemsByIdentity[l]:this._arrayOfAllItems[l],a,c)}else for(l=0;l<g.length;l++)k=g[l],this.isItem(k)&&this._addReferenceToMap(k,a,c);a[c]=g;g=!0}if(d)this.onSet(a,c,e,b);return g},_addReferenceToMap:function(a,
c,b){c=this.getIdentity(c);var d=a[this._reverseRefMap];d||(d=a[this._reverseRefMap]={});(a=d[c])||(a=d[c]={});a[b]=!0},_removeReferenceFromMap:function(a,c,b){c=this.getIdentity(c);var d=a[this._reverseRefMap],e;if(d){for(e in d)e==c&&(delete d[e][b],this._isEmpty(d[e])&&delete d[e]);this._isEmpty(d)&&delete a[this._reverseRefMap]}},_dumpReferenceMap:function(){var a;for(a=0;a<this._arrayOfAllItems.length;a++);},_getValueOrValues:function(a,c){var b=void 0;this.hasAttribute(a,c)&&(a=this.getValues(a,
c),b=1==a.length?a[0]:a);return b},_flatten:function(a){if(this.isItem(a))return{_reference:this.getIdentity(a)};if("object"===typeof a)for(var c in this._datatypeMap){var b=this._datatypeMap[c];if(f.isObject(b)&&!f.isFunction(b)){if(a instanceof b.type){if(!b.serialize)throw Error("ItemFileWriteStore:  No serializer defined for type mapping: ["+c+"]");return{_type:c,_value:b.serialize(a)}}}else if(a instanceof b)return{_type:c,_value:a.toString()}}return a},_getNewFileContentString:function(){var a=
{},c=this._getIdentifierAttribute();c!==Number&&(a.identifier=c);this._labelAttr&&(a.label=this._labelAttr);a.items=[];for(c=0;c<this._arrayOfAllItems.length;++c){var b=this._arrayOfAllItems[c];if(null!==b){var d={},f;for(f in b)if(f!==this._storeRefPropName&&f!==this._itemNumPropName&&f!==this._reverseRefMap&&f!==this._rootItemPropName){var g=this.getValues(b,f);if(1==g.length)d[f]=this._flatten(g[0]);else for(var m=[],r=0;r<g.length;++r)m.push(this._flatten(g[r])),d[f]=m}a.items.push(d)}}return h.toJson(a,
!0)},_isEmpty:function(a){var c=!0;if(f.isObject(a))for(var b in a){c=!1;break}else f.isArray(a)&&0<a.length&&(c=!1);return c},save:function(a){this._assert(!this._saveInProgress);this._saveInProgress=!0;var d=this,b=function(){d._pending={_newItems:{},_modifiedItems:{},_deletedItems:{}};d._saveInProgress=!1;a&&a.onComplete&&a.onComplete.call(a.scope||c.global)},f=function(b){d._saveInProgress=!1;a&&a.onError&&a.onError.call(a.scope||c.global,b)};if(this._saveEverything){var g=this._getNewFileContentString();
this._saveEverything(b,f,g)}this._saveCustom&&this._saveCustom(b,f);this._saveEverything||this._saveCustom||b()},revert:function(){this._assert(!this._saveInProgress);for(var a in this._pending._modifiedItems){var c=this._pending._modifiedItems[a],b=null,b=this._itemsByIdentity?this._itemsByIdentity[a]:this._arrayOfAllItems[a];c[this._storeRefPropName]=this;for(var d in b)delete b[d];f.mixin(b,c)}var g;for(a in this._pending._deletedItems)g=this._pending._deletedItems[a],g[this._storeRefPropName]=
this,c=g[this._itemNumPropName],g["backup_"+this._reverseRefMap]&&(g[this._reverseRefMap]=g["backup_"+this._reverseRefMap],delete g["backup_"+this._reverseRefMap]),this._arrayOfAllItems[c]=g,this._itemsByIdentity&&(this._itemsByIdentity[a]=g),g[this._rootItemPropName]&&this._arrayOfTopLevelItems.push(g);for(a in this._pending._deletedItems)g=this._pending._deletedItems[a],g["backupRefs_"+this._reverseRefMap]&&(m.forEach(g["backupRefs_"+this._reverseRefMap],function(a){this._addReferenceToMap(this._itemsByIdentity?
this._itemsByIdentity[a.id]:this._arrayOfAllItems[a.id],g,a.attr)},this),delete g["backupRefs_"+this._reverseRefMap]);for(a in this._pending._newItems)c=this._pending._newItems[a],c[this._storeRefPropName]=null,this._arrayOfAllItems[c[this._itemNumPropName]]=null,c[this._rootItemPropName]&&this._removeArrayElement(this._arrayOfTopLevelItems,c),this._itemsByIdentity&&delete this._itemsByIdentity[a];this._pending={_newItems:{},_modifiedItems:{},_deletedItems:{}};return!0},isDirty:function(a){return a?
(a=this.getIdentity(a),(new Boolean(this._pending._newItems[a]||this._pending._modifiedItems[a]||this._pending._deletedItems[a])).valueOf()):!this._isEmpty(this._pending._newItems)||!this._isEmpty(this._pending._modifiedItems)||!this._isEmpty(this._pending._deletedItems)},onSet:function(a,c,b,d){},onNew:function(a,c){},onDelete:function(a){},close:function(a){if(this.clearOnClose){if(this.isDirty())throw Error("dojo.data.ItemFileWriteStore: There are unsaved changes present in the store.  Please save or revert the changes before invoking close.");
this.inherited(arguments)}}})})},"dijit/main":function(){define(["dojo/_base/kernel"],function(f){return f.dijit})},"dojo/date/stamp":function(){define(["../_base/lang","../_base/array"],function(f,d){var m={};f.setObject("dojo.date.stamp",m);m.fromISOString=function(f,c){m._isoRegExp||(m._isoRegExp=/^(?:(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:T(\d{2}):(\d{2})(?::(\d{2})(.\d+)?)?((?:[+-](\d{2}):(\d{2}))|Z)?)?$/);var a=m._isoRegExp.exec(f);f=null;if(a){a.shift();a[1]&&a[1]--;a[6]&&(a[6]*=1E3);c&&(c=
new Date(c),d.forEach(d.map("FullYear Month Date Hours Minutes Seconds Milliseconds".split(" "),function(a){return c["get"+a]()}),function(c,b){a[b]=a[b]||c}));f=new Date(a[0]||1970,a[1]||0,a[2]||1,a[3]||0,a[4]||0,a[5]||0,a[6]||0);100>a[0]&&f.setFullYear(a[0]||1970);var g=0,h=a[7]&&a[7].charAt(0);"Z"!=h&&(g=60*(a[8]||0)+(Number(a[9])||0),"-"!=h&&(g*=-1));h&&(g-=f.getTimezoneOffset());g&&f.setTime(f.getTime()+6E4*g)}return f};m.toISOString=function(d,c){var a=function(a){return 10>a?"0"+a:a};c=c||
{};var f=[],h=c.zulu?"getUTC":"get",e="";"time"!=c.selector&&(e=d[h+"FullYear"](),e=["0000".substr((e+"").length)+e,a(d[h+"Month"]()+1),a(d[h+"Date"]())].join("-"));f.push(e);"date"!=c.selector&&(e=[a(d[h+"Hours"]()),a(d[h+"Minutes"]()),a(d[h+"Seconds"]())].join(":"),h=d[h+"Milliseconds"](),c.milliseconds&&(e+="."+(100>h?"0":"")+a(h)),c.zulu?e+="Z":"time"!=c.selector&&(d=d.getTimezoneOffset(),c=Math.abs(d),e+=(0<d?"-":"+")+a(Math.floor(c/60))+":"+a(c%60)),f.push(e));return f.join("T")};return m})},
"dijit/MenuItem":function(){define("dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/_base/kernel dojo/sniff dojo/_base/lang ./_Widget ./_TemplatedMixin ./_Contained ./_CssStateMixin dojo/text!./templates/MenuItem.html".split(" "),function(f,d,m,h,c,a,g,l,e,b,k,n){g=f("dijit.MenuItem"+(a("dojo-bidi")?"_NoBidi":""),[l,e,b,k],{templateString:n,baseClass:"dijitMenuItem",label:"",_setLabelAttr:function(a){this._set("label",a);var b="",c;c=a.search(/{\S}/);if(0<=c){var b=a.charAt(c+1),d=a.substr(0,
c);a=a.substr(c+3);c=d+b+a;a=d+'\x3cspan class\x3d"dijitMenuItemShortcutKey"\x3e'+b+"\x3c/span\x3e"+a}else c=a;this.domNode.setAttribute("aria-label",c+" "+this.accelKey);this.containerNode.innerHTML=a;this._set("shortcutKey",b)},iconClass:"dijitNoIcon",_setIconClassAttr:{node:"iconNode",type:"class"},accelKey:"",disabled:!1,_fillContent:function(a){!a||"label"in this.params||this._set("label",a.innerHTML)},buildRendering:function(){this.inherited(arguments);m.set(this.containerNode,"id",this.id+
"_text");this.accelKeyNode&&m.set(this.accelKeyNode,"id",this.id+"_accel");d.setSelectable(this.domNode,!1)},onClick:function(){},focus:function(){try{8==a("ie")&&this.containerNode.focus(),this.focusNode.focus()}catch(p){}},_setSelected:function(a){h.toggle(this.domNode,"dijitMenuItemSelected",a)},setLabel:function(a){c.deprecated("dijit.MenuItem.setLabel() is deprecated.  Use set('label', ...) instead.","","2.0");this.set("label",a)},setDisabled:function(a){c.deprecated("dijit.Menu.setDisabled() is deprecated.  Use set('disabled', bool) instead.",
"","2.0");this.set("disabled",a)},_setDisabledAttr:function(a){this.focusNode.setAttribute("aria-disabled",a?"true":"false");this._set("disabled",a)},_setAccelKeyAttr:function(a){this.accelKeyNode&&(this.accelKeyNode.style.display=a?"":"none",this.accelKeyNode.innerHTML=a,m.set(this.containerNode,"colSpan",a?"1":"2"));this._set("accelKey",a)}});a("dojo-bidi")&&(g=f("dijit.MenuItem",g,{_setLabelAttr:function(a){this.inherited(arguments);"auto"===this.textDir&&this.applyTextDir(this.textDirNode)}}));
return g})},"dijit/tree/_dndContainer":function(){define("dojo/aspect dojo/_base/declare dojo/dom-class dojo/_base/lang dojo/on dojo/touch".split(" "),function(f,d,m,h,c,a){return d("dijit.tree._dndContainer",null,{constructor:function(d,l){this.tree=d;this.node=d.domNode;h.mixin(this,l);this.containerState="";m.add(this.node,"dojoDndContainer");this.events=[c(this.node,a.enter,h.hitch(this,"onOverEvent")),c(this.node,a.leave,h.hitch(this,"onOutEvent")),f.after(this.tree,"_onNodeMouseEnter",h.hitch(this,
"onMouseOver"),!0),f.after(this.tree,"_onNodeMouseLeave",h.hitch(this,"onMouseOut"),!0),c(this.node,"dragstart, selectstart",function(a){a.preventDefault()})]},destroy:function(){for(var a;a=this.events.pop();)a.remove();this.node=this.parent=null},onMouseOver:function(a){this.current=a},onMouseOut:function(){this.current=null},_changeState:function(a,c){var d="dojoDnd"+a;a=a.toLowerCase()+"State";m.replace(this.node,d+c,d+this[a]);this[a]=c},_addItemClass:function(a,c){m.add(a,"dojoDndItem"+c)},
_removeItemClass:function(a,c){m.remove(a,"dojoDndItem"+c)},onOverEvent:function(){this._changeState("Container","Over")},onOutEvent:function(){this._changeState("Container","")}})})},"dojo/request/util":function(){define("exports ../errors/RequestError ../errors/CancelError ../Deferred ../io-query ../_base/array ../_base/lang ../promise/Promise ../has".split(" "),function(f,d,m,h,c,a,g,l,e){function b(a){return e("native-arraybuffer")&&a instanceof ArrayBuffer}function k(a){return e("native-blob")&&
a instanceof Blob}function n(a){return t(a)}function p(a){return void 0!==a.data?a.data:a.text}f.deepCopy=function(a,c){for(var d in c){var h=a[d],l=c[d];if(h!==l){var m=l,n;(n=!m||"object"!==typeof m)||(n=m,n=e("native-formdata")&&n instanceof FormData);n||("undefined"!==typeof HTMLFormElement?n=m instanceof HTMLFormElement:("FORM"===m.tagName,n=void 0));n||k(m)||b(m)?a[d]=l:"[object Date]"===Object.prototype.toString.call(l)?a[d]=new Date(l):g.isArray(l)?a[d]=f.deepCopyArray(l):h&&"object"===typeof h?
f.deepCopy(h,l):a[d]=f.deepCopy({},l)}}return a};f.deepCopyArray=function(a){for(var b=[],c=0,d=a.length;c<d;c++){var e=a[c];"object"===typeof e?b.push(f.deepCopy({},e)):b.push(e)}return b};f.deepCreate=function(a,b){b=b||{};var c=g.delegate(a),d,e;for(d in a)(e=a[d])&&"object"===typeof e&&(c[d]=f.deepCreate(e,b[d]));return f.deepCopy(c,b)};var t=Object.freeze||function(a){return a};f.deferred=function(a,b,c,e,k,y){var q=new h(function(c){b&&b(q,a);return c&&(c instanceof d||c instanceof m)?c:new m("Request canceled",
a)});q.response=a;q.isValid=c;q.isReady=e;q.handleResponse=k;c=q.then(n).otherwise(function(b){b.response=a;throw b;});f.notify&&c.then(g.hitch(f.notify,"emit","load"),g.hitch(f.notify,"emit","error"));e=c.then(p);k=new l;for(var r in e)e.hasOwnProperty(r)&&(k[r]=e[r]);k.response=c;t(k);y&&q.then(function(a){y.call(q,a)},function(b){y.call(q,a,b)});q.promise=k;q.then=k.then;return q};f.addCommonMethods=function(b,c){a.forEach(c||["GET","POST","PUT","DELETE"],function(a){b[("DELETE"===a?"DEL":a).toLowerCase()]=
function(c,d){d=g.delegate(d||{});d.method=a;return b(c,d)}})};f.parseArgs=function(a,d,f){var g=d.data,h=d.query;!g||f||"object"!==typeof g||e("native-xhr2")&&(b(g)||k(g))||(d.data=c.objectToQuery(g));h?("object"===typeof h&&(h=c.objectToQuery(h)),d.preventCache&&(h+=(h?"\x26":"")+"request.preventCache\x3d"+ +new Date)):d.preventCache&&(h="request.preventCache\x3d"+ +new Date);a&&h&&(a+=(~a.indexOf("?")?"\x26":"?")+h);return{url:a,options:d,getHeader:function(a){return null}}};f.checkStatus=function(a){a=
a||0;return 200<=a&&300>a||304===a||1223===a||!a}})},"dijit/tree/ForestStoreModel":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/kernel","dojo/_base/lang","./TreeStoreModel"],function(f,d,m,h,c){return d("dijit.tree.ForestStoreModel",c,{rootId:"$root$",rootLabel:"ROOT",query:null,constructor:function(a){this.root={store:this,root:!0,id:a.rootId,label:a.rootLabel,children:a.rootChildren}},mayHaveChildren:function(a){return a===this.root||this.inherited(arguments)},getChildren:function(a,
c,d){a===this.root?this.root.children?c(this.root.children):this.store.fetch({query:this.query,onComplete:h.hitch(this,function(a){this.root.children=a;c(a)}),onError:d}):this.inherited(arguments)},isItem:function(a){return a===this.root?!0:this.inherited(arguments)},fetchItemByIdentity:function(a){if(a.identity==this.root.id){var c=a.scope||m.global;a.onItem&&a.onItem.call(c,this.root)}else this.inherited(arguments)},getIdentity:function(a){return a===this.root?this.root.id:this.inherited(arguments)},
getLabel:function(a){return a===this.root?this.root.label:this.inherited(arguments)},newItem:function(a,c,d){return c===this.root?(this.onNewRootItem(a),this.store.newItem(a)):this.inherited(arguments)},onNewRootItem:function(){},pasteItem:function(a,c,d,e,b){if(c===this.root&&!e)this.onLeaveRoot(a);this.inherited(arguments,[a,c===this.root?null:c,d===this.root?null:d,e,b]);if(d===this.root)this.onAddToRoot(a)},onAddToRoot:function(a){},onLeaveRoot:function(a){},_requeryTop:function(){var a=this.root.children||
[];this.store.fetch({query:this.query,onComplete:h.hitch(this,function(c){this.root.children=c;if(a.length!=c.length||f.some(a,function(a,d){return c[d]!=a}))this.onChildrenChange(this.root,c)})})},onNewItem:function(a,c){this._requeryTop();this.inherited(arguments)},onDeleteItem:function(a){-1!=f.indexOf(this.root.children,a)&&this._requeryTop();this.inherited(arguments)},onSetItem:function(a,c,d,e){this._requeryTop();this.inherited(arguments)}})})},"dijit/_MenuBase":function(){define("dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/_base/lang dojo/mouse dojo/on dojo/window ./a11yclick ./registry ./_Widget ./_CssStateMixin ./_KeyNavContainer ./_TemplatedMixin".split(" "),
function(f,d,m,h,c,a,g,l,e,b,k,n,p,t,r){return d("dijit._MenuBase",[n,r,t,p],{selected:null,_setSelectedAttr:function(a){this.selected!=a&&(this.selected&&(this.selected._setSelected(!1),this._onChildDeselect(this.selected)),a&&a._setSelected(!0),this._set("selected",a))},activated:!1,_setActivatedAttr:function(a){c.toggle(this.domNode,"dijitMenuActive",a);c.toggle(this.domNode,"dijitMenuPassive",!a);this._set("activated",a)},parentMenu:null,popupDelay:500,passivePopupDelay:Infinity,autoFocus:!1,
childSelector:function(a){var b=k.byNode(a);return a.parentNode==this.containerNode&&b&&b.focus},postCreate:function(){var c=this,d="string"==typeof this.childSelector?this.childSelector:a.hitch(this,"childSelector");this.own(l(this.containerNode,l.selector(d,g.enter),function(){c.onItemHover(k.byNode(this))}),l(this.containerNode,l.selector(d,g.leave),function(){c.onItemUnhover(k.byNode(this))}),l(this.containerNode,l.selector(d,b),function(a){c.onItemClick(k.byNode(this),a);a.stopPropagation()}),
l(this.containerNode,l.selector(d,"focusin"),function(){c._onItemFocus(k.byNode(this))}));this.inherited(arguments)},onKeyboardSearch:function(a,b,c,d){this.inherited(arguments);if(a&&(-1==d||a.popup&&1==d))this.onItemClick(a,b)},_keyboardSearchCompare:function(a,b){return a.shortcutKey?b==a.shortcutKey.toLowerCase()?-1:0:this.inherited(arguments)?1:0},onExecute:function(){},onCancel:function(){},_moveToPopup:function(a){if(this.focusedChild&&this.focusedChild.popup&&!this.focusedChild.disabled)this.onItemClick(this.focusedChild,
a);else(a=this._getTopMenu())&&a._isMenuBar&&a.focusNext()},_onPopupHover:function(){this.set("selected",this.currentPopupItem);this._stopPendingCloseTimer()},onItemHover:function(a){this.activated?(this.set("selected",a),!a.popup||a.disabled||this.hover_timer||(this.hover_timer=this.defer(function(){this._openItemPopup(a)},this.popupDelay))):Infinity>this.passivePopupDelay&&(this.passive_hover_timer&&this.passive_hover_timer.remove(),this.passive_hover_timer=this.defer(function(){this.onItemClick(a,
{type:"click"})},this.passivePopupDelay));this._hoveredChild=a;a._set("hovering",!0)},_onChildDeselect:function(a){this._stopPopupTimer();this.currentPopupItem==a&&(this._stopPendingCloseTimer(),this._pendingClose_timer=this.defer(function(){this.currentPopupItem=this._pendingClose_timer=null;a._closePopup()},this.popupDelay))},onItemUnhover:function(a){this._hoveredChild==a&&(this._hoveredChild=null);this.passive_hover_timer&&(this.passive_hover_timer.remove(),this.passive_hover_timer=null);a._set("hovering",
!1)},_stopPopupTimer:function(){this.hover_timer&&(this.hover_timer=this.hover_timer.remove())},_stopPendingCloseTimer:function(){this._pendingClose_timer&&(this._pendingClose_timer=this._pendingClose_timer.remove())},_getTopMenu:function(){for(var a=this;a.parentMenu;a=a.parentMenu);return a},onItemClick:function(a,b){this.passive_hover_timer&&this.passive_hover_timer.remove();this.focusChild(a);if(a.disabled)return!1;a.popup?(this.set("selected",a),this.set("activated",!0),b=/^key/.test(b._origType||
b.type)||0==b.clientX&&0==b.clientY,this._openItemPopup(a,b)):(this.onExecute(),a._onClick?a._onClick(b):a.onClick(b))},_openItemPopup:function(b,c){if(b!=this.currentPopupItem){this.currentPopupItem&&(this._stopPendingCloseTimer(),this.currentPopupItem._closePopup());this._stopPopupTimer();var d=b.popup;d.parentMenu=this;this.own(this._mouseoverHandle=l.once(d.domNode,"mouseover",a.hitch(this,"_onPopupHover")));var e=this;b._openPopup({parent:this,orient:this._orient||["after","before"],onCancel:function(){c&&
e.focusChild(b);e._cleanUp()},onExecute:a.hitch(this,"_cleanUp",!0),onClose:function(){e._mouseoverHandle&&(e._mouseoverHandle.remove(),delete e._mouseoverHandle)}},c);this.currentPopupItem=b}},onOpen:function(){this.isShowingNow=!0;this.set("activated",!0)},onClose:function(){this.set("activated",!1);this.set("selected",null);this.isShowingNow=!1;this.parentMenu=null},_closeChild:function(){this._stopPopupTimer();this.currentPopupItem&&(this.focused&&(h.set(this.selected.focusNode,"tabIndex",this.tabIndex),
this.selected.focusNode.focus()),this.currentPopupItem._closePopup(),this.currentPopupItem=null)},_onItemFocus:function(a){if(this._hoveredChild&&this._hoveredChild!=a)this.onItemUnhover(this._hoveredChild);this.set("selected",a)},_onBlur:function(){this._cleanUp(!0);this.inherited(arguments)},_cleanUp:function(a){this._closeChild();"undefined"==typeof this.isShowingNow&&this.set("activated",!1);a&&this.set("selected",null)}})})},"dojo/promise/all":function(){define(["../_base/array","../_base/lang",
"../Deferred","../when"],function(f,d,m,h){var c=f.some;return function(a){var f,l;d.isArray(a)?l=a:a&&"object"===typeof a&&(f=a);var e,b=[];if(f){l=[];for(var k in f)Object.hasOwnProperty.call(f,k)&&(b.push(k),l.push(f[k]));e={}}else l&&(e=[]);if(!l||!l.length)return(new m).resolve(e);var n=new m;n.promise.always(function(){e=b=null});var p=l.length;c(l,function(a,c){f||b.push(c);h(a,function(a){n.isFulfilled()||(e[b[c]]=a,0===--p&&n.resolve(e))},n.reject);return n.isFulfilled()});return n.promise}})},
"dojo/ready":function(){define(["./_base/kernel","./has","require","./domReady","./_base/lang"],function(f,d,m,h,c){var a=0,g=[],l=0;d=function(){a=1;f._postLoad=f.config.afterOnLoad=!0;e()};var e=function(){if(!l){for(l=1;a&&(!h||0==h._Q.length)&&(m.idle?m.idle():1)&&g.length;){var b=g.shift();try{b()}catch(p){if(p.info=p.message,m.signal)m.signal("error",p);else throw p;}}l=0}};m.on&&m.on("idle",e);h&&(h._onQEmpty=e);var b=f.ready=f.addOnLoad=function(a,b,d){var k=c._toArray(arguments);"number"!=
typeof a?(d=b,b=a,a=1E3):k.shift();d=d?c.hitch.apply(f,k):function(){b()};d.priority=a;for(k=0;k<g.length&&a>=g[k].priority;k++);g.splice(k,0,d);e()},k=f.config.addOnLoad;if(k)b[c.isArray(k)?"apply":"call"](f,k);h?h(d):d();return b})},"dijit/_TemplatedMixin":function(){define("dojo/cache dojo/_base/declare dojo/dom-construct dojo/_base/lang dojo/on dojo/sniff dojo/string ./_AttachMixin".split(" "),function(f,d,m,h,c,a,g,l){var e=d("dijit._TemplatedMixin",l,{templateString:null,templatePath:null,_skipNodeCache:!1,
searchContainerNode:!0,_stringRepl:function(a){var b=this.declaredClass,c=this;return g.substitute(a,this,function(a,d){"!"==d.charAt(0)&&(a=h.getObject(d.substr(1),!1,c));if("undefined"==typeof a)throw Error(b+" template:"+d);return null==a?"":"!"==d.charAt(0)?a:this._escapeValue(""+a)},this)},_escapeValue:function(a){return a.replace(/["'<>&]/g,function(a){return{"\x26":"\x26amp;","\x3c":"\x26lt;","\x3e":"\x26gt;",'"':"\x26quot;","'":"\x26#x27;"}[a]})},buildRendering:function(){if(!this._rendered){this.templateString||
(this.templateString=f(this.templatePath,{sanitize:!0}));var a=e.getCachedTemplate(this.templateString,this._skipNodeCache,this.ownerDocument),c;if(h.isString(a)){if(c=m.toDom(this._stringRepl(a),this.ownerDocument),1!=c.nodeType)throw Error("Invalid template: "+a);}else c=a.cloneNode(!0);this.domNode=c}this.inherited(arguments);this._rendered||this._fillContent(this.srcNodeRef);this._rendered=!0},_fillContent:function(a){var b=this.containerNode;if(a&&b)for(;a.hasChildNodes();)b.appendChild(a.firstChild)}});
e._templateCache={};e.getCachedTemplate=function(a,c,d){var b=e._templateCache,f=a,k=b[f];if(k){try{if(!k.ownerDocument||k.ownerDocument==(d||document))return k}catch(q){}m.destroy(k)}a=g.trim(a);if(c||a.match(/\$\{([^\}]+)\}/g))return b[f]=a;c=m.toDom(a,d);if(1!=c.nodeType)throw Error("Invalid template: "+a);return b[f]=c};a("ie")&&c(window,"unload",function(){var a=e._templateCache,c;for(c in a){var d=a[c];"object"==typeof d&&m.destroy(d);delete a[c]}});return e})},"dojo/data/ItemFileReadStore":function(){define("../_base/kernel ../_base/lang ../_base/declare ../_base/array ../_base/xhr ../Evented ./util/filter ./util/simpleFetch ../date/stamp".split(" "),
function(f,d,m,h,c,a,g,l,e){m=m("dojo.data.ItemFileReadStore",[a],{constructor:function(a){this._arrayOfAllItems=[];this._arrayOfTopLevelItems=[];this._loadFinished=!1;this.url=this._ccUrl=this._jsonFileUrl=a.url;this._jsonData=a.data;this.data=null;this._datatypeMap=a.typeMap||{};this._datatypeMap.Date||(this._datatypeMap.Date={type:Date,deserialize:function(a){return e.fromISOString(a)}});this._features={"dojo.data.api.Read":!0,"dojo.data.api.Identity":!0};this._itemsByIdentity=null;this._storeRefPropName=
"_S";this._itemNumPropName="_0";this._rootItemPropName="_RI";this._reverseRefMap="_RRM";this._loadInProgress=!1;this._queuedFetches=[];void 0!==a.urlPreventCache&&(this.urlPreventCache=a.urlPreventCache?!0:!1);void 0!==a.hierarchical&&(this.hierarchical=a.hierarchical?!0:!1);a.clearOnClose&&(this.clearOnClose=!0);"failOk"in a&&(this.failOk=a.failOk?!0:!1)},url:"",_ccUrl:"",data:null,typeMap:null,clearOnClose:!1,urlPreventCache:!1,failOk:!1,hierarchical:!0,_assertIsItem:function(a){if(!this.isItem(a))throw Error(this.declaredClass+
": Invalid item argument.");},_assertIsAttribute:function(a){if("string"!==typeof a)throw Error(this.declaredClass+": Invalid attribute argument.");},getValue:function(a,c,d){a=this.getValues(a,c);return 0<a.length?a[0]:d},getValues:function(a,c){this._assertIsItem(a);this._assertIsAttribute(c);return(a[c]||[]).slice(0)},getAttributes:function(a){this._assertIsItem(a);var b=[],c;for(c in a)c!==this._storeRefPropName&&c!==this._itemNumPropName&&c!==this._rootItemPropName&&c!==this._reverseRefMap&&
b.push(c);return b},hasAttribute:function(a,c){this._assertIsItem(a);this._assertIsAttribute(c);return c in a},containsValue:function(a,c,d){var b=void 0;"string"===typeof d&&(b=g.patternToRegExp(d,!1));return this._containsValue(a,c,d,b)},_containsValue:function(a,c,e,f){return h.some(this.getValues(a,c),function(a){if(null!==a&&!d.isObject(a)&&f){if(a.toString().match(f))return!0}else if(e===a)return!0})},isItem:function(a){return a&&a[this._storeRefPropName]===this&&this._arrayOfAllItems[a[this._itemNumPropName]]===
a?!0:!1},isItemLoaded:function(a){return this.isItem(a)},loadItem:function(a){this._assertIsItem(a.item)},getFeatures:function(){return this._features},getLabel:function(a){if(this._labelAttr&&this.isItem(a))return this.getValue(a,this._labelAttr)},getLabelAttributes:function(a){return this._labelAttr?[this._labelAttr]:null},filter:function(a,c,d){var b=[],e,f;if(a.query){var k;e=a.queryOptions?a.queryOptions.ignoreCase:!1;var h={};for(f in a.query)k=a.query[f],"string"===typeof k?h[f]=g.patternToRegExp(k,
e):k instanceof RegExp&&(h[f]=k);for(e=0;e<c.length;++e){var l=!0,m=c[e];if(null===m)l=!1;else for(f in a.query)k=a.query[f],this._containsValue(m,f,k,h[f])||(l=!1);l&&b.push(m)}}else for(e=0;e<c.length;++e)f=c[e],null!==f&&b.push(f);d(b,a)},_fetchItems:function(a,e,g){var b=this;if(this._loadFinished)this.filter(a,this._getItemsArray(a.queryOptions),e);else if(this._jsonFileUrl!==this._ccUrl?(f.deprecated(this.declaredClass+": ","To change the url, set the url property of the store, not _jsonFileUrl.  _jsonFileUrl support will be removed in 2.0"),
this.url=this._ccUrl=this._jsonFileUrl):this.url!==this._ccUrl&&(this._ccUrl=this._jsonFileUrl=this.url),null!=this.data&&(this._jsonData=this.data,this.data=null),this._jsonFileUrl)if(this._loadInProgress)this._queuedFetches.push({args:a,filter:d.hitch(b,"filter"),findCallback:d.hitch(b,e)});else{this._loadInProgress=!0;var k=c.get({url:b._jsonFileUrl,handleAs:"json-comment-optional",preventCache:this.urlPreventCache,failOk:this.failOk});k.addCallback(function(c){try{b._getItemsFromLoadedData(c),
b._loadFinished=!0,b._loadInProgress=!1,b.filter(a,b._getItemsArray(a.queryOptions),e),b._handleQueuedFetches()}catch(u){b._loadFinished=!0,b._loadInProgress=!1,g(u,a)}});k.addErrback(function(c){b._loadInProgress=!1;g(c,a)});var h=null;a.abort&&(h=a.abort);a.abort=function(){var b=k;b&&-1===b.fired&&(b.cancel(),b=null);h&&h.call(a)}}else if(this._jsonData)try{this._loadFinished=!0,this._getItemsFromLoadedData(this._jsonData),this._jsonData=null,b.filter(a,this._getItemsArray(a.queryOptions),e)}catch(q){g(q,
a)}else g(Error(this.declaredClass+": No JSON source data was provided as either URL or a nested Javascript object."),a)},_handleQueuedFetches:function(){if(0<this._queuedFetches.length){for(var a=0;a<this._queuedFetches.length;a++){var c=this._queuedFetches[a],d=c.args,e=c.filter,c=c.findCallback;e?e(d,this._getItemsArray(d.queryOptions),c):this.fetchItemByIdentity(d)}this._queuedFetches=[]}},_getItemsArray:function(a){return a&&a.deep?this._arrayOfAllItems:this._arrayOfTopLevelItems},close:function(a){this.clearOnClose&&
this._loadFinished&&!this._loadInProgress&&(this._arrayOfAllItems=[],this._arrayOfTopLevelItems=[],this._loadFinished=!1,this._itemsByIdentity=null,this._loadInProgress=!1,this._queuedFetches=[])},_getItemsFromLoadedData:function(a){function b(a){return null!==a&&"object"===typeof a&&(!d.isArray(a)||e)&&!d.isFunction(a)&&(a.constructor==Object||d.isArray(a))&&"undefined"===typeof a._reference&&"undefined"===typeof a._type&&"undefined"===typeof a._value&&f.hierarchical}function c(a){f._arrayOfAllItems.push(a);
for(var e in a){var g=a[e];if(g)if(d.isArray(g))for(var k=0;k<g.length;++k){var h=g[k];b(h)&&c(h)}else b(g)&&c(g)}}var e=!1,f=this;this._labelAttr=a.label;var g,h;this._arrayOfAllItems=[];this._arrayOfTopLevelItems=a.items;for(g=0;g<this._arrayOfTopLevelItems.length;++g)h=this._arrayOfTopLevelItems[g],d.isArray(h)&&(e=!0),c(h),h[this._rootItemPropName]=!0;var l={},m;for(g=0;g<this._arrayOfAllItems.length;++g)for(m in h=this._arrayOfAllItems[g],h){if(m!==this._rootItemPropName){var v=h[m];null!==v?
d.isArray(v)||(h[m]=[v]):h[m]=[null]}l[m]=m}for(;l[this._storeRefPropName];)this._storeRefPropName+="_";for(;l[this._itemNumPropName];)this._itemNumPropName+="_";for(;l[this._reverseRefMap];)this._reverseRefMap+="_";if(l=a.identifier)for(this._itemsByIdentity={},this._features["dojo.data.api.Identity"]=l,g=0;g<this._arrayOfAllItems.length;++g)if(h=this._arrayOfAllItems[g],a=h[l],a=a[0],Object.hasOwnProperty.call(this._itemsByIdentity,a)){if(this._jsonFileUrl)throw Error(this.declaredClass+":  The json data as specified by: ["+
this._jsonFileUrl+"] is malformed.  Items within the list have identifier: ["+l+"].  Value collided: ["+a+"]");if(this._jsonData)throw Error(this.declaredClass+":  The json data provided by the creation arguments is malformed.  Items within the list have identifier: ["+l+"].  Value collided: ["+a+"]");}else this._itemsByIdentity[a]=h;else this._features["dojo.data.api.Identity"]=Number;for(g=0;g<this._arrayOfAllItems.length;++g)h=this._arrayOfAllItems[g],h[this._storeRefPropName]=this,h[this._itemNumPropName]=
g;for(g=0;g<this._arrayOfAllItems.length;++g)for(m in h=this._arrayOfAllItems[g],h)for(a=h[m],l=0;l<a.length;++l)if(v=a[l],null!==v&&"object"==typeof v){if("_type"in v&&"_value"in v){var y=v._type,x=this._datatypeMap[y];if(x)if(d.isFunction(x))a[l]=new x(v._value);else if(d.isFunction(x.deserialize))a[l]=x.deserialize(v._value);else throw Error("dojo.data.ItemFileReadStore: Value provided in typeMap was neither a constructor, nor a an object with a deserialize function");else throw Error("dojo.data.ItemFileReadStore: in the typeMap constructor arg, no object class was specified for the datatype '"+
y+"'");}if(v._reference){v=v._reference;if(d.isObject(v))for(y=0;y<this._arrayOfAllItems.length;++y){var x=this._arrayOfAllItems[y],w=!0,A;for(A in v)x[A]!=v[A]&&(w=!1);w&&(a[l]=x)}else a[l]=this._getItemByIdentity(v);this.referenceIntegrity&&(v=a[l],this.isItem(v)&&this._addReferenceToMap(v,h,m))}else this.isItem(v)&&this.referenceIntegrity&&this._addReferenceToMap(v,h,m)}},_addReferenceToMap:function(a,c,d){},getIdentity:function(a){var b=this._features["dojo.data.api.Identity"];return b===Number?
a[this._itemNumPropName]:(a=a[b])?a[0]:null},fetchItemByIdentity:function(a){var b,d;if(this._loadFinished)b=this._getItemByIdentity(a.identity),a.onItem&&(d=a.scope?a.scope:f.global,a.onItem.call(d,b));else{var e=this;this._jsonFileUrl!==this._ccUrl?(f.deprecated(this.declaredClass+": ","To change the url, set the url property of the store, not _jsonFileUrl.  _jsonFileUrl support will be removed in 2.0"),this.url=this._ccUrl=this._jsonFileUrl):this.url!==this._ccUrl&&(this._ccUrl=this._jsonFileUrl=
this.url);null!=this.data&&null==this._jsonData&&(this._jsonData=this.data,this.data=null);this._jsonFileUrl?this._loadInProgress?this._queuedFetches.push({args:a}):(this._loadInProgress=!0,d=c.get({url:e._jsonFileUrl,handleAs:"json-comment-optional",preventCache:this.urlPreventCache,failOk:this.failOk}),d.addCallback(function(c){var d=a.scope?a.scope:f.global;try{e._getItemsFromLoadedData(c),e._loadFinished=!0,e._loadInProgress=!1,b=e._getItemByIdentity(a.identity),a.onItem&&a.onItem.call(d,b),e._handleQueuedFetches()}catch(q){e._loadInProgress=
!1,a.onError&&a.onError.call(d,q)}}),d.addErrback(function(b){e._loadInProgress=!1;a.onError&&a.onError.call(a.scope?a.scope:f.global,b)})):this._jsonData&&(e._getItemsFromLoadedData(e._jsonData),e._jsonData=null,e._loadFinished=!0,b=e._getItemByIdentity(a.identity),a.onItem&&(d=a.scope?a.scope:f.global,a.onItem.call(d,b)))}},_getItemByIdentity:function(a){var b=null;this._itemsByIdentity?Object.hasOwnProperty.call(this._itemsByIdentity,a)&&(b=this._itemsByIdentity[a]):Object.hasOwnProperty.call(this._arrayOfAllItems,
a)&&(b=this._arrayOfAllItems[a]);void 0===b&&(b=null);return b},getIdentityAttributes:function(a){a=this._features["dojo.data.api.Identity"];return a===Number?null:[a]},_forceLoad:function(){var a=this;this._jsonFileUrl!==this._ccUrl?(f.deprecated(this.declaredClass+": ","To change the url, set the url property of the store, not _jsonFileUrl.  _jsonFileUrl support will be removed in 2.0"),this.url=this._ccUrl=this._jsonFileUrl):this.url!==this._ccUrl&&(this._ccUrl=this._jsonFileUrl=this.url);null!=
this.data&&(this._jsonData=this.data,this.data=null);if(this._jsonFileUrl){var d=c.get({url:this._jsonFileUrl,handleAs:"json-comment-optional",preventCache:this.urlPreventCache,failOk:this.failOk,sync:!0});d.addCallback(function(b){try{if(!0!==a._loadInProgress&&!a._loadFinished)a._getItemsFromLoadedData(b),a._loadFinished=!0;else if(a._loadInProgress)throw Error(this.declaredClass+":  Unable to perform a synchronous load, an async load is in progress.");}catch(p){throw p;}});d.addErrback(function(a){throw a;
})}else this._jsonData&&(a._getItemsFromLoadedData(a._jsonData),a._jsonData=null,a._loadFinished=!0)}});d.extend(m,l);return m})},"com/huayun/webgis/action/search/ReactionSearch":function(){define("dojo/_base/declare dojo/on dojo/dom dojo/query dojo/topic dojo/dom-style dojo/dom-construct dojo/_base/window dojo/debounce ../../geometry/Point2D ../ActiveMapAction".split(" "),function(f,d,m,h,c,a,g,l,e,b,k){return f("com.huayun.webgis.action.search.ReactionSearch",[k],{constructor:function(a){f.safeMixin(this,
a);this.view=a.view;this.state=!1;this.power=this.view.map.findLayerById("power");this._onClick=null},active:function(){this.state||(this.state=!0,this.view.selectEnabled=!0,this._onClick=d(this.view.domNode,"mousemove",e(this._mouseClick.bind(this),500)))},_mouseClick:function(a){this.doAction(a)},invalid:function(){this.view.panEnabled=!0;c.publish("closeDevInfo");this._endActionMethod.call(this)},doAction:function(a){if(this.view.selectEnabled){var b=this.view.screenToGeometry(a.clientX,a.clientY);
this.view.domNode.style.cursor="wait";var d=this;this.power.queryFeaturesByGeometry(b,2,function(b,e){d.view.domNode.style.cursor="pointer";if(!b){e=e.results;debugger;e&&0<e.length&&d.state?c.publish("showDevInfo",e,a):c.publish("closeDevInfo")}})}},_endActionMethod:function(){this.state=!1;c.publish("closeDevInfo");this._onClick&&(this._onClick.remove(),this._onClick=null)}})})},"dojo/window":function(){define("./_base/lang ./sniff ./_base/window ./dom ./dom-geometry ./dom-style ./dom-construct".split(" "),
function(f,d,m,h,c,a,g){d.add("rtl-adjust-position-for-verticalScrollBar",function(a,b){a=m.body(b);b=g.create("div",{style:{overflow:"scroll",overflowX:"visible",direction:"rtl",visibility:"hidden",position:"absolute",left:"0",top:"0",width:"64px",height:"64px"}},a,"last");var d=g.create("div",{style:{overflow:"hidden",direction:"ltr"}},b,"last"),e=0!=c.position(d).x;b.removeChild(d);a.removeChild(b);return e});d.add("position-fixed-support",function(a,b){a=m.body(b);b=g.create("span",{style:{visibility:"hidden",
position:"fixed",left:"1px",top:"1px"}},a,"last");var d=g.create("span",{style:{position:"fixed",left:"0",top:"0"}},b,"last"),e=c.position(d).x!=c.position(b).x;b.removeChild(d);a.removeChild(b);return e});var l={getBox:function(a){a=a||m.doc;var b="BackCompat"==a.compatMode?m.body(a):a.documentElement,e=c.docScroll(a);if(d("touch")){var f=l.get(a);a=f.innerWidth||b.clientWidth;b=f.innerHeight||b.clientHeight}else a=b.clientWidth,b=b.clientHeight;return{l:e.x,t:e.y,w:a,h:b}},get:function(a){if(d("ie")&&
l!==document.parentWindow){a.parentWindow.execScript("document._parentWindow \x3d window;","Javascript");var b=a._parentWindow;a._parentWindow=null;return b}return a.parentWindow||a.defaultView},scrollIntoView:function(e,b){try{e=h.byId(e);var f=e.ownerDocument||m.doc,g=m.body(f),l=f.documentElement||g.parentNode,t=d("ie")||d("trident"),r=d("webkit");if(e!=g&&e!=l)if(!(d("mozilla")||t||r||d("opera")||d("trident")||d("edge"))&&"scrollIntoView"in e)e.scrollIntoView(!1);else{var q="BackCompat"==f.compatMode,
u=Math.min(g.clientWidth||l.clientWidth,l.clientWidth||g.clientWidth),z=Math.min(g.clientHeight||l.clientHeight,l.clientHeight||g.clientHeight),f=r||q?g:l,v=b||c.position(e),y=e.parentNode;b=function(b){return 6>=t||7==t&&q?!1:d("position-fixed-support")&&"fixed"==a.get(b,"position").toLowerCase()};var x=this,r=function(a,b,c){"BODY"==a.tagName||"HTML"==a.tagName?x.get(a.ownerDocument).scrollBy(b,c):(b&&(a.scrollLeft+=b),c&&(a.scrollTop+=c))};if(!b(e))for(;y;){y==g&&(y=f);var w=c.position(y),A=b(y),
B="rtl"==a.getComputedStyle(y).direction.toLowerCase();if(y==f)w.w=u,w.h=z,f==l&&(t||d("trident"))&&B&&(w.x+=f.offsetWidth-w.w),w.x=0,w.y=0;else{var E=c.getPadBorderExtents(y);w.w-=E.w;w.h-=E.h;w.x+=E.l;w.y+=E.t;var C=y.clientWidth,F=w.w-C;0<C&&0<F&&(B&&d("rtl-adjust-position-for-verticalScrollBar")&&(w.x+=F),w.w=C);C=y.clientHeight;F=w.h-C;0<C&&0<F&&(w.h=C)}A&&(0>w.y&&(w.h+=w.y,w.y=0),0>w.x&&(w.w+=w.x,w.x=0),w.y+w.h>z&&(w.h=z-w.y),w.x+w.w>u&&(w.w=u-w.x));var G=v.x-w.x,I=v.y-w.y,M=G+v.w-w.w,D=I+v.h-
w.h,H,J;0<M*G&&(y.scrollLeft||y==f||y.scrollWidth>y.offsetHeight)&&(H=Math[0>G?"max":"min"](G,M),B&&(8==t&&!q||5<=d("trident"))&&(H=-H),J=y.scrollLeft,r(y,H,0),H=y.scrollLeft-J,v.x-=H);0<D*I&&(y.scrollTop||y==f||y.scrollHeight>y.offsetHeight)&&(H=Math.ceil(Math[0>I?"max":"min"](I,D)),J=y.scrollTop,r(y,0,H),H=y.scrollTop-J,v.y-=H);y=y!=f&&!A&&y.parentNode}}}catch(Q){console.error("scrollIntoView: "+Q),e.scrollIntoView(!1)}}};f.setObject("dojo.window",l);return l})},"com/huayun/webgis/widget/searchs/PointSearch":function(){define("dojo/_base/declare dojo/dom dojo/on dojo/query dojo/dom-style dojo/dom-construct dojo/topic ../MapModuleX ../../Feature ../../Graphic ../../geometry/Point ../../geometry/Polyline ../../geometry/Multipoint ../../geometry/Polygon ../../symbols/PointSymbol ../../symbols/LineSymbol ../../symbols/PolygonSymbol dojo/text!../../templates/searchs/reactionSearch.html".split(" "),
function(f,d,m,h,c,a,g,l,e,b,k,n,p,t,r,q,u,z){return f("com.huayun.webgis.widget.searchs.ReactionSearch",[l],{baseClass:"reactionSearch",templateString:z,constructor:function(){this.view=this.map=this.point=this.dataList=null},doInit:function(){var a=d.byId("showList");this.map=this.get("map");this.view=this.get("view");g.subscribe("showDevInfo",function(b,c){debugger;this.dataList=b;this.point=c;this.showDev();a.style.display="block";a.style.left=c.clientX+"px";a.style.top=c.clientY+"px"}.bind(this));
g.subscribe("closeDevInfo",function(){a.style.display="none";devMoreInfo.style.display="none"}.bind(this))},showDev:function(){var b=d.byId("devList"),c=d.byId("moreInfoList");devMoreInfo.style.display="none";a.empty(c);a.empty(b);for(c=0;c<this.dataList.length;c++){var e=this.dataList[c],f=a.create("li",{index:c,className:"showLi"},b);a.create("div",{index:c,className:"message",innerHTML:c+1+"."+e.attributes.NAME+"---"+e.layerName},f);a.create("button",{index:c,className:"locationBtn",innerHTML:"\u5b9a\u4f4d"},
f)}},isMessage:function(a){"message"===a.target.className?this.showMoreInfo(a):this.mscLocation(a)},mscLocation:function(a){a=a.target.getAttribute("index");var b=this.dataList[a].geometry,c=this.dataList[a].geometryType;a=this.map.findLayerById("drawLayer");var d=new r({color:"#FFFF00",radious:5,strokeColor:"#0000FF",strokeWidth:1}),e=new q({color:"#ff2f39",width:3}),f=new u({color:"#0FF",opacity:.5});switch(c){case "esriGeometryPoint":b=b[0][0];e=new k(b.x,b.y);this.addgraphic(a,e,d);break;case "esriGeometryMultipoint":b=
b[0];e=b.points.map(function(a){return new k(a[0],a[1])});e=new p(e);this.addgraphic(a,e,d);break;case "esriGeometryPolyline":d=b.paths.map(function(a){return a.map(function(a){return new k(a[0],a[1])})});d=new n(d);this.addgraphic(a,d,e);break;default:d=b.rings.map(function(a){return a.map(function(a){return new k(a[0],a[1])})}),d=new t(d),this.addgraphic(a,d,f)}},addgraphic:function(a,c,d){c=new e({attributes:null,geometry:c});d=new b({feature:c,symbol:d});a.addGraphic(d);this.view.threeRender()},
showMoreInfo:function(b){var c=d.byId("devMoreInfo");b=b.target.getAttribute("index");b=this.dataList[b].attributes;c.style.display="block";c.style.zIndex="500";a.empty(moreInfoList);this.createTable(b)},closeMoreInfo:function(){devMoreInfo.style.display="none"},createTable:function(b){for(var c in b)if("SHAPE"!==c&&"SUBGEOREGION"!==c){var d=a.create("tr",{className:"attrTr"},moreInfoList);a.create("td",{className:"td1",noWrap:"false",innerHTML:c},d);a.create("td",{className:"td2",noWrap:"false",
innerHTML:b[c]},d)}}})})},"dojo/_base/xhr":function(){define("./kernel ./sniff require ../io-query ../dom ../dom-form ./Deferred ./config ./json ./lang ./array ../on ../aspect ../request/watch ../request/xhr ../request/util".split(" "),function(f,d,m,h,c,a,g,l,e,b,k,n,p,t,r,q){f._xhrObj=r._create;var u=f.config;f.objectToQuery=h.objectToQuery;f.queryToObject=h.queryToObject;f.fieldToObject=a.fieldToObject;f.formToObject=a.toObject;f.formToQuery=a.toQuery;f.formToJson=a.toJson;f._blockAsync=!1;var z=
f._contentHandlers=f.contentHandlers={text:function(a){return a.responseText},json:function(a){return e.fromJson(a.responseText||null)},"json-comment-filtered":function(a){l.useCommentedJson||console.warn("Consider using the standard mimetype:application/json. json-commenting can introduce security issues. To decrease the chances of hijacking, use the standard the 'json' handler and prefix your json with: {}\x26\x26\nUse djConfig.useCommentedJson\x3dtrue to turn off this message.");a=a.responseText;
var b=a.indexOf("/*"),c=a.lastIndexOf("*/");if(-1==b||-1==c)throw Error("JSON was not comment filtered");return e.fromJson(a.substring(b+2,c))},javascript:function(a){return f.eval(a.responseText)},xml:function(a){var b=a.responseXML;b&&d("dom-qsa2.1")&&!b.querySelectorAll&&d("dom-parser")&&(b=(new DOMParser).parseFromString(a.responseText,"application/xml"));if(d("ie")&&(!b||!b.documentElement)){var c=function(a){return"MSXML"+a+".DOMDocument"},c=["Microsoft.XMLDOM",c(6),c(4),c(3),c(2)];k.some(c,
function(c){try{var d=new ActiveXObject(c);d.async=!1;d.loadXML(a.responseText);b=d}catch(G){return!1}return!0})}return b},"json-comment-optional":function(a){return a.responseText&&/^[^{\[]*\/\*/.test(a.responseText)?z["json-comment-filtered"](a):z.json(a)}};f._ioSetArgs=function(d,e,k,l){var m={args:d,url:d.url},n=null;if(d.form){var n=c.byId(d.form),p=n.getAttributeNode("action");m.url=m.url||(p?p.value:f.doc?f.doc.URL:null);n=a.toObject(n)}p={};n&&b.mixin(p,n);d.content&&b.mixin(p,d.content);
d.preventCache&&(p["dojo.preventCache"]=(new Date).valueOf());m.query=h.objectToQuery(p);m.handleAs=d.handleAs||"text";var q=new g(function(a){a.canceled=!0;e&&e(a);var b=a.ioArgs.error;b||(b=Error("request cancelled"),b.dojoType="cancel",a.ioArgs.error=b);return b});q.addCallback(k);var t=d.load;t&&b.isFunction(t)&&q.addCallback(function(a){return t.call(d,a,m)});var r=d.error;r&&b.isFunction(r)&&q.addErrback(function(a){return r.call(d,a,m)});var v=d.handle;v&&b.isFunction(v)&&q.addBoth(function(a){return v.call(d,
a,m)});q.addErrback(function(a){return l(a,q)});u.ioPublish&&f.publish&&!1!==m.args.ioPublish&&(q.addCallbacks(function(a){f.publish("/dojo/io/load",[q,a]);return a},function(a){f.publish("/dojo/io/error",[q,a]);return a}),q.addBoth(function(a){f.publish("/dojo/io/done",[q,a]);return a}));q.ioArgs=m;return q};var v=function(a){a=z[a.ioArgs.handleAs](a.ioArgs.xhr);return void 0===a?null:a},y=function(a,b){b.ioArgs.args.failOk||console.error(a);return a},x=function(a){0>=w&&(w=0,u.ioPublish&&f.publish&&
(!a||a&&!1!==a.ioArgs.args.ioPublish)&&f.publish("/dojo/io/stop"))},w=0;p.after(t,"_onAction",function(){--w});p.after(t,"_onInFlight",x);f._ioCancelAll=t.cancelAll;f._ioNotifyStart=function(a){u.ioPublish&&f.publish&&!1!==a.ioArgs.args.ioPublish&&(w||f.publish("/dojo/io/start"),w+=1,f.publish("/dojo/io/send",[a]))};f._ioWatch=function(a,c,d,e){a.ioArgs.options=a.ioArgs.args;b.mixin(a,{response:a.ioArgs,isValid:function(b){return c(a)},isReady:function(b){return d(a)},handleResponse:function(b){return e(a)}});
t(a);x(a)};f._ioAddQueryToUrl=function(a){a.query.length&&(a.url+=(-1==a.url.indexOf("?")?"?":"\x26")+a.query,a.query=null)};f.xhr=function(a,b,c){var d,e=f._ioSetArgs(b,function(a){d&&d.cancel()},v,y),g=e.ioArgs;"postData"in b?g.query=b.postData:"putData"in b?g.query=b.putData:"rawBody"in b?g.query=b.rawBody:(2<arguments.length&&!c||-1==="POST|PUT".indexOf(a.toUpperCase()))&&f._ioAddQueryToUrl(g);var h={method:a,handleAs:"text",timeout:b.timeout,withCredentials:b.withCredentials,ioArgs:g};"undefined"!==
typeof b.headers&&(h.headers=b.headers);"undefined"!==typeof b.contentType&&(h.headers||(h.headers={}),h.headers["Content-Type"]=b.contentType);"undefined"!==typeof g.query&&(h.data=g.query);"undefined"!==typeof b.sync&&(h.sync=b.sync);f._ioNotifyStart(e);try{d=r(g.url,h,!0)}catch(M){return e.cancel(),e}e.ioArgs.xhr=d.response.xhr;d.then(function(){e.resolve(e)}).otherwise(function(a){g.error=a;a.response&&(a.status=a.response.status,a.responseText=a.response.text,a.xhr=a.response.xhr);e.reject(a)});
return e};f.xhrGet=function(a){return f.xhr("GET",a)};f.rawXhrPost=f.xhrPost=function(a){return f.xhr("POST",a,!0)};f.rawXhrPut=f.xhrPut=function(a){return f.xhr("PUT",a,!0)};f.xhrDelete=function(a){return f.xhr("DELETE",a)};f._isDocumentOk=function(a){return q.checkStatus(a.status)};f._getText=function(a){var b;f.xhrGet({url:a,sync:!0,load:function(a){b=a}});return b};b.mixin(f.xhr,{_xhrObj:f._xhrObj,fieldToObject:a.fieldToObject,formToObject:a.toObject,objectToQuery:h.objectToQuery,formToQuery:a.toQuery,
formToJson:a.toJson,queryToObject:h.queryToObject,contentHandlers:z,_ioSetArgs:f._ioSetArgs,_ioCancelAll:f._ioCancelAll,_ioNotifyStart:f._ioNotifyStart,_ioWatch:f._ioWatch,_ioAddQueryToUrl:f._ioAddQueryToUrl,_isDocumentOk:f._isDocumentOk,_getText:f._getText,get:f.xhrGet,post:f.xhrPost,put:f.xhrPut,del:f.xhrDelete});return f.xhr})},"dojo/data/util/simpleFetch":function(){define(["../../_base/lang","../../_base/kernel","./sorter"],function(f,d,m){var h={};f.setObject("dojo.data.util.simpleFetch",h);
h.errorHandler=function(c,a){a.onError&&a.onError.call(a.scope||d.global,c,a)};h.fetchHandler=function(c,a){var f=a.abort||null,h=!1,e=a.start?a.start:0,b=a.count&&Infinity!==a.count?e+a.count:c.length;a.abort=function(){h=!0;f&&f.call(a)};var k=a.scope||d.global;a.store||(a.store=this);a.onBegin&&a.onBegin.call(k,c.length,a);a.sort&&c.sort(m.createSortFunction(a.sort,this));if(a.onItem)for(var n=e;n<c.length&&n<b;++n){var p=c[n];h||a.onItem.call(k,p,a)}a.onComplete&&!h&&(n=null,a.onItem||(n=c.slice(e,
b)),a.onComplete.call(k,n,a))};h.fetch=function(c){c=c||{};c.store||(c.store=this);this._fetchItems(c,f.hitch(this,"fetchHandler"),f.hitch(this,"errorHandler"));return c};return h})},"dojo/errors/RequestError":function(){define(["./create"],function(f){return f("RequestError",function(d,f){this.response=f})})},"com/huayun/webgis/widget/DeviceResult":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_OnDijitClickMixin ../geometry/Extent ../Feature ../Graphic dojo/text!../templates/deviceResult.html".split(" "),
function(f,d,m,h,c,a,g,l){return f("com.huayun.webgis.widget.DeviceResult",[d,m,h],{templateString:l,sequence:1,name:"",shape:"",map:null,constructor:function(a){this.sequence=a.sequence;this.name=a.name;this.shape=a.shape;this.map=a.map},locate:function(){var d=this.map.findLayerById("drawLayer");if(this.shape.startsWith("POINT")){var b=this.shape.indexOf(" "),f=1*this.shape.substring(6,b),b=1*this.shape.substring(b+1,this.shape.length-1);d.clear();var h=this.map.getMaxResolution(),l=this.map.realWidth,
m=this.map.realHeight;this.map.setExtent(new c(f-h*l/2,b-h*m/2,f+h*l/2,b+h*m/2));var r=this.map.geometryTo3D({x:f,y:b});d.addPoint({x:r.x,y:r.y})}else if(this.shape.startsWith("MULTILINESTRING")){d.clear();for(var r=this.shape.substring(17,this.shape.length-2).split("),("),q=[],h=[],u,z=0,v,y=0,l=0,x=r.length;l<x;l++){for(var w=r[l].split(","),q=[],m=0,A=w.length;m<A;m++)f=w[m],b=f.split(" "),f=Number(b[0]),b=Number(b[1]),!u||f<u?u=f:f>z&&(z=f),!v||b<v?v=b:b>y&&(y=b),q.push({x:f,y:b});h.push(q)}f=
new c(u,v,z,y);this.map.setExtent(f);q=[];u=[];f=d.group.position.x;b=d.group.position.y;for(l=0;l<h.length;l++){q=h[l];u=[];for(m=0;m<q.length;m++)r=this.map.geometryTo3D(q[m]),r.x-=f,r.y-=b,u.push(r);m=new a({_geometry:u});m=new g({feature:m,symbol:this.lineSymbol,graphicLayer:d});d.addGraphic(m)}d.map.layerContainer.threeRender()}}})})},"dijit/popup":function(){define("dojo/_base/array dojo/aspect dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/has dojo/keys dojo/_base/lang dojo/on ./place ./BackgroundIframe ./Viewport ./main dojo/touch".split(" "),
function(f,d,m,h,c,a,g,l,e,b,k,n,p,t,r,q){function u(){this._popupWrapper&&(a.destroy(this._popupWrapper),delete this._popupWrapper)}m=m(null,{_stack:[],_beginZIndex:1E3,_idGen:1,_repositionAll:function(){if(this._firstAroundNode){var a=this._firstAroundPosition,b=g.position(this._firstAroundNode,!0),c=b.x-a.x,a=b.y-a.y;if(c||a)for(this._firstAroundPosition=b,b=0;b<this._stack.length;b++){var d=this._stack[b].wrapper.style;d.top=parseFloat(d.top)+a+"px";"auto"==d.right?d.left=parseFloat(d.left)+c+
"px":d.right=parseFloat(d.right)-c+"px"}this._aroundMoveListener=setTimeout(k.hitch(this,"_repositionAll"),c||a?10:50)}},_createWrapper:function(b){var c=b._popupWrapper,e=b.domNode;c||(c=a.create("div",{"class":"dijitPopup",style:{display:"none"},role:"region","aria-label":b["aria-label"]||b.label||b.name||b.id},b.ownerDocumentBody),c.appendChild(e),e=e.style,e.display="",e.visibility="",e.position="",e.top="0px",b._popupWrapper=c,d.after(b,"destroy",u,!0),"ontouchend"in document&&n(c,"touchend",
function(a){/^(input|button|textarea)$/i.test(a.target.tagName)||a.preventDefault()}),c.dojoClick=!0);return c},moveOffScreen:function(a){var b=this._createWrapper(a);a=g.isBodyLtr(a.ownerDocument);var c={visibility:"hidden",top:"-9999px",display:""};c[a?"left":"right"]="-9999px";c[a?"right":"left"]="auto";l.set(b,c);return b},hide:function(a){var b=this._createWrapper(a);l.set(b,{display:"none",height:"auto",overflowY:"visible",border:""});a=a.domNode;"_originalStyle"in a&&(a.style.cssText=a._originalStyle)},
getTopPopup:function(){for(var a=this._stack,b=a.length-1;0<b&&a[b].parent===a[b-1].widget;b--);return a[b]},open:function(a){for(var d=this._stack,f=a.popup,m=f.domNode,q=a.orient||["below","below-alt","above","above-alt"],u=a.parent?a.parent.isLeftToRight():g.isBodyLtr(f.ownerDocument),z=a.around,E=a.around&&a.around.id?a.around.id+"_dropdown":"popup_"+this._idGen++;d.length&&(!a.parent||!h.isDescendant(a.parent.domNode,d[d.length-1].widget.domNode));)this.close(d[d.length-1].widget);var C=this.moveOffScreen(f);
f.startup&&!f._started&&f.startup();var F,G=g.position(m);if("maxHeight"in a&&-1!=a.maxHeight)F=a.maxHeight||Infinity;else{F=r.getEffectiveBox(this.ownerDocument);var I=z?g.position(z,!1):{y:a.y-(a.padding||0),h:2*(a.padding||0)};F=Math.floor(Math.max(I.y,F.h-(I.y+I.h)))}G.h>F&&(G=l.getComputedStyle(m),l.set(C,{overflowY:"scroll",height:F+"px",border:G.borderLeftWidth+" "+G.borderLeftStyle+" "+G.borderLeftColor}),m._originalStyle=m.style.cssText,m.style.border="none");c.set(C,{id:E,style:{zIndex:this._beginZIndex+
d.length},"class":"dijitPopup "+(f.baseClass||f["class"]||"").split(" ")[0]+"Popup",dijitPopupParent:a.parent?a.parent.id:""});0==d.length&&z&&(this._firstAroundNode=z,this._firstAroundPosition=g.position(z,!0),this._aroundMoveListener=setTimeout(k.hitch(this,"_repositionAll"),50));e("config-bgIframe")&&!f.bgIframe&&(f.bgIframe=new t(C));E=f.orient?k.hitch(f,"orient"):null;q=z?p.around(C,z,q,u,E):p.at(C,a,"R"==q?["TR","BR","TL","BL"]:["TL","BL","TR","BR"],a.padding,E);C.style.visibility="visible";
m.style.visibility="visible";m=[];m.push(n(C,"keydown",k.hitch(this,function(c){if(c.keyCode==b.ESCAPE&&a.onCancel)c.stopPropagation(),c.preventDefault(),a.onCancel();else if(c.keyCode==b.TAB&&(c.stopPropagation(),c.preventDefault(),(c=this.getTopPopup())&&c.onCancel))c.onCancel()})));f.onCancel&&a.onCancel&&m.push(f.on("cancel",a.onCancel));m.push(f.on(f.onExecute?"execute":"change",k.hitch(this,function(){var a=this.getTopPopup();if(a&&a.onExecute)a.onExecute()})));d.push({widget:f,wrapper:C,parent:a.parent,
onExecute:a.onExecute,onCancel:a.onCancel,onClose:a.onClose,handlers:m});if(f.onOpen)f.onOpen(q);return q},close:function(a){for(var b=this._stack;a&&f.some(b,function(b){return b.widget==a})||!a&&b.length;){var c=b.pop(),d=c.widget,e=c.onClose;d.bgIframe&&(d.bgIframe.destroy(),delete d.bgIframe);if(d.onClose)d.onClose();for(var g;g=c.handlers.pop();)g.remove();d&&d.domNode&&this.hide(d);e&&e()}0==b.length&&this._aroundMoveListener&&(clearTimeout(this._aroundMoveListener),this._firstAroundNode=this._firstAroundPosition=
this._aroundMoveListener=null)}});return q.popup=new m})},"dijit/_WidgetBase":function(){define("require dojo/_base/array dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/has dojo/_base/kernel dojo/_base/lang dojo/on dojo/ready dojo/Stateful dojo/topic dojo/_base/window ./Destroyable dojo/has!dojo-bidi?./_BidiMixin ./registry".split(" "),function(f,d,m,h,c,a,g,l,e,b,k,n,p,t,r,q,u,z,v,
y,x,w,A){function B(a){return function(b){l[b?"set":"remove"](this.domNode,a,b);this._set(a,b)}}p.add("dijit-legacy-requires",!t.isAsync);p.add("dojo-bidi",!1);p("dijit-legacy-requires")&&u(0,function(){f(["dijit/_base/manager"])});var E={};h=a("dijit._WidgetBase",[z,x],{id:"",_setIdAttr:"domNode",lang:"",_setLangAttr:B("lang"),dir:"",_setDirAttr:B("dir"),"class":"",_setClassAttr:{node:"domNode",type:"class"},_setTypeAttr:null,style:"",title:"",tooltip:"",baseClass:"",srcNodeRef:null,domNode:null,
containerNode:null,ownerDocument:null,_setOwnerDocumentAttr:function(a){this._set("ownerDocument",a)},attributeMap:{},_blankGif:h.blankGif||f.toUrl("dojo/resources/blank.gif"),textDir:"",_introspect:function(){var a=this.constructor;if(!a._setterAttrs){var b=a.prototype,c=a._setterAttrs=[],a=a._onMap={},d;for(d in b.attributeMap)c.push(d);for(d in b)/^on/.test(d)&&(a[d.substring(2).toLowerCase()]=d),/^_set[A-Z](.*)Attr$/.test(d)&&(d=d.charAt(4).toLowerCase()+d.substr(5,d.length-9),b.attributeMap&&
d in b.attributeMap||c.push(d))}},postscript:function(a,b){this.create(a,b)},create:function(a,b){this._introspect();this.srcNodeRef=g.byId(b);this._connects=[];this._supportingWidgets=[];this.srcNodeRef&&this.srcNodeRef.id&&"string"==typeof this.srcNodeRef.id&&(this.id=this.srcNodeRef.id);a&&(this.params=a,r.mixin(this,a));this.postMixInProperties();this.id||(this.id=A.getUniqueId(this.declaredClass.replace(/\./g,"_")),this.params&&delete this.params.id);this.ownerDocument=this.ownerDocument||(this.srcNodeRef?
this.srcNodeRef.ownerDocument:document);this.ownerDocumentBody=y.body(this.ownerDocument);A.add(this);this.buildRendering();var c;this.domNode&&(this._applyAttributes(),(a=this.srcNodeRef)&&a.parentNode&&this.domNode!==a&&(a.parentNode.replaceChild(this.domNode,a),c=!0),this.domNode.setAttribute("widgetId",this.id));this.postCreate();c&&delete this.srcNodeRef;this._created=!0},_applyAttributes:function(){var a={},b;for(b in this.params||{})a[b]=this._get(b);d.forEach(this.constructor._setterAttrs,
function(b){if(!(b in a)){var c=this._get(b);c&&this.set(b,c)}},this);for(b in a)this.set(b,a[b])},postMixInProperties:function(){},buildRendering:function(){this.domNode||(this.domNode=this.srcNodeRef||this.ownerDocument.createElement("div"));if(this.baseClass){var a=this.baseClass.split(" ");this.isLeftToRight()||(a=a.concat(d.map(a,function(a){return a+"Rtl"})));e.add(this.domNode,a)}},postCreate:function(){},startup:function(){this._started||(this._started=!0,d.forEach(this.getChildren(),function(a){a._started||
a._destroyed||!r.isFunction(a.startup)||(a.startup(),a._started=!0)}))},destroyRecursive:function(a){this._beingDestroyed=!0;this.destroyDescendants(a);this.destroy(a)},destroy:function(a){function b(b){b.destroyRecursive?b.destroyRecursive(a):b.destroy&&b.destroy(a)}this._beingDestroyed=!0;this.uninitialize();d.forEach(this._connects,r.hitch(this,"disconnect"));d.forEach(this._supportingWidgets,b);this.domNode&&d.forEach(A.findWidgets(this.domNode,this.containerNode),b);this.destroyRendering(a);
A.remove(this.id);this._destroyed=!0},destroyRendering:function(a){this.bgIframe&&(this.bgIframe.destroy(a),delete this.bgIframe);this.domNode&&(a?l.remove(this.domNode,"widgetId"):b.destroy(this.domNode),delete this.domNode);this.srcNodeRef&&(a||b.destroy(this.srcNodeRef),delete this.srcNodeRef)},destroyDescendants:function(a){d.forEach(this.getChildren(),function(b){b.destroyRecursive&&b.destroyRecursive(a)})},uninitialize:function(){return!1},_setStyleAttr:function(a){var b=this.domNode;r.isObject(a)?
n.set(b,a):b.style.cssText=b.style.cssText?b.style.cssText+("; "+a):a;this._set("style",a)},_attrToDom:function(a,b,c){c=3<=arguments.length?c:this.attributeMap[a];d.forEach(r.isArray(c)?c:[c],function(c){var d=this[c.node||c||"domNode"];switch(c.type||"attribute"){case "attribute":r.isFunction(b)&&(b=r.hitch(this,b));c=c.attribute?c.attribute:/^on[A-Z][a-zA-Z]*$/.test(a)?a.toLowerCase():a;d.tagName?l.set(d,c,b):d.set(c,b);break;case "innerText":d.innerHTML="";d.appendChild(this.ownerDocument.createTextNode(b));
break;case "textContent":d.textContent=b;break;case "innerHTML":d.innerHTML=b;break;case "class":e.replace(d,b,this[a]);break;case "toggleClass":e.toggle(d,c.className||a,b)}},this)},get:function(a){var b=this._getAttrNames(a);return this[b.g]?this[b.g]():this._get(a)},set:function(a,b){if("object"===typeof a){for(var c in a)this.set(c,a[c]);return this}c=this._getAttrNames(a);var d=this[c.s];if(r.isFunction(d))var e=d.apply(this,Array.prototype.slice.call(arguments,1));else{var d=this.focusNode&&
!r.isFunction(this.focusNode)?"focusNode":"domNode",f=this[d]&&this[d].tagName,g;if((g=f)&&!(g=E[f])){g=this[d];var h={},k;for(k in g)h[k.toLowerCase()]=!0;g=E[f]=h}k=g;c=a in this.attributeMap?this.attributeMap[a]:c.s in this?this[c.s]:k&&c.l in k&&"function"!=typeof b||/^aria-|^data-|^role$/.test(a)?d:null;null!=c&&this._attrToDom(a,b,c);this._set(a,b)}return e||this},_attrPairNames:{},_getAttrNames:function(a){var b=this._attrPairNames;if(b[a])return b[a];var c=a.replace(/^[a-z]|-[a-zA-Z]/g,function(a){return a.charAt(a.length-
1).toUpperCase()});return b[a]={n:a+"Node",s:"_set"+c+"Attr",g:"_get"+c+"Attr",l:c.toLowerCase()}},_set:function(a,b){var c=this[a];this[a]=b;!this._created||c===b||c!==c&&b!==b||(this._watchCallbacks&&this._watchCallbacks(a,c,b),this.emit("attrmodified-"+a,{detail:{prevValue:c,newValue:b}}))},_get:function(a){return this[a]},emit:function(a,b,c){b=b||{};void 0===b.bubbles&&(b.bubbles=!0);void 0===b.cancelable&&(b.cancelable=!0);b.detail||(b.detail={});b.detail.widget=this;var d,e=this["on"+a];e&&
(d=e.apply(this,c?c:[b]));this._started&&!this._beingDestroyed&&q.emit(this.domNode,a.toLowerCase(),b);return d},on:function(a,b){var c=this._onMap(a);return c?m.after(this,c,b,!0):this.own(q(this.domNode,a,b))[0]},_onMap:function(a){var b=this.constructor,c=b._onMap;if(!c){var c=b._onMap={},d;for(d in b.prototype)/^on/.test(d)&&(c[d.replace(/^on/,"").toLowerCase()]=d)}return c["string"==typeof a&&a.toLowerCase()]},toString:function(){return"[Widget "+this.declaredClass+", "+(this.id||"NO ID")+"]"},
getChildren:function(){return this.containerNode?A.findWidgets(this.containerNode):[]},getParent:function(){return A.getEnclosingWidget(this.domNode.parentNode)},connect:function(a,b,d){return this.own(c.connect(a,b,this,d))[0]},disconnect:function(a){a.remove()},subscribe:function(a,b){return this.own(v.subscribe(a,r.hitch(this,b)))[0]},unsubscribe:function(a){a.remove()},isLeftToRight:function(){return this.dir?"ltr"==this.dir.toLowerCase():k.isBodyLtr(this.ownerDocument)},isFocusable:function(){return this.focus&&
"none"!=n.get(this.domNode,"display")},placeAt:function(a,c){var d=!a.tagName&&A.byId(a);!d||!d.addChild||c&&"number"!==typeof c?(a=d&&"domNode"in d?d.containerNode&&!/after|before|replace/.test(c||"")?d.containerNode:d.domNode:g.byId(a,this.ownerDocument),b.place(this.domNode,a,c),!this._started&&(this.getParent()||{})._started&&this.startup()):d.addChild(this,c);return this},defer:function(a,b){var c=setTimeout(r.hitch(this,function(){c&&(c=null,this._destroyed||r.hitch(this,a)())}),b||0);return{remove:function(){c&&
(clearTimeout(c),c=null);return null}}}});p("dojo-bidi")&&h.extend(w);return h})},"url:com/huayun/webgis/templates/searchs/polygonSearch.html":'\x3cdiv class\x3d"${baseClass}" style\x3d"pointer-events: all;"\x3e\r\n    \x3cdiv id\x3d"polyList" class\x3d"listView"\x3e\r\n        \x3cspan class\x3d"devTip"\x3e\u8bbe\u5907\u5217\u8868\x3c/span\x3e\r\n        \x3cdiv class\x3d"first"\x3e\r\n            \x3c!-- \x3cul id\x3d"simList" class\x3d"devView" data-dojo-attach-event\x3d"onclick:tabList"\x3e\x3c/ul\x3e --\x3e\r\n            \x3cul id\x3d"simList" class\x3d"devView" \x3e\x3c/ul\x3e\r\n        \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3c!-- \x3cdiv id\x3d"infoList" class\x3d"infoView"\x3e\r\n        \x3cspan class\x3d"infoTip"\x3e\u8bbe\u5907\u8be6\u60c5\u5217\u8868\x3c/span\x3e\r\n        \x3cdiv class\x3d"end"\x3e\r\n            \x3ctable id\x3d"tableInfoList" class\x3d"infoTableView"\x3e\x3c/table\x3e\r\n        \x3c/div\x3e\r\n        \x3cbutton id\x3d"closeBtn" class\x3d"closeShow" data-dojo-attach-event\x3d"onclick:closeShowAction"\x3e\u5173\u95ed\x3c/button\x3e\r\n    \x3c/div\x3e --\x3e\r\n\x3c/div\x3e',
"url:dijit/templates/MenuItem.html":'\x3ctr class\x3d"dijitReset" data-dojo-attach-point\x3d"focusNode" role\x3d"menuitem" tabIndex\x3d"-1"\x3e\n\t\x3ctd class\x3d"dijitReset dijitMenuItemIconCell" role\x3d"presentation"\x3e\n\t\t\x3cspan role\x3d"presentation" class\x3d"dijitInline dijitIcon dijitMenuItemIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\n\t\x3c/td\x3e\n\t\x3ctd class\x3d"dijitReset dijitMenuItemLabel" colspan\x3d"2" data-dojo-attach-point\x3d"containerNode,textDirNode"\n\t\trole\x3d"presentation"\x3e\x3c/td\x3e\n\t\x3ctd class\x3d"dijitReset dijitMenuItemAccelKey" style\x3d"display: none" data-dojo-attach-point\x3d"accelKeyNode"\x3e\x3c/td\x3e\n\t\x3ctd class\x3d"dijitReset dijitMenuArrowCell" role\x3d"presentation"\x3e\n\t\t\x3cspan data-dojo-attach-point\x3d"arrowWrapper" style\x3d"visibility: hidden"\x3e\n\t\t\t\x3cspan class\x3d"dijitInline dijitIcon dijitMenuExpand"\x3e\x3c/span\x3e\n\t\t\t\x3cspan class\x3d"dijitMenuExpandA11y"\x3e+\x3c/span\x3e\n\t\t\x3c/span\x3e\n\t\x3c/td\x3e\n\x3c/tr\x3e\n',
"url:com/huayun/webgis/templates/deviceResult.html":'\x3cdiv class\x3d"device-single"\x3e\r\n    \x3cdiv class\x3d"device-sequence"\x3e\r\n        \x3cspan\x3e${sequence}\x3c/span\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"device-detail"\x3e\r\n        \x3cdiv class\x3d"device-name"\x3e${name}\x3c/div\x3e\r\n        \x3cdiv class\x3d"device-district"\x3e[\u5355\u4f4d] : \x3c/div\x3e\r\n        \x3cdiv\x3e\r\n            \x3cbutton data-dojo-attach-event\x3d"onclick: locate"\x3e\u5b9a\u4f4d\x3c/button\x3e\x3c/div\x3e\r\n        \x3c/div\x3e\r\n\x3c/div\x3e',
"url:com/huayun/webgis/templates/deviceSearch.html":'\x3cdiv class\x3d"${baseClass}"\x3e\r\n    \x3cdiv class\x3d"title-container"\x3e\r\n        \x3cspan class\x3d"active" data-dojo-attach-event\x3d"onclick: switchSBD"\x3e\u8f93\u53d8\u7535\x3c/span\x3e\r\n        \x3cspan data-dojo-attach-event\x3d"onclick: switchPD"\x3e\u914d\u7535\x3c/span\x3e\r\n        \x3cspan data-dojo-attach-event\x3d"onclick: switchDY"\x3e\u4f4e\u538b\x3c/span\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"input-container"\x3e\r\n        \x3cdiv\x3e\r\n            \u8bbe\u5907\u7c7b\u578b: \x3cselect class\x3d"device-select" data-dojo-attach-point\x3d"selectNode"\x3e\x3c/select\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv\x3e\r\n            \u8bbe\u5907\u540d\u79f0: \x3cinput type\x3d"text" data-dojo-attach-point\x3d"searchName"\x3e\x3cbutton data-dojo-attach-event\x3d"onclick: search"\x3e\x3c/button\x3e\r\n        \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"result-container"\x3e\r\n        \x3cdiv class\x3d"device-result" \x3e\r\n            \u641c\u7d22\u7ed3\u679c \x3cspan class\x3d"count-result" data-dojo-attach-point\x3d"countResult"\x3e(0)\x3c/span\x3e\r\n            \x3cspan class\x3d"page-count" data-dojo-attach-point\x3d"pageResult"\x3e\r\n                \x3cbutton class\x3d"pre-page" data-dojo-attach-event\x3d"onclick: prePage"\x3e\x3c/button\x3e\r\n                \x3cspan data-dojo-attach-point\x3d"countPage"\x3e1/20\x3c/span\x3e\r\n                \x3cbutton class\x3d"next-page" data-dojo-attach-event\x3d"onclick: nextPage"\x3e\x3c/button\x3e\r\n            \x3c/span\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"searchResult"\x3e\r\n\r\n        \x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e\r\n\r\n',
"url:com/huayun/webgis/templates/gridLayerControl.html":'\x3cdiv class\x3d"${baseClass}" style\x3d"width: 100px;" data-dojo-attach-event\x3d"mouseover:_onMouseOverHandler,mouseout:_onMouseOutHandler"\x3e\r\n    \x3cdiv style\x3d"border:2px solid #EEEEEE;width: 52px;float:right;background: #EEEEEE" data-dojo-attach-event\x3d"onclick:_changeGridState"\x3e\r\n        \x3cdiv class\x3d"gridOpenIcon hidden" data-dojo-attach-point\x3d"openNode"\r\n             style\x3d"height: 27px;background-repeat: no-repeat;"\x3e\x3c/div\x3e\r\n        \x3cdiv class\x3d"gridCloseIcon hidden" data-dojo-attach-point\x3d"closeNode"\r\n             style\x3d"height: 27px;background-repeat: no-repeat;"\x3e\x3c/div\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"gridTxt" style\x3d"font-size: 1px;text-align: center"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e',
"url:com/huayun/webgis/templates/locatingController.html":'\x3cul class\x3d"${baseClass}" style\x3d"width:${width}px;pointer-events: all;"\x3e\r\n    \x3cli class\x3d"locating-item"\x3e\r\n        \x3clabel class\x3d"item-label" for\x3d"point"\x3e\u5750\u6807(\u70b9)\x3c/label\x3e\r\n        \x3cinput id\x3d"point" type\x3d"text" value\x3d"${inputDefaultValue.point}"\x3e\r\n        \x3cspan class\x3d"btn locate-btn" data-dojo-attach-event\x3d"onclick:locateOnPoint"\x3e\x3c/span\x3e\r\n        \x3cspan class\x3d"btn clear-btn" data-dojo-attach-event\x3d"onclick:clearLocating"\x3e\x3c/span\x3e\r\n    \x3c/li\x3e\r\n    \x3cli class\x3d"locating-item"\x3e\r\n        \x3clabel class\x3d"item-label" for\x3d"points"\x3e\u5750\u6807(\u591a\u70b9)\x3c/label\x3e\r\n        \x3cinput id\x3d"points" type\x3d"text" value\x3d"${inputDefaultValue.points}"\x3e\r\n        \x3cspan class\x3d"btn locate-btn" data-dojo-attach-event\x3d"onclick:locateOnPoints"\x3e\x3c/span\x3e\r\n        \x3cspan class\x3d"btn clear-btn" data-dojo-attach-event\x3d"onclick:clearLocating"\x3e\x3c/span\x3e\r\n    \x3c/li\x3e\r\n\r\n    \x3cli class\x3d"locating-item"\x3e\r\n        \x3clabel class\x3d"item-label" for\x3d"line"\x3e\u5750\u6807(\u7ebf)\x3c/label\x3e\r\n        \x3cinput id\x3d"line" type\x3d"text" value\x3d"${inputDefaultValue.line}" \x3e\r\n        \x3cspan class\x3d"btn locate-btn" data-dojo-attach-event\x3d"onclick:locateOnLineString"\x3e\x3c/span\x3e\r\n        \x3cspan class\x3d"btn clear-btn" data-dojo-attach-event\x3d"onclick:clearLocating"\x3e\x3c/span\x3e\r\n    \x3c/li\x3e\r\n    \x3c!--\r\n   \x3cli class\x3d"locating-item"\x3e\r\n       \x3clabel class\x3d"item-label" for\x3d"lines"\x3e\u5750\u6807(\u591a\u7ebf)\x3c/label\x3e\x3cinput id\x3d"lines" type\x3d"text" value\x3d"${inputDefaultValue.lines}"\x3e\r\n       \x3cspan class\x3d"btn" data-dojo-attach-event\x3d"onclick:locateOnLinesString"\x3e\u5b9a\u4f4d\x3c/span\x3e\x3cspan class\x3d"btn"\r\n                                                                                                data-dojo-attach-event\x3d"onclick:clearLocating"\x3e\u6e05\u9664\x3c/span\x3e\r\n   \x3c/li\x3e\r\n   --\x3e\r\n    \x3cli class\x3d"locating-item"\x3e\r\n        \x3clabel class\x3d"item-label"\x3e\u5750\u6807(\u9762)\x3c/label\x3e\r\n        \x3cinput id\x3d"plane" type\x3d"text" value\x3d"${inputDefaultValue.plane}"\x3e\r\n        \x3cspan class\x3d"btn locate-btn" data-dojo-attach-event\x3d"onclick:locateInPolygon"\x3e\x3c/span\x3e\r\n        \x3cspan class\x3d"btn clear-btn" data-dojo-attach-event\x3d"onclick:clearLocating"\x3e\x3c/span\x3e\r\n    \x3c/li\x3e\r\n\x3c/ul\x3e',
"url:dijit/templates/Menu.html":'\x3ctable class\x3d"dijit dijitMenu dijitMenuPassive dijitReset dijitMenuTable" role\x3d"menu" tabIndex\x3d"${tabIndex}"\n\t   cellspacing\x3d"0"\x3e\n\t\x3ctbody class\x3d"dijitReset" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/tbody\x3e\n\x3c/table\x3e\n',"url:dijit/templates/TreeNode.html":'\x3cdiv class\x3d"dijitTreeNode" role\x3d"presentation"\n\t\x3e\x3cdiv data-dojo-attach-point\x3d"rowNode" class\x3d"dijitTreeRow" role\x3d"presentation"\n\t\t\x3e\x3cspan data-dojo-attach-point\x3d"expandoNode" class\x3d"dijitInline dijitTreeExpando" role\x3d"presentation"\x3e\x3c/span\n\t\t\x3e\x3cspan data-dojo-attach-point\x3d"expandoNodeText" class\x3d"dijitExpandoText" role\x3d"presentation"\x3e\x3c/span\n\t\t\x3e\x3cspan data-dojo-attach-point\x3d"contentNode"\n\t\t\tclass\x3d"dijitTreeContent" role\x3d"presentation"\x3e\n\t\t\t\x3cspan role\x3d"presentation" class\x3d"dijitInline dijitIcon dijitTreeIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\n\t\t\t\x3e\x3cspan data-dojo-attach-point\x3d"labelNode,focusNode" class\x3d"dijitTreeLabel" role\x3d"treeitem"\n\t\t\t\t   tabindex\x3d"-1" aria-selected\x3d"false" id\x3d"${id}_label"\x3e\x3c/span\x3e\n\t\t\x3c/span\n\t\x3e\x3c/div\x3e\n\t\x3cdiv data-dojo-attach-point\x3d"containerNode" class\x3d"dijitTreeNodeContainer" role\x3d"presentation"\n\t\t style\x3d"display: none;" aria-labelledby\x3d"${id}_label"\x3e\x3c/div\x3e\n\x3c/div\x3e\n',
"url:com/huayun/webgis/templates/searchs/rectSearch.html":'\x3cdiv class\x3d"${baseClass}" style\x3d"pointer-events: all;"\x3e\r\n    \x3cdiv id\x3d"rectList" class\x3d"listView"\x3e\r\n        \x3cspan class\x3d"devTip"\x3e\u8bbe\u5907\u5217\u8868\x3c/span\x3e\r\n        \x3cdiv class\x3d"first"\x3e\r\n            \x3c!-- \x3cul id\x3d"rectExList" class\x3d"devView" data-dojo-attach-event\x3d"onclick:rectTabList"\x3e\x3c/ul\x3e --\x3e\r\n            \x3cul id\x3d"rectExList" class\x3d"devView"\x3e\x3c/ul\x3e\r\n        \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3c!-- \x3cdiv id\x3d"rectMoreInfo" class\x3d"infoView"\x3e\r\n        \x3cspan class\x3d"infoTip"\x3e\u8bbe\u5907\u8be6\u60c5\u5217\u8868\x3c/span\x3e\r\n        \x3cdiv class\x3d"end"\x3e\r\n            \x3ctable id\x3d"rectInfoList" class\x3d"infoTableView"\x3e\x3c/table\x3e\r\n        \x3c/div\x3e\r\n        \x3cbutton id\x3d"rectCloseBtn" class\x3d"closeShow" data-dojo-attach-event\x3d"onclick:closeRectShow"\x3e\u5173\u95ed\x3c/button\x3e\r\n    \x3c/div\x3e --\x3e\r\n\x3c/div\x3e',
"url:com/huayun/webgis/templates/deviceTree.html":'\x3cdiv class\x3d"device-tree-panel"\x3e\r\n    \x3cbutton data-dojo-attach-event\x3d"onclick: clear"\x3e\x3c/button\x3e\r\n    \x3cdiv class\x3d"device-tree-content"\x3e\r\n        \x3cdiv data-dojo-attach-point \x3d"deviceTreeNode"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e',"url:dijit/templates/Tree.html":'\x3cdiv role\x3d"tree"\x3e\n\t\x3cdiv class\x3d"dijitInline dijitTreeIndent" style\x3d"position: absolute; top: -9999px" data-dojo-attach-point\x3d"indentDetector"\x3e\x3c/div\x3e\n\t\x3cdiv class\x3d"dijitTreeExpando dijitTreeExpandoLoading" data-dojo-attach-point\x3d"rootLoadingIndicator"\x3e\x3c/div\x3e\n\t\x3cdiv data-dojo-attach-point\x3d"containerNode" class\x3d"dijitTreeContainer" role\x3d"presentation"\x3e\n\t\x3c/div\x3e\n\x3c/div\x3e\n',
"url:com/huayun/webgis/templates/searchs/reactionSearch.html":'\x3cdiv class\x3d"${baseClass}"  style\x3d"pointer-events: all;"\x3e\r\n    \x3cdiv id\x3d"showList" class\x3d"listView" \x3e\r\n        \x3cspan class\x3d"devTip"\x3e\u8bbe\u5907\u5217\u8868\x3c/span\x3e\r\n        \x3cdiv class\x3d"first"\x3e\r\n            \x3cul id\x3d"devList" class\x3d"devView" data-dojo-attach-event\x3d"onclick:isMessage"\x3e\x3c/ul\x3e\r\n        \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv id\x3d"devMoreInfo" class\x3d"infoView"\x3e\r\n        \x3cspan class\x3d"infoTip"\x3e\u8bbe\u5907\u8be6\u60c5\u5217\u8868\x3c/span\x3e\r\n        \x3cdiv class\x3d"end"\x3e\r\n            \x3ctable id\x3d"moreInfoList" class\x3d"infoTableView"\x3e\x3c/table\x3e\r\n        \x3c/div\x3e\r\n        \x3cbutton id\x3d"closeShow" class\x3d"closeShow" data-dojo-attach-event\x3d"onclick:closeMoreInfo"\x3e\u5173\u95ed\x3c/button\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e',
"url:com/huayun/widget/templates/ModuleX.html":"\x3cdiv\x3e\r\n\x3c/div\x3e"}});(function(){var f=this.require;f({cache:{}});!f.async&&f(["dojo"]);f.boot&&f.apply(null,f.boot)})();